<VirtualHost *:80>
    # [...]
    ServerName localhost
    DocumentRoot %TRAVIS_BUILD_DIR%/public

    <Directory "%TRAVIS_BUILD_DIR%/public">
        Options Indexes Includes FollowSymLinks ExecCGI
        AllowOverride All
        Require all granted
        # Generates a 503 error (though apache seems to be 2.14.18, so it shoudl work)
        # CGIPassAuth On
    </Directory>

    #to test : if adding this, get a 503 error
    # SetEnvIf Authorization "(.*)" HTTP_AUTHORIZATION=$1
    # SetEnvIf Content-Type "(.*)" HTTP_CONTENT_TYPE=$1
    # SetEnvIf Accept "(.*)" HTTP_ACCEPT=$1      
     
    SetEnv proxy-chain-auth On
    
    
    <FilesMatch \.php$>
        # this seems to work but Authorization header is missing
        SetHandler  "proxy:fcgi://localhost:9000"        
    </FilesMatch>  

    
# This leads to a 500 internal error    
    # Wire up Apache to use Travis CI's php-fpm.
#    <IfModule mod_fastcgi.c>
#        AddHandler php5-fcgi .php
#        Action php5-fcgi /php5-fcgi
#        Alias /php5-fcgi /usr/lib/cgi-bin/php5-fcgi
#        FastCgiExternalServer /usr/lib/cgi-bin/php5-fcgi -host 127.0.0.1:9000 -pass-header Authorization

#        # ScriptAlias /cgi-bin/ /usr/lib/cgi-bin/

#        <Directory /usr/lib/cgi-bin>
#            Require all granted
#        </Directory>    
#    </IfModule>

    ErrorLog "%TRAVIS_BUILD_DIR%/apache-error.log" 
    CustomLog "%TRAVIS_BUILD_DIR%/apache-access.log" combined

  # [...]
</VirtualHost>