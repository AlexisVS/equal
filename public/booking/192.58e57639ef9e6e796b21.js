(self.webpackChunksymbiose=self.webpackChunksymbiose||[]).push([[192],{4192:(t,n,e)=>{"use strict";e.r(n),e.d(n,{AppInPlanningModule:()=>E});var o=e(2458),i=e(521),s=e(7430),a=e(6947),r=e(3423),c=e(4762);class d{constructor(t=0,n=0,e=0,o=0,i=new Date,s=new Date,a=new Date,r=0,c="",d="",h=0,g="",l="",p=[]){this.id=t,this.booking_line_id=n,this.rental_unit_id=e,this.capacity=o,this.date=i,this.date_from=s,this.date_to=a,this.nb_nights=r,this.booking_ref=c,this.booking_status=d,this.booking_customer_id=h,this.booking_customer_name=g,this.booking_payment_status=l,this.booking_contacts_ids=p}}var h=e(7716);class g{constructor(){this.headDaysAll=[],this.headDays1=[],this.headDays2=[],this.months=[]}}class l{constructor(t,n,e,o,i=new Date,s=new Date,a=0){this.type=t,this.operation=n,this.capacity=e,this.days=o,this.date_from=i,this.date_to=s,this.center_id=a}}var p=e(8295),_=e(7441),u=e(3679),f=e(8583),y=e(3220),m=e(3166),C=e(1095),O=e(6627),b=e(9790);function M(t,n){if(1&t&&(h.TgZ(0,"mat-option",13),h._uU(1),h.qZA()),2&t){const t=n.$implicit;h.Q6J("value",t.id),h.xp6(1),h.Oqu(t.name)}}let x=(()=>{class t{constructor(t,n,e){this.api=t,this.auth=n,this.zone=e,this.changedays=new h.vpe,this.capacity="0",this.center_id=0,this.view_range=15,this.centers=[]}ngOnInit(){this.type="month";const t=+this.capacity;this.currymd=new Date(this.year,this.month-1,1),this.datpicker=new Date(this.currymd),this.hd=this.createHeaderDays();const n=new l(this.type,"init",t,this.hd);this.changedays.emit(n),this.auth.getObservable().subscribe(t=>(0,c.mG)(this,void 0,void 0,function*(){if(t.hasOwnProperty("centers_ids")&&t.centers_ids.length)try{const n=yield this.api.collect("lodging\\identity\\Center",["id","in",t.centers_ids],["id","name","code"]);n.length&&this.zone.run(()=>{this.centers=n,this.center_id=n[0].id,this.changeDays(this.type,"refresh")})}catch(n){console.warn(n)}}))}onCapacityChange(t){this.capacity=t.value,this.changeDays(this.type,"refresh")}onCenterChange(t){this.center_id=t.value,this.changeDays(this.type,"refresh")}onViewChange(){this.changeDays(this.type,"refresh")}onToday(){this.type="month";let t=new Date;t.setDate(1),this.currymd=new Date(t),this.changeDays(this.type,"refresh")}onPrev(){this.currymd=(t=>{let n=new Date(this.currymd);return n.setDate(1),n.setMonth(n.getMonth()-1),n})(),this.changeDays(this.type,"prev")}onNext(){this.currymd=(t=>{let n=new Date(this.currymd);return n.setDate(1),n.setMonth(n.getMonth()+1),n})(),this.changeDays(this.type,"next")}onPickerChange(t){console.log(t),this.type="month";const n=new Date(t.value);n.setDate(1),this.currymd=new Date(n),this.changeDays(this.type,"refresh")}changeDays(t,n){console.log("relaying changes"),this.datpicker=new Date(this.currymd),this.hd=this.createHeaderDays();const e=new l(t,n,+this.capacity,this.hd,this.hd.date_from,this.hd.date_to,this.center_id);this.changedays.emit(e)}createHeaderDays(){const t=new g;let n=new Date(this.currymd);const e=n.getDate();let o=(i=n,new Date(i.getFullYear(),i.getMonth()+1,0).getDate());var i;let s=1===e?o:31;for(let r=0;r<s;r++)r>0&&(n=(t=>{let n=new Date(t);return n.setDate(n.getDate()+1),n})(n)),t.headDaysAll.push(n);t.date_from=t.headDaysAll[0],t.date_to=t.headDaysAll[t.headDaysAll.length-1];const a=t.headDaysAll[0].getMonth();for(const r of t.headDaysAll)r.getMonth()===a?t.headDays1.push(r):t.headDays2.push(r);return t.headDays1.length>0&&t.months.push({date:t.headDays1[0],days:t.headDays1.length}),t.headDays2.length>0&&t.months.push({date:t.headDays2[0],days:t.headDays2.length}),t}}return t.\u0275fac=function(n){return new(n||t)(h.Y36(a.sM),h.Y36(a.Tq),h.Y36(h.R0b))},t.\u0275cmp=h.Xpm({type:t,selectors:[["planning-calendar-navbar"]],inputs:{day:"day",month:"month",year:"year"},outputs:{changedays:"changedays"},decls:30,vars:17,consts:[[1,"containerNavigationBar"],[1,"panelFilters"],[3,"ngModel","disableOptionCentering","ngModelChange","selectionChange"],[3,"value",4,"ngFor","ngForOf"],[1,"panelStatus"],[2,"line-height","70px"],[2,"position","absolute","visibility","hidden","margin-left","-260px"],["matSuffix","",3,"for"],["picker",""],["matInput","","name","datpicker",3,"matDatepicker","ngModel","dateChange"],["mat-icon-button","",3,"click"],[1,"panelNavigation"],["mat-button","",3,"click"],[3,"value"]],template:function(t,n){if(1&t){const t=h.EpF();h.TgZ(0,"div",0),h.TgZ(1,"div",1),h.TgZ(2,"div"),h.TgZ(3,"mat-form-field"),h.TgZ(4,"mat-select",2),h.NdJ("ngModelChange",function(t){return n.center_id=t})("selectionChange",function(t){return n.onCenterChange(t)}),h.YNc(5,M,2,2,"mat-option",3),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.TgZ(6,"div",4),h.TgZ(7,"div",5),h._uU(8),h.ALo(9,"date"),h.ALo(10,"date"),h.qZA(),h.TgZ(11,"div"),h.TgZ(12,"mat-form-field",6),h._UZ(13,"mat-datepicker-toggle",7),h._UZ(14,"mat-datepicker",null,8),h.TgZ(16,"input",9),h.NdJ("dateChange",function(t){return n.onPickerChange(t)}),h.qZA(),h.qZA(),h.TgZ(17,"button",10),h.NdJ("click",function(){return h.CHM(t),h.MAs(15).open()}),h.TgZ(18,"mat-icon"),h._uU(19,"calendar_today"),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.TgZ(20,"div",11),h.TgZ(21,"button",10),h.NdJ("click",function(){return n.onPrev()}),h.TgZ(22,"mat-icon"),h._uU(23,"chevron_left"),h.qZA(),h.qZA(),h.TgZ(24,"button",12),h.NdJ("click",function(){return n.onToday()}),h._uU(25),h.ALo(26,"translate"),h.qZA(),h.TgZ(27,"button",10),h.NdJ("click",function(){return n.onNext()}),h.TgZ(28,"mat-icon"),h._uU(29,"chevron_right"),h.qZA(),h.qZA(),h.qZA(),h.qZA()}if(2&t){const t=h.MAs(15);h.xp6(4),h.Q6J("ngModel",n.center_id)("disableOptionCentering",!0),h.xp6(1),h.Q6J("ngForOf",n.centers),h.xp6(3),h.AsE("",h.xi3(9,9,n.hd.date_from,"d MMM y")," - ",h.xi3(10,12,n.hd.date_to,"d MMM y"),""),h.xp6(5),h.Q6J("for",t),h.xp6(3),h.Q6J("matDatepicker",t)("ngModel",n.datpicker),h.xp6(9),h.Oqu(h.lcZ(26,15,"BOOKING_PLANNING_HEADER_TODAY"))}},directives:[p.KE,_.gD,u.JJ,u.On,f.sg,y.nW,p.R9,y.Mq,m.Nt,y.hl,u.Fj,C.lW,O.Hw,o.ey],pipes:[f.uU,b.X$],styles:["[_nghost-%COMP%]{display:block;padding:0 15px}[_nghost-%COMP%]   .containerNavigationBar[_ngcontent-%COMP%]{display:flex;height:75px}[_nghost-%COMP%]   .panelFilters[_ngcontent-%COMP%]{flex:1 0 33%;display:flex}[_nghost-%COMP%]   .panelStatus[_ngcontent-%COMP%]{display:flex;line-height:65px;flex:1 0 33%;text-align:center;font-size:20px;font-weight:500}[_nghost-%COMP%]   .panelStatus[_ngcontent-%COMP%]   .mat-datepicker-popup[_ngcontent-%COMP%]{position:relative;top:110px}[_nghost-%COMP%]   .panelNavigation[_ngcontent-%COMP%]{line-height:65px;flex:1 0 33%;text-align:right}[_nghost-%COMP%]   .panelSearch[_ngcontent-%COMP%]{line-height:65px;display:inline-block}[_nghost-%COMP%]   .panelDatePicker[_ngcontent-%COMP%]{display:inline-block}[_nghost-%COMP%]   .mat-datepicker-popup[_ngcontent-%COMP%]{position:relative;top:110px}[_nghost-%COMP%]   .containerStatusbar[_ngcontent-%COMP%]{height:20px}[_nghost-%COMP%]   .panelStatusbar[_ngcontent-%COMP%]{display:inline-block}"]}),t})();var Z=e(2238);function w(t,n){if(1&t){const t=h.EpF();h.TgZ(0,"div",11),h.TgZ(1,"div",12),h._uU(2),h.TgZ(3,"b"),h._uU(4),h.qZA(),h.qZA(),h.TgZ(5,"div",13),h.TgZ(6,"a",14),h._uU(7),h.qZA(),h.qZA(),h.TgZ(8,"div",12),h.TgZ(9,"a",14),h._uU(10),h.qZA(),h.qZA(),h.TgZ(11,"div",15),h.TgZ(12,"button",1),h.NdJ("click",function(){const n=h.CHM(t).$implicit;return h.oxw().onShowContact(n.id)}),h.TgZ(13,"mat-icon"),h._uU(14,"open_in_new"),h.qZA(),h.qZA(),h.qZA(),h.qZA()}if(2&t){const t=n.$implicit;h.xp6(2),h.hij("",t.name," "),h.xp6(2),h.hij("(","booking"==t.type?"r\xe9sa":"sojourn"==t.type?"s\xe9jour":"invoice"==t.type?"facture":"contract"==t.type?"contrat":"",")"),h.xp6(2),h.MGl("href","mailto:",t.partner_identity_id.email,"",h.LSH),h.xp6(1),h.Oqu(t.partner_identity_id.email),h.xp6(2),h.MGl("href","tel:",t.partner_identity_id.phone,"",h.LSH),h.xp6(1),h.Oqu(t.partner_identity_id.phone)}}class k{constructor(t=0,n="",e=""){this.id=t,this.name=n,this.type=e}}let P=(()=>{class t{constructor(t,n,e){this.dialog=t,this.api=n,this.booking=e,this.contacts=[],console.log(e)}load(){return(0,c.mG)(this,void 0,void 0,function*(){try{const t=yield this.api.collect("sale\\booking\\Contact",[["id","in",this.booking.booking_contacts_ids]],["partner_identity_id.email","partner_identity_id.phone",...Object.getOwnPropertyNames(new k)],"id","asc",0,3);this.contacts=t}catch(t){console.warn(t)}})}ngOnInit(){return(0,c.mG)(this,void 0,void 0,function*(){yield this.load()})}onClose(){this.dialog.close()}onShowBooking(t){this.dialog.close({open:"booking",id:t})}onShowCustomer(t){this.dialog.close({open:"customer",id:t})}onShowContact(t){this.dialog.close({open:"contact",id:t})}}return t.\u0275fac=function(n){return new(n||t)(h.Y36(Z.so),h.Y36(a.sM),h.Y36(Z.WI))},t.\u0275cmp=h.Xpm({type:t,selectors:[["planning-dialog-booking"]],decls:37,vars:11,consts:[["mat-dialog-title",""],["mat-icon-button","",3,"click"],["mat-dialog-content",""],[1,"row"],[1,"row-cell","row-title"],[1,"row-cell"],[2,"display","flex"],[1,"row-cell",2,"margin-top","5px"],["class","item-contact",4,"ngFor","ngForOf"],["mat-dialog-actions",""],["mat-raised-button","","color","primary",3,"click"],[1,"item-contact"],[1,"contact-cell",2,"flex","0 1 30%"],[1,"contact-cell",2,"flex","0 1 40%"],[3,"href"],[2,"margin-top","-7px","width","30px"]],template:function(t,n){1&t&&(h.TgZ(0,"h2",0),h._uU(1,"Reservation "),h.TgZ(2,"small"),h._uU(3),h.qZA(),h.TgZ(4,"button",1),h.NdJ("click",function(){return n.onShowBooking(n.booking.id)}),h.TgZ(5,"mat-icon"),h._uU(6,"open_in_new"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(7,"div",2),h.TgZ(8,"div",3),h.TgZ(9,"div",4),h._uU(10,"Du"),h.qZA(),h.TgZ(11,"div",5),h._uU(12),h.ALo(13,"date"),h.qZA(),h.qZA(),h.TgZ(14,"div",3),h.TgZ(15,"div",4),h._uU(16,"Au"),h.qZA(),h.TgZ(17,"div",5),h._uU(18),h.ALo(19,"date"),h.qZA(),h.qZA(),h.TgZ(20,"div",3),h.TgZ(21,"div",4),h._uU(22,"Client"),h.qZA(),h.TgZ(23,"div",5),h.TgZ(24,"div",6),h._uU(25),h.TgZ(26,"button",1),h.NdJ("click",function(){return n.onShowCustomer(n.booking.booking_customer_id)}),h.TgZ(27,"mat-icon"),h._uU(28,"open_in_new"),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.TgZ(29,"div",3),h.TgZ(30,"div",4),h._uU(31,"Contacts"),h.qZA(),h.TgZ(32,"div",7),h.YNc(33,w,15,6,"div",8),h.qZA(),h.qZA(),h.qZA(),h.TgZ(34,"div",9),h.TgZ(35,"button",10),h.NdJ("click",function(){return n.onClose()}),h._uU(36,"Ok"),h.qZA(),h.qZA()),2&t&&(h.xp6(3),h.hij("[",n.booking.booking_ref,"]"),h.xp6(9),h.Oqu(h.xi3(13,5,n.booking.date_from,"fullDate")),h.xp6(6),h.Oqu(h.xi3(19,8,n.booking.date_to,"fullDate")),h.xp6(7),h.hij("",n.booking.booking_customer_name," "),h.xp6(8),h.Q6J("ngForOf",n.contacts))},directives:[Z.uh,C.lW,O.Hw,Z.xY,f.sg,Z.H8],pipes:[f.uU],styles:["[_nghost-%COMP%]{min-height:450px}[_nghost-%COMP%]   .mat-dialog-title[_ngcontent-%COMP%]{height:50px}[_nghost-%COMP%]   .mat-dialog-content[_ngcontent-%COMP%]{height:calc(100% - 114px);max-height:-webkit-fit-content;max-height:-moz-fit-content;max-height:fit-content}[_nghost-%COMP%]   .mat-dialog-actions[_ngcontent-%COMP%]{height:50px}[_nghost-%COMP%]   .mat-dialog-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-left:auto}[_nghost-%COMP%]   .mat-icon-button[_ngcontent-%COMP%]{transform:scale(.8)}[_nghost-%COMP%]   .row[_ngcontent-%COMP%]{height:45px;display:flex}[_nghost-%COMP%]   .row[_ngcontent-%COMP%]   .row-cell[_ngcontent-%COMP%]{display:block;width:100%;line-height:40px}[_nghost-%COMP%]   .row[_ngcontent-%COMP%]   .row-cell[_ngcontent-%COMP%]   .item-contact[_ngcontent-%COMP%]{display:flex;height:30px}[_nghost-%COMP%]   .row[_ngcontent-%COMP%]   .row-cell[_ngcontent-%COMP%]   .item-contact[_ngcontent-%COMP%]   .contact-cell[_ngcontent-%COMP%]{flex:1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;line-height:30px}[_nghost-%COMP%]   .row[_ngcontent-%COMP%]   .row-title[_ngcontent-%COMP%]{font-weight:500;width:110px}"]}),t})();function v(t,n){if(1&t&&(h.TgZ(0,"div",6),h.TgZ(1,"div",7),h.TgZ(2,"div",8),h._uU(3),h.qZA(),h.TgZ(4,"div",9),h._uU(5),h.qZA(),h.qZA(),h.TgZ(6,"div",7),h.TgZ(7,"div",8),h._uU(8),h.qZA(),h.TgZ(9,"div",9),h._uU(10),h.qZA(),h.qZA(),h.qZA()),2&t){const t=h.oxw(2);h.Udp("background-color",t.color),h.xp6(3),h.Oqu(t.booking.booking_ref),h.xp6(2),h.Oqu(t.booking.booking_status),h.xp6(3),h.Oqu(t.booking.booking_customer_name),h.xp6(2),h.Oqu(t.booking.booking_payment_status)}}function A(t,n){if(1&t){const t=h.EpF();h.TgZ(0,"div",4),h.NdJ("click",function(){h.CHM(t);const n=h.oxw();return n.onShowBooking(n.booking)}),h.YNc(1,v,11,6,"div",5),h.qZA()}if(2&t){const t=h.oxw();h.xp6(1),h.Q6J("ngIf",t.is_first)}}function q(t,n){1&t&&h._UZ(0,"div",10)}let T=(()=>{class t{constructor(t,n,e){this.elementRef=t,this.dialog=n,this.context=e,this.is_weekend=!1,this.is_today=!1,this.is_first=!1}ngOnInit(){}ngOnChanges(t){t.booking&&this.datasourceChanged()}datasourceChanged(){var t;this.is_first=!1,this.is_today=(t=>{const n=new Date;return t.getDate()==n.getDate()&&t.getMonth()==n.getMonth()&&t.getFullYear()==n.getFullYear()})(this.day),this.is_weekend=0==(t=this.day).getDay()||6==t.getDay(),this.booking&&(this.is_first=this.booking.date_from.getDate()==this.day.getDate()&&this.booking.date_from.getMonth()==this.day.getMonth(),this.elementRef.nativeElement.style.setProperty("--duration",this.booking.nb_nights+1))}onShowBooking(t){this.dialog.open(P,{data:t,width:"800px",height:"450px"}).afterClosed().subscribe(t=>{if(t&&t.hasOwnProperty("open"))switch(t.open){case"booking":this.onOpenBooking(t.id);break;case"customer":this.onOpenCustomer(t.id);break;case"contact":this.onOpenContact(t.id)}})}onOpenBooking(t){this.context.change({context:{entity:"lodging\\sale\\booking\\Booking",type:"form",name:"default",domain:["id","=",t],mode:"view",purpose:"view",target:"#sb-planning-container"}})}onOpenCustomer(t){this.context.change({context:{entity:"sale\\customer\\Customer",type:"form",name:"default",domain:["id","=",t],mode:"view",purpose:"view",target:"#sb-planning-container"}})}onOpenContact(t){this.context.change({context:{entity:"sale\\booking\\Contact",type:"form",name:"default",domain:["id","=",t],mode:"view",purpose:"view",target:"#sb-planning-container"}})}}return t.\u0275fac=function(n){return new(n||t)(h.Y36(h.SBq),h.Y36(Z.uw),h.Y36(a.Ob))},t.\u0275cmp=h.Xpm({type:t,selectors:[["planning-calendar-booking"]],inputs:{color:"color",day:"day",booking:"booking"},features:[h.TTD],decls:6,vars:10,consts:[[1,"reservedBox"],[1,"reservedBoxBg"],["style","height: 100%; position: relative;",3,"click",4,"ngIf"],["class","is-today",4,"ngIf"],[2,"height","100%","position","relative",3,"click"],["class","booking-details",3,"background-color",4,"ngIf"],[1,"booking-details"],[2,"display","flex"],[2,"flex","0 1 20%"],[2,"margin-left","auto"],[1,"is-today"]],template:function(t,n){1&t&&(h.TgZ(0,"div",0),h.TgZ(1,"div",1),h._uU(2),h.ALo(3,"date"),h.qZA(),h.YNc(4,A,2,1,"div",2),h.YNc(5,q,1,0,"div",3),h.qZA()),2&t&&(h.ekj("is-weekend",n.is_weekend),h.xp6(1),h.ekj("invert",n.booking),h.xp6(1),h.hij(" ",h.xi3(3,7,n.day,"d")," "),h.xp6(2),h.Q6J("ngIf",n.booking),h.xp6(1),h.Q6J("ngIf",n.is_today))},directives:[f.O5],pipes:[f.uU],styles:[".reservedBox[_ngcontent-%COMP%]{position:relative;height:45px}.reservedBox.is-weekend[_ngcontent-%COMP%]{background-color:#0000000d}.reservedBoxBg[_ngcontent-%COMP%]{position:absolute;font-size:12px;height:100%;width:100%;line-height:45px}.reservedBoxBg.invert[_ngcontent-%COMP%]{color:#fff}tr.rows:not(:hover)[_nghost-%COMP%]   .reservedBoxBg[_ngcontent-%COMP%], tr.rows:not(:hover)   [_nghost-%COMP%]   .reservedBoxBg[_ngcontent-%COMP%]{display:none}tr.rows:hover[_nghost-%COMP%]   .reservedBoxBg[_ngcontent-%COMP%], tr.rows:hover   [_nghost-%COMP%]   .reservedBoxBg[_ngcontent-%COMP%]{display:block}.booking-details[_ngcontent-%COMP%]{position:absolute;width:calc(100% * var(--duration));height:100%;left:0;top:0;color:#fff;z-index:1;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;-webkit-user-select:none;user-select:none;cursor:pointer;padding:0 2px}.is-today[_ngcontent-%COMP%]{position:absolute;background:#ff4500;width:100%;height:calc(100% + 4px);top:-2px;width:2px;left:50%;z-index:-1}"]}),t})();function D(t,n){if(1&t&&(h.TgZ(0,"td",9),h._uU(1),h.ALo(2,"date"),h.qZA()),2&t){const t=n.$implicit,e=h.oxw();h.Udp("width",100/e.headerdays.months.length+"%"),h.uIk("colspan",t.days),h.xp6(1),h.hij(" ",h.xi3(2,4,t.date,"MMMM y")," ")}}function U(t,n){if(1&t&&(h.TgZ(0,"th",10),h.TgZ(1,"span",11),h._uU(2),h.ALo(3,"date"),h.qZA(),h._UZ(4,"br"),h._uU(5),h.ALo(6,"date"),h.qZA()),2&t){const t=n.$implicit;h.xp6(2),h.Oqu(h.xi3(3,2,t,"EEE")),h.xp6(3),h.hij(" ",h.xi3(6,5,t,"d")," ")}}function N(t,n){if(1&t&&(h.TgZ(0,"th",10),h._uU(1),h.ALo(2,"date"),h._UZ(3,"br"),h._uU(4),h.ALo(5,"date"),h.qZA()),2&t){const t=n.$implicit;h.xp6(1),h.hij(" ",h.xi3(2,2,t,"EEE"),""),h.xp6(3),h.hij(" ",h.xi3(5,5,t,"d")," ")}}function F(t,n){if(1&t&&(h.TgZ(0,"td"),h._UZ(1,"planning-calendar-booking",15),h.qZA()),2&t){const t=n.$implicit,e=h.oxw(),o=e.index,i=e.$implicit,s=h.oxw();h.xp6(1),h.Q6J("color",s.colors[o%s.colors.length])("day",t)("booking",s.getBooking(i,t))}}function B(t,n){if(1&t&&(h.TgZ(0,"tr",12),h.TgZ(1,"td",13),h._uU(2),h.qZA(),h._UZ(3,"td",13),h.YNc(4,F,2,3,"td",14),h.qZA()),2&t){const t=n.$implicit,e=h.oxw();h.xp6(2),h.Oqu(t.name),h.xp6(2),h.Q6J("ngForOf",e.headerdays.headDaysAll)}}let J=(()=>{class t{constructor(){this.rental_units=new Array,this.bookings=new Array,this.filters=new h.vpe,this.colors=["#ff9633","#0fc4a7","#0288d1","#9575cd","#C80651"]}get currentYMD(){return this.navbar.currymd}ngOnInit(){}onFiltersChange(t){this.headerdays=t.days,this.filters.emit(t)}getBooking(t,n){let e=this.bookings.filter(e=>e.rental_unit_id==t.id&&e.date.getMonth()==n.getMonth()&&e.date.getDate()==n.getDate());return e.length?e[0]:null}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=h.Xpm({type:t,selectors:[["planning-calendar"]],viewQuery:function(t,n){if(1&t&&h.Gf(x,5),2&t){let t;h.iGM(t=h.CRH())&&(n.navbar=t.first)}},inputs:{year:"year",month:"month",day:"day",rental_units:"rental_units",bookings:"bookings"},outputs:{filters:"filters"},decls:16,vars:7,consts:[[3,"day","month","year","changedays"],[1,"container"],[1,"tabreservation"],[1,"head"],["rowspan","2",1,"cell-room",2,"min-width","100px"],["rowspan","2",1,"cell-room"],["class","head-months",3,"width",4,"ngFor","ngForOf"],["class","head-days",4,"ngFor","ngForOf"],["class","rows",4,"ngFor","ngForOf"],[1,"head-months"],[1,"head-days"],[2,"font-weight","400"],[1,"rows"],[1,"cell-room"],[4,"ngFor","ngForOf"],[3,"color","day","booking"]],template:function(t,n){1&t&&(h.TgZ(0,"div"),h.TgZ(1,"planning-calendar-navbar",0),h.NdJ("changedays",function(t){return n.onFiltersChange(t)}),h.qZA(),h.qZA(),h.TgZ(2,"div",1),h.TgZ(3,"table",2),h.TgZ(4,"thead"),h.TgZ(5,"tr",3),h.TgZ(6,"td",4),h._uU(7,"ref."),h.qZA(),h.TgZ(8,"td",5),h._uU(9,"stat."),h.qZA(),h.YNc(10,D,3,7,"td",6),h.qZA(),h.TgZ(11,"tr",3),h.YNc(12,U,7,8,"th",7),h.YNc(13,N,6,8,"th",7),h.qZA(),h.qZA(),h.TgZ(14,"tbody"),h.YNc(15,B,5,2,"tr",8),h.qZA(),h.qZA(),h.qZA()),2&t&&(h.xp6(1),h.Q6J("day",n.day)("month",n.month)("year",n.year),h.xp6(9),h.Q6J("ngForOf",n.headerdays.months),h.xp6(2),h.Q6J("ngForOf",n.headerdays.headDays1),h.xp6(1),h.Q6J("ngForOf",n.headerdays.headDays2),h.xp6(2),h.Q6J("ngForOf",n.rental_units))},directives:[x,f.sg,T],pipes:[f.uU],styles:["[_nghost-%COMP%]   .container[_ngcontent-%COMP%]{overflow-y:scroll;height:calc(100vh - 130px);padding:0 15px 15px}[_nghost-%COMP%]   table[_ngcontent-%COMP%]{border-spacing:0;width:100%;border:1px solid #e0e0e0}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px;overflow-y:scroll;background:#0000}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:var(--mdc-theme-primary,#6200ee);border-radius:10px}[_nghost-%COMP%]   table.tabreservation[_ngcontent-%COMP%]{margin-top:20px}[_nghost-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{min-width:30px;width:30px}[_nghost-%COMP%]   tr.head[_ngcontent-%COMP%]{color:#0000008a!important}[_nghost-%COMP%]   tr.head[_ngcontent-%COMP%]   .head-days[_ngcontent-%COMP%], [_nghost-%COMP%]   tr.head[_ngcontent-%COMP%]   .head-months[_ngcontent-%COMP%]{height:46px;font-size:16px}[_nghost-%COMP%]   tr.head[_ngcontent-%COMP%]   .head-days[_ngcontent-%COMP%]{border-top:1px solid #e0e0e0}[_nghost-%COMP%]   tr.head[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], [_nghost-%COMP%]   tr.head[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{text-align:center;border-right:1px solid #e0e0e0}[_nghost-%COMP%]   tr.head[_ngcontent-%COMP%]:last-child{box-shadow:0 3px 5px 0 #0000001a!important}[_nghost-%COMP%]   tr.head[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{position:sticky;top:0;background:#fff;z-index:2;box-shadow:0 3px 5px 0 #0000001a!important}[_nghost-%COMP%]   tr.head[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:last-child{border-right:0}[_nghost-%COMP%]   tr[_ngcontent-%COMP%]   td.cell-room[_ngcontent-%COMP%]{width:40px;min-width:40px;max-width:40px;font-size:12px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}[_nghost-%COMP%]   tr.rows[_ngcontent-%COMP%]{height:45px}[_nghost-%COMP%]   tr.rows[_ngcontent-%COMP%]:hover{background-color:#e0e0e0}[_nghost-%COMP%]   tr.rows[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:0;text-align:center;border-right:1px solid #e0e0e0;border-top:1px solid #e0e0e0}[_nghost-%COMP%]   tr.rows[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:last-child{border-right:0}[_nghost-%COMP%]   td[_ngcontent-%COMP%]:first-child, [_nghost-%COMP%]   th[_ngcontent-%COMP%]:first-child{padding-left:2px}[_nghost-%COMP%]   td[_ngcontent-%COMP%]:last-child, [_nghost-%COMP%]   th[_ngcontent-%COMP%]:last-child{padding-right:2px}[_nghost-%COMP%]   .rows[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:13px}"]}),t})();class Y{constructor(t=0,n="",e="",o=0){this.id=t,this.name=n,this.code=e,this.capacity=o}}class S{constructor(t=0,n=0,e=0,o=0,i=new Date,s="",a=""){this.id=t,this.booking_id=n,this.booking_line_id=e,this.rental_unit_id=o,this.date=i,this.schedule_from=s,this.schedule_to=a}}const j=[{path:"",component:(()=>{class t{constructor(t,n,e,o){this.api=t,this.auth=n,this.cd=e,this.zone=o,this.date_range={},this.rental_units=[],this.bookings=[],this.showSbContainer=!1;const i=new Date;this.year=i.getFullYear(),this.month=i.getMonth()+1,this.day=i.getDate(),this.center_id=0}ngOnInit(){}ngAfterViewInit(){$("#sb-planning-container").on("_close",(t,n)=>{this.zone.run(()=>{this.showSbContainer=!1})}),$("#sb-planning-container").on("_open",(t,n)=>{this.zone.run(()=>{this.showSbContainer=!0})})}load(){return(0,c.mG)(this,void 0,void 0,function*(){console.log("load",this.center_id),this.rental_units=[];let t=[];if(this.center_id){const n=yield this.api.collect("lodging\\realestate\\RentalUnit",["center_id","=",this.center_id],Object.getOwnPropertyNames(new Y),"id","asc",0,100);if(n&&n.length){this.rental_units=n;let e=n.map(t=>t.id);t=yield this.api.collect("sale\\booking\\Consumption",[["date",">=",this.date_range.from],["date","<=",this.date_range.to],["rental_unit_id","in",e]],["booking_id.customer_id.name","booking_id.status","booking_id.name","booking_id.contacts_ids","rental_unit_id.children_ids",...Object.getOwnPropertyNames(new S)],"id","asc",0,500)}}return t})}onFiltersChange(t){return(0,c.mG)(this,void 0,void 0,function*(){console.log("PlanningComponent::onFiltersChange",t);let n=t;this.currentsearch=n,this.date_range.from=n.date_from,this.date_range.to=n.date_to,this.center_id=n.center_id;try{let t=yield this.load();if(this.rental_units.length){let n={};for(let e of t)n.hasOwnProperty(e.booking_line_id)||(n[e.booking_line_id]=[]),n[e.booking_line_id].push(e);for(let t of Object.keys(n)){let e=n[t],o=e[0],i=e[e.length-1],s=new Date(o.date),a=new Date(i.date),r=((t,n)=>{const e=Date.UTC(t.getFullYear(),t.getMonth(),t.getDate()),o=Date.UTC(n.getFullYear(),n.getMonth(),n.getDate());return Math.floor((o-e)/864e5)})(s,a),c=o.rental_unit_id.id,h=this.rental_units.find(t=>t.id==c).capacity;if(this.bookings.push(new d(o.booking_id.id,o.booking_line_id,c,h,new Date(o.date),s,a,r,o.booking_id.name,o.booking_id.status,o.booking_id.customer_id.id,o.booking_id.customer_id.name,"unknown",o.booking_id.contacts_ids)),o.rental_unit_id.children_ids.length)for(let t of o.rental_unit_id.children_ids)this.bookings.push(new d(o.booking_id.id,o.booking_line_id,t,h,new Date(o.date),s,a,r,o.booking_id.name,o.booking_id.status,o.booking_id.customer_id.id,o.booking_id.customer_id.name,"unknown",o.booking_id.contacts_ids))}}this.cd.detectChanges()}catch(e){console.warn(e)}})}}return t.\u0275fac=function(n){return new(n||t)(h.Y36(a.sM),h.Y36(a.Tq),h.Y36(h.sBO),h.Y36(h.R0b))},t.\u0275cmp=h.Xpm({type:t,selectors:[["planning"]],decls:6,vars:7,consts:[[1,"container"],[1,"planning-header"],[1,"planning-body"],[3,"day","month","year","rental_units","bookings","filters"],["id","sb-planning-container",1,"sb-container"]],template:function(t,n){1&t&&(h.TgZ(0,"div",0),h.TgZ(1,"div",1),h._uU(2,"Calendrier"),h.qZA(),h.TgZ(3,"div",2),h.TgZ(4,"planning-calendar",3),h.NdJ("filters",function(t){return n.onFiltersChange(t)}),h.qZA(),h.qZA(),h.qZA(),h._UZ(5,"div",4)),2&t&&(h.ekj("hidden",n.showSbContainer),h.xp6(4),h.Q6J("day",n.day)("month",n.month)("year",n.year)("rental_units",n.rental_units)("bookings",n.bookings))},directives:[J],styles:["[_nghost-%COMP%]{width:100%;height:100%;overflow:hidden;box-sizing:border-box}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]{height:100%;width:100%}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]   .planning-header[_ngcontent-%COMP%]{width:100%;padding-left:12px;height:48px;line-height:48px;border-bottom:1px solid #d3d3d3;font-size:22px}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]   .planning-body[_ngcontent-%COMP%]{height:calc(100vh - 123px);width:100%;overflow:hidden}[_nghost-%COMP%]   .container.hidden[_ngcontent-%COMP%]{display:none}"]}),t})()}];let z=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=h.oAB({type:t}),t.\u0275inj=h.cJS({imports:[[r.Bz.forChild(j)],r.Bz]}),t})();var I=e(2111),Q=e(625);let E=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=h.oAB({type:t}),t.\u0275inj=h.cJS({providers:[{provide:o._A,useClass:s.e,deps:[o.Ad,i.t4]}],imports:[[a._e,z,I.xu,Q.U8]]}),t})()}}]);