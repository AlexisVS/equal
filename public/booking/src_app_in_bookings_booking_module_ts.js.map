{"version":3,"sources":["./src/app/in/bookings/booking-routing.module.ts","./src/app/in/bookings/booking.component.ts","./src/app/in/bookings/booking.module.ts","./src/app/in/bookings/composition/booking.composition.component.ts","./src/app/in/bookings/composition/booking.composition.component.html","./src/app/in/bookings/composition/components/booking.composition.lines/booking.composition.lines.component.ts","./src/app/in/bookings/composition/components/booking.composition.lines/booking.composition.lines.component.html","./src/app/in/bookings/edit/booking.edit.component.ts","./src/app/in/bookings/edit/booking.edit.component.html","./src/app/in/bookings/edit/components/booking.edit.bookings/booking.edit.bookings.component.ts","./src/app/in/bookings/edit/components/booking.edit.bookings/booking.edit.bookings.component.html","./src/app/in/bookings/edit/components/booking.edit.bookings/components/booking.edit.bookings.group.accomodation/booking.edit.bookings.group.accomodation.component.ts","./src/app/in/bookings/edit/components/booking.edit.bookings/components/booking.edit.bookings.group.accomodation/booking.edit.bookings.group.accomodation.component.html","./src/app/in/bookings/edit/components/booking.edit.bookings/components/booking.edit.bookings.group.line.discount/booking.edit.bookings.group.line.discount.component.ts","./src/app/in/bookings/edit/components/booking.edit.bookings/components/booking.edit.bookings.group.line.discount/booking.edit.bookings.group.line.discount.component.html","./src/app/in/bookings/edit/components/booking.edit.bookings/components/booking.edit.bookings.group.line/booking.edit.bookings.group.line.component.ts","./src/app/in/bookings/edit/components/booking.edit.bookings/components/booking.edit.bookings.group.line/booking.edit.bookings.group.line.component.html","./src/app/in/bookings/edit/components/booking.edit.bookings/components/booking.edit.bookings.group/booking.edit.bookings.group.component.ts","./src/app/in/bookings/edit/components/booking.edit.bookings/components/booking.edit.bookings.group/booking.edit.bookings.group.component.html","./src/app/in/bookings/edit/components/booking.edit.customer/booking.edit.customer.component.ts","./src/app/in/bookings/edit/components/booking.edit.customer/booking.edit.customer.component.html","./src/app/in/bookings/edit/components/booking.edit.customer/booking.edit.customer.create.partner.dialog.html","./src/app/in/bookings/edit/components/booking.edit.sojourn/booking.edit.sojourn.component.ts","./src/app/in/bookings/edit/components/booking.edit.sojourn/booking.edit.sojourn.component.html","./src/app/in/bookings/edit/components/booking.edit.sojourn/booking.edit.customer.create.contact.dialog.html"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;AACuD;AAEA;AACc;AACqB;;;AAG1F,MAAM,MAAM,GAAW;IACnB;QACI,IAAI,EAAE,EAAE;QACR,SAAS,EAAE,gEAAgB;KAC9B;IACD;QACI,IAAI,EAAE,UAAU;QAChB,SAAS,EAAE,8EAAoB;KAClC;IACD;QACI,IAAI,EAAE,MAAM;QACZ,SAAS,EAAE,8EAAoB;KAClC;IACD;QACI,IAAI,EAAE,iBAAiB;QACvB,SAAS,EAAE,mGAA2B;KACzC;CAEJ,CAAC;AAMK,MAAM,oBAAoB;;wFAApB,oBAAoB;iHAApB,oBAAoB;qHAHtB,CAAC,kEAAqB,CAAC,MAAM,CAAC,CAAC,EAC9B,yDAAY;mIAEX,oBAAoB,oFAFrB,yDAAY;;;;;;;;;;;;;;;;;;;;ACtBjB,MAAM,gBAAgB;IAG3B,YACU,IAAiB;QAAjB,SAAI,GAAJ,IAAI,CAAa;IACxB,CAAC;IAGG,QAAQ;QACb,OAAO,CAAC,GAAG,CAAC,uBAAuB,CAAC,CAAC;QACrC,4BAA4B;IAC9B,CAAC;;gFAXU,gBAAgB;8GAAhB,gBAAgB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACPyC;AACrB;AACW;AAGY;AAER;AAET;AACc;AAGkD;AACT;AAEM;AACR;AAEW;AACkD;AACc;AACwB;AACE;AAEtF;AACe;;AAoBnI,MAAM,kBAAkB;;oFAAlB,kBAAkB;gHAAlB,kBAAkB;qHAJlB;QACT,EAAE,OAAO,EAAE,gEAAW,EAAE,QAAQ,EAAE,iEAAiB,EAAE,IAAI,EAAE,CAAC,oEAAe,EAAE,4DAAQ,CAAC,EAAE;KACzF,YAfQ;YACP,2DAAe;YACf,yEAAoB;SACrB;oIAcU,kBAAkB,mBAZ3B,gEAAgB,EAAE,8EAAoB;QACtC,gIAA4B,EAAE,uHAAmB;QACjD,6HAA2B,EAAE,qHAAmB;QAChD,gIAA4B;QAC5B,kLAAiC,EAAE,wNAA6C,EAAE,gMAAqC,EAAE,2NAA6C;QACtK,oGAA2B,EAAE,wGAA+B;QAC5D,oJAAgC,aAVhC,2DAAe;QACf,yEAAoB;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC9B4D;;;;;;;;;;;ICc1E,yEAA2C;;;IAE3C,2FAE6B;;;IAD3B,yGAAyC;;;;IAQ3C,2EAA+B;IAAzB,yUAAwB;IAAC,0EAAe;IAAA,4DAAO;;;ADf/D,MAAM,OAAO;IACX,YACS,KAAa,CAAC,EACd,OAAe,EAAE,EACjB,iBAAyB,CAAC;QAF1B,OAAE,GAAF,EAAE,CAAY;QACd,SAAI,GAAJ,IAAI,CAAa;QACjB,mBAAc,GAAd,cAAc,CAAY;IAChC,CAAC;CACL;AAQM,MAAM,2BAA2B;IAStC,YACU,MAAiB,EACjB,GAAe,EACf,KAAqB,EACrB,OAAsB,EACtB,IAAY;QAJZ,WAAM,GAAN,MAAM,CAAW;QACjB,QAAG,GAAH,GAAG,CAAY;QACf,UAAK,GAAL,KAAK,CAAgB;QACrB,YAAO,GAAP,OAAO,CAAe;QACtB,SAAI,GAAJ,IAAI,CAAQ;QAZf,oBAAe,GAAY,KAAK,CAAC;QACjC,qBAAgB,GAAU,CAAC,CAAC;QAC5B,YAAO,GAAG,IAAI,CAAC;QAGf,YAAO,GAAQ,IAAI,OAAO,EAAE,CAAC;IASpC,CAAC;IAED;;OAEG;IACI,kBAAkB;QACvB,IAAI,CAAC,OAAO,GAAG,KAAK,CAAC;QAErB,+GAA+G;QAC/G,kEAAkE;QAClE,CAAC,CAAC,2BAA2B,CAAC,CAAC,EAAE,CAAC,QAAQ,EAAE,CAAC,KAAK,EAAE,IAAI,EAAE,EAAE;YAC1D,IAAI,CAAC,IAAI,CAAC,GAAG,CAAE,GAAG,EAAE;gBAClB,OAAO,CAAC,GAAG,CAAC,kBAAkB,CAAC,CAAC;gBAChC,IAAI,CAAC,eAAe,GAAG,KAAK,CAAC;gBAC7B,IAAI,CAAC,gBAAgB,GAAG,CAAC,CAAC;YAC5B,CAAC,CAAC,CAAC;QACL,CAAC,CAAC,CAAC;QAEH,CAAC,CAAC,2BAA2B,CAAC,CAAC,EAAE,CAAC,OAAO,EAAE,CAAC,KAAK,EAAE,IAAI,EAAE,EAAE;YACzD,IAAI,CAAC,IAAI,CAAC,GAAG,CAAE,GAAG,EAAE;gBAClB,OAAO,CAAC,GAAG,CAAC,mBAAmB,CAAC,CAAC;gBACjC,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC;YAC9B,CAAC,CAAC,CAAC;QACL,CAAC,CAAC,CAAC;IACL,CAAC;IAED,QAAQ;QACN,sCAAsC;QACtC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,SAAS,CAAE,CAAO,MAAM,EAAE,EAAE,CAAC;YAC7C,IAAG,MAAM,IAAI,MAAM,CAAC,cAAc,CAAC,IAAI,CAAC,EAAE;gBACxC,IAAI;oBACF,IAAI,CAAC,UAAU,GAAY,MAAM,CAAC,IAAI,CAAC,CAAC;oBACxC,MAAM,OAAO,GAAG,MAAM,IAAI,CAAC,IAAI,CAAE,MAAM,CAAC,mBAAmB,CAAC,IAAI,OAAO,EAAE,CAAC,CAAE,CAAC;oBAC7E,IAAI,CAAC,OAAO,GAAG,IAAI,OAAO,CACxB,OAAO,CAAC,EAAE,EACV,OAAO,CAAC,IAAI,EACZ,OAAO,CAAC,cAAc,CACvB,CAAC;iBACH;gBACD,OAAM,KAAK,EAAE;oBACX,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;iBACrB;aACF;QACH,CAAC,EAAC,CAAC;IACL,CAAC;IAEa,IAAI,CAAC,MAAa;;YAC9B,MAAM,MAAM,GAAG,MAAM,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,iCAAiC,EAAE,CAAC,IAAI,CAAC,UAAU,CAAC,EAAE,MAAM,CAAC,CAAC;YACjG,IAAG,MAAM,IAAI,MAAM,CAAC,MAAM,EAAE;gBAC1B,OAAO,MAAM,CAAC,CAAC,CAAC,CAAC;aAClB;YACD,OAAO,EAAE,CAAC;QACZ,CAAC;KAAA;IAED;;;OAGG;IACI,YAAY;QACjB,GAAG;QACH,IAAI,CAAC,gBAAgB,GAAG,CAAC,CAAC;QAE1B,IAAI,UAAU,GAAG;YACf,OAAO,EAAE;gBACP,MAAM,EAAM,gCAAgC;gBAC5C,IAAI,EAAQ,MAAM;gBAClB,IAAI,EAAQ,SAAS;gBACrB,MAAM,EAAM,CAAC,gBAAgB,EAAE,GAAG,EAAE,IAAI,CAAC,OAAO,CAAC,cAAc,CAAC;gBAChE,IAAI,EAAQ,MAAM;gBAClB,OAAO,EAAK,MAAM;gBAClB,MAAM,EAAM,2BAA2B;gBACvC,QAAQ,EAAI,CAAC,IAAQ,EAAE,EAAE;oBACvB,IAAG,IAAI,IAAI,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE;wBAC9C,gBAAgB;qBACjB;gBACH,CAAC;aACF;SACF,CAAC;QAEF,qDAAqD;QACrD,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC;IAClC,CAAC;IAKM,UAAU;QACf,MAAM,SAAS,GAAG,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,+BAA+B,EAAE;YAClE,KAAK,EAAE,MAAM;YACb,IAAI,EAAE,EAAC,OAAO,EAAE,IAAI,CAAC,OAAO,EAAC;SAC9B,CAAC,CAAC;QAEH,SAAS,CAAC,WAAW,EAAE,CAAC,SAAS,CAAC,MAAM,CAAC,EAAE;YACzC,IAAG,MAAM,EAAE;gBACT,OAAO,CAAC,GAAG,CAAC,eAAe,CAAC,CAAC;aAC9B;iBACI;gBACH,OAAO,CAAC,GAAG,CAAC,cAAc,CAAC,CAAC;aAC7B;QACH,CAAC,CAAC,CAAC;IACL,CAAC;;sGApHU,2BAA2B;yHAA3B,2BAA2B;QC1BxC,yEAA+D;QAC7D,yEAA4B;QAAA,uEAAY;QAAA,uEAAM;QAAC,mEAAE;QAAA,4DAAO;QAAC,uDAA4B;QAAA,4DAAM;QAC3F,yEAA0B;QAExB,yEAA4B;QAC1B,oEAAiC;QACjC,yEAAgC;QAC9B,6EAAkE;QAAvC,oJAAS,gBAAY,IAAC;QAAiB,4FAAsB;QAAA,4DAAS;QACnG,4DAAM;QACR,4DAAM;QAEN,oFAAkD;QAChD,8EAA4C;QAE1C,0EAA+B;QAE7B,0IAA2C;QAE3C,sKAE6B;QAC/B,4DAAM;QAER,4DAAU;QAEV,2EAAS;QACP,0IAEc;QAChB,4DAAU;QAEZ,4DAAgB;QAElB,4DAAM;QACR,4DAAM;QAEN,sEAA8D;;QApCvC,+JAAuC;QACH,0DAA4B;QAA5B,4GAA4B;QAUpE,0DAAkC;QAAlC,+FAAkC;QAK7B,0DAAa;QAAb,6EAAa;QAEC,0DAAc;QAAd,8EAAc;;ADkJ7C,MAAM,+BAA+B;IAC1C,YACS,SAAwD,EAC/B,IAAyC;QADlE,cAAS,GAAT,SAAS,CAA+C;QAC/B,SAAI,GAAJ,IAAI,CAAqC;IACxE,CAAC;;8GAJO,+BAA+B,uMAGhC,qEAAe;6HAHd,+BAA+B;QAd1C,wEAAqB;QAAA,2FAAsB;QAAA,4DAAK;QAEhD,yEAAwB;QACtB,oEAAG;QAAA,4IAAkE;QAAA,oEAAG;QAAA,uDAAqB;QAAA,4DAAI;QAAA,4DAAC;QAAA,4DAAI;QACtG,oEAAG;QAAA,6LAA8G;QAAA,4DAAI;QACrH,qEAAG;QAAA,qEAAG;QAAA,wGAAkC;QAAA,4DAAI;QAAA,4DAAI;QAClD,4DAAM;QAEN,0EAAwB;QACtB,6EAA8C;QAAA,mEAAO;QAAA,4DAAS;QAC9D,6EAA6D;QAAA,sEAAK;QAAA,4DAAS;QAC7E,4DAAM;;QARoE,0DAAqB;QAArB,sFAAqB;QAM1E,0DAA0B;QAA1B,mFAA0B;QAC1B,0DAAyB;QAAzB,kFAAyB;;;;;;;;;;;;;;;;;;;;;;;;;;AEhKW;;;;;;;;;;IC8B/C,4EAAuG;IAAnD,yfAAkD;IACpG,+EAAmC;IAAA,+EAAoB;IAAA,4DAAW;IACpE,4DAAS;;;;IACT,4EAAsG;IAAnD,0fAAkD;IACnG,+EAAmC;IAAA,4EAAiB;IAAA,4DAAW;IACjE,4DAAS;;;IAST,sEAAiC;IAAA,0EAAe;IAAA,4DAAM;;;IAmBlD,0EAA0C;IACxC,0EAAgC;IAAA,uDAAiD;IAAA,4DAAM;IACzF,4DAAM;;;IAD4B,0DAAiD;IAAjD,4HAAiD;;;;IATrF,0EAOwC;IAJnC,oaAAgC;IAKnC,iJAEM;IACN,0EAA0C;IAAA,uDAAQ;IAAA,4DAAM;IACxD,0EAA0C;IAAA,uDAAkB;IAAA,4DAAM;IAClE,0EAA0C;IAAA,uDAAiB;IAAA,4DAAM;IACjE,0EAA0C;IAAA,uDAAe;IAAA,4DAAM;IAC/D,2EAAqE;IACnE,6EAAiE;IAAzC,0aAAwC;IAC9D,4EAAU;IAAA,uEAAW;IAAA,4DAAW;IAClC,4DAAS;IACX,4DAAM;IACR,4DAAM;;;;;IAhBD,wFAAgC;IAGhC,+FAAkC;IAIK,0DAAQ;IAAR,oFAAQ;IACR,0DAAkB;IAAlB,mFAAkB;IAClB,0DAAiB;IAAjB,kFAAiB;IACjB,0DAAe;IAAf,gFAAe;;;IAvB7D,0EAA8D;IAC5D,0EAA0C;IACxC,0EAAiD;IAAA,4DAAC;IAAA,4DAAM;IACxD,0EAAiD;IAAA,8DAAG;IAAA,4DAAM;IAC1D,0EAAiD;IAAA,sEAAM;IAAA,4DAAM;IAC7D,0EAAiD;IAAA,gEAAK;IAAA,4DAAM;IAC5D,sEAAuE;IACzE,4DAAM;IAEN,6IAoBM;IAER,4DAAM;;;;IApBkB,2DAAsC;IAAtC,gHAAsC;;;;IA9CtE,qEAAiE;IAC/D,qEAAI;IACF,yEAA4B;IAC1B,yEAAyC;IAAA,uDAAqE;IAAA,4DAAM;IACpH,yEAA6C;IAC3C,4EAAmE;IAA3C,iaAA0C;IAChE,2EAAU;IAAA,sEAAW;IAAA,4DAAW;IAClC,4DAAS;IACX,4DAAM;IACR,4DAAM;IACR,4DAAK;IACL,yEAA2C;IACzC,2EAAkB;IAAA,wDAA4C;IAAA,4DAAM;IACtE,4DAAK;IAEL,sEAAK;IACH,2EAAmB;IAEjB,2EAAyB;IACvB,2IAES;IACT,2IAES;IACX,4DAAM;IAEN,2EAI2C;IAAtC,wWAAqC;IAExC,qIAAsD;IAEtD,sIA+BM;IAER,4DAAM;IAER,4DAAM;IACR,4DAAK;IAEP,4DAAK;;;;;;IAtE0C,0DAAqE;IAArE,wJAAqE;IAS9F,0DAA4C;IAA5C,mHAA4C;IAOjC,0DAAyB;IAAzB,sFAAyB;IAGzB,0DAAwB;IAAxB,qFAAwB;IAM9C,0DAAuB;IAAvB,4FAAuB;IAEvB,8FAAkC;IAG/B,0DAAyB;IAAzB,sFAAyB;IAEzB,0DAAwB;IAAxB,qFAAwB;;;;ADxC1C,MAAM,WAAW;IACf,YACS,KAAa,CAAC,EACd,aAAqB,CAAC;QADtB,OAAE,GAAF,EAAE,CAAY;QACd,eAAU,GAAV,UAAU,CAAY;IAC7B,CAAC;CACJ;AAED,MAAM,eAAe;IACnB,YACS,KAAa,CAAC,EACd,YAAoB,EAAE,EACtB,WAAmB,EAAE,EACrB,SAAiB,EAAE,EACnB,gBAAwB,EAAE,EAC1B,iBAAyB,EAAE,EAC3B,QAAgB,EAAE,EAClB,QAAgB,EAAE,EAClB,UAAkB,EAAE,EACpB,UAAkB,EAAE,EACpB,iBAAyB,EAAE;QAV3B,OAAE,GAAF,EAAE,CAAY;QACd,cAAS,GAAT,SAAS,CAAa;QACtB,aAAQ,GAAR,QAAQ,CAAa;QACrB,WAAM,GAAN,MAAM,CAAa;QACnB,kBAAa,GAAb,aAAa,CAAa;QAC1B,mBAAc,GAAd,cAAc,CAAa;QAC3B,UAAK,GAAL,KAAK,CAAa;QAClB,UAAK,GAAL,KAAK,CAAa;QAClB,YAAO,GAAP,OAAO,CAAa;QACpB,YAAO,GAAP,OAAO,CAAa;QACpB,mBAAc,GAAd,cAAc,CAAa;IACjC,CAAC;CACL;AAED,MAAM,UAAU;IACd,YACS,KAAa,CAAC,EACd,OAAe,EAAE,EACjB,OAAe,EAAE,EACjB,WAAmB,CAAC;QAHpB,OAAE,GAAF,EAAE,CAAY;QACd,SAAI,GAAJ,IAAI,CAAa;QACjB,SAAI,GAAJ,IAAI,CAAa;QACjB,aAAQ,GAAR,QAAQ,CAAY;IAC1B,CAAC;CACL;AAOM,MAAM,gCAAgC;IAc3C,YACU,GAAe,EACf,EAAqB,EACrB,OAAsB,EACtB,IAAY,EACZ,KAAiB;QAJjB,QAAG,GAAH,GAAG,CAAY;QACf,OAAE,GAAF,EAAE,CAAmB;QACrB,YAAO,GAAP,OAAO,CAAe;QACtB,SAAI,GAAJ,IAAI,CAAQ;QACZ,UAAK,GAAL,KAAK,CAAY;QAfnB,gBAAW,GAAgB,IAAI,WAAW,EAAE,CAAC;QAErD,0DAA0D;QACnD,sBAAiB,GAAQ,EAAE,CAAC;QAE5B,iBAAY,GAAsB,EAAE,CAAC;QAErC,cAAS,GAAO,EAAE,CAAC;QACnB,aAAQ,GAAY,KAAK,CAAC;IAQ9B,CAAC;IAEJ,QAAQ;IAER,CAAC;IAEK,WAAW,CAAC,OAAsB;;YACtC,IAAG,OAAO,CAAC,cAAc,EAAE;gBAEzB,IAAI;oBACF,MAAM,YAAY,GAAG,MAAM,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,4BAA4B,EACnE,CAAC,IAAI,CAAC,cAAc,CAAC,EACrB,MAAM,CAAC,mBAAmB,CAAE,IAAI,WAAW,EAAE,CAAE,CAChD,CAAC;oBAEF,IAAG,YAAY,CAAC,MAAM,EAAE;wBACtB,IAAI,CAAC,WAAW,GAAG,YAAY,CAAC,CAAC,CAAC,CAAC;wBAEnC;4BACE,MAAM,IAAI,GAAG,MAAM,IAAI,CAAC,IAAI,CAAE,MAAM,CAAC,mBAAmB,CAAE,IAAI,eAAe,EAAE,CAAE,CAAE,CAAC;4BAEpF,KAAI,IAAI,IAAI,IAAI,IAAI,EAAE;gCACpB,IAAG,CAAC,IAAI,CAAC,iBAAiB,CAAC,cAAc,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC,EAAE;oCACjE,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC,GAAG,EAAE,CAAC;iCACrD;gCACD,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;6BAC3D;yBACF;wBACD,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;wBAEpC;4BACE,MAAM,IAAI,GAAG,MAAM,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,iCAAiC,EAChE,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,iBAAiB,CAAC,EACnC,MAAM,CAAC,mBAAmB,CAAE,IAAI,UAAU,EAAE,CAAE,CAC/C,CAAC;4BAEF,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;yBAC1B;wBACD,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;qBAChC;iBACF;gBACD,OAAM,KAAK,EAAE;oBACX,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;oBACpB,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC;iBAClC;aAEF;QACH,CAAC;KAAA;IAEM,QAAQ,CAAC,KAAU,EAAE,IAAS;QACnC,OAAO,CAAC,GAAG,CAAC,WAAW,EAAE,KAAK,EAAE,IAAI,CAAC,CAAC;QACtC,IAAG,CAAC,IAAI,CAAC,cAAc,CAAC,UAAU,CAAC,EAAE;YACnC,IAAI,CAAC,QAAQ,GAAG,KAAK,CAAC;SACvB;QAED,IAAI,cAAc,GAAG,IAAI,CAAC,cAAc,CAAC;QAEzC,IAAG,IAAI,CAAC,QAAQ,EAAE;YAChB,IAAI,CAAC,QAAQ,GAAG,KAAK,CAAC;SACvB;aACI;YACH,uCAAuC;YACvC,KAAI,IAAI,IAAI,IAAI,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,iBAAiB,CAAC,EAAE;gBACnD,IAAG,IAAI,IAAI,cAAc,EAAE;oBACzB,KAAI,IAAI,CAAC,IAAI,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,EAAE;wBACzC,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,QAAQ,GAAG,KAAK,CAAC;qBAClD;iBACF;aACF;YACD,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;SACtB;QACD,2BAA2B;QAC3B,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,iBAAiB,CAAC,cAAc,CAAC,CAAC,MAAM,CAAE,CAAC,IAAQ,EAAE,EAAE,CAAC,IAAI,CAAC,QAAQ,CAAE,CAAC;QAE9F,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;IAC9B,CAAC;IAEM,WAAW,CAAC,KAAU;QAC3B,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;IACvB,CAAC;IAEM,MAAM,CAAC,KAAU;QACtB,IAAI,KAAK,CAAC,iBAAiB,IAAI,KAAK,CAAC,SAAS,EAAE;YAC9C,OAAO,CAAC,GAAG,CAAC,MAAM,EAAE,KAAK,CAAC,iBAAiB,CAAC,IAAI,EAAE,IAAI,EAAE,KAAK,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC;YAE9E,IAAI,aAAa,GAAG,KAAK,CAAC,YAAY,CAAC;YACvC,IAAI,kBAAkB,GAAG,KAAK,CAAC,SAAS,CAAC,IAAI,CAAC;YAC9C,IAAI,kBAAkB,GAAG,KAAK,CAAC,iBAAiB,CAAC,IAAI,CAAC;YAEtD,KAAI,IAAI,IAAI,IAAI,IAAI,CAAC,SAAS,EAAE;gBAC9B,IAAI,cAAc,GAAG,IAAI,CAAC,iBAAiB,CAAC,kBAAkB,CAAC,CAAC,SAAS,CAAE,CAAC,CAAK,EAAE,EAAE,CAAC,CAAC,CAAC,EAAE,IAAI,IAAI,CAAC,EAAE,CAAE,CAAC;gBACxG,YAAY;gBACZ,yEAAiB,CACf,IAAI,CAAC,iBAAiB,CAAC,kBAAkB,CAAC,EAC1C,IAAI,CAAC,iBAAiB,CAAC,kBAAkB,CAAC,EAC1C,cAAc,EACd,aAAa,CACd,CAAC;gBACF,EAAE,aAAa,CAAC;gBAChB,cAAc;gBACd,IAAI,CAAC,cAAc,GAAG,kBAAkB,CAAC;gBACzC,IAAI,CAAC,QAAQ,GAAG,KAAK,CAAC;aACvB;YACD,kBAAkB;YAClB,IAAI,CAAC,SAAS,GAAG,EAAE,CAAC;SACrB;QACD,IAAI,CAAC,QAAQ,GAAG,KAAK,CAAC;QACtB,OAAO,CAAC,GAAG,CAAC,SAAS,EAAE,KAAK,CAAC,CAAC;IAChC,CAAC;IAEM,gBAAgB,CAAC,cAAsB;QAE5C,IAAI,UAAU,GAAG;YACf,OAAO,EAAE;gBACP,MAAM,EAAM,iCAAiC;gBAC7C,IAAI,EAAQ,MAAM;gBAClB,IAAI,EAAQ,SAAS;gBACrB,MAAM,EAAM,CAAC,IAAI,EAAE,GAAG,EAAE,cAAc,CAAC;gBACvC,IAAI,EAAQ,MAAM;gBAClB,OAAO,EAAK,MAAM;gBAClB,MAAM,EAAM,2BAA2B;gBACvC,QAAQ,EAAI,CAAC,IAAQ,EAAE,EAAE;oBACvB,IAAG,IAAI,IAAI,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE;wBAC9C,gBAAgB;qBACjB;gBACH,CAAC;aACF;SACF,CAAC;QAEF,qDAAqD;QACrD,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC;IAClC,CAAC;IAEM,qBAAqB,CAAC,OAAe;QAE1C,IAAI,UAAU,GAAG;YACf,OAAO,EAAE;gBACP,MAAM,EAAM,gCAAgC;gBAC5C,IAAI,EAAQ,MAAM;gBAClB,IAAI,EAAQ,SAAS;gBACrB,MAAM,EAAM,CAAC,IAAI,EAAE,GAAG,EAAE,OAAO,CAAC;gBAChC,IAAI,EAAQ,MAAM;gBAClB,OAAO,EAAK,MAAM;gBAClB,MAAM,EAAM,2BAA2B;gBACvC,QAAQ,EAAI,CAAC,IAAQ,EAAE,EAAE;oBACvB,IAAG,IAAI,IAAI,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE;wBAC9C,gBAAgB;qBACjB;gBACH,CAAC;aACF;SACF,CAAC;QAEF,qDAAqD;QACrD,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC;IAClC,CAAC;IAEa,IAAI,CAAC,MAAa;;YAC9B,MAAM,MAAM,GAAG,MAAM,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,gCAAgC,EAAE;gBACpE,gBAAgB,EAAE,GAAG,EAAE,IAAI,CAAC,WAAW,CAAC,EAAE;aAC3C,EACD,MAAM,EACN,IAAI,EAAC,KAAK,EACV,CAAC,EAAE,GAAG,CACP,CAAC;YACF,OAAO,MAAM,CAAC;QAChB,CAAC;KAAA;;gHAzLU,gCAAgC;8HAAhC,gCAAgC;QC1C7C,uEAA4C;QAE5C,wEAAO;QAEL,wEAAO;QACL,qEAAI;QAAA,wEAAuB;QAAA,8EAAc;QAAA,4DAAK;QAAA,wEAAgB;QAAA,qEAAU;QAAA,4DAAK;QAAA,4DAAK;QACpF,4DAAQ;QAER,2EAAwB;QAEtB,8HAyEK;QAEP,4DAAQ;QACV,4DAAQ;;QAtFU,6MAAmB;QAUL,2DAAiB;QAAjB,qFAAiB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACHiB;;;;;;;;;;;ICDxB,iEAAM;;;IAQN,sEAAM;;;IAQN,4EAAY;;ADXtD;;;;;;;;;;EAUE;AAEF,MAAM,OAAO;IACX,YACS,KAAa,CAAC,EACd,OAAe,EAAE,EACjB,UAAgB,IAAI,IAAI,EAAE,EAC1B,QAAgB,CAAC,EACjB,cAAsB,CAAC,EACvB,yBAAkC,KAAK,EACvC,wBAAgC,CAAC,EACjC,YAAoB,CAAC,EACrB,UAAU,CAAC,EACX,cAAsB,EAAE,EACxB,eAA8B,EAAE,EAChC,2BAA0C,EAAE;QAX5C,OAAE,GAAF,EAAE,CAAY;QACd,SAAI,GAAJ,IAAI,CAAa;QACjB,YAAO,GAAP,OAAO,CAAmB;QAC1B,UAAK,GAAL,KAAK,CAAY;QACjB,gBAAW,GAAX,WAAW,CAAY;QACvB,2BAAsB,GAAtB,sBAAsB,CAAiB;QACvC,0BAAqB,GAArB,qBAAqB,CAAY;QACjC,cAAS,GAAT,SAAS,CAAY;QACrB,YAAO,GAAP,OAAO,CAAI;QACX,gBAAW,GAAX,WAAW,CAAa;QACxB,iBAAY,GAAZ,YAAY,CAAoB;QAChC,6BAAwB,GAAxB,wBAAwB,CAAoB;IAClD,CAAC;CACL;AAQM,MAAM,oBAAoB;IAU/B,YACoB,IAAiB,EACjB,GAAe,EACf,MAAc,EACd,MAAiB,EACjB,KAAqB,EACrB,KAAkB,EAClB,IAAY;QANZ,SAAI,GAAJ,IAAI,CAAa;QACjB,QAAG,GAAH,GAAG,CAAY;QACf,WAAM,GAAN,MAAM,CAAQ;QACd,WAAM,GAAN,MAAM,CAAW;QACjB,UAAK,GAAL,KAAK,CAAgB;QACrB,UAAK,GAAL,KAAK,CAAa;QAClB,SAAI,GAAJ,IAAI,CAAQ;QAZzB,kBAAa,GAAwB,IAAI,+CAAa,CAAC,CAAC,CAAC,CAAC;QAC1D,mBAAc,GAAuB,IAAI,+CAAa,CAAC,CAAC,CAAC,CAAC;QAE1D,oBAAe,GAAY,KAAK,CAAC;IAWxC,CAAC;IAID;;OAEG;IACI,eAAe;QACpB,+GAA+G;QAC/G,kEAAkE;QAClE,CAAC,CAAC,uBAAuB,CAAC,CAAC,EAAE,CAAC,QAAQ,EAAE,CAAC,KAAK,EAAE,IAAI,EAAE,EAAE;YACtD,IAAI,CAAC,IAAI,CAAC,GAAG,CAAE,GAAG,EAAE;gBAClB,IAAI,CAAC,eAAe,GAAG,KAAK,CAAC;YAC/B,CAAC,CAAC,CAAC;QACL,CAAC,CAAC,CAAC;QACH,CAAC,CAAC,uBAAuB,CAAC,CAAC,EAAE,CAAC,OAAO,EAAE,CAAC,KAAK,EAAE,IAAI,EAAE,EAAE;YACrD,IAAI,CAAC,IAAI,CAAC,GAAG,CAAE,GAAG,EAAE;gBAClB,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC;YAC9B,CAAC,CAAC,CAAC;QACL,CAAC,CAAC,CAAC;IACL,CAAC;IAEM,QAAQ;QAEb,kFAAkF;QAClF,IAAI,CAAC,aAAa,CAAC,SAAS,CAAC,MAAM,CAAC,EAAE,CAAC,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC;QAE5D,sCAAsC;QACtC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,SAAS,CAAE,CAAO,MAAM,EAAE,EAAE,CAAC;YAC7C,IAAG,MAAM,IAAI,MAAM,CAAC,cAAc,CAAC,IAAI,CAAC,EAAE;gBACxC,IAAI,CAAC,EAAE,GAAY,MAAM,CAAC,IAAI,CAAC,CAAC;gBAChC,IAAI;oBACF,sBAAsB;oBACtB,IAAI,IAAI,GAAG,MAAM,IAAI,CAAC,IAAI,CAAE,MAAM,CAAC,mBAAmB,CAAC,IAAI,OAAO,EAAE,CAAC,CAAE,CAAC;oBAExE,IAAI,CAAC,OAAO,GAAG,IAAI,OAAO,CACxB,IAAI,CAAC,EAAE,EACP,IAAI,CAAC,IAAI,EACT,IAAI,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,EACtB,IAAI,CAAC,KAAK,EACV,IAAI,CAAC,WAAW,EAChB,IAAI,CAAC,sBAAsB,EAC3B,IAAI,CAAC,qBAAqB,EAC1B,IAAI,CAAC,SAAS,EACd,IAAI,CAAC,OAAO,EACZ,IAAI,CAAC,WAAW,EACA,IAAI,CAAC,YAAY,EACjB,IAAI,CAAC,wBAAwB,CAC9C,CAAC;oBAEF,oBAAoB;oBACpB,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;iBACxC;gBACD,OAAM,QAAQ,EAAE;oBACd,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;iBACxB;aACF;QACH,CAAC,EAAC,CAAC;IAEL,CAAC;IAED;;;OAGG;IACW,IAAI,CAAC,MAAU;;YAC3B,MAAM,MAAM,GAAG,MAAM,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,iCAAiC,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,MAAM,CAAC,CAAC;YACzF,IAAG,MAAM,IAAI,MAAM,CAAC,MAAM,EAAE;gBAC1B,OAAO,MAAM,CAAC,CAAC,CAAC,CAAC;aAClB;YACD,OAAO,EAAE,CAAC;QACZ,CAAC;KAAA;IAED;;OAEG;IACW,MAAM,CAAC,OAAW;;YAC9B,OAAO,CAAC,GAAG,CAAC,uCAAuC,EAAE,OAAO,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC;YAC5E,IAAI;gBAEF,6CAA6C;gBAC7C,IAAG,OAAO,CAAC,cAAc,CAAC,SAAS,CAAC,EAAE;oBACpC,+DAA+D;oBAC/D,+DAA+D;oBAC/D,IAAI,YAAY,GAAG,MAAM,CAAC,mBAAmB,CAAE,IAAI,OAAO,EAAE,CAAE,CAAC;oBAC/D,IAAG,KAAK,CAAC,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE;wBACjC,YAAY,GAAG,OAAO,CAAC,OAAO,CAAC;qBAChC;oBAED,IAAI,IAAI,GAAG,MAAM,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;oBAEzC,IAAI,CAAC,OAAO,GAAG,IAAI,OAAO,CACxB,IAAI,CAAC,EAAE,EACP,IAAI,CAAC,IAAI,EACT,IAAI,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,EACtB,IAAI,CAAC,KAAK,EACV,IAAI,CAAC,WAAW,EAChB,IAAI,CAAC,sBAAsB,EAC3B,IAAI,CAAC,qBAAqB,EAC1B,IAAI,CAAC,SAAS,EACd,IAAI,CAAC,OAAO,EACZ,IAAI,CAAC,WAAW,EAChB,IAAI,CAAC,YAAY,EACjB,IAAI,CAAC,wBAAwB,CAC9B,CAAC;oBAEF,kBAAkB;oBAClB,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;oBAC/B,OAAO;iBACR;gBAED,qDAAqD;gBAErD,IAAI,UAAU,GAAG,KAAK,CAAC;gBAEvB,IAAG,OAAO,CAAC,cAAc,CAAC,aAAa,CAAC,IAAI,OAAO,CAAC,WAAW,IAAI,IAAI,CAAC,OAAO,CAAC,WAAW,EAAE;oBAC3F,MAAM,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC;oBAC/C,UAAU,GAAG,IAAI,CAAC;iBACnB;gBAED,IAAI,CAAC,OAAO,CAAC,cAAc,CAAC,uBAAuB,CAAC,IAAI,OAAO,CAAC,qBAAqB,IAAI,IAAI,CAAC,OAAO,CAAC,qBAAqB,CAAC;uBACrH,CAAC,OAAO,CAAC,cAAc,CAAC,wBAAwB,CAAC,IAAI,OAAO,CAAC,sBAAsB,IAAI,IAAI,CAAC,OAAO,CAAC,sBAAsB,CAAC,EAAG;oBACnI,MAAM,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,qBAAqB,CAAC,CAAC;oBACtD,UAAU,GAAG,IAAI,CAAC;iBACnB;gBAED,IAAG,OAAO,CAAC,cAAc,CAAC,WAAW,CAAC,IAAI,OAAO,CAAC,SAAS,IAAI,IAAI,CAAC,OAAO,CAAC,SAAS,EAAE;oBACrF,MAAM,IAAI,CAAC,YAAY,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC;oBAC3C,UAAU,GAAG,IAAI,CAAC;iBACnB;gBAED,IAAG,OAAO,CAAC,cAAc,CAAC,SAAS,CAAC,IAAI,OAAO,CAAC,OAAO,IAAI,IAAI,CAAC,OAAO,CAAC,OAAO,EAAE;oBAC/E,MAAM,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;oBACvC,UAAU,GAAG,IAAI,CAAC;iBACnB;gBAED,IAAG,OAAO,CAAC,cAAc,CAAC,aAAa,CAAC,IAAI,OAAO,CAAC,WAAW,IAAI,IAAI,CAAC,OAAO,CAAC,WAAW,EAAE;oBAC3F,MAAM,IAAI,CAAC,iBAAiB,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC;oBAClD,UAAU,GAAG,IAAI,CAAC;iBACnB;gBAED,IAAG,OAAO,CAAC,cAAc,CAAC,cAAc,CAAC,IAAI,OAAO,CAAC,YAAY,CAAC,MAAM,IAAI,IAAI,CAAC,OAAO,CAAC,YAAY,CAAC,MAAM,EAAG;oBAC7G,IAAI,CAAC,OAAO,CAAC,YAAY,GAAG,OAAO,CAAC,YAAY,CAAC;oBACjD,UAAU,GAAG,IAAI,CAAC;iBACnB;gBAED,IAAG,OAAO,CAAC,cAAc,CAAC,0BAA0B,CAAC,IAAI,OAAO,CAAC,wBAAwB,CAAC,MAAM,IAAI,IAAI,CAAC,OAAO,CAAC,wBAAwB,CAAC,MAAM,EAAG;oBACjJ,IAAI,CAAC,OAAO,CAAC,wBAAwB,GAAG,OAAO,CAAC,wBAAwB,CAAC;oBACzE,UAAU,GAAG,IAAI,CAAC;iBACnB;gBAGD,IAAG,UAAU,EAAE;oBACb,iBAAiB;oBACjB,IAAI,IAAI,GAAG,MAAM,IAAI,CAAC,IAAI,CAAE,MAAM,CAAC,mBAAmB,CAAE,IAAI,OAAO,EAAE,CAAE,CAAC,CAAC;oBACzE,sBAAsB;oBACtB,KAAI,IAAI,KAAK,IAAI,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE;wBAClC,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC;qBACnC;oBACD,uCAAuC;oBACvC,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;oBACvC,cAAc;oBACd,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,yBAAyB,CAAC,CAAC;iBAC5C;aACF;YACD,OAAM,QAAY,EAAE;gBAClB,OAAO,CAAC,IAAI,CAAC,kCAAkC,EAAE,QAAQ,CAAC,CAAC;gBAC3D,IAAI,KAAK,GAAU,SAAS,CAAC;gBAC7B,IAAG,QAAQ,IAAI,QAAQ,CAAC,cAAc,CAAC,OAAO,CAAC,IAAI,QAAQ,CAAC,OAAO,CAAC,CAAC,cAAc,CAAC,QAAQ,CAAC,EAAE;oBAC7F,IAAI,MAAM,GAAG,QAAQ,CAAC,OAAO,CAAC,CAAC,QAAQ,CAAC,CAAC;oBAEzC,IAAG,MAAM,CAAC,cAAc,CAAC,eAAe,CAAC,EAAE;wBACzC,KAAK,GAAG,eAAe,CAAC;qBACzB;yBACI,IAAG,MAAM,CAAC,cAAc,CAAC,aAAa,CAAC,EAAE;wBAC5C,KAAK,GAAG,aAAa,CAAC;qBACvB;yBACI,IAAG,MAAM,CAAC,cAAc,CAAC,iBAAiB,CAAC,EAAE;wBAChD,KAAK,GAAG,iBAAiB,CAAC;qBAC3B;iBACF;gBAED,QAAO,KAAK,EAAE;oBACZ,KAAK,aAAa;wBAChB,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,kEAAkE,CAAC,CAAC;wBACpF,MAAM;oBACR,KAAK,iBAAiB;wBACpB,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,qEAAqE,CAAC,CAAC;wBACvF,MAAM;oBACR,KAAK,SAAS,CAAC;oBACf,KAAK,eAAe,CAAC;oBACrB;wBACE,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,8DAA8D,CAAC,CAAC;iBACnF;aACF;QACH,CAAC;KAAA;IAEa,cAAc,CAAC,WAAkB;;YAC7C,OAAO,CAAC,GAAG,CAAC,sCAAsC,EAAE,WAAW,CAAC,CAAC;YACjE,MAAM,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,iCAAiC,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,EAAO,EAAC,aAAa,EAAE,WAAW,EAAC,CAAC,CAAC;QACzG,CAAC;KAAA;IAEa,iBAAiB,CAAC,WAAkB;;YAChD,OAAO,CAAC,GAAG,CAAC,yCAAyC,EAAE,WAAW,CAAC,CAAC;YACpE,MAAM,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,iCAAiC,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,EAAO,EAAC,aAAa,EAAE,WAAW,EAAC,CAAC,CAAC;QACzG,CAAC;KAAA;IAEa,WAAW,CAAC,qBAA4B;;YACpD,OAAO,CAAC,GAAG,CAAC,mCAAmC,EAAE,qBAAqB,CAAC,CAAC;YACxE,IAAI,MAAM,GAAO,EAAE,CAAC;YAEpB,IAAG,qBAAqB,IAAI,CAAC,EAAE;gBAC7B,MAAM,CAAC,sBAAsB,GAAG,KAAK,CAAC;gBACtC,MAAM,CAAC,qBAAqB,GAAG,CAAC,CAAC;aAClC;iBACI;gBACH,MAAM,CAAC,sBAAsB,GAAG,IAAI,CAAC;gBACrC,MAAM,CAAC,qBAAqB,GAAG,qBAAqB,CAAC;aACtD;YAED,MAAM,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,iCAAiC,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,MAAM,CAAC,CAAC;QAC9E,CAAC;KAAA;IAGa,YAAY,CAAC,SAAgB;;YACzC,OAAO,CAAC,GAAG,CAAC,oCAAoC,EAAE,SAAS,CAAC,CAAC;YAC7D,MAAM,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,iCAAiC,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,EAAO,EAAC,WAAW,EAAE,SAAS,EAAC,CAAC,CAAC;QACrG,CAAC;KAAA;IAEa,UAAU,CAAC,OAAc;;YACrC,OAAO,CAAC,GAAG,CAAC,kCAAkC,EAAE,OAAO,CAAC,CAAC;YACzD,MAAM,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,iCAAiC,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,EAAO,EAAC,SAAS,EAAE,OAAO,EAAC,CAAC,CAAC;QACjG,CAAC;KAAA;;wFA3PU,oBAAoB;kHAApB,oBAAoB;QC/CjC,yEAAwD;QACpD,yEAA4B;QAAA,oFAAoB;QAAA,4DAAM;QACtD,yEAA0B;QAEtB,+FAAwC;QAEpC,2EAAU;QACN,gIAA8C;QAC9C,yEAA4B;QACxB,sFAA+G;QACnH,4DAAM;QACV,4DAAW;QAGX,4EAAU;QACN,kIAA8C;QAC9C,0EAA6B;QACzB,sFAA6G;QACjH,4DAAM;QACV,4DAAW;QAGX,4EAAU;QACN,kIAAoD;QACpD,0EAA6B;QACzB,uFAA+G;QACnH,4DAAM;QACV,4DAAW;QACf,4DAAyB;QAC7B,4DAAM;QACV,4DAAM;QAEN,qEAA0D;;QAhCnC,wFAAgC;QASZ,0DAA+B;QAA/B,4FAA+B;QAQhC,0DAA+B;QAA/B,4FAA+B;QAQ9B,0DAA+B;QAA/B,4FAA+B;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACtBD;AAMH;;;;;;;;;;;ICC9D,0EAAwG;IACtG,0EAAyC;IAAA,+EAAmC;IAAA,yEAAc;IAAA,4DAAW;IAAA,4DAAM;IAC3G,0EAA0B;IAAA,6EAA0D;IAAlC,8WAAS,iCAAuB,IAAC;IAAE,2EAAU;IAAA,iEAAM;IAAA,4DAAW;IAAA,4DAAS;IAAA,4DAAM;IAC/H,6FAAmJ;IACrJ,4DAAM;;;;;IAJ0B,iFAAqB;IAGtB,0DAAwB;IAAxB,wFAAwB;;;;IAN3D,yEAAiD;IAC/C,yEAAmF;IAA9C,wUAAsB,6BAAsB,IAAC;IAEhF,+HAIM;IACR,4DAAM;IACR,4DAAM;;;IANsE,0DAAW;IAAX,kFAAW;;AD6BpF,MAAM,4BAA4B;IA4BvC,YACoB,GAAe,EACf,IAAiB,EACjB,IAAY,EACZ,KAAkB;QAHlB,QAAG,GAAH,GAAG,CAAY;QACf,SAAI,GAAJ,IAAI,CAAa;QACjB,SAAI,GAAJ,IAAI,CAAQ;QACZ,UAAK,GAAL,KAAK,CAAa;QA3BtC,kDAAkD;QAC3C,gBAAW,GAAwB,IAAI,+CAAa,CAAC,CAAC,CAAC,CAAC;QAC/D,8CAA8C;QACvC,iBAAY,GAA8B,EAAE,CAAC;QAG5C,iBAAY,GAAG;YACrB,gBAAgB,EAAE,CAAC,IAAI,EAAE,YAAY,EAAE,MAAM,EAAE,OAAO,EAAE,UAAU,EAAE,SAAS,EAAE,OAAO;gBACpE,WAAW,EAAE,WAAW,EAAE,SAAS;gBACnC,cAAc,EAAE,SAAS,EAAE,eAAe;gBAC1C,mBAAmB,EAAE,mBAAmB,CAAC;SAC5D,CAAC;QAmBA,IAAI,CAAC,OAAO,GAAG,EAAE,CAAC;QAClB,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;QAEnB,IAAI,CAAC,MAAM,GAAG,EAAE,CAAC;QAGjB,IAAI,CAAC,EAAE,GAAG;YACR,KAAK,EAAE;gBACL,KAAK,EAAW,GAAG;aACpB;YACD,MAAM,EAAE;gBACN,GAAG,EAAa,GAAG,EAAE,CAAC,IAAI,CAAC,QAAQ,EAAE;gBACrC,MAAM,EAAU,CAAC,KAAS,EAAE,EAAE,CAAC,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC;gBACtD,IAAI,EAAY,CAAC,KAAsB,EAAE,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC;aAClE;SACF,CAAC;IAEJ,CAAC;IAEM,QAAQ;QAEb,qDAAqD;QACrD,IAAI,CAAC,YAAY,CAAC,SAAS,CAAE,CAAO,OAAY,EAAE,EAAE,CAAC,iGAAI,CAAC,IAAI,CAAC,OAAO,CAAC,KAAE,CAAC;QAE1E,kFAAkF;QAClF,IAAI,CAAC,WAAW,CAAC,SAAS,CAAC,MAAM,CAAC,EAAE,CAAC,IAAI,CAAC,eAAe,CAAC,MAAM,CAAC,CAAC,CAAC;IAErE,CAAC;IAED;;;;OAIG;IACW,IAAI,CAAC,OAAW;;YAC5B,IAAI,CAAC,IAAI,CAAC,GAAG,CAAE,GAAS,EAAE,CAAC;gBACzB,IAAI;oBACF,OAAO,CAAC,GAAG,CAAC,4DAA4D,EAAE,OAAO,CAAC,CAAC;oBAEnF,8BAA8B;oBAC9B,KAAI,IAAI,KAAK,IAAI,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE;wBACrC,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,GAAG,OAAO,CAAC,KAAK,CAAC,CAAC;qBACtC;oBAED,IAAG,OAAO,CAAC,cAAc,CAAC,OAAO,CAAC,EAAE;wBAClC,IAAI,CAAC,EAAE,CAAC,KAAK,CAAC,KAAK,GAAG,OAAO,CAAC,KAAK,CAAC;qBACrC;oBAED,IAAG,OAAO,CAAC,wBAAwB,IAAI,OAAO,CAAC,wBAAwB,CAAC,MAAM,EAAE;wBAE9E,IAAI,IAAI,GAAO,MAAM,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,wBAAwB,EAAE,IAAI,CAAC,YAAY,CAAC,kBAAkB,CAAC,CAAC,CAAC;wBAC9G,IAAG,IAAI,EAAE;4BACP,KAAI,IAAI,CAAC,KAAK,EAAE,KAAK,CAAC,IAAI,IAAI,CAAC,OAAO,EAAE,EAAE;gCACxC,0EAA0E;gCAC1E,IAAG,KAAK,IAAI,IAAI,CAAC,MAAM,CAAC,MAAM,EAAE;oCAC9B,IAAI,IAAI,GAAG,IAAI,+CAAa,CAAC,CAAC,CAAC,CAAC;oCAChC,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;oCAC7B,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;oCACjB,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;iCACzB;gCACD,uDAAuD;qCAClD,IAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,IAAI,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,EAAG;oCACpE,IAAI,IAAI,GAAG,IAAI,+CAAa,CAAC,CAAC,CAAC,CAAC;oCAChC,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,GAAG,IAAI,CAAC;oCAChC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,GAAG,KAAK,CAAC;oCAC3B,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;iCAClB;6BAEF;4BACD,iCAAiC;4BACjC,IAAG,IAAI,CAAC,MAAM,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM,EAAE;gCACnC,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;gCAChC,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;6BACvC;yBACF;qBACF;oBAED,IAAG,OAAO,CAAC,SAAS,EAAE;wBACpB,IAAI,IAAI,GAAO,MAAM,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,2BAA2B,EAAE,CAAC,OAAO,CAAC,SAAS,CAAC,EAAE,CAAC,IAAI,EAAE,MAAM,EAAE,MAAM,EAAE,iBAAiB,CAAC,CAAC,CAAC;wBAChI,IAAG,IAAI,IAAI,IAAI,CAAC,MAAM,EAAE;4BACtB,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;yBACvB;qBACF;iBAEF;gBACD,OAAM,QAAQ,EAAE;oBAAC,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;iBAAC;YAC3C,CAAC,EAAC,CAAC;QACL,CAAC;KAAA;IAEa,UAAU,CAAC,GAAc,EAAE,MAAW;;YAClD,IAAI,IAAI,GAAO,MAAM,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,0CAA0C,EAC3C,GAAG,EACH,MAAM,EACN,OAAO,CACN,CAAC;YACpC,OAAO,IAAI,CAAC;QACd,CAAC;KAAA;IAEa,QAAQ;;YACpB,OAAO,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC;YAEzB,IAAI;gBACF,MAAM,KAAK,GAAG,MAAM,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,0CAA0C,EAAE;oBAC9E,IAAI,EAAE,SAAS,GAAG,IAAI,CAAC,MAAM,CAAC,IAAI;oBAClC,KAAK,EAAE,IAAI,CAAC,MAAM,CAAC,MAAM,GAAG,CAAC;oBAC7B,UAAU,EAAE,IAAI,CAAC,OAAO,CAAC,EAAE;oBAC3B,aAAa,EAAE,CAAC,CAAgB,8BAA8B;iBAC/D,CAAC,CAAC;gBAEH,IAAI,IAAI,GAAG,MAAM,IAAI,CAAC,UAAU,CAAC,CAAC,KAAK,CAAC,EAAE,CAAC,EAAE,IAAI,CAAC,YAAY,CAAC,kBAAkB,CAAC,CAAC,CAAC;gBAEpF,IAAI,IAAI,GAAG,IAAI,+CAAa,CAAC,CAAC,CAAC,CAAC;gBAChC,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;gBAC7B,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;gBAC1B,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;gBACnB,wBAAwB;gBACxB,kEAAkE;aACnE;YACD,OAAM,KAAK,EAAE;gBACX,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;aACpB;QACH,CAAC;KAAA;IAEa,WAAW,CAAC,KAAS;;YACjC,IAAI;gBACF,MAAM,QAAQ,GAAG,MAAM,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,0CAA0C,EAAE,CAAC,KAAK,CAAC,EAAE,CAAC,EAAE,IAAI,CAAC,CAAC;gBACrG,IAAI,KAAK,GAAG,IAAI,CAAC,MAAM,CAAC,SAAS,CAAE,CAAC,OAAO,EAAE,EAAE,CAAC,OAAO,CAAC,EAAE,IAAI,KAAK,CAAC,EAAE,CAAC,CAAC;gBACxE,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;gBAC7B,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;aACpC;YACD,OAAM,QAAQ,EAAE;gBACd,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;aACxB;QACH,CAAC;KAAA;IAEO,SAAS,CAAC,KAAsB;QACtC,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,aAAa,EAAE,KAAK,CAAC,YAAY,CAAC,CAAC;QACrD,0CAA0C;QAC1C,uEAAe,CAAC,IAAI,CAAC,MAAM,EAAE,KAAK,CAAC,aAAa,EAAE,KAAK,CAAC,YAAY,CAAC,CAAC;QACtE,uEAAe,CAAC,IAAI,CAAC,YAAY,EAAE,KAAK,CAAC,aAAa,EAAE,KAAK,CAAC,YAAY,CAAC,CAAC;QAE5E,qCAAqC;QACrC,KAAI,IAAI,KAAK,IAAI,IAAI,CAAC,MAAM,EAAE;YAC5B,IAAI,IAAI,GAAG,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;YAC9B,IAAI,CAAC,eAAe,CAAC,EAAC,EAAE,EAAE,IAAI,CAAC,EAAE,EAAE,KAAK,EAAE,QAAQ,CAAC,KAAK,CAAC,GAAG,CAAC,EAAC,CAAC,CAAC;SACjE;IAGH,CAAC;IAEa,eAAe,CAAC,KAAU;;YACtC,OAAO,CAAC,GAAG,CAAC,2DAA2D,EAAE,KAAK,CAAC,CAAC;YAEhF,IAAI;gBACF,IAAI,KAAK,GAAG,IAAI,CAAC,MAAM,CAAC,SAAS,CAAE,CAAC,OAAO,EAAE,EAAE,CAAC,OAAO,CAAC,EAAE,IAAI,KAAK,CAAC,EAAE,CAAC,CAAC;gBACxE,IAAI,OAAO,GAAG,IAAI,CAAC,MAAM,CAAC,IAAI,CAAE,CAAC,OAAO,EAAE,EAAE,CAAC,OAAO,CAAC,EAAE,IAAI,KAAK,CAAC,EAAE,CAAC,CAAC;gBAErE,+BAA+B;gBAE/B,IAAI,UAAU,GAAG,KAAK,CAAC;gBACvB,IAAI,gBAAgB,GAAO,EAAE,CAAC;gBAE9B,IAAG,KAAK,CAAC,cAAc,CAAC,MAAM,CAAC,IAAI,KAAK,CAAC,IAAI,IAAI,OAAO,CAAC,IAAI,EAAE;oBAC7D,MAAM,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;oBAC7B,UAAU,GAAG,IAAI,CAAC;iBACnB;gBAED,IAAG,KAAK,CAAC,cAAc,CAAC,SAAS,CAAC,IAAI,KAAK,CAAC,OAAO,IAAI,OAAO,CAAC,OAAO,EAAE;oBACtE,MAAM,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;oBAC7B,kCAAkC;oBAClC,gBAAgB,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;oBAC/B,UAAU,GAAG,IAAI,CAAC;iBACnB;gBAED,IAAG,KAAK,CAAC,cAAc,CAAC,eAAe,CAAC,IAAI,KAAK,CAAC,aAAa,IAAI,OAAO,CAAC,aAAa,EAAE;oBACxF,MAAM,IAAI,CAAC,eAAe,CAAC,KAAK,CAAC,CAAC;oBAClC,UAAU,GAAG,IAAI,CAAC;iBACnB;gBAED,IAAG,KAAK,CAAC,cAAc,CAAC,WAAW,CAAC,IAAI,KAAK,CAAC,SAAS,IAAI,OAAO,CAAC,SAAS,EAAE;oBAC5E,MAAM,IAAI,CAAC,cAAc,CAAC,KAAK,CAAC,CAAC;oBACjC,kCAAkC;oBAClC,gBAAgB,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;oBAC/B,UAAU,GAAG,IAAI,CAAC;iBACnB;gBAED,IAAG,KAAK,CAAC,cAAc,CAAC,UAAU,CAAC,IAAI,KAAK,CAAC,QAAQ,IAAI,OAAO,CAAC,QAAQ,EAAE;oBACzE,MAAM,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;oBAChC,UAAU,GAAG,IAAI,CAAC;iBACnB;gBAED,IAAI,CAAC,KAAK,CAAC,cAAc,CAAC,WAAW,CAAC,IAAI,KAAK,CAAC,SAAS,IAAI,OAAO,CAAC,SAAS,CAAC;uBAC5E,CAAC,KAAK,CAAC,cAAc,CAAC,SAAS,CAAC,IAAI,KAAK,CAAC,OAAO,IAAI,OAAO,CAAC,OAAO,CAAC,EAAG;oBACzE,MAAM,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;oBAC7B,UAAU,GAAG,IAAI,CAAC;iBACnB;gBAED,IAAG,KAAK,CAAC,cAAc,CAAC,SAAS,CAAC,IAAI,KAAK,CAAC,OAAO,IAAI,OAAO,CAAC,OAAO,EAAE;oBACtE,MAAM,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC;oBAC/B,UAAU,GAAG,IAAI,CAAC;iBACnB;gBAED,IAAG,KAAK,CAAC,cAAc,CAAC,OAAO,CAAC,IAAI,KAAK,CAAC,KAAK,IAAI,OAAO,CAAC,KAAK,EAAE;oBAChE,MAAM,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;oBAC9B,UAAU,GAAG,IAAI,CAAC;iBACnB;gBAED,IAAG,KAAK,CAAC,cAAc,CAAC,mBAAmB,CAAC,EAAE;oBAC5C,IAAI,IAAI,GAAG,KAAK,CAAC,iBAAiB,CAAC,MAAM,CAAE,CAAC,GAAO,EAAE,EAAE,CAAC,OAAO,CAAC,iBAAiB,CAAC,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;oBACvG,IAAG,IAAI,CAAC,MAAM,EAAE;wBACd,MAAM,IAAI,CAAC,qBAAqB,CAAC,KAAK,CAAC,CAAC;wBACxC,UAAU,GAAG,IAAI,CAAC;qBACnB;iBACF;gBAED,8EAA8E;gBAC9E,IAAG,KAAK,CAAC,cAAc,CAAC,SAAS,CAAC,EAAE;oBAClC,+DAA+D;oBAC/D,+DAA+D;oBAC/D,IAAI,YAAY,GAAG,IAAI,CAAC,YAAY,CAAC,kBAAkB,CAAC,CAAC;oBAEzD,IAAG,KAAK,CAAC,OAAO,CAAC,cAAc,CAAC,MAAM,CAAC,EAAE;wBACvC,IAAG,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE;4BACpC,YAAY,GAAG,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC;yBACnC;wBACD,4BAA4B;wBAC5B,IAAI,IAAI,GAAG,MAAM,IAAI,CAAC,UAAU,CAAC,CAAC,KAAK,CAAC,EAAE,CAAC,EAAE,YAAY,CAAC,CAAC;wBAC3D,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;qBACxC;oBAED,qCAAqC;oBACrC,IAAG,KAAK,CAAC,OAAO,CAAC,cAAc,CAAC,YAAY,CAAC,EAAE;wBAC7C,yFAAyF;wBACzF,gBAAgB,GAAG,CAAC,GAAG,gBAAgB,EAAE,GAAG,KAAK,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC;qBACvE;iBAEF;gBACD,kCAAkC;qBAC7B,IAAG,UAAU,EAAE;oBAElB,IAAI,IAAI,GAAG,MAAM,IAAI,CAAC,UAAU,CAAC,CAAC,KAAK,CAAC,EAAE,CAAC,EAAE,IAAI,CAAC,YAAY,CAAC,kBAAkB,CAAC,CAAC,CAAC;oBACpF,IAAI,MAAM,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;oBACrB,KAAI,IAAI,KAAK,IAAI,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE;wBACpC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,KAAK,CAAC,GAAG,MAAM,CAAC,KAAK,CAAC,CAAC;qBAC3C;oBACD,uCAAuC;oBACvC,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC;oBAClD,cAAc;oBACd,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,yBAAyB,CAAC,CAAC;iBAC5C;gBAED,0CAA0C;gBAC1C,IAAG,gBAAgB,CAAC,MAAM,EAAE;oBAC1B,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,EAAC,EAAE,EAAE,IAAI,CAAC,OAAO,CAAC,EAAE,EAAE,OAAO,EAAE,gBAAgB,EAAC,CAAC,CAAC;iBAC3E;aAEF;YACD,OAAM,QAAY,EAAE;gBAClB,OAAO,CAAC,IAAI,CAAC,kCAAkC,EAAE,QAAQ,CAAC,CAAC;gBAC3D,IAAI,KAAK,GAAU,SAAS,CAAC;gBAC7B,IAAG,QAAQ,IAAI,QAAQ,CAAC,cAAc,CAAC,OAAO,CAAC,IAAI,QAAQ,CAAC,OAAO,CAAC,CAAC,cAAc,CAAC,QAAQ,CAAC,EAAE;oBAC7F,IAAI,MAAM,GAAG,QAAQ,CAAC,OAAO,CAAC,CAAC,QAAQ,CAAC,CAAC;oBAEzC,IAAG,MAAM,CAAC,cAAc,CAAC,eAAe,CAAC,EAAE;wBACzC,KAAK,GAAG,eAAe,CAAC;qBACzB;yBACI,IAAG,MAAM,CAAC,cAAc,CAAC,aAAa,CAAC,EAAE;wBAC5C,KAAK,GAAG,aAAa,CAAC;qBACvB;yBACI,IAAG,MAAM,CAAC,cAAc,CAAC,iBAAiB,CAAC,EAAE;wBAChD,KAAK,GAAG,iBAAiB,CAAC;qBAC3B;iBACF;gBAED,QAAO,KAAK,EAAE;oBACZ,KAAK,aAAa;wBAChB,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,kEAAkE,CAAC,CAAC;wBACpF,MAAM;oBACR,KAAK,iBAAiB;wBACpB,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,qEAAqE,CAAC,CAAC;wBACvF,MAAM;oBACR,KAAK,SAAS,CAAC;oBACf,KAAK,eAAe,CAAC;oBACrB;wBACE,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,8DAA8D,CAAC,CAAC;iBACnF;aAEF;QACH,CAAC;KAAA;IAAA,CAAC;IAKY,UAAU,CAAC,KAAS;;YAChC,OAAO,CAAC,GAAG,CAAC,0CAA0C,EAAE,KAAK,CAAC,CAAC;YAC/D,MAAM,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,0CAA0C,EAAE,CAAC,KAAK,CAAC,EAAE,CAAC,EAAO,EAAC,MAAM,EAAE,KAAK,CAAC,IAAI,EAAC,CAAC,CAAC;QAC3G,CAAC;KAAA;IAEa,UAAU,CAAC,KAAS;;YAChC,OAAO,CAAC,GAAG,CAAC,0CAA0C,EAAE,KAAK,CAAC,CAAC;YAC/D,MAAM,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,0CAA0C,EAAE,CAAC,KAAK,CAAC,EAAE,CAAC,EAAO,EAAC,SAAS,EAAE,KAAK,CAAC,OAAO,EAAC,CAAC,CAAC;QACjH,CAAC;KAAA;IAEa,eAAe,CAAC,KAAS;;YACrC,OAAO,CAAC,GAAG,CAAC,+CAA+C,EAAE,KAAK,CAAC,CAAC;YACpE,MAAM,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,0CAA0C,EAAE,CAAC,KAAK,CAAC,EAAE,CAAC,EAAO,EAAC,eAAe,EAAE,KAAK,CAAC,aAAa,EAAC,CAAC,CAAC;QAC7H,CAAC;KAAA;IAEa,aAAa,CAAC,KAAS;;YACnC,OAAO,CAAC,GAAG,CAAC,6CAA6C,EAAE,KAAK,CAAC,CAAC;YAClE,MAAM,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,0CAA0C,EAAE,CAAC,KAAK,CAAC,EAAE,CAAC,EAAO,EAAC,UAAU,EAAE,KAAK,CAAC,QAAQ,EAAC,CAAC,CAAC;QACnH,CAAC;KAAA;IAEa,YAAY,CAAC,KAAS;;YAClC,OAAO,CAAC,GAAG,CAAC,4CAA4C,EAAE,KAAK,CAAC,CAAC;YACjE,MAAM,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,0CAA0C,EAAE,CAAC,KAAK,CAAC,EAAE,CAAC,EAAO,EAAC,SAAS,EAAE,KAAK,CAAC,OAAO,EAAC,CAAC,CAAC;QACjH,CAAC;KAAA;IAEa,WAAW,CAAC,KAAS;;YACjC,OAAO,CAAC,GAAG,CAAC,2CAA2C,EAAE,KAAK,CAAC,CAAC;YAChE,MAAM,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,0CAA0C,EAAE,CAAC,KAAK,CAAC,EAAE,CAAC,EAAO,EAAC,OAAO,EAAE,KAAK,CAAC,KAAK,EAAC,CAAC,CAAC;QAC7G,CAAC;KAAA;IAEa,cAAc,CAAC,KAAS;;YACpC,OAAO,CAAC,GAAG,CAAC,8CAA8C,EAAE,KAAK,CAAC,CAAC;YACnE,MAAM,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,0CAA0C,EAAE,CAAC,KAAK,CAAC,EAAE,CAAC,EAAO,EAAC,WAAW,EAAE,KAAK,CAAC,SAAS,EAAC,CAAC,CAAC;QACrH,CAAC;KAAA;IAEa,UAAU,CAAC,KAAS;;YAChC,OAAO,CAAC,GAAG,CAAC,0CAA0C,EAAE,KAAK,CAAC,CAAC;YAC/D,IAAG,KAAK,CAAC,SAAS,IAAI,KAAK,CAAC,OAAO,EAAE;gBACnC,MAAM,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,0CAA0C,EAAE,CAAC,KAAK,CAAC,EAAE,CAAC,EAAO,EAAC,WAAW,EAAE,KAAK,CAAC,SAAS,EAAE,SAAS,EAAE,KAAK,CAAC,OAAO,EAAC,CAAC,CAAC;aAC9I;iBACI,IAAG,KAAK,CAAC,SAAS,EAAE;gBACvB,MAAM,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,0CAA0C,EAAE,CAAC,KAAK,CAAC,EAAE,CAAC,EAAO,EAAC,WAAW,EAAE,KAAK,CAAC,SAAS,EAAC,CAAC,CAAC;aACpH;iBACI;gBACH,MAAM,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,0CAA0C,EAAE,CAAC,KAAK,CAAC,EAAE,CAAC,EAAO,EAAC,SAAS,EAAE,KAAK,CAAC,OAAO,EAAC,CAAC,CAAC;aAChH;QACH,CAAC;KAAA;IAEa,qBAAqB,CAAC,KAAS;;YAC3C,MAAM,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,0CAA0C,EAAE,CAAC,KAAK,CAAC,EAAE,CAAC,EAAO,EAAC,mBAAmB,EAAE,KAAK,CAAC,iBAAiB,EAAC,CAAC,CAAC;QACrI,CAAC;KAAA;;wGA1XU,4BAA4B;0HAA5B,4BAA4B;QCvCzC,yEAAuB;QAErB,yEAA+C;QAC7C,yEAAwD;QACtD,yEAAsB;QAAA,kFAAkB;QAAA,4EAA+F;QAA1B,oJAAS,mBAAe,IAAC;QAAE,2EAAU;QAAA,8DAAG;QAAA,4DAAW;QAAA,4DAAS;QAAA,4DAAM;QAC/K,yEAAiD;QAAA,uDAAgD;;QAAA,4DAAM;QACzG,4DAAM;QACN,0HASM;QACR,4DAAM;QAER,4DAAM;;QAdiD,0DAAgD;QAAhD,wLAAgD;QAEvE,0DAAmB;QAAnB,mFAAmB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACCe;AAEY;;;;;;;;;;;;;ICO1E,4EAAoI;IAAjC,8TAAS,6BAAsB,IAAC;IACjI,2EAAU;IAAA,gEAAK;IAAA,4DAAW;IAC5B,4DAAS;;;IAIL,gFAAmE;IACjE,uDACF;IAAA,4DAAa;;;IAFgC,iFAAqB;IAChE,0DACF;IADE,+HACF;;;IACA,6EAAqC;IAAA,oEAAG;IAAA,+EAAe;IAAA,4DAAI;IAAA,4DAAa;;;IAJ1E,sEAA4D;IAC1D,8JAEa;IACb,8JAAwE;IAC1E,4DAAM;;;IAJgC,0DAAO;IAAP,4EAAO;IAG9B,0DAAsB;IAAtB,qFAAsB;;ADUpC,MAAM,6CAA6C;IAqBxD,YACoB,GAAe,EACf,IAAiB,EACjB,IAAY,EACZ,KAAkB;QAHlB,QAAG,GAAH,GAAG,CAAY;QACf,SAAI,GAAJ,IAAI,CAAa;QACjB,SAAI,GAAJ,IAAI,CAAQ;QACZ,UAAK,GAAL,KAAK,CAAa;QAR/B,UAAK,GAAY,KAAK,CAAC;QAW5B,IAAI,CAAC,YAAY,GAAG,EAAE,CAAC;QACvB,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;QACpB,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC;QAGxB,IAAI,CAAC,EAAE,GAAG;YACR,WAAW,EAAE;gBACX,IAAI,EAAY,EAAE;gBAClB,SAAS,EAAO,IAAI,+CAAa,CAAC,CAAC,CAAC;gBACpC,YAAY,EAAI,IAAI,4CAAU,EAAE;gBAChC,MAAM,EAAU,CAAC,KAAS,EAAE,EAAE,CAAC,IAAI,CAAC,gBAAgB,CAAC,KAAK,CAAC;gBAC3D,WAAW,EAAK,CAAC,KAAS,EAAE,EAAE,CAAC,IAAI,CAAC,qBAAqB,CAAC,KAAK,CAAC;gBAChE,KAAK,EAAW,GAAG,EAAE,CAAC,IAAI,CAAC,eAAe,EAAE;gBAC5C,OAAO,EAAS,GAAG,EAAE,CAAC,IAAI,CAAC,iBAAiB,EAAE;gBAC9C,KAAK,EAAW,GAAG,EAAE,CAAC,IAAI,CAAC,eAAe,EAAE;gBAC5C,OAAO,EAAS,CAAC,IAAQ,EAAE,EAAE,CAAC,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC;aAC3D;YACD,OAAO,EAAE;gBACP,EAAE,EAAc,CAAC;gBACjB,IAAI,EAAY,EAAE;aACnB;SACF,CAAC;IAEJ,CAAC;IAGM,QAAQ;QAEb,IAAI,CAAC,iBAAiB,CAAC,SAAS,CAAE,CAAC,IAAS,EAAE,EAAE,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAE,CAAC;QAEnE;;WAEG;QACH,IAAI,CAAC,EAAE,CAAC,WAAW,CAAC,YAAY,GAAG,IAAI,CAAC,EAAE,CAAC,WAAW,CAAC,SAAS,CAAC,IAAI,CACnE,4DAAY,CAAC,GAAG,CAAC,EACjB,mDAAG,CAAE,CAAC,KAAS,EAAE,EAAE,CAAC,CAAC,OAAO,KAAK,KAAK,QAAQ,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,KAAK,IAAI,IAAI,CAAC,EAAC,GAAE,EAAC,MAAK,CAAC,IAAI,CAAC,CAAE,EACzF,wDAAQ,CAAE,CAAO,IAAW,EAAE,EAAE,CAAC,iGAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,KAAE,CAChE,CAAC;IAEJ,CAAC;IAED;;;;OAIG;IACW,IAAI,CAAC,YAAgB;;YACjC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAE,GAAG,EAAE;gBAClB,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;YACrB,CAAC,CAAC,CAAC;YAEH,IAAI,CAAC,IAAI,CAAC,GAAG,CAAE,GAAS,EAAE,CAAC;gBACzB,IAAI;oBAEF,4BAA4B;oBAC5B,KAAI,IAAI,KAAK,IAAI,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,EAAE;wBAC1C,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,GAAG,YAAY,CAAC,KAAK,CAAC,CAAC;qBAChD;oBAED,IAAG,YAAY,CAAC,UAAU,EAAE;wBAC1B,IAAI,IAAI,GAAO,MAAM,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,iCAAiC,EAAE,CAAC,YAAY,CAAC,UAAU,CAAC,EAAE,CAAC,IAAI,EAAE,MAAM,EAAE,KAAK,CAAC,CAAC,CAAC;wBACxH,IAAG,IAAI,IAAI,IAAI,CAAC,MAAM,EAAE;4BACtB,IAAI,OAAO,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;4BACtB,IAAI,CAAC,OAAO,GAAG,OAAO,CAAC;4BACvB,IAAI,CAAC,EAAE,CAAC,OAAO,CAAC,IAAI,GAAG,OAAO,CAAC,IAAI,GAAG,IAAI,GAAE,OAAO,CAAC,GAAG,GAAE,GAAG,CAAC;yBAC9D;qBACF;oBAED,IAAG,YAAY,CAAC,cAAc,EAAE;wBAC9B,IAAI,IAAI,GAAO,MAAM,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,iCAAiC,EAAE,CAAC,YAAY,CAAC,cAAc,CAAC,EAAE,CAAC,IAAI,EAAE,MAAM,EAAE,UAAU,CAAC,CAAC,CAAC;wBACjI,IAAG,IAAI,IAAI,IAAI,CAAC,MAAM,EAAE;4BACtB,IAAI,WAAW,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;4BAC1B,IAAI,CAAC,WAAW,GAAG,WAAW,CAAC;4BAC/B,IAAI,CAAC,EAAE,CAAC,WAAW,CAAC,IAAI,GAAG,WAAW,CAAC,IAAI,GAAG,IAAI,GAAE,WAAW,CAAC,QAAQ,GAAE,GAAG,CAAC;yBAC/E;qBACF;iBAIF;gBACD,OAAM,QAAQ,EAAE;oBAAC,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;iBAAC;gBACzC,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC;YACpB,CAAC,EAAC,CAAC;QACL,CAAC;KAAA;IAIO,qBAAqB,CAAC,KAAS;QACrC,IAAI,CAAC,EAAE,CAAC,WAAW,CAAC,SAAS,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;IACzD,CAAC;IAEO,eAAe;QACrB,IAAI,CAAC,EAAE,CAAC,WAAW,CAAC,SAAS,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;IACzC,CAAC;IAEO,iBAAiB,CAAC,WAAe;QACvC,OAAO,WAAW,CAAC,CAAC,CAAC,WAAW,CAAC,IAAI,GAAG,IAAI,GAAE,WAAW,CAAC,QAAQ,GAAE,GAAG,EAAC,CAAC,EAAE,CAAC;IAC9E,CAAC;IAEO,eAAe;QACrB,UAAU,CAAE,GAAG,EAAE;YACf,IAAI,CAAC,EAAE,CAAC,WAAW,CAAC,IAAI,GAAG,EAAE,CAAC;QAChC,CAAC,EAAE,GAAG,CAAC,CAAC;IACV,CAAC;IAEO,iBAAiB;QACvB,IAAG,IAAI,CAAC,WAAW,EAAE;YACnB,IAAI,CAAC,EAAE,CAAC,WAAW,CAAC,IAAI,GAAG,IAAI,CAAC,WAAW,CAAC,IAAI,GAAG,IAAI,GAAE,IAAI,CAAC,WAAW,CAAC,QAAQ,GAAE,GAAG,CAAC;SACzF;aACI;YACH,IAAI,CAAC,EAAE,CAAC,WAAW,CAAC,IAAI,GAAG,EAAE,CAAC;SAC/B;IACH,CAAC;IAGO,gBAAgB,CAAC,KAAS;QAChC,OAAO,CAAC,GAAG,CAAC,gDAAgD,EAAE,KAAK,CAAC;QAEpE,wBAAwB;QACxB,IAAG,KAAK,IAAI,KAAK,CAAC,MAAM,IAAI,KAAK,CAAC,MAAM,CAAC,KAAK,EAAE;YAC9C,IAAI,WAAW,GAAG,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC;YACrC,IAAI,CAAC,WAAW,GAAG,WAAW,CAAC;YAC/B,IAAI,CAAC,EAAE,CAAC,WAAW,CAAC,IAAI,GAAG,WAAW,CAAC,IAAI,GAAG,IAAI,GAAE,WAAW,CAAC,QAAQ,GAAE,GAAG,CAAC;YAC9E,mCAAmC;YACnC,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,EAAC,EAAE,EAAE,IAAI,CAAC,YAAY,CAAC,EAAE,EAAE,cAAc,EAAE,WAAW,CAAC,EAAE,EAAC,CAAC,CAAC;SAC1F;IACH,CAAC;IAEa,iBAAiB,CAAC,IAAY;;YAC1C,IAAI,QAAQ,GAAS,EAAE,CAAC;YACxB,IAAI;gBACF,IAAI,IAAI,GAAS,MAAM,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,iCAAiC,EAAE,CAAC,CAAC,MAAM,EAAE,OAAO,EAAE,GAAG,GAAC,IAAI,GAAC,GAAG,CAAC,CAAC,EAAE,CAAC,IAAI,EAAE,MAAM,EAAE,UAAU,CAAC,EAAE,MAAM,EAAE,KAAK,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC;gBAChK,QAAQ,GAAG,IAAI,CAAC;aACjB;YACD,OAAM,QAAQ,EAAE;gBACd,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;aACvB;YACD,OAAO,QAAQ,CAAC;QAClB,CAAC;KAAA;;0IAtKU,6CAA6C;2IAA7C,6CAA6C;QCjC1D,yEAAkB;QAChB,iFAAgB;QACd,4EAAW;QAAA,8EAAc;QAAA,4DAAY;QACrC,2EAOiD;QAHzC,0KAAS,sCAAkC,IAAC,4GACnC,0BAAsB,IADa,0GAEpC,4BAAwB,IAFY;QAJpD,4DAOiD;QAEjD,8EAA0B;QAAA,uDAAuC;QAAA,4DAAW;QAE5E,+IAES;QAET,yFAAoJ;QAAjD,uMAAkB,iCAA6B,IAAC;QACjJ,2IAKM;;QACR,4DAAmB;QAErB,4DAAiB;QACnB,4DAAM;;;QAvBM,0DAA0C;QAA1C,gFAA0C;QAOxC,0DAAe;QAAf,wEAAe;QAAC,0DAAuC;QAAvC,0HAAuC;QAE7C,0DAAgC;QAAhC,gGAAgC;QAIQ,0DAAsC;QAAtC,mGAAsC;QACzF,0DAA2C;QAA3C,mKAA2C;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACnBC;;;;;;;;;;;ICUjD,4EAA8D;IAC5D,oFACF;IAAA,4DAAY;;ADgBb,MAAM,6CAA6C;IAgBxD,YACoB,GAAe,EACf,IAAiB,EACjB,MAAiB,EACjB,IAAY,EACZ,KAAkB;QAJlB,QAAG,GAAH,GAAG,CAAY;QACf,SAAI,GAAJ,IAAI,CAAa;QACjB,WAAM,GAAN,MAAM,CAAW;QACjB,SAAI,GAAJ,IAAI,CAAQ;QACZ,UAAK,GAAL,KAAK,CAAa;QAT/B,UAAK,GAAY,KAAK,CAAC;QAY5B,IAAI,CAAC,QAAQ,GAAG,EAAE,CAAC;QAGnB,IAAI,CAAC,EAAE,GAAG;YACR,KAAK,EAAE;gBACL,KAAK,EAAW,GAAG;gBACnB,WAAW,EAAK,IAAI,uDAAW,CAAC,EAAE,EAAE,+DAAmB,CAAC;gBACxD,MAAM,EAAU,CAAC,KAAS,EAAE,EAAE,CAAC,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC;aACvD;YACD,IAAI,EAAE;gBACJ,KAAK,EAAW,EAAE;gBAClB,WAAW,EAAK,IAAI,uDAAW,CAAC,EAAE,EAAE,+DAAmB,CAAC;gBACxD,MAAM,EAAU,CAAC,KAAS,EAAE,EAAE,CAAC,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC;aACtD;SACF,CAAC;IAEJ,CAAC;IAGM,QAAQ;QAEb,IAAI,CAAC,aAAa,CAAC,SAAS,CAAE,CAAC,QAAa,EAAE,EAAE,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAE,CAAC;QAEvE;;WAEG;QAEH,IAAI,CAAC,EAAE,CAAC,KAAK,CAAC,WAAW,CAAC,YAAY,CAAC,SAAS,CAAE,CAAC,KAAY,EAAG,EAAE;YAClE,IAAI,CAAC,EAAE,CAAC,KAAK,CAAC,KAAK,GAAG,KAAK,CAAC;QAC9B,CAAC,CAAC,CAAC;IAGL,CAAC;IAED;;;;OAIG;IACW,IAAI,CAAC,QAAY;;YAC7B,IAAI,CAAC,IAAI,CAAC,GAAG,CAAE,GAAG,EAAE;gBAClB,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;YACrB,CAAC,CAAC,CAAC;YAEH,IAAI,CAAC,IAAI,CAAC,GAAG,CAAE,GAAS,EAAE,CAAC;gBACzB,IAAI;oBACF,OAAO,CAAC,GAAG,CAAC,6EAA6E,EAAE,QAAQ,CAAC,EAAE,EAAE,QAAQ,CAAC,CAAC;oBAElH,4BAA4B;oBAC5B,KAAI,IAAI,KAAK,IAAI,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE;wBACtC,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,GAAG,QAAQ,CAAC,KAAK,CAAC,CAAC;qBACxC;oBAED,IAAG,QAAQ,CAAC,cAAc,CAAC,MAAM,CAAC,EAAE;wBAClC,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,KAAK,GAAG,QAAQ,CAAC,IAAI,CAAC;wBACnC,IAAG,QAAQ,CAAC,IAAI,IAAI,SAAS,EAAE;4BAC7B,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,WAAW,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;yBAC1C;6BACI;4BACH,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,WAAW,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;yBACzC;qBACF;oBAED,IAAG,QAAQ,CAAC,cAAc,CAAC,OAAO,CAAC,EAAE;wBACnC,IAAI,CAAC,EAAE,CAAC,KAAK,CAAC,KAAK,GAAG,QAAQ,CAAC,KAAK,CAAC;wBACrC,IAAI,CAAC,EAAE,CAAC,KAAK,CAAC,WAAW,CAAC,QAAQ,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;qBACpD;iBAEF;gBACD,OAAM,QAAQ,EAAE;oBAAC,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;iBAAC;gBACzC,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC;YACpB,CAAC,EAAC,CAAC;QACL,CAAC;KAAA;IAIO,UAAU,CAAC,KAAS;QAC1B,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;QACnB,yBAAyB;QAEzB,IAAG,KAAK,EAAE;YACR,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,KAAK,GAAG,QAAQ,CAAC;SAC/B;aACI;YACH,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,KAAK,GAAG,SAAS,CAAC;SAChC;QACD,IAAG,IAAI,CAAC,EAAE,CAAC,KAAK,CAAC,KAAK,EAAE;YACtB,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,EAAC,EAAE,EAAE,IAAI,CAAC,QAAQ,CAAC,EAAE,EAAE,IAAI,EAAE,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,KAAK,EAAC,CAAC,CAAC;SAC5E;IACH,CAAC;IAEO,WAAW,CAAC,KAAS;QAC3B,IAAG,IAAI,CAAC,EAAE,CAAC,KAAK,CAAC,KAAK,EAAE;YACtB,mCAAmC;YACnC,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,EAAC,EAAE,EAAE,IAAI,CAAC,QAAQ,CAAC,EAAE,EAAE,KAAK,EAAE,IAAI,CAAC,EAAE,CAAC,KAAK,CAAC,KAAK,EAAC,CAAC,CAAC;SAE9E;IACH,CAAC;;0IAzHU,6CAA6C;2IAA7C,6CAA6C;QC/B1D,yEAAkB;QACZ,oFAA+E;QAC7E,8DAAE;QAAA,sFAAgG;QAA1C,uLAAU,kCAA8B,IAAC;QAAC,iEAAC;QAAA,4DAAmB;QACtH,yEAAqC;QACvC,4DAAiB;QACvB,4DAAM;QACN,yEAAkB;QACZ,oFAAyC;QACvC,2EAI8C;QADtC,wKAAQ,2BAAuB,IAAC;QAHxC,4DAI8C;QAC9C,qJAEY;QACd,4DAAiB;QACvB,4DAAM;;QAfsB,0DAAmC;QAAnC,gGAAmC;QAU/C,0DAAoC;QAApC,iGAAoC;QAChC,0DAAgD;QAAhD,gHAAgD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACTa;AAOf;AAEY;;;;;;;;;;;;;;;;ICL1E,6EAA2I;IAA3E,4aAA0E;IACxI,+EAAmC;IAAA,4EAAiB;IAAA,4DAAW;IACjE,4DAAS;;;;IACT,6EAA0I;IAA3E,4aAA0E;IACvI,+EAAmC;IAAA,+EAAoB;IAAA,4DAAW;IACpE,4DAAS;;;IAqBH,+EAAsG;IAAA,gEAAK;IAAA,4DAAW;;;IAGpH,uEAA2D;IAAA,sEAAW;IAAA,4DAAO;;;IAC7E,uEAAqD;IAAA,6EAAa;IAAA,4DAAO;;;IACzE,uEAAmD;IAAA,8EAAS;IAAA,4DAAO;;;;IAIrE,6EAA4H;IAA7B,yTAAS,0BAAkB,IAAC;IACzH,2EAAU;IAAA,gEAAK;IAAA,4DAAW;IAC5B,4DAAS;;;IAIL,iFAA2D;IACzD,uDACF;IAAA,4DAAa;;;IAF4B,8EAAiB;IACxD,0DACF;IADE,4FACF;;;IACA,6EAAqC;IAAA,oEAAG;IAAA,+EAAe;IAAA,4DAAI;IAAA,4DAAa;;;IAJ1E,sEAAwD;IACtD,uJAEa;IACb,uJAAwE;IAC1E,4DAAM;;;IAJ4B,0DAAO;IAAP,6EAAO;IAG1B,0DAAsB;IAAtB,sFAAsB;;;IAUzC,uEAAmC;IAAA,uDAAiB;IAAA,4DAAO;;;IAAxB,0DAAiB;IAAjB,qFAAiB;;;IAOlD,4EAA4D;IAC1D,oFACF;IAAA,4DAAY;;;;IARd,iFAA8C;IAC5C,4EAAW;IAAA,wEAAQ;IAAA,4DAAY;IAC/B,4EAG4C;IADpC,8TAAQ,uBAAe,IAAC;IAFhC,4DAG4C;IAC5C,gKAEY;IACd,4DAAiB;;;IAJP,0DAAkC;IAAlC,mGAAkC;IAC9B,0DAA8C;IAA9C,kHAA8C;;;IAQ5D,uEAAoC;IAAA,uDAAsB;IAAA,4DAAO;;;IAA7B,0DAAsB;IAAtB,0FAAsB;;;IAK1D,uEAAoC;IAAA,uDAA2C;;IAAA,4DAAO;;;IAAlD,0DAA2C;IAA3C,sLAA2C;;;IAK/E,uEAAoC;IAAA,uDAA+B;;IAAA,4DAAO;;;IAAtC,0DAA+B;IAA/B,2JAA+B;;;IAKnE,uEAAoC;IAAA,uDAA0B;;IAAA,4DAAO;;;IAAjC,0DAA0B;IAA1B,sJAA0B;;;IAK9D,uEAAoC;IAAA,uDAA6C;;IAAA,4DAAO;;;IAApD,0DAA6C;IAA7C,uLAA6C;;;;IAc/E,6EAAyH;IAA/D,waAA8D;IACtH,+EAAmC;IAAA,4EAAiB;IAAA,4DAAW;IACjE,4DAAS;;;;IACT,6EAAwH;IAA/D,waAA8D;IACrH,+EAAmC;IAAA,+EAAoB;IAAA,4DAAW;IACpE,4DAAS;;;IAWH,uEAAuC;IAAA,uDAAqC;;IAAA,4DAAO;;;IAA5C,0DAAqC;IAArC,4KAAqC;;;IAC5E,uEAAwC;IAAA,uDAA2B;;IAAA,4DAAO;;;IAAlC,0DAA2B;IAA3B,mJAA2B;;;IACnE,uEAAwC;IAAA,uDAAiB;IAAA,4DAAO;;;IAAxB,0DAAiB;IAAjB,kFAAiB;;;IAJ3D,sEAA0D;IACxD,uDACA;IAAA,uJAAmF;IACnF,uJAA0E;IAC1E,uJAAgE;IAClE,4DAAM;;;IAJJ,0DACA;IADA,0GACA;IAAO,0DAA8B;IAA9B,8FAA8B;IAC9B,0DAA+B;IAA/B,+FAA+B;IAC/B,0DAA+B;IAA/B,+FAA+B;;;IAN5C,0EAA4D;IAC1D,sEAAK;IACH,+IAKM;IACR,4DAAM;IACR,4DAAM;;;IAPuB,0DAAa;IAAb,qFAAa;;;IAjBhD,yEAA4F;IAC1F,0EAA+C;IAC7C,yEAAyB;IACvB,8IAES;IACT,8IAES;IACX,4DAAM;IACN,yEAA4B;IAC1B,0EAAoC;IACpC,uEAAM;IAAA,8EAAc;IAAA,4DAAO;IAC3B,4DAAM;IAEN,yIASM;IACR,4DAAM;IACR,4DAAM;IACR,4DAAM;;;;IA1BmB,0DAAuB;IAAvB,mFAAuB;IAEjB,0DAA+B;IAA/B,sFAA+B;IAG/B,0DAA8B;IAA9B,qFAA8B;IAS5B,0DAA+B;IAA/B,sFAA+B;;;;IAkB1D,6EAA4H;IAAjE,0aAAgE;IACzH,+EAAmC;IAAA,4EAAiB;IAAA,4DAAW;IACjE,4DAAS;;;;IACT,6EAA2H;IAAjE,0aAAgE;IACxH,+EAAmC;IAAA,+EAAoB;IAAA,4DAAW;IACpE,4DAAS;;;;IAWL,0EAAkF;IAChF,0EAA6B;IAAA,6EAAgE;IAAxC,oYAAS,yCAA6B,IAAC;IAAE,2EAAU;IAAA,iEAAM;IAAA,4DAAW;IAAA,4DAAS;IAAA,4DAAM;IACxI,2GAA+M;IACjN,4DAAM;;;;IADuC,0DAAwC;IAAxC,6GAAwC;;;IANzF,0EAA6D;IAE3D,0EAA4B;IAE1B,gJAGM;IACR,4DAAM;IACR,4DAAM;;;IAL8C,0DAAc;IAAd,sFAAc;;;;IAnBxE,yEAA4F;IAC1F,0EAA+C;IAC7C,yEAAyB;IACvB,8IAES;IACT,8IAES;IACX,4DAAM;IACN,yEAA4B;IAC1B,0EAAoC;IACpC,uEAAM;IAAA,2EAAW;IAAA,6EAAqI;IAAhE,yXAAS,0BAAkB,gCAA8B,KAAK,IAAC;IAAE,4EAAU;IAAA,+DAAG;IAAA,4DAAW;IAAA,4DAAS;IAAA,4DAAO;IAC/L,4DAAM;IAEN,2IASM;IACR,4DAAM;IACR,4DAAM;IACR,4DAAM;;;;IA1BmB,0DAAuB;IAAvB,mFAAuB;IAEjB,0DAAgC;IAAhC,uFAAgC;IAGhC,0DAA+B;IAA/B,sFAA+B;IAS7B,0DAAgC;IAAhC,uFAAgC;;;;AD5F9D,MAAM,qCAAqC;IAgChD,YACoB,GAAe,EACf,IAAiB,EACjB,MAAiB,EACjB,IAAY,EACZ,KAAkB;QAJlB,QAAG,GAAH,GAAG,CAAY;QACf,SAAI,GAAJ,IAAI,CAAa;QACjB,WAAM,GAAN,MAAM,CAAW;QACjB,SAAI,GAAJ,IAAI,CAAQ;QACZ,UAAK,GAAL,KAAK,CAAa;QA7BtC,kDAAkD;QAC3C,mBAAc,GAAwB,IAAI,+CAAa,CAAC,CAAC,CAAC,CAAC;QAClE,8CAA8C;QACvC,oBAAe,GAA8B,EAAE,CAAC;QAEvD,uBAAuB;QACf,iBAAY,GAAG;YACrB,mBAAmB,EAAE,CAAC,IAAI,EAAE,MAAM,EAAE,OAAO,EAAE,kBAAkB,EAAE,iBAAiB,CAAC;SACpF,CAAC;QAYK,UAAK,GAAY,KAAK,CAAC;QAY5B,IAAI,CAAC,IAAI,GAAG,EAAE,CAAC;QACf,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;QACpB,IAAI,CAAC,SAAS,GAAG,EAAE,CAAC;QAEpB,IAAI,CAAC,EAAE,GAAG;YACR,OAAO,EAAE;gBACP,IAAI,EAAY,EAAE;gBAClB,SAAS,EAAO,IAAI,+CAAa,CAAC,CAAC,CAAC;gBACpC,YAAY,EAAI,IAAI,4CAAU,EAAE;gBAChC,MAAM,EAAU,CAAC,KAAS,EAAE,EAAE,CAAC,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC;gBACxD,WAAW,EAAK,CAAC,KAAS,EAAE,EAAE,CAAC,IAAI,CAAC,kBAAkB,CAAC,KAAK,CAAC;gBAC7D,KAAK,EAAW,GAAG,EAAE,CAAC,IAAI,CAAC,YAAY,EAAE;gBACzC,OAAO,EAAS,GAAG,EAAE,CAAC,IAAI,CAAC,cAAc,EAAE;gBAC3C,KAAK,EAAW,GAAG,EAAE,CAAC,IAAI,CAAC,YAAY,EAAE;gBACzC,OAAO,EAAS,CAAC,IAAQ,EAAE,EAAE,CAAC,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC;aACxD;YACD,GAAG,EAAE;gBACH,KAAK,EAAW,CAAC;gBACjB,WAAW,EAAK,IAAI,uDAAW,CAAC,EAAE,EAAE,+DAAmB,CAAC;gBACxD,MAAM,EAAU,GAAG,EAAE,CAAC,IAAI,CAAC,SAAS,EAAE;aACvC;YACD,QAAQ,EAAE;gBACR,KAAK,EAAW,GAAG;aACpB;YACD,UAAU,EAAE;gBACV,KAAK,EAAW,GAAG;aACpB;YACD,QAAQ,EAAE;gBACR,KAAK,EAAW,GAAG;aACpB;YACD,GAAG,EAAE;gBACH,KAAK,EAAW,GAAG;aACpB;YACD,WAAW,EAAE;gBACX,KAAK,EAAW,GAAG;aACpB;YACD,SAAS,EAAE;gBACT,GAAG,EAAa,GAAG,EAAE,CAAC,IAAI,CAAC,WAAW,EAAE;gBACxC,MAAM,EAAU,CAAC,QAAY,EAAE,EAAE,CAAC,IAAI,CAAC,cAAc,CAAC,QAAQ,CAAC;aAChE;SACF,CAAC;IAEJ,CAAC;IAGM,QAAQ;QAEb,IAAI,CAAC,SAAS,CAAC,SAAS,CAAE,CAAC,IAAS,EAAE,EAAE,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAE,CAAC;QAE3D,kFAAkF;QAClF,IAAI,CAAC,cAAc,CAAC,SAAS,CAAC,MAAM,CAAC,EAAE,CAAC,IAAI,CAAC,kBAAkB,CAAC,MAAM,CAAC,CAAC,CAAC;QAEzE;;WAEG;QACH,IAAI,CAAC,EAAE,CAAC,OAAO,CAAC,YAAY,GAAG,IAAI,CAAC,EAAE,CAAC,OAAO,CAAC,SAAS,CAAC,IAAI,CAC3D,4DAAY,CAAC,GAAG,CAAC,EACjB,mDAAG,CAAE,CAAC,KAAS,EAAE,EAAE,CAAC,CAAC,OAAO,KAAK,KAAK,QAAQ,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,KAAK,IAAI,IAAI,CAAC,EAAC,GAAE,EAAC,MAAK,CAAC,IAAI,CAAC,CAAE,EACzF,wDAAQ,CAAE,CAAO,IAAW,EAAE,EAAE,CAAC,iGAAI,CAAC,cAAc,CAAC,IAAI,CAAC,KAAE,CAC7D,CAAC;QAEF,IAAI,CAAC,EAAE,CAAC,GAAG,CAAC,WAAW,CAAC,YAAY,CAAC,SAAS,CAAE,CAAC,KAAY,EAAG,EAAE;YAChE,IAAI,CAAC,EAAE,CAAC,GAAG,CAAC,KAAK,GAAG,KAAK,CAAC;QAC5B,CAAC,CAAC,CAAC;IACL,CAAC;IAED;;;;OAIG;IACW,IAAI,CAAC,IAAQ;;YACzB,IAAI,CAAC,IAAI,CAAC,GAAG,CAAE,GAAG,EAAE;gBAClB,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;YACrB,CAAC,CAAC,CAAC;YAEH,IAAI,CAAC,IAAI,CAAC,GAAG,CAAE,GAAS,EAAE,CAAC;gBACzB,IAAI;oBACF,OAAO,CAAC,GAAG,CAAC,qEAAqE,EAAE,IAAI,CAAC,EAAE,EAAE,IAAI,CAAC,CAAC;oBAElG,4BAA4B;oBAC5B,KAAI,IAAI,KAAK,IAAI,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE;wBAClC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC;qBAChC;oBAED,IAAG,IAAI,CAAC,UAAU,EAAE;wBAClB,IAAI,IAAI,GAAO,MAAM,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,iCAAiC,EAAE,CAAC,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,IAAI,EAAE,MAAM,EAAE,KAAK,CAAC,CAAC,CAAC;wBAChH,IAAG,IAAI,IAAI,IAAI,CAAC,MAAM,EAAE;4BACtB,IAAI,OAAO,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;4BACtB,IAAI,CAAC,OAAO,GAAG,OAAO,CAAC;4BACvB,IAAI,CAAC,EAAE,CAAC,OAAO,CAAC,IAAI,GAAG,OAAO,CAAC,IAAI,GAAG,IAAI,GAAE,OAAO,CAAC,GAAG,GAAE,GAAG,CAAC;yBAC9D;qBACF;oBAET,0IAA0I;oBAE1I,6EAA6E;oBACrE,IAAG,IAAI,CAAC,cAAc,CAAC,UAAU,CAAC,EAAE;wBAClC,IAAI,IAAI,GAAO,MAAM,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,oBAAoB,EAAE,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC,CAAC;wBAC3F,IAAG,IAAI,IAAI,IAAI,CAAC,MAAM,EAAE;4BACtB,IAAI,KAAK,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;4BACpB,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;4BACnB,6FAA6F;4BAC7F,IAAI,CAAC,EAAE,CAAC,UAAU,CAAC,KAAK,GAAG,KAAK,CAAC,KAAK,CAAC;yBACxC;6BACI;4BACH,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC;4BAClB,IAAI,CAAC,EAAE,CAAC,UAAU,CAAC,KAAK,GAAG,CAAC,CAAC;4BAC7B,IAAI,CAAC,EAAE,CAAC,GAAG,CAAC,KAAK,GAAG,CAAC,CAAC;yBACvB;qBACF;oBAED,IAAG,IAAI,CAAC,cAAc,CAAC,YAAY,CAAC,EAAE;wBACpC,IAAI,CAAC,EAAE,CAAC,UAAU,CAAC,KAAK,GAAG,IAAI,CAAC,UAAU,CAAC;qBAC5C;oBAED,IAAG,IAAI,CAAC,cAAc,CAAC,UAAU,CAAC,EAAE;wBAClC,IAAI,CAAC,EAAE,CAAC,GAAG,CAAC,KAAK,GAAG,IAAI,CAAC,QAAQ,CAAC;qBACnC;oBAED,IAAG,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,EAAE;wBAC/B,IAAI,CAAC,EAAE,CAAC,WAAW,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC;qBACxC;oBAED,IAAG,IAAI,CAAC,cAAc,CAAC,KAAK,CAAC,EAAE;wBAC7B,IAAI,CAAC,EAAE,CAAC,GAAG,CAAC,KAAK,GAAG,IAAI,CAAC,GAAG,CAAC;wBAC7B,IAAI,CAAC,EAAE,CAAC,GAAG,CAAC,WAAW,CAAC,QAAQ,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;qBAC5C;oBAED,IAAG,IAAI,CAAC,oBAAoB,EAAE;wBAC5B,IAAI,IAAI,GAAO,MAAM,IAAI,CAAC,mBAAmB,CAAC,IAAI,CAAC,oBAAoB,EAAE,IAAI,CAAC,YAAY,CAAC,qBAAqB,CAAC,CAAC,CAAC;wBACnH,IAAG,IAAI,EAAE;4BACP,KAAI,IAAI,CAAC,KAAK,EAAE,QAAQ,CAAC,IAAI,IAAI,CAAC,OAAO,EAAE,EAAE;gCAC3C,iFAAiF;gCACjF,IAAG,KAAK,IAAI,IAAI,CAAC,SAAS,CAAC,MAAM,EAAE;oCACjC,IAAI,IAAI,GAAG,IAAI,+CAAa,CAAC,CAAC,CAAC,CAAC;oCAChC,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;oCAChC,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;oCACpB,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;iCAC/B;gCACD,8DAA8D;qCACzD,IAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,IAAI,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,EAAG;oCAC1E,IAAI,IAAI,GAAG,IAAI,+CAAa,CAAC,CAAC,CAAC,CAAC;oCAChC,IAAI,CAAC,eAAe,CAAC,KAAK,CAAC,GAAG,IAAI,CAAC;oCACnC,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,GAAG,QAAQ,CAAC;oCACjC,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;iCACrB;6BACF;4BACD,qCAAqC;4BACrC,IAAG,IAAI,CAAC,SAAS,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM,EAAE;gCACtC,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;gCACnC,IAAI,CAAC,eAAe,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;6BAC1C;yBACF;wBACD,IAAI,QAAQ,GAAG,GAAG,CAAC;wBACnB,KAAI,IAAI,IAAI,IAAI,IAAI,CAAC,SAAS,EAAE;4BAC9B,IAAG,IAAI,CAAC,MAAM,CAAC,IAAI,SAAS,EAAE;gCAC5B,QAAQ,IAAI,IAAI,CAAC,OAAO,CAAC,CAAC;6BAC3B;yBACF;wBACD,IAAI,CAAC,EAAE,CAAC,QAAQ,CAAC,KAAK,GAAG,QAAQ,CAAC;qBACnC;oBAED,8BAA8B;oBAC9B,IAAG,IAAI,CAAC,kBAAkB,EAAE;wBAC1B,IAAI,QAAQ,GAAG,CAAC,CAAC;wBACjB,MAAM,QAAQ,GAAO,MAAM,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,kBAAkB,EAAE,IAAI,CAAC,YAAY,CAAC,qBAAqB,CAAC,CAAC,CAAC;wBACrH,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;wBACzB,KAAI,IAAI,OAAO,IAAI,IAAI,CAAC,QAAQ,EAAE;4BAChC,IAAG,OAAO,CAAC,MAAM,CAAC,IAAI,SAAS,EAAE;gCAC/B,QAAQ,IAAI,OAAO,CAAC,OAAO,CAAC,CAAC;6BAC9B;yBACF;wBAED,IAAI,CAAC,EAAE,CAAC,QAAQ,CAAC,KAAK,GAAG,QAAQ,CAAC;qBACnC;iBAGF;gBACD,OAAM,QAAQ,EAAE;oBAAC,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;iBAAC;gBACzC,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC;YACpB,CAAC,EAAC,CAAC;QACL,CAAC;KAAA;IAGD;;;OAGG;IACY,kBAAkB,CAAC,QAAa;;YAC7C,OAAO,CAAC,GAAG,CAAC,oEAAoE,EAAE,QAAQ,CAAC,CAAC;YAE5F,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;YAE5B,IAAI;gBAEF,IAAI,UAAU,GAAG,KAAK,CAAC;gBACvB,IAAI,KAAK,GAAG,IAAI,CAAC,SAAS,CAAC,SAAS,CAAE,CAAC,OAAW,EAAE,EAAE,CAAC,OAAO,CAAC,EAAE,IAAI,QAAQ,CAAC,EAAE,CAAC,CAAC;gBAClF,IAAI,MAAM,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAE,CAAC,OAAW,EAAE,EAAE,CAAC,OAAO,CAAC,EAAE,IAAI,QAAQ,CAAC,EAAE,CAAC,CAAC;gBAE9E,IAAG,QAAQ,CAAC,cAAc,CAAC,OAAO,CAAC,IAAI,QAAQ,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,EAAE;oBACrE,MAAM,IAAI,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC;oBACpC,UAAU,GAAG,IAAI,CAAC;iBACnB;gBAED,IAAG,QAAQ,CAAC,cAAc,CAAC,MAAM,CAAC,IAAI,QAAQ,CAAC,IAAI,IAAI,MAAM,CAAC,IAAI,EAAE;oBAClE,MAAM,IAAI,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC;oBACpC,UAAU,GAAG,IAAI,CAAC;iBACnB;gBAED,IAAG,UAAU,EAAE;oBACb,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,EAAC,EAAE,EAAE,IAAI,CAAC,IAAI,CAAC,EAAE,EAAE,kBAAkB,EAAE,IAAI,EAAC,CAAC,CAAC;iBACpE;aAEF;YACD,OAAM,KAAK,EAAE;gBACX,OAAO,CAAC,IAAI,CAAC,kCAAkC,EAAE,KAAK,CAAC,CAAC;gBACxD,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,8DAA8D,CAAC,CAAC;aACjF;QACH,CAAC;KAAA;IAEO,kBAAkB,CAAC,KAAS;QAClC,IAAI,CAAC,EAAE,CAAC,OAAO,CAAC,SAAS,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;IACrD,CAAC;IAEO,YAAY;QAClB,IAAI,CAAC,EAAE,CAAC,OAAO,CAAC,SAAS,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;IACrC,CAAC;IAEO,cAAc,CAAC,OAAW;QAChC,OAAO,OAAO,CAAC,CAAC,CAAC,OAAO,CAAC,IAAI,GAAG,IAAI,GAAE,OAAO,CAAC,GAAG,GAAE,GAAG,EAAC,CAAC,EAAE,CAAC;IAC7D,CAAC;IAEO,YAAY;QAClB,UAAU,CAAE,GAAG,EAAE;YACf,IAAI,CAAC,EAAE,CAAC,OAAO,CAAC,IAAI,GAAG,EAAE,CAAC;QAC5B,CAAC,EAAE,GAAG,CAAC,CAAC;IACV,CAAC;IAEO,cAAc;QACpB,IAAG,IAAI,CAAC,OAAO,EAAE;YACf,IAAI,CAAC,EAAE,CAAC,OAAO,CAAC,IAAI,GAAG,IAAI,CAAC,OAAO,CAAC,IAAI,GAAG,IAAI,GAAE,IAAI,CAAC,OAAO,CAAC,GAAG,GAAE,GAAG,CAAC;SACxE;aACI;YACH,IAAI,CAAC,EAAE,CAAC,OAAO,CAAC,IAAI,GAAG,EAAE,CAAC;SAC3B;IACH,CAAC;IAGO,aAAa,CAAC,KAAS;QAC7B,OAAO,CAAC,GAAG,CAAC,6CAA6C,EAAE,KAAK,CAAC;QAEjE,wBAAwB;QACxB,IAAG,KAAK,IAAI,KAAK,CAAC,MAAM,IAAI,KAAK,CAAC,MAAM,CAAC,KAAK,EAAE;YAC9C,IAAI,OAAO,GAAG,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC;YACjC,IAAI,CAAC,OAAO,GAAG,OAAO,CAAC;YACvB,IAAI,CAAC,EAAE,CAAC,OAAO,CAAC,IAAI,GAAG,OAAO,CAAC,IAAI,GAAG,IAAI,GAAE,OAAO,CAAC,GAAG,GAAE,GAAG,CAAC;YAC7D,mCAAmC;YACnC,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,EAAC,EAAE,EAAE,IAAI,CAAC,IAAI,CAAC,EAAE,EAAE,UAAU,EAAE,OAAO,CAAC,EAAE,EAAE,OAAO,EAAE,EAAC,IAAI,EAAE,CAAC,OAAO,CAAC,EAAC,EAAC,CAAC,CAAC;SAC9F;IAEH,CAAC;IAEO,SAAS;QACf,mCAAmC;QACnC,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,EAAC,EAAE,EAAE,IAAI,CAAC,IAAI,CAAC,EAAE,EAAE,GAAG,EAAE,IAAI,CAAC,EAAE,CAAC,GAAG,CAAC,KAAK,EAAE,OAAO,EAAE,EAAC,IAAI,EAAE,CAAC,OAAO,CAAC,EAAC,EAAC,CAAC,CAAC;IAC/F,CAAC;IAEa,cAAc,CAAC,IAAY;;YAC3C;;;;cAIE;YACE,IAAI,QAAQ,GAAS,EAAE,CAAC;YACxB,IAAI;gBACF,IAAI,IAAI,GAAS,MAAM,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,iCAAiC,EAAE,CAAC,CAAC,MAAM,EAAE,OAAO,EAAE,GAAG,GAAC,IAAI,GAAC,GAAG,CAAC,CAAC,EAAE,CAAC,IAAI,EAAE,MAAM,EAAE,KAAK,CAAC,EAAE,MAAM,EAAE,KAAK,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC;gBAC3J,QAAQ,GAAG,IAAI,CAAC;aACjB;YACD,OAAM,QAAQ,EAAE;gBACd,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;aACvB;YACD,OAAO,QAAQ,CAAC;QAClB,CAAC;KAAA;IAGa,iBAAiB,CAAC,GAAc,EAAE,MAAU;;YACxD,IAAI,IAAI,GAAS,MAAM,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,6CAA6C,EAAE,GAAG,EAAE,MAAM,CAAC,CAAC;YACjG,OAAO,IAAI,CAAC;QACd,CAAC;KAAA;IAEa,mBAAmB,CAAC,GAAc,EAAE,MAAU;;YAC1D,IAAI,IAAI,GAAS,MAAM,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,6CAA6C,EAAE,GAAG,EAAE,MAAM,CAAC,CAAC;YACjG,OAAO,IAAI,CAAC;QACd,CAAC;KAAA;IAGa,WAAW;;YAEvB,IAAI;gBACF,MAAM,OAAO,GAAG,MAAM,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,6CAA6C,EAAE;oBACnF,UAAU,EAAE,IAAI,CAAC,IAAI,CAAC,UAAU;oBAChC,qBAAqB,EAAE,IAAI,CAAC,IAAI,CAAC,qBAAqB;oBACtD,eAAe,EAAE,IAAI,CAAC,IAAI,CAAC,EAAE;iBAC9B,CAAC,CAAC;gBAEH,wBAAwB;gBACxB,8EAA8E;gBAE9E,IAAI,QAAQ,GAAG,EAAC,EAAE,EAAE,OAAO,CAAC,EAAE,EAAE,IAAI,EAAE,SAAS,EAAE,KAAK,EAAE,CAAC,EAAC,CAAC;gBAE3D,IAAI,IAAI,GAAG,IAAI,+CAAa,CAAC,CAAC,CAAC,CAAC;gBAChC,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;gBAChC,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;gBACpB,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;aAE/B;YACD,OAAM,KAAK,EAAE;gBACX,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;aACpB;QAEH,CAAC;KAAA;IAEa,cAAc,CAAC,QAAa;;YACxC,6FAA6F;YAC7F,MAAM,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,qCAAqC,EAAE,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,EAAC,kBAAkB,EAAE,CAAC,CAAC,QAAQ,CAAC,EAAE,CAAC,EAAC,EAAE,QAAQ,CAAC,CAAC;YAC7H,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,EAAC,EAAE,EAAE,IAAI,CAAC,IAAI,CAAC,EAAE,EAAE,kBAAkB,EAAE,IAAI,EAAC,CAAC,CAAC;QACrE,CAAC;KAAA;IAEa,cAAc,CAAC,QAAY;;YACvC,MAAM,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,6CAA6C,EAAE,CAAC,QAAQ,CAAC,EAAE,CAAC,EAAE,QAAQ,CAAC,CAAC;QAChG,CAAC;KAAA;;0HAnXU,qCAAqC;mIAArC,qCAAqC;QC3DlD,uEAAyH;QAIzH,yEAA0C;QACxC,yEAA+D;QAC7D,uIAES;QACT,uIAES;QACX,4DAAM;QAEN,yEAA6B;QAG3B,yEAA2B;QAGzB,yEAAkB;QAChB,iFAAgB;QACd,6EAAW;QAAA,mEAAO;QAAA,4DAAY;QAC9B,4EAOiD;QAHzC,mKAAS,kCAA8B,IAAC,qGAC/B,sBAAkB,IADa,mGAEhC,wBAAoB,IAFY;QAJhD,4DAOiD;QAEjD,6IAAsH;QACtH,4EAAU;QAAA,gEAAI;QAAA,4DAAW;QACzB,gFAA0B;QACxB,sIAA6E;QAC7E,sIAAyE;QACzE,sIAAmE;QACrE,4DAAW;QAGX,0IAES;QAET,4FAAyI;QAA7C,gMAAkB,6BAAyB,IAAC;QACtI,oIAKM;;QACR,4DAAmB;QAErB,4DAAiB;QACnB,4DAAM;QAIN,2EAAsE;QACpE,sIAA2D;QAC3D,0JASiB;QACnB,4DAAM;QAGN,2EAAwC;QACtC,sIAAiE;QACnE,4DAAM;QAGN,2EAAwC;QACtC,sIAAsF;QACxF,4DAAM;QAGN,2EAAwC;QACtC,sIAA0E;QAC5E,4DAAM;QAGN,2EAAwC;QACtC,sIAAqE;QACvE,4DAAM;QAGN,2EAAwC;QACtC,sIAAwF;QAC1F,4DAAM;QAGN,sEAAqC;QAEvC,4DAAM;QAKN,qIA2BM;QAGN,qIA2BM;QAER,4DAAM;QACR,4DAAM;;;;QAtKe,+VAA6F;QAIhG,0DAAuB;QAAvB,+EAAuB;QACd,0DAAqC;QAArC,6FAAqC;QACnC,0DAAqC;QAArC,4FAAqC;QAGrC,0DAAoC;QAApC,2FAAoC;QAgB/C,0DAAuC;QAAvC,gFAAuC;QAOpC,0DAAkD;QAAlD,kHAAkD;QAEnD,0DAAe;QAAf,wEAAe;QAChB,0DAAkD;QAAlD,kHAAkD;QAClD,0DAA4C;QAA5C,4GAA4C;QAC5C,0DAA0C;QAA1C,0GAA0C;QAI/B,0DAA4B;QAA5B,4FAA4B;QAIS,0DAAkC;QAAlC,+FAAkC;QAClF,0DAAuC;QAAvC,gKAAuC;QAavB,0DAAwC;QAAxC,gGAAwC;QAC5D,0DAA0B;QAA1B,0FAA0B;QAChB,0DAA2B;QAA3B,2FAA2B;QAcrC,0DAA2B;QAA3B,2FAA2B;QAK3B,0DAA2B;QAA3B,2FAA2B;QAK3B,0DAA2B;QAA3B,2FAA2B;QAK3B,0DAA2B;QAA3B,2FAA2B;QAK3B,0DAA2B;QAA3B,2FAA2B;QAWV,0DAA8D;QAA9D,yHAA8D;QA8B9D,0DAA8D;QAA9D,yHAA8D;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACtIb;AAOf;AAEY;AAER;;;;;;;;;;;;;;;;;;;;;ICLlE,6EAAqI;IAAvE,waAAsE;IAClI,+EAAmC;IAAA,4EAAiB;IAAA,4DAAW;IACjE,4DAAS;;;;IACT,6EAAoI;IAAvE,waAAsE;IACjI,+EAAmC;IAAA,+EAAoB;IAAA,4DAAW;IACpE,4DAAS;;;IAgBH,4EAA6D;IAC3D,oFACF;IAAA,4DAAY;;;;IAfpB,yEAAiE;IAE/D,yEAAiB;IAGf,0EAAwC;IACtC,qFAA+B;IAC7B,4EAAW;IAAA,uFAAkB;IAAA,4DAAY;IACzC,4EAG6C;IADrC,8SAAQ,wBAAgB,IAAC;IAFjC,4DAG6C;IAC7C,2EAAU;IAAA,wFAAwB;IAAA,4DAAW;IAC7C,gJAEY;IACd,4DAAiB;IACnB,4DAAM;IACR,4DAAM;IACR,4DAAM;;;IARU,0DAAmC;IAAnC,mGAAmC;IAE/B,0DAA+C;IAA/C,kHAA+C;;;IAqB3D,4EAA6D;IAC3D,oFACF;IAAA,4DAAY;;;IA6BZ,4EAA2E;IACzE,oGACF;IAAA,4DAAY;;;;IAuBZ,6EAAkI;IAAhC,4TAAS,6BAAqB,IAAC;IAC/H,2EAAU;IAAA,gEAAK;IAAA,4DAAW;IAC5B,4DAAS;;;IAIL,iFAAiE;IAC/D,uDACF;IAAA,4DAAa;;;IAF+B,iFAAoB;IAC9D,0DACF;IADE,+FACF;;;IACA,6EAAqC;IAAA,oEAAG;IAAA,+EAAe;IAAA,4DAAI;IAAA,4DAAa;;;IAJ1E,sEAA2D;IACzD,yJAEa;IACb,yJAAwE;IAC1E,4DAAM;;;IAJ+B,0DAAO;IAAP,6EAAO;IAG7B,0DAAsB;IAAtB,sFAAsB;;;;IAgDvC,6EAAsH;IAA1B,kUAAS,uBAAe,IAAC;IACnH,2EAAU;IAAA,gEAAK;IAAA,4DAAW;IAC5B,4DAAS;;;IAIL,iFAAqD;IACnD,uDACF;IAAA,4DAAa;;;IAFyB,2EAAc;IAClD,0DACF;IADE,yFACF;;;IACA,6EAAqC;IAAA,oEAAG;IAAA,+EAAe;IAAA,4DAAI;IAAA,4DAAa;;;IAJ1E,sEAAqD;IACnD,+JAEa;IACb,+JAAwE;IAC1E,4DAAM;;;IAJyB,0DAAO;IAAP,6EAAO;IAGvB,0DAAsB;IAAtB,sFAAsB;;;;IArB3C,0EAAqE;IACnE,iFAAiB;IACf,4EAAW;IAAA,sFAAiB;IAAA,4DAAY;IACxC,4EAOiD;IAHzC,8TAAS,mCAA2B,IAAC,gQAC5B,uBAAe,IADa,8PAE7B,yBAAiB,IAFY;IAJ7C,4DAOiD;IAEjD,iJAES;IAET,2FAAqJ;IAA/D,2VAAkB,uBAAe,MAAM,sBAAsB,IAAC;IAClJ,2IAKM;;IACR,4DAAmB;IAEnB,gFAA+C;IAC7C,wEAAM;IAAA,sGAAgC;IAAA,4DAAO;IAC/C,4DAAW;IACb,4DAAiB;IACnB,4DAAM;;;;IAxBM,0DAAoC;IAApC,iFAAoC;IAOxB,0DAAyB;IAAzB,6FAAyB;IAIS,0DAA+B;IAA/B,gGAA+B;IAC5E,0DAAoC;IAApC,+JAAoC;IAQnC,0DAAiB;IAAjB,0EAAiB;;;;IAO/B,0EAA2C;IACzC,qFAAsD;IACpD,uFAAuG;IAAvD,2UAAU,uBAAe,WAAW,iBAAiB,IAAC;IAAC,8FAA8B;IAAA,4DAAmB;IACxJ,0EAAqC;IACvC,4DAAiB;IACnB,4DAAM;;;IAHgB,0DAA6B;IAA7B,8FAA6B;;;;IApJvD,yEAAkE;IAEhE,yEAAiB;IAGf,0EAAwC;IACtC,qFAA+B;IAC7B,4EAAW;IAAA,uFAAkB;IAAA,4DAAY;IACzC,4EAG6C;IADrC,8SAAQ,wBAAgB,IAAC;IAFjC,4DAG6C;IAC7C,2EAAU;IAAA,wFAAwB;IAAA,4DAAW;IAC7C,gJAEY;IACd,4DAAiB;IACnB,4DAAM;IAGN,2EAA4C;IAC1C,kFAAiB;IACf,6EAAW;IAAA,gFAAe;IAAA,4DAAY;IACtC,4FACyC;IACvC,6EAA2H;IAA9E,+SAAQ,6BAAqB,IAAC;IAA3E,4DAA2H;IAC3H,6EAAuH;IAA5E,+SAAQ,6BAAqB,IAAC;IAAzE,4DAAuH;IACzH,4DAAuB;IACvB,wFAAwF;IACxF,iGAAgF;IAAjC,mUAAU,6BAAqB,IAAC;IAAC,4DAAwB;IACxG,gFAA0B;IAAA,0EAAQ;IAAA,wDAAoF;IAAA,4DAAS;IAAA,4DAAW;IAC5I,4DAAiB;IACnB,4DAAM;IAGN,2EAA4C;IAC1C,kFAAgB;IACd,6EAAW;IAAA,wEAAY;IAAA,4DAAY;IACnC,6EAI2D;IAFnD,+SAAQ,sCAA8B,IAAC;IAF/C,4DAI2D;IAC3D,4EAAU;IAAA,+EAAc;IAAA,4DAAW;IACnC,kJAEY;IACd,4DAAiB;IACnB,4DAAM;IAER,4DAAM;IAEN,0EAAiB;IAKf,2EAA4C;IAC1C,kFAAgB;IACd,6EAAW;IAAA,oFAAmB;IAAA,4DAAY;IAC1C,6EAOiD;IAHzC,uTAAS,yCAAiC,IAAC,yPAClC,6BAAqB,IADa,uPAEnC,+BAAuB,IAFY;IAJnD,4DAOiD;IAEjD,4IAES;IAET,4FAAiJ;IAAhD,oVAAkB,oCAA4B,IAAC;IAC9I,sIAKM;;IACR,4DAAmB;IAEnB,gFAA+C;IAC7C,wEAAM;IAAA,mGAAkC;IAAA,4DAAO;IACjD,4DAAW;IACb,4DAAiB;IACnB,4DAAM;IAGN,2EAA4C;IAC1C,kFAAgB;IACd,6EAAW;IAAA,+EAAc;IAAA,4DAAY;IACrC,kFAAiG;IAAnD,gVAAmB,sCAA8B,IAAC;IAC9F,kFAAuB;IAAA,8DAAE;IAAA,4DAAa;IACtC,kFAAuB;IAAA,8DAAE;IAAA,4DAAa;IACxC,4DAAa;IACf,4DAAiB;IACnB,4DAAM;IAGR,4DAAM;IAGN,0EAAiB;IAGf,2EAA4C;IAC5C,sFAAsD;IACpD,wFAAqH;IAAtD,oUAAU,uBAAe,UAAU,iBAAiB,IAAC;IAAC,8EAAkB;IAAA,4DAAmB;IAC1J,2EAAqC;IACvC,4DAAiB;IACnB,4DAAM;IAGJ,uIA6BM;IAGN,sIAKM;IAER,4DAAM;IAER,4DAAM;;;;;IAhJU,0DAAmC;IAAnC,mGAAmC;IAE/B,0DAA+C;IAA/C,kHAA+C;IAWzD,0DAAsC;IAAtC,6EAAsC;IACsC,0DAA8C;IAA9C,8GAA8C;IAChD,0DAA4C;IAA5C,4GAA4C;IAEvF,0DAA8B;IAA9B,qEAA8B;IAErD,0DAAe;IAAf,wEAAe;IAAS,0DAAoF;IAApF,sLAAoF;IAW9G,0DAAqC;IAArC,qGAAqC;IAGjC,0DAA6D;IAA7D,gIAA6D;IAkBjE,0DAAyC;IAAzC,iFAAyC;IAO7B,0DAA+B;IAA/B,kGAA+B;IAIQ,0DAAqC;IAArC,qGAAqC;IACvF,0DAA0C;IAA1C,sKAA0C;IAQzC,0DAAiB;IAAjB,0EAAiB;IAUf,0DAAiC;IAAjC,iGAAiC;IAgBb,0DAA4B;IAA5B,4FAA4B;IAMnB,0DAAsB;IAAtB,yFAAsB;IAgChD,0DAAsB;IAAtB,yFAAsB;;;;IAmB3C,6EAAmH;IAA3D,6ZAA0D;IAChH,+EAAmC;IAAA,4EAAiB;IAAA,4DAAW;IACjE,4DAAS;;;;IACT,6EAAkH;IAA3D,6ZAA0D;IAC/G,+EAAmC;IAAA,+EAAoB;IAAA,4DAAW;IACpE,4DAAS;;;;IAKkC,6EAAyH;IAAzB,qTAAS,sBAAc,IAAC;IAAE,2EAAU;IAAA,8DAAG;IAAA,4DAAW;IAAA,4DAAS;;;;IAuBhK,6EAAmF;IAAhC,6ZAAS,iCAAqB,IAAC;IAAE,2EAAU;IAAA,iEAAM;IAAA,4DAAW;IAAA,4DAAS;;;IAFtJ,0EAAsG;IACpG,0EAA0C;IAAA,+EAAmC;IAAA,yEAAc;IAAA,4DAAW;IAAA,4DAAM;IAC5G,0EAA4B;IAAA,iJAAwH;IAAA,4DAAM;IAC1J,kGAAqJ;IACvJ,4DAAM;;;;;IAJ4B,iFAAoB;IAEf,0DAAwB;IAAxB,4FAAwB;IAC3B,0DAAoB;IAApB,qFAAoB;;;;IArBhE,yEAAiD;IAC7C,0EAA0B;IACxB,0EAA6B;IAC3B,0EAAyC;IACvC,0EAAoD;IAAA,8DAAG;IAAA,4DAAM;IAC7D,0EAA0B;IAAA,mEAAG;IAAA,4DAAM;IACnC,0EAA0B;IAAA,mEAAG;IAAA,4DAAM;IACnC,2EAA0B;IAAA,gEAAI;IAAA,4DAAM;IACpC,2EAA0B;IAAA,sEAAK;IAAA,4DAAM;IACrC,2EAA0B;IAAA,+DAAG;IAAA,4DAAM;IACnC,2EAA0B;IAAA,gEAAI;IAAA,4DAAM;IAEpC,sEAAyD;IAC3D,4DAAM;IACR,4DAAM;IAEN,2EAAoF;IAA7C,gVAAsB,6BAAqB,IAAC;IAEjF,uIAIM;IACR,4DAAM;IAER,4DAAM;IAEV,4DAAM;;;IAT0E,2DAAU;IAAV,iFAAU;;;;IAmB1F,6EAAkI;IAArE,uaAAoE;IAC/H,+EAAmC;IAAA,4EAAiB;IAAA,4DAAW;IACjE,4DAAS;;;;IACT,6EAAiI;IAArE,uaAAoE;IAC9H,+EAAmC;IAAA,+EAAoB;IAAA,4DAAW;IACpE,4DAAS;;;IAGX,yEAAgE;IAC9D,yEAAiB;IACf,0EAA8B;IAAA,qEAAU;IAAA,4DAAM;IAChD,4DAAM;IACR,4DAAM;;;IAOF,0EAA6F;IAC3F,0GAAqM;IACvM,4DAAM;;;;IADsC,0DAAoB;IAApB,qFAAoB;;;IANpE,yEAAiE;IAC/D,yEAAiB;IACf,0EAA8B;IAAA,qEAAU;IAAA,4DAAM;IAChD,4DAAM;IACN,0EAAyC;IACvC,qIAEM;IACR,4DAAM;IACR,4DAAM;;;IAJqD,0DAAkB;IAAlB,0FAAkB;;;;;AD/LxE,MAAM,iCAAiC;IAoD5C,YACoB,GAAe,EACf,IAAiB,EACjB,MAAiB,EACjB,IAAY,EACZ,KAAkB;QAJlB,QAAG,GAAH,GAAG,CAAY;QACf,SAAI,GAAJ,IAAI,CAAa;QACjB,WAAM,GAAN,MAAM,CAAW;QACjB,SAAI,GAAJ,IAAI,CAAQ;QACZ,UAAK,GAAL,KAAK,CAAa;QA/CtC,kDAAkD;QAC3C,eAAU,GAAwB,IAAI,+CAAa,CAAC,CAAC,CAAC,CAAC;QAC9D,8CAA8C;QACvC,gBAAW,GAA8B,EAAE,CAAC;QAGnD,kDAAkD;QAC3C,uBAAkB,GAAwB,IAAI,+CAAa,CAAC,CAAC,CAAC,CAAC;QACtE,8CAA8C;QACvC,wBAAmB,GAA8B,EAAE,CAAC;QAG3D,uBAAuB;QACf,iBAAY,GAAG;YACrB,WAAW,EAAE;gBACX,IAAI,EAAE,YAAY,EAAE,OAAO,EAAE,KAAK,EAAE,UAAU,EAAE,UAAU,EAAE,YAAY,EAAE,OAAO;gBACjF,YAAY,EAAE,uBAAuB;gBACrC,oBAAoB,EAAE,oBAAoB,EAAE,sBAAsB;gBAClE,uBAAuB;aACxB;YACD,WAAW,EAAE;gBACX,IAAI,EAAE,YAAY,EAAE,gBAAgB;aACrC;SAEF,CAAC;QAcK,UAAK,GAAY,KAAK,CAAC;QAY5B,IAAI,CAAC,KAAK,GAAG,EAAE,CAAC;QAChB,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC;QACvB,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;QACjB,IAAI,CAAC,KAAK,GAAG,EAAE,CAAC;QAChB,IAAI,CAAC,aAAa,GAAG,EAAE,CAAC;QAGxB,IAAI,CAAC,EAAE,GAAG;YACR,KAAK,EAAE;gBACL,KAAK,EAAW,CAAC;aAClB;YACD,IAAI,EAAE;gBACJ,KAAK,EAAW,EAAE;gBAClB,WAAW,EAAK,IAAI,uDAAW,CAAC,EAAE,EAAE,+DAAmB,CAAC;gBACxD,MAAM,EAAU,GAAG,EAAE,CAAC,IAAI,CAAC,UAAU,EAAE;aACxC;YACD,SAAS,EAAE;gBACT,KAAK,EAAC;oBACJ,WAAW,EAAG,IAAI,uDAAW,EAAE;iBAChC;gBACD,GAAG,EAAC;oBACF,WAAW,EAAG,IAAI,uDAAW,EAAE;iBAChC;gBACD,YAAY,EAAI,CAAC;gBACjB,MAAM,EAAU,GAAG,EAAE,CAAC,IAAI,CAAC,eAAe,EAAE;aAC7C;YACD,kBAAkB,EAAE;gBAClB,KAAK,EAAW,CAAC;gBACjB,WAAW,EAAK,IAAI,uDAAW,CAAC,EAAE,EAAE,+DAAmB,CAAC;gBACxD,MAAM,EAAU,GAAG,EAAE,CAAC,IAAI,CAAC,YAAY,EAAE;aAC1C;YACD,YAAY,EAAE;gBACZ,KAAK,EAAW,IAAI;gBACpB,MAAM,EAAU,CAAC,KAAS,EAAE,EAAE,CAAC,IAAI,CAAC,iBAAiB,CAAC,KAAK,CAAC;aAC7D;YACD,IAAI,EAAE;gBACJ,IAAI,EAAY,EAAE;gBAClB,QAAQ,EAAQ,KAAK;gBACrB,SAAS,EAAO,KAAK;gBACrB,SAAS,EAAO,IAAI,+CAAa,CAAC,CAAC,CAAC;gBACpC,YAAY,EAAI,IAAI,4CAAU,EAAE;gBAChC,MAAM,EAAU,CAAC,MAAM,EAAE,KAAS,EAAE,EAAE,CAAC,IAAI,CAAC,UAAU,CAAC,MAAM,EAAE,KAAK,CAAC;gBACrE,WAAW,EAAK,CAAC,KAAS,EAAE,EAAE,CAAC,IAAI,CAAC,eAAe,CAAC,KAAK,CAAC;gBAC1D,KAAK,EAAW,GAAG,EAAE,CAAC,IAAI,CAAC,SAAS,EAAE;gBACtC,OAAO,EAAS,GAAG,EAAE,CAAC,IAAI,CAAC,WAAW,EAAE;gBACxC,KAAK,EAAW,GAAG,EAAE,CAAC,IAAI,CAAC,SAAS,EAAE;gBACtC,OAAO,EAAS,CAAC,IAAQ,EAAE,EAAE,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC;aACrD;YACD,UAAU,EAAE;gBACV,IAAI,EAAY,EAAE;gBAClB,SAAS,EAAO,IAAI,+CAAa,CAAC,CAAC,CAAC;gBACpC,YAAY,EAAI,IAAI,4CAAU,EAAE;gBAChC,MAAM,EAAU,CAAC,KAAS,EAAE,EAAE,CAAC,IAAI,CAAC,eAAe,CAAC,KAAK,CAAC;gBAC1D,WAAW,EAAK,CAAC,KAAS,EAAE,EAAE,CAAC,IAAI,CAAC,oBAAoB,CAAC,KAAK,CAAC;gBAC/D,KAAK,EAAW,GAAG,EAAE,CAAC,IAAI,CAAC,cAAc,EAAE;gBAC3C,OAAO,EAAS,GAAG,EAAE,CAAC,IAAI,CAAC,gBAAgB,EAAE;gBAC7C,KAAK,EAAW,GAAG,EAAE,CAAC,IAAI,CAAC,cAAc,EAAE;gBAC3C,OAAO,EAAS,CAAC,IAAQ,EAAE,EAAE,CAAC,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC;aAC1D;YACD,KAAK,EAAE;gBACL,GAAG,EAAa,GAAG,EAAE,CAAC,IAAI,CAAC,OAAO,EAAE;gBACpC,MAAM,EAAU,CAAC,KAAS,EAAE,EAAE,CAAC,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC;gBACrD,IAAI,EAAY,CAAC,KAAsB,EAAE,EAAE,CAAC,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC;aACjE;SACF,CAAC;IAEJ,CAAC;IAGM,QAAQ;QAEb,mDAAmD;QACnD,IAAI,CAAC,UAAU,CAAC,SAAS,CAAE,CAAC,KAAU,EAAE,EAAE,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,CAAE,CAAC;QAG9D,kFAAkF;QAClF,IAAI,CAAC,UAAU,CAAC,SAAS,CAAC,MAAM,CAAC,EAAE,CAAC,IAAI,CAAC,cAAc,CAAC,MAAM,CAAC,CAAC,CAAC;QAEjE,kFAAkF;QAClF,IAAI,CAAC,kBAAkB,CAAC,SAAS,CAAC,MAAM,CAAC,EAAE,CAAC,IAAI,CAAC,sBAAsB,CAAC,MAAM,CAAC,CAAC,CAAC;QAEjF;;WAEG;QAEH,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CACrD,4DAAY,CAAC,GAAG,CAAC,EACjB,mDAAG,CAAE,CAAC,KAAS,EAAE,EAAE,CAAC,CAAC,OAAO,KAAK,KAAK,QAAQ,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,KAAK,IAAI,IAAI,CAAC,EAAC,GAAE,EAAC,MAAK,CAAC,IAAI,CAAC,CAAE,EACzF,wDAAQ,CAAE,CAAO,IAAW,EAAE,EAAE,CAAC,iGAAI,CAAC,WAAW,CAAC,IAAI,CAAC,KAAE,CAC1D,CAAC;QAEF,IAAI,CAAC,EAAE,CAAC,UAAU,CAAC,YAAY,GAAG,IAAI,CAAC,EAAE,CAAC,UAAU,CAAC,SAAS,CAAC,IAAI,CACjE,4DAAY,CAAC,GAAG,CAAC,EACjB,mDAAG,CAAE,CAAC,KAAS,EAAE,EAAE,CAAC,CAAC,OAAO,KAAK,KAAK,QAAQ,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,KAAK,IAAI,IAAI,CAAC,EAAC,GAAE,EAAC,MAAK,CAAC,IAAI,CAAC,CAAE,EACzF,wDAAQ,CAAE,CAAO,IAAW,EAAE,EAAE,CAAC,iGAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,KAAE,CAChE,CAAC;QAEF,IAAI,CAAC,EAAE,CAAC,SAAS,CAAC,KAAK,CAAC,WAAW,CAAC,YAAY,CAAC,SAAS,CAAE,CAAC,IAAS,EAAG,EAAE;YACzE,IAAI,CAAC,eAAe,EAAE,CAAC;QACzB,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,EAAE,CAAC,SAAS,CAAC,GAAG,CAAC,WAAW,CAAC,YAAY,CAAC,SAAS,CAAE,CAAC,IAAS,EAAG,EAAE;YACvE,IAAI,CAAC,eAAe,EAAE,CAAC;QACzB,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,EAAE,CAAC,kBAAkB,CAAC,WAAW,CAAC,YAAY,CAAC,SAAS,CAAE,CAAC,KAAY,EAAG,EAAE;YAC/E,IAAI,CAAC,EAAE,CAAC,kBAAkB,CAAC,KAAK,GAAG,KAAK,CAAC;QAC3C,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,WAAW,CAAC,YAAY,CAAC,SAAS,CAAE,CAAC,KAAY,EAAG,EAAE;YACjE,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;QAC7B,CAAC,CAAC,CAAC;IAEL,CAAC;IAGD;;;;OAIG;IACW,IAAI,CAAC,KAAS;;YAC1B,IAAI,CAAC,IAAI,CAAC,GAAG,CAAE,GAAG,EAAE;gBAClB,sBAAsB;YACxB,CAAC,CAAC,CAAC;YACH,IAAI,CAAC,IAAI,CAAC,GAAG,CAAE,GAAS,EAAE,CAAC;gBACzB,IAAI;oBACF,OAAO,CAAC,GAAG,CAAC,iEAAiE,EAAE,KAAK,CAAC,EAAE,EAAE,KAAK,CAAC,CAAC;oBAEhG,4BAA4B;oBAC5B,KAAI,IAAI,KAAK,IAAI,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE;wBACnC,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,GAAG,KAAK,CAAC,KAAK,CAAC,CAAC;qBAClC;oBAED,IAAG,KAAK,CAAC,IAAI,EAAE;wBACb,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,WAAW,CAAC,QAAQ,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;qBAC/C;oBAED,IAAG,KAAK,CAAC,cAAc,CAAC,OAAO,CAAC,EAAE;wBAChC,IAAI,CAAC,EAAE,CAAC,KAAK,CAAC,KAAK,GAAG,KAAK,CAAC,KAAK,CAAC;qBACnC;oBAED,IAAG,KAAK,CAAC,aAAa,EAAE;wBACtB,IAAI,IAAI,GAAO,MAAM,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,2BAA2B,EAAE,CAAC,KAAK,CAAC,aAAa,CAAC,EAAE,CAAC,IAAI,EAAE,MAAM,EAAE,aAAa,CAAC,CAAC,CAAC;wBACtH,IAAG,IAAI,IAAI,IAAI,CAAC,MAAM,EAAE;4BACtB,IAAI,UAAU,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;4BACzB,IAAI,CAAC,UAAU,GAAG,UAAU,CAAC;4BAC7B,IAAI,CAAC,EAAE,CAAC,UAAU,CAAC,IAAI,GAAG,UAAU,CAAC,IAAI,CAAC;yBAC3C;qBACF;oBAED,IAAG,KAAK,CAAC,OAAO,EAAE;wBAChB,IAAI,IAAI,GAAO,MAAM,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,iCAAiC,EAAE,CAAC,KAAK,CAAC,OAAO,CAAC,EAAE,CAAC,IAAI,EAAE,MAAM,EAAE,KAAK,CAAC,CAAC,CAAC;wBAC9G,IAAG,IAAI,IAAI,IAAI,CAAC,MAAM,EAAE;4BACtB,IAAI,IAAI,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;4BACnB,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;4BACjB,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC;yBAC/B;wBAED,wCAAwC;qBACzC;oBAED,IAAG,KAAK,CAAC,cAAc,CAAC,UAAU,CAAC,EAAE;wBACnC,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,QAAQ,GAAG,KAAK,CAAC,QAAQ,CAAC;qBACxC;oBAED,IAAG,KAAK,CAAC,cAAc,CAAC,WAAW,CAAC,EAAE;wBACpC,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,SAAS,GAAG,KAAK,CAAC,SAAS,CAAC;qBAC1C;oBAED,IAAG,KAAK,CAAC,cAAc,CAAC,SAAS,CAAC,EAAE;wBAClC,IAAI,CAAC,EAAE,CAAC,kBAAkB,CAAC,WAAW,CAAC,QAAQ,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;qBAChE;oBAED,IAAG,KAAK,CAAC,YAAY,EAAE;wBACrB,IAAI,CAAC,EAAE,CAAC,YAAY,CAAC,KAAK,GAAG,KAAK,CAAC,YAAY,CAAC;qBACjD;oBAED,IAAG,KAAK,CAAC,SAAS,EAAE;wBAClB,IAAI,CAAC,EAAE,CAAC,SAAS,CAAC,KAAK,CAAC,WAAW,CAAC,QAAQ,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC;qBAC/D;oBAED,IAAG,KAAK,CAAC,OAAO,EAAE;wBAChB,IAAI,CAAC,EAAE,CAAC,SAAS,CAAC,GAAG,CAAC,WAAW,CAAC,QAAQ,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;qBAC3D;oBAED,IAAG,KAAK,CAAC,iBAAiB,EAAE;wBAC1B,IAAI,IAAI,GAAO,MAAM,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,iBAAiB,EAAE,IAAI,CAAC,YAAY,CAAC,aAAa,CAAC,CAAC,CAAC;wBAC/F,IAAG,IAAI,EAAE;4BACP,KAAI,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,IAAI,IAAI,CAAC,OAAO,EAAE,EAAE;gCACvC,0EAA0E;gCAC1E,IAAG,KAAK,IAAI,IAAI,CAAC,KAAK,CAAC,MAAM,EAAE;oCAC7B,IAAI,IAAI,GAAG,IAAI,+CAAa,CAAC,CAAC,CAAC,CAAC;oCAChC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;oCAC5B,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;oCAChB,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;iCACvB;gCACD,uDAAuD;qCAClD,IAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,IAAI,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,EAAG;oCAClE,IAAI,IAAI,GAAG,IAAI,+CAAa,CAAC,CAAC,CAAC,CAAC;oCAChC,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,GAAG,IAAI,CAAC;oCAC/B,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,GAAG,IAAI,CAAC;oCACzB,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;iCACjB;6BACF;4BACD,iCAAiC;4BACjC,IAAG,IAAI,CAAC,KAAK,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM,EAAE;gCAClC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;gCAC/B,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;6BACtC;yBACF;qBACF;oBAGD,IAAG,KAAK,CAAC,iBAAiB,EAAE;wBAC1B,IAAI,IAAI,GAAO,MAAM,IAAI,CAAC,iBAAiB,CAAC,KAAK,CAAC,iBAAiB,EAAE,IAAI,CAAC,YAAY,CAAC,aAAa,CAAC,CAAC,CAAC;wBACvG,IAAG,IAAI,EAAE;4BACP,KAAI,IAAI,CAAC,KAAK,EAAE,YAAY,CAAC,IAAI,IAAI,CAAC,OAAO,EAAE,EAAE;gCAC/C,0EAA0E;gCAC1E,IAAG,KAAK,IAAI,IAAI,CAAC,aAAa,CAAC,MAAM,EAAE;oCACrC,IAAI,IAAI,GAAG,IAAI,+CAAa,CAAC,CAAC,CAAC,CAAC;oCAChC,IAAI,CAAC,mBAAmB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;oCACpC,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;oCACxB,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;iCACvC;gCACD,+DAA+D;qCAC1D,IAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC,IAAI,IAAI,CAAC,SAAS,CAAC,YAAY,CAAC,EAAG;oCAClF,IAAI,IAAI,GAAG,IAAI,+CAAa,CAAC,CAAC,CAAC,CAAC;oCAChC,IAAI,CAAC,mBAAmB,CAAC,KAAK,CAAC,GAAG,IAAI,CAAC;oCACvC,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC,GAAG,YAAY,CAAC;oCACzC,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;iCACzB;6BACF;4BACD,yCAAyC;4BACzC,IAAG,IAAI,CAAC,aAAa,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM,EAAE;gCAC1C,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;gCACvC,IAAI,CAAC,mBAAmB,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;6BAC9C;yBACF;qBACF;iBACF;gBACD,OAAM,QAAQ,EAAE;oBAAC,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;iBAAC;gBACzC,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC;YACpB,CAAC,EAAC,CAAC;QACL,CAAC;KAAA;IAEa,sBAAsB,CAAC,IAAS;;YAC5C,OAAO,CAAC,GAAG,CAAC,gEAAgE,EAAE,IAAI,CAAC,CAAC;YAEpF,IAAI,UAAU,GAAW,KAAK,CAAC;YAE/B,IAAI;gBACF,IAAI,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,SAAS,CAAE,CAAC,OAAO,EAAE,EAAE,CAAC,OAAO,CAAC,EAAE,IAAI,IAAI,CAAC,EAAE,CAAC,CAAC;gBACtE,IAAI,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAE,CAAC,OAAO,EAAE,EAAE,CAAC,OAAO,CAAC,EAAE,IAAI,IAAI,CAAC,EAAE,CAAC,CAAC;gBAElE,IAAG,IAAI,CAAC,cAAc,CAAC,gBAAgB,CAAC,IAAI,IAAI,CAAC,cAAc,IAAI,MAAM,CAAC,cAAc,EAAE;oBACxF,UAAU,GAAG,IAAI,CAAC;oBAClB,MAAM,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,CAAC;iBACnC;gBAGD,IAAG,UAAU,EAAE;oBACb,IAAI,IAAI,GAAG,MAAM,IAAI,CAAC,iBAAiB,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,IAAI,CAAC,YAAY,CAAC,aAAa,CAAC,CAAC,CAAC;oBACrF,IAAI,MAAM,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;oBACrB,KAAI,IAAI,KAAK,IAAI,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE;wBACpC,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC,KAAK,CAAC,GAAG,MAAM,CAAC,KAAK,CAAC,CAAC;qBAClD;oBACD,uCAAuC;oBACvC,IAAI,CAAC,mBAAmB,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC,CAAC;oBAChE,cAAc;oBACd,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,qBAAqB,CAAC,CAAC;iBACxC;aACF;YACD,OAAM,KAAK,EAAE;gBACX,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;aACrB;QACH,CAAC;KAAA;IAED;;;OAGG;IACW,cAAc,CAAC,IAAS;;YACpC,OAAO,CAAC,GAAG,CAAC,gEAAgE,EAAE,IAAI,CAAC,CAAC;YAEpF,IAAI;gBACF,IAAI,UAAU,GAAG,KAAK,CAAC;gBACvB,IAAI,gBAAgB,GAAO,EAAE,CAAC;gBAE9B,IAAI,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,SAAS,CAAE,CAAC,OAAO,EAAE,EAAE,CAAC,OAAO,CAAC,EAAE,IAAI,IAAI,CAAC,EAAE,CAAC,CAAC;gBACtE,IAAI,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAE,CAAC,OAAO,EAAE,EAAE,CAAC,OAAO,CAAC,EAAE,IAAI,IAAI,CAAC,EAAE,CAAC,CAAC;gBAElE,IAAG,IAAI,CAAC,cAAc,CAAC,YAAY,CAAC,IAAI,IAAI,CAAC,UAAU,IAAI,MAAM,CAAC,UAAU,EAAE;oBAC5E,MAAM,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC;oBAC/B,UAAU,GAAG,IAAI,CAAC;oBAClB,uEAAuE;oBACvE,gBAAgB,CAAC,YAAY,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;oBAC3C,gBAAgB,CAAC,MAAM,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;iBACtC;gBAED,IAAG,IAAI,CAAC,cAAc,CAAC,KAAK,CAAC,IAAI,IAAI,CAAC,GAAG,IAAI,MAAM,CAAC,GAAG,EAAE;oBACvD,MAAM,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,CAAC;oBAChC,UAAU,GAAG,IAAI,CAAC;oBAClB,gBAAgB,CAAC,YAAY,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;oBAC3C,gBAAgB,CAAC,MAAM,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;iBACtC;gBAED,IAAG,IAAI,CAAC,cAAc,CAAC,oBAAoB,CAAC,EAAE;oBAC5C,UAAU,GAAG,IAAI,CAAC;oBAClB,gBAAgB,CAAC,YAAY,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;oBAC3C,gBAAgB,CAAC,MAAM,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;iBACtC;gBAGD,8EAA8E;gBAC9E,IAAG,IAAI,CAAC,cAAc,CAAC,SAAS,CAAC,EAAE;oBACjC,+DAA+D;oBAC/D,+DAA+D;oBAC/D,IAAI,YAAY,GAAG,IAAI,CAAC,YAAY,CAAC,aAAa,CAAC,CAAC;oBAEpD,IAAG,IAAI,CAAC,OAAO,CAAC,cAAc,CAAC,MAAM,CAAC,EAAE;wBACtC,IAAG,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE;4BACnC,YAAY,GAAG,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC;yBAClC;wBACD,4BAA4B;wBAC5B,IAAI,IAAI,GAAG,MAAM,IAAI,CAAC,SAAS,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,YAAY,CAAC,CAAC;wBACzD,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;qBACvC;oBAED,qCAAqC;oBACrC,IAAG,IAAI,CAAC,OAAO,CAAC,cAAc,CAAC,uBAAuB,CAAC,EAAE;wBACvD,4GAA4G;wBAC5G,IAAG,gBAAgB,CAAC,iBAAiB,CAAC,MAAM,CAAC,EAAE;4BAC7C,gBAAgB,CAAC,MAAM,CAAC,GAAG,CAAC,GAAG,gBAAgB,CAAC,MAAM,CAAC,EAAE,GAAG,IAAI,CAAC,OAAO,CAAC,qBAAqB,CAAC,CAAC;yBACjG;6BACI;4BACH,gBAAgB,CAAC,MAAM,CAAC,GAAG,IAAI,CAAC,OAAO,CAAC,qBAAqB,CAAC;yBAC/D;qBACF;iBACF;gBACD,kCAAkC;qBAC7B,IAAG,UAAU,EAAE;oBAClB,IAAI,IAAI,GAAG,MAAM,IAAI,CAAC,SAAS,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,IAAI,CAAC,YAAY,CAAC,aAAa,CAAC,CAAC,CAAC;oBAC7E,IAAI,MAAM,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;oBACrB,KAAI,IAAI,KAAK,IAAI,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE;wBACpC,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,KAAK,CAAC,GAAG,MAAM,CAAC,KAAK,CAAC,CAAC;qBAC1C;oBACD,uCAAuC;oBACvC,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC;oBAChD,cAAc;oBACd,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,yBAAyB,CAAC,CAAC;iBAC5C;gBAED,0CAA0C;gBAC1C,IAAG,MAAM,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC,MAAM,EAAE;oBACvC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,EAAC,EAAE,EAAE,IAAI,CAAC,KAAK,CAAC,EAAE,EAAE,OAAO,EAAE,gBAAgB,EAAC,CAAC,CAAC;iBACvE;aAEF;YACD,OAAM,KAAK,EAAE;gBACX,OAAO,CAAC,IAAI,CAAC,kCAAkC,EAAE,KAAK,CAAC,CAAC;gBACxD,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,8DAA8D,CAAC,CAAC;aACjF;QACH,CAAC;KAAA;IAEa,SAAS,CAAC,GAAc,EAAE,MAAU;;YAChD,IAAI,IAAI,GAAO,MAAM,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,qCAAqC,EACtC,GAAG,EACH,MAAM,EACN,OAAO,CACN,CAAC;YACpC,OAAO,IAAI,CAAC;QACd,CAAC;KAAA;IAEa,iBAAiB,CAAC,GAAc,EAAE,MAAU;;YACxD,IAAI,IAAI,GAAO,MAAM,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,qCAAqC,EACtC,GAAG,EACH,MAAM,CACL,CAAC;YACpC,OAAO,IAAI,CAAC;QACd,CAAC;KAAA;IAEO,eAAe;QACrB,IAAI,KAAK,GAAG,IAAI,CAAC,EAAE,CAAC,SAAS,CAAC,KAAK,CAAC,WAAW,CAAC,KAAK,CAAC;QACtD,IAAI,GAAG,GAAG,IAAI,CAAC,EAAE,CAAC,SAAS,CAAC,GAAG,CAAC,WAAW,CAAC,KAAK,CAAC;QAClD,IAAG,KAAK,IAAI,GAAG,EAAE;YACf,IAAI,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,QAAQ,EAAE,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,QAAQ,EAAE,CAAC,CAAC,GAAG,CAAC,EAAE,GAAC,EAAE,GAAC,EAAE,GAAC,IAAI,CAAC,CAAC,CAAC;YACrG,IAAI,CAAC,EAAE,CAAC,SAAS,CAAC,YAAY,GAAG,CAAC,IAAI,GAAG,CAAC,CAAC,EAAC,EAAC,EAAC,KAAI,CAAC;SACpD;IACH,CAAC;IAEO,YAAY;QAClB,OAAO,CAAC,GAAG,CAAC,4CAA4C,CAAC,CAAC;QAC1D,mCAAmC;QACnC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,EAAC,EAAE,EAAE,IAAI,CAAC,KAAK,CAAC,EAAE,EAAE,OAAO,EAAE,IAAI,CAAC,EAAE,CAAC,kBAAkB,CAAC,KAAK,EAAE,OAAO,EAAE,EAAE,IAAI,EAAE,CAAC,OAAO,CAAC,EAAE,UAAU,EAAE,CAAC,OAAO,CAAC,EAAE,EAAC,CAAC,CAAC;IAC7I,CAAC;IAEO,UAAU;QAChB,OAAO,CAAC,GAAG,CAAC,0CAA0C,CAAC,CAAC;QACxD,mCAAmC;QACnC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,EAAC,EAAE,EAAE,IAAI,CAAC,KAAK,CAAC,EAAE,EAAE,IAAI,EAAE,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,KAAK,EAAC,CAAC;IACtE,CAAC;IAEO,eAAe;QACrB,OAAO,CAAC,GAAG,CAAC,+CAA+C,CAAC,CAAC;QAC7D,mCAAmC;QACnC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,EAAC,EAAE,EAAE,IAAI,CAAC,KAAK,CAAC,EAAE,EAAE,SAAS,EAAE,IAAI,CAAC,EAAE,CAAC,SAAS,CAAC,KAAK,CAAC,WAAW,CAAC,KAAK,EAAE,OAAO,EAAE,IAAI,CAAC,EAAE,CAAC,SAAS,CAAC,GAAG,CAAC,WAAW,CAAC,KAAK,EAAC,CAAC;IACpJ,CAAC;IAEO,UAAU,CAAC,MAAa,EAAE,KAAS;QACzC,OAAO,CAAC,GAAG,CAAC,0CAA0C,EAAE,KAAK,CAAC;QAE9D,QAAO,MAAM,EAAE;YACb,KAAK,MAAM;gBACT,IAAI,IAAI,GAAG,KAAK,CAAC;gBACjB,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;gBACjB,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC;gBAC9B,mCAAmC;gBACnC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,EAAC,EAAE,EAAE,IAAI,CAAC,KAAK,CAAC,EAAE,EAAE,OAAO,EAAE,IAAI,CAAC,EAAE,EAAC,CAAC;gBAC5D,MAAM;YACR,KAAK,UAAU;gBACb,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,QAAQ,GAAG,KAAK,CAAC;gBAC9B,mCAAmC;gBACnC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,EAAC,EAAE,EAAE,IAAI,CAAC,KAAK,CAAC,EAAE,EAAE,QAAQ,EAAE,KAAK,EAAC,CAAC;gBAC3D,MAAM;YACR,KAAK,WAAW;gBACd,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,SAAS,GAAG,KAAK,CAAC;gBAC/B,mCAAmC;gBACnC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,EAAC,EAAE,EAAE,IAAI,CAAC,KAAK,CAAC,EAAE,EAAE,SAAS,EAAE,KAAK,EAAC,CAAC;gBAC5D,MAAM;SACT;IACH,CAAC;IAEO,eAAe,CAAC,KAAS;QAC/B,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;IAClD,CAAC;IAEO,SAAS;QACf,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;IAClC,CAAC;IAEO,WAAW,CAAC,IAAQ;QAC1B,OAAO,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,EAAC,CAAC,EAAE,CAAC;IAC9B,CAAC;IAEO,SAAS;QACf,UAAU,CAAE,GAAG,EAAE;YACf,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,IAAI,GAAG,EAAE,CAAC;QACzB,CAAC,EAAE,GAAG,CAAC,CAAC;IACV,CAAC;IAEO,WAAW;QACjB,IAAG,IAAI,CAAC,IAAI,EAAE;YACZ,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC;SACpC;aACI;YACH,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,IAAI,GAAG,EAAE,CAAC;SACxB;IACH,CAAC;IAIO,iBAAiB,CAAC,KAAS;IAEnC,CAAC;IAEO,eAAe,CAAC,KAAS;QAC/B,OAAO,CAAC,GAAG,CAAC,+CAA+C,EAAE,KAAK,CAAC;QAEnE,wBAAwB;QACxB,IAAG,KAAK,IAAI,KAAK,CAAC,MAAM,IAAI,KAAK,CAAC,MAAM,CAAC,KAAK,EAAE;YAC9C,IAAI,UAAU,GAAG,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC;YACpC,IAAI,CAAC,UAAU,GAAG,UAAU,CAAC;YAC7B,IAAI,CAAC,EAAE,CAAC,UAAU,CAAC,IAAI,GAAG,UAAU,CAAC,IAAI,CAAC;YAC1C,mCAAmC;YACnC,+CAA+C;YAC/C,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,EAAC,EAAE,EAAE,IAAI,CAAC,KAAK,CAAC,EAAE,EAAE,aAAa,EAAE,UAAU,CAAC,EAAE,EAAC,CAAC,CAAC;SAC1E;IAEH,CAAC;IAEO,oBAAoB,CAAC,KAAS;QACpC,IAAI,CAAC,EAAE,CAAC,UAAU,CAAC,SAAS,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;IACxD,CAAC;IAEO,cAAc;QACpB,IAAI,CAAC,EAAE,CAAC,UAAU,CAAC,SAAS,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;IACxC,CAAC;IAEO,gBAAgB,CAAC,UAAc;QACrC,OAAO,UAAU,CAAC,CAAC,CAAC,CAAC,UAAU,CAAC,IAAI,GAAG,KAAK,GAAG,UAAU,CAAC,WAAW,CAAC,EAAC,CAAC,EAAE,CAAC;IAC7E,CAAC;IAEO,cAAc;QACpB,UAAU,CAAE,GAAG,EAAE;YACf,IAAI,CAAC,EAAE,CAAC,UAAU,CAAC,IAAI,GAAG,EAAE,CAAC;QAC/B,CAAC,EAAE,GAAG,CAAC,CAAC;IACV,CAAC;IAEO,gBAAgB;QACtB,IAAG,IAAI,CAAC,UAAU,EAAE;YAClB,IAAI,CAAC,EAAE,CAAC,UAAU,CAAC,IAAI,GAAG,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC;SAChD;aACI;YACH,IAAI,CAAC,EAAE,CAAC,UAAU,CAAC,IAAI,GAAG,EAAE,CAAC;SAC9B;IACH,CAAC;IAEa,WAAW,CAAC,IAAY;;YACxC;;;;cAIE;YACE,IAAI,QAAQ,GAAS,EAAE,CAAC;YACxB,IAAI;gBACF,IAAI,IAAI,GAAS,MAAM,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,iCAAiC,EAAE,CAAC,CAAC,MAAM,EAAE,OAAO,EAAE,GAAG,GAAC,IAAI,GAAC,GAAG,CAAC,EAAE,CAAC,SAAS,EAAE,GAAG,EAAE,MAAM,CAAC,CAAC,EAAE,CAAC,IAAI,EAAE,MAAM,CAAC,EAAE,MAAM,EAAE,KAAK,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC;gBAC9K,QAAQ,GAAG,IAAI,CAAC;aACjB;YACD,OAAM,QAAQ,EAAE;gBACd,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;aACvB;YACD,OAAO,QAAQ,CAAC;QAClB,CAAC;KAAA;IAEa,iBAAiB,CAAC,IAAY;;YAC1C,IAAI,QAAQ,GAAS,EAAE,CAAC;YACxB,IAAI;gBACF,IAAI,IAAI,GAAS,MAAM,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,2BAA2B,EAAE,CAAC,CAAC,MAAM,EAAE,OAAO,EAAE,GAAG,GAAC,IAAI,GAAC,GAAG,CAAC,CAAC,EAAE,CAAC,IAAI,EAAE,MAAM,EAAE,aAAa,CAAC,EAAE,MAAM,EAAE,KAAK,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC;gBAC7J,QAAQ,GAAG,IAAI,CAAC;aACjB;YACD,OAAM,QAAQ,EAAE;gBACd,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;aACvB;YACD,OAAO,QAAQ,CAAC;QAClB,CAAC;KAAA;IAEa,OAAO;;YACnB,IAAI;gBACF,MAAM,IAAI,GAAG,MAAM,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,qCAAqC,EAAE;oBACxE,KAAK,EAAE,IAAI,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC;oBAC5B,UAAU,EAAE,IAAI,CAAC,KAAK,CAAC,UAAU;oBACjC,qBAAqB,EAAE,IAAI,CAAC,KAAK,CAAC,EAAE;iBACrC,CAAC,CAAC;gBAEH,wBAAwB;gBACxB,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,EAAC,EAAE,EAAE,IAAI,CAAC,KAAK,CAAC,EAAE,EAAE,iBAAiB,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,EAAC,CAAC,CAAC;aAC1E;YACD,OAAM,KAAK,EAAE;gBACX,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;aACpB;QACH,CAAC;KAAA;IAED;;;OAGG;IACW,UAAU,CAAC,IAAS;;YAChC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,EAAC,EAAE,EAAE,IAAI,CAAC,KAAK,CAAC,EAAE,EAAE,iBAAiB,EAAE,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,EAAC,CAAC,CAAC;QAC5E,CAAC;KAAA;IAEO,QAAQ,CAAC,KAAsB;QACrC,wEAAe,CAAC,IAAI,CAAC,KAAK,EAAE,KAAK,CAAC,aAAa,EAAE,KAAK,CAAC,YAAY,CAAC,CAAC;QACrE,wEAAe,CAAC,IAAI,CAAC,WAAW,EAAE,KAAK,CAAC,aAAa,EAAE,KAAK,CAAC,YAAY,CAAC,CAAC;QAE3E,qCAAqC;QACrC,KAAI,IAAI,KAAK,IAAI,IAAI,CAAC,KAAK,EAAE;YAC3B,IAAI,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;YAC7B,IAAI,CAAC,cAAc,CAAC,EAAC,EAAE,EAAE,IAAI,CAAC,EAAE,EAAE,KAAK,EAAE,QAAQ,CAAC,KAAK,CAAC,GAAG,CAAC,EAAC,CAAC,CAAC;SAChE;IAEH,CAAC;IAEa,aAAa,CAAC,IAAQ;;YAClC,MAAM,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,qCAAqC,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,EAAO,EAAC,YAAY,EAAE,IAAI,CAAC,UAAU,EAAC,CAAC,CAAC;QAChH,CAAC;KAAA;IAEa,cAAc,CAAC,IAAQ;;YACnC,MAAM,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,qCAAqC,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,EAAO,EAAC,KAAK,EAAE,IAAI,CAAC,GAAG,EAAC,CAAC,CAAC;QAClG,CAAC;KAAA;IAEa,gBAAgB,CAAC,IAAQ;;YACrC,MAAM,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,qCAAqC,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,EAAO,EAAC,gBAAgB,EAAE,IAAI,CAAC,cAAc,EAAC,CAAC,CAAC;QACxH,CAAC;KAAA;;kHAnoBU,iCAAiC;+HAAjC,iCAAiC;QChF9C,uEAA6H;QAE7H,sEAA6B;QAG7B,yEAAkB;QAEhB,yEAAyB;QACvB,mIAES;QACT,mIAES;QACX,4DAAM;QAEN,8HAmBM;QAEN,+HA2JM;QAGR,4DAAM;QAIN,yEAAkB;QAEhB,0EAAyB;QACvB,qIAES;QACT,qIAES;QACX,4DAAM;QAEN,0EAA4B;QAC1B,0EAAiB;QACf,0EAAgC;QAAA,qEAAS;QAAA,qIAA2J;QAAA,4DAAM;QAC1M,2EAAgC;QAAA,wDAA+D;;QAAA,4DAAM;QACvG,4DAAM;QACN,iIA2BM;QACR,4DAAM;QAER,4DAAM;QAIN,0EAAkB;QAEhB,0EAAyB;QACvB,qIAES;QACT,qIAES;QACX,4DAAM;QAEN,+HAIM;QAEN,+HASM;QAER,4DAAM;QAGN,4DAAM;;;QAxRa,+VAAmG;QAEjH,0DAAuB;QAAvB,+EAAuB;QAMC,0DAAmC;QAAnC,4FAAmC;QAGnC,0DAAkC;QAAlC,2FAAkC;QAKhC,0DAAkC;QAAlC,2FAAkC;QAqBlC,0DAAmC;QAAnC,4FAAmC;QAqKrC,0DAA6B;QAA7B,sFAA6B;QAG7B,0DAA4B;QAA5B,qFAA4B;QAOD,0DAAwB;QAAxB,wFAAwB;QAC1C,0DAA+D;QAA/D,uMAA+D;QAE/E,0DAA6B;QAA7B,sFAA6B;QAqCtB,0DAAkC;QAAlC,2FAAkC;QAGlC,0DAAiC;QAAjC,0FAAiC;QAK/B,0DAAiC;QAAjC,0FAAiC;QAMjC,0DAAkC;QAAlC,2FAAkC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACvQmB;AAIlB;AAEY;;;;;;;;;;;;;;;ICIpE,6EAA8H;IAA9B,6SAAS,0BAAmB,IAAC;IAC3H,2EAAU;IAAA,gEAAK;IAAA,4DAAW;IAC5B,4DAAS;;;IAIL,iFAA6D;IAC3D,uDACF;IAAA,4DAAa;;;IAF6B,8EAAkB;IAC1D,0DACF;IADE,4FACF;;;IACA,6EAAqC;IAAA,oEAAG;IAAA,+EAAe;IAAA,4DAAI;IAAA,4DAAa;;;IAJ1E,sEAAwD;IACtD,6IAEa;IACb,4IAAwE;IAC1E,4DAAM;;;IAJ6B,0DAAO;IAAP,4EAAO;IAG3B,0DAAsB;IAAtB,qFAAsB;;;;IA6BvC,6EAAwH;IAA3B,uTAAS,wBAAgB,IAAC;IACrH,2EAAU;IAAA,gEAAK;IAAA,4DAAW;IAC5B,4DAAS;;;IAIL,iFAAuD;IACrD,uDACF;IAAA,4DAAa;;;IAF0B,4EAAe;IACpD,0DACF;IADE,0FACF;;;IACA,6EAAqC;IAAA,oEAAG;IAAA,+EAAe;IAAA,4DAAI;IAAA,4DAAa;;;IAJ1E,sEAAsD;IACpD,oJAEa;IACb,mJAAwE;IAC1E,4DAAM;;;IAJ0B,0DAAO;IAAP,6EAAO;IAGxB,0DAAsB;IAAtB,sFAAsB;;;;IAtB3C,sEAAuB;IAErB,qFAAoC;IAClC,4EAAW;IAAA,2EAAgB;IAAA,4DAAY;IACvC,4EAOiD;IAHzC,kTAAS,oCAA4B,IAAC,oPAC7B,wBAAgB,IADa,kPAE9B,0BAAkB,IAFY;IAJ9C,4DAOiD;IAEjD,qIAES;IAET,0FAAmI;IAA3C,+UAAkB,+BAAuB,IAAC;IAChI,+HAKM;;IACR,4DAAmB;IAEnB,+EAA+C;IAC7C,wEAAM;IAAA,gGAA+B;IAAA,4DAAO;IAC9C,4DAAW;IACb,4DAAiB;IAEjB,8EAA2C;IAAxB,uUAAuB;IAAC,uFAA2B;IAAA,4DAAS;IACjF,4DAAM;;;;IA1BM,0DAAqC;IAArC,iFAAqC;IAOzB,0DAA0B;IAA1B,6FAA0B;IAIS,0DAAgC;IAAhC,gGAAgC;IAC9E,0DAAqC;IAArC,+JAAqC;IAQpC,0DAAiB;IAAjB,0EAAiB;;ADhB9B,MAAM,4BAA4B;IAgBvC,YACoB,GAAe,EACf,MAAiB,EACjB,IAAY,EACZ,OAAsB;QAHtB,QAAG,GAAH,GAAG,CAAY;QACf,WAAM,GAAN,MAAM,CAAW;QACjB,SAAI,GAAJ,IAAI,CAAQ;QACZ,YAAO,GAAP,OAAO,CAAe;QAGxC,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;QACrB,IAAI,CAAC,SAAS,GAAG,KAAK,CAAC;QACvB,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC;QAElB,IAAI,CAAC,EAAE,GAAG;YACR,QAAQ,EAAE;gBACR,IAAI,EAAY,EAAE;gBAClB,SAAS,EAAO,IAAI,+CAAa,CAAC,CAAC,CAAC;gBACpC,YAAY,EAAI,IAAI,4CAAU,EAAE;gBAChC,WAAW,EAAK,CAAC,KAAS,EAAE,EAAE,CAAC,IAAI,CAAC,mBAAmB,CAAC,KAAK,CAAC;gBAC9D,MAAM,EAAU,CAAC,KAAkC,EAAE,EAAE,CAAC,IAAI,CAAC,cAAc,CAAC,KAAK,CAAC;gBAClF,KAAK,EAAW,GAAG,EAAE,CAAC,IAAI,CAAC,aAAa,EAAE;gBAC1C,OAAO,EAAS,GAAG,EAAE,CAAC,IAAI,CAAC,eAAe,EAAE;gBAC5C,KAAK,EAAW,GAAG,EAAE,CAAC,IAAI,CAAC,aAAa,EAAE;gBAC1C,OAAO,EAAS,CAAC,QAAY,EAAE,EAAE,CAAC,IAAI,CAAC,eAAe,CAAC,QAAQ,CAAC;aACjE;YACD,KAAK,EAAE;gBACL,IAAI,EAAY,EAAE;gBAClB,SAAS,EAAO,IAAI,+CAAa,CAAC,CAAC,CAAC;gBACpC,YAAY,EAAI,IAAI,4CAAU,EAAE;gBAChC,WAAW,EAAK,CAAC,KAAS,EAAE,EAAE,CAAC,IAAI,CAAC,gBAAgB,CAAC,KAAK,CAAC;gBAC3D,MAAM,EAAU,CAAC,KAAS,EAAE,EAAE,CAAC,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC;gBACtD,KAAK,EAAW,GAAG,EAAE,CAAC,IAAI,CAAC,UAAU,EAAE;gBACvC,OAAO,EAAS,GAAG,EAAE,CAAC,IAAI,CAAC,YAAY,EAAE;gBACzC,KAAK,EAAW,GAAG,EAAE,CAAC,IAAI,CAAC,UAAU,EAAE;gBACvC,OAAO,EAAS,CAAC,KAAS,EAAE,EAAE,CAAC,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC;aACxD;SACF,CAAC;IAEJ,CAAC;IAGM,QAAQ;QAEb;;WAEG;QACH,IAAI,CAAC,YAAY,CAAC,SAAS,CAAE,CAAO,OAAY,EAAE,EAAE,CAAC;YACnD,IAAI,CAAC,IAAI,CAAC,GAAG,CAAE,GAAS,EAAE,CAAC;gBACzB,IAAI;oBACF,OAAO,CAAC,GAAG,CAAC,qEAAqE,CAAC,CAAC;oBAEnF,IAAI,CAAC,OAAO,GAAG,OAAO,CAAC;oBAEvB,IAAI,CAAC,SAAS,GAAG,OAAO,CAAC,sBAAsB,CAAC;oBAEhD,IAAG,OAAO,CAAC,WAAW,EAAE;wBACtB,IAAI,IAAI,GAAO,MAAM,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,mBAAmB,EAAE,CAAC,OAAO,CAAC,WAAW,CAAC,EAAE,CAAC,IAAI,EAAE,MAAM,EAAE,qBAAqB,CAAC,CAAC,CAAC;wBACtH,IAAG,IAAI,IAAI,IAAI,CAAC,MAAM,EAAE;4BACtB,IAAI,QAAQ,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;4BACvB,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;4BACzB,IAAI,CAAC,EAAE,CAAC,QAAQ,CAAC,IAAI,GAAG,QAAQ,CAAC,IAAI,CAAC;yBACvC;qBACF;oBAED,IAAG,OAAO,CAAC,qBAAqB,EAAE;wBAChC,IAAI,IAAI,GAAO,MAAM,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,mBAAmB,EAAE,CAAC,OAAO,CAAC,qBAAqB,CAAC,EAAE,CAAC,IAAI,EAAE,MAAM,EAAE,qBAAqB,CAAC,CAAC,CAAC;wBAChI,IAAG,IAAI,IAAI,IAAI,CAAC,MAAM,EAAE;4BACtB,IAAI,KAAK,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;4BACpB,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;4BACnB,IAAI,CAAC,EAAE,CAAC,KAAK,CAAC,IAAI,GAAG,KAAK,CAAC,IAAI,CAAC;yBACjC;qBACF;iBACF;gBACD,OAAM,QAAQ,EAAE,GAAE;YACpB,CAAC,EAAC,CAAC;QAGL,CAAC,EAAC,CAAC;QAGH,8CAA8C;QAE9C,IAAI,CAAC,EAAE,CAAC,QAAQ,CAAC,YAAY,GAAG,IAAI,CAAC,EAAE,CAAC,QAAQ,CAAC,SAAS,CAAC,IAAI,CAC7D,4DAAY,CAAC,GAAG,CAAC,EACjB,mDAAG,CAAE,CAAC,KAAS,EAAE,EAAE,CAAC,CAAC,OAAO,KAAK,KAAK,QAAQ,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,KAAK,IAAI,IAAI,CAAC,EAAC,GAAE,EAAC,MAAK,CAAC,IAAI,CAAC,CAAE,EACzF,wDAAQ,CAAE,CAAO,IAAW,EAAE,EAAE,CAAC,iGAAI,CAAC,eAAe,CAAC,IAAI,CAAC,KAAE,CAC9D,CAAC;QAEF,IAAI,CAAC,EAAE,CAAC,KAAK,CAAC,YAAY,GAAG,IAAI,CAAC,EAAE,CAAC,KAAK,CAAC,SAAS,CAAC,IAAI,CACvD,4DAAY,CAAC,GAAG,CAAC,EACjB,mDAAG,CAAE,CAAC,KAAS,EAAE,EAAE,CAAC,CAAC,OAAO,KAAK,KAAK,QAAQ,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,KAAK,IAAI,IAAI,CAAC,EAAC,GAAE,EAAC,MAAK,CAAC,IAAI,CAAC,CAAE,EACzF,wDAAQ,CAAE,CAAO,IAAW,EAAE,EAAE,CAAC,iGAAI,CAAC,YAAY,CAAC,IAAI,CAAC,KAAE,CAC3D,CAAC;IAEJ,CAAC;IAEa,cAAc,CAAC,KAAkC;;YAC7D,IAAI,QAAQ,GAAG,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC;YAClC,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;YACzB,IAAI,CAAC,EAAE,CAAC,QAAQ,CAAC,IAAI,GAAG,QAAQ,CAAC,IAAI,CAAC;YACtC,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,EAAC,WAAW,EAAE,IAAI,CAAC,QAAQ,CAAC,EAAE,EAAC,CAAC,CAAC;QAC3D,CAAC;KAAA;IAEO,mBAAmB,CAAC,KAAS;QACnC,IAAI,CAAC,EAAE,CAAC,QAAQ,CAAC,SAAS,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;IACtD,CAAC;IAEO,aAAa;QACnB,IAAI,CAAC,EAAE,CAAC,QAAQ,CAAC,SAAS,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;IACtC,CAAC;IAEO,eAAe,CAAC,QAAa;QACnC,OAAO,QAAQ,CAAC,CAAC,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC;IACvC,CAAC;IAEO,aAAa;QACnB,UAAU,CAAE,GAAG,EAAE;YACf,IAAI,CAAC,EAAE,CAAC,QAAQ,CAAC,IAAI,GAAG,EAAE,CAAC;QAC7B,CAAC,EAAE,GAAG,CAAC,CAAC;IACV,CAAC;IAEO,eAAe;QACrB,IAAG,IAAI,CAAC,QAAQ,EAAE;YAChB,IAAI,CAAC,EAAE,CAAC,QAAQ,CAAC,IAAI,GAAG,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC;SAC5C;aACI;YACH,IAAI,CAAC,EAAE,CAAC,QAAQ,CAAC,IAAI,GAAG,EAAE,CAAC;SAC5B;IACH,CAAC;IAEO,WAAW,CAAC,KAAS;QAC3B,OAAO,CAAC,GAAG,CAAC,2CAA2C,EAAE,KAAK,CAAC,CAAC;QAEhE,wBAAwB;QACxB,IAAG,KAAK,IAAI,KAAK,CAAC,cAAc,CAAC,SAAS,CAAC,EAAE;YAC3C,IAAI,CAAC,SAAS,GAAY,KAAK,CAAC,OAAO,CAAC;YACxC,IAAG,CAAC,IAAI,CAAC,SAAS,EAAE;gBAClB,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,EAAC,qBAAqB,EAAE,CAAC,EAAC,CAAC,CAAC;aACrD;SACF;QACD,wBAAwB;aACnB,IAAG,KAAK,IAAI,KAAK,CAAC,MAAM,IAAI,KAAK,CAAC,MAAM,CAAC,KAAK,EAAE;YACnD,IAAI,KAAK,GAAG,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC;YAC/B,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;YACnB,IAAI,CAAC,EAAE,CAAC,KAAK,CAAC,IAAI,GAAG,KAAK,CAAC,IAAI,CAAC;YAChC,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,EAAC,qBAAqB,EAAE,IAAI,CAAC,KAAK,CAAC,EAAE,EAAE,sBAAsB,EAAE,IAAI,CAAC,SAAS,EAAC,CAAC,CAAC;SACzG;IAEH,CAAC;IAEO,gBAAgB,CAAC,KAAS;QAChC,IAAI,CAAC,EAAE,CAAC,KAAK,CAAC,SAAS,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;IACnD,CAAC;IAEO,UAAU;QAChB,IAAI,CAAC,EAAE,CAAC,KAAK,CAAC,SAAS,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;IACnC,CAAC;IAEO,YAAY,CAAC,KAAU;QAC7B,OAAO,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC;IACjC,CAAC;IAEO,UAAU;QAChB,UAAU,CAAE,GAAG,EAAE;YACf,IAAI,CAAC,EAAE,CAAC,KAAK,CAAC,IAAI,GAAG,EAAE,CAAC;QAC1B,CAAC,EAAE,GAAG,CAAC,CAAC;IACV,CAAC;IAEO,YAAY;QAClB,IAAG,IAAI,CAAC,KAAK,EAAE;YACb,IAAI,CAAC,EAAE,CAAC,KAAK,CAAC,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC;SACtC;aACI;YACH,IAAI,CAAC,EAAE,CAAC,KAAK,CAAC,IAAI,GAAG,EAAE,CAAC;SACzB;IACH,CAAC;IAGD;;;OAGG;IACI,WAAW;QAChB,OAAO,CAAC,GAAG,CAAC,2CAA2C,CAAC,CAAC;QAEzD,IAAI,UAAU,GAAG;YACf,OAAO,EAAE;gBACP,MAAM,EAAM,mBAAmB;gBAC/B,IAAI,EAAQ,MAAM;gBAClB,IAAI,EAAQ,OAAO;gBACnB,MAAM,EAAM,CAAE,CAAC,mBAAmB,EAAE,GAAG,EAAE,IAAI,CAAC,QAAQ,CAAC,mBAAmB,CAAC,EAAE,CAAC,cAAc,EAAE,GAAG,EAAE,OAAO,CAAC,CAAE;gBAC7G,IAAI,EAAQ,MAAM;gBAClB,OAAO,EAAK,QAAQ;gBACpB,MAAM,EAAM,uBAAuB;gBACnC,QAAQ,EAAI,CAAC,IAAQ,EAAE,EAAE;oBACvB,IAAG,IAAI,IAAI,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE;wBAC9C,IAAI,CAAC,WAAW,CAAC,EAAC,MAAM,EAAE;gCACxB,KAAK,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC;6BACvB,EAAC,CAAC,CAAC;qBACL;gBACH,CAAC;aACF;SACF,CAAC;QAEF,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC;IAClC,CAAC;IAEM,WAAW;QAChB,MAAM,SAAS,GAAG,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,mBAAmB,EAAE;YACtD,KAAK,EAAE,MAAM;YACb,IAAI,EAAE,EAAC,iBAAiB,EAAE,IAAI,CAAC,QAAQ,CAAC,mBAAmB,EAAE,YAAY,EAAE,OAAO,EAAC;SACpF,CAAC,CAAC;QAEH,SAAS,CAAC,WAAW,EAAE,CAAC,SAAS,CAAC,MAAM,CAAC,EAAE;YACzC,OAAO,CAAC,GAAG,CAAC,uBAAuB,CAAC,CAAC;QACvC,CAAC,CAAC,CAAC;IACL,CAAC;IAED;;;;;OAKG;IACW,eAAe,CAAC,IAAY;;YACxC,IAAI,QAAQ,GAAS,EAAE,CAAC;YACxB,IAAI;gBACF,IAAI,IAAI,GAAS,MAAM,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,mBAAmB,EAAE,CAAC,CAAC,MAAM,EAAE,OAAO,EAAE,GAAG,GAAC,IAAI,GAAC,GAAG,CAAC,EAAE,CAAC,cAAc,EAAE,GAAG,EAAE,UAAU,CAAC,CAAC,EAAE,CAAC,IAAI,EAAE,MAAM,CAAC,EAAE,MAAM,EAAE,KAAK,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;gBACxK,QAAQ,GAAG,IAAI,CAAC;aACjB;YACD,OAAM,QAAQ,EAAE;gBACd,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;aACvB;YACD,OAAO,QAAQ,CAAC;QAClB,CAAC;KAAA;IAEa,YAAY,CAAC,IAAY;;YACrC,IAAI,QAAQ,GAAS,EAAE,CAAC;YACxB,IAAI;gBACF,IAAI,IAAI,GAAS,MAAM,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,mBAAmB,EAAE,CAAC,CAAC,MAAM,EAAE,OAAO,EAAE,GAAG,GAAC,IAAI,GAAC,GAAG,CAAC,EAAE,CAAC,mBAAmB,EAAE,GAAG,EAAE,IAAI,CAAC,QAAQ,CAAC,mBAAmB,CAAC,EAAE,CAAC,cAAc,EAAE,GAAG,EAAE,OAAO,CAAC,CAAC,EAAE,CAAC,IAAI,EAAE,MAAM,CAAC,EAAE,MAAM,EAAE,KAAK,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;gBACpO,QAAQ,GAAG,IAAI,CAAC;aACjB;YACD,OAAM,QAAQ,EAAE;gBACd,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;aACvB;YACD,OAAO,QAAQ,CAAC;QAClB,CAAC;KAAA;;wGApQU,4BAA4B;0HAA5B,4BAA4B;QClDzC,yEAAuB;QAEnB,yEAA4B;QACxB,oFAAsC;QACpC,4EAAW;QAAA,iEAAM;QAAA,4DAAY;QAC7B,2EAQ6B;QAJrB,yJAAS,mCAA+B,IAAC,2FAChC,uBAAmB,IADa,yFAEjC,yBAAqB,IAFY;QAJjD,4DAQ6B;QAE7B,8HAES;QAET,yFAA4I;QAA9C,sLAAkB,8BAA0B,IAAC;QACzI,wHAKM;;QACR,4DAAmB;QAEnB,+EAA+C;QAC7C,wEAAM;QAAA,oFAAmB;QAAA,4DAAO;QAClC,4DAAW;QAEb,4DAAiB;QAErB,4DAAM;QAEN,0EAA4B;QAC1B,uEAAK;QACH,uFAA2E;QAAnC,uKAAU,2BAAuB,IAAC;QAAC,kHAA4C;QAAA,4DAAmB;QAC5I,4DAAM;QACN,2HAgCM;QAIR,4DAAM;QAEV,4DAAM;;;QAvEY,0DAAwC;QAAxC,gFAAwC;QAQ5B,0DAA6B;QAA7B,6FAA6B;QAIS,0DAAmC;QAAnC,gGAAmC;QACrF,0DAAwC;QAAxC,gKAAwC;QAQtC,0DAAiB;QAAjB,0EAAiB;QAUX,0DAAqB;QAArB,kFAAqB;QAEnC,0DAAe;QAAf,+EAAe;;ADyRpB,MAAM,mBAAmB;IAE9B,YACS,SAA4C,EACnB,IAA6B;QADtD,cAAS,GAAT,SAAS,CAAmC;QACnB,SAAI,GAAJ,IAAI,CAAyB;IAAG,CAAC;IAEnE,SAAS;QACP,IAAI,CAAC,SAAS,CAAC,KAAK,EAAE,CAAC;IACzB,CAAC;;sFARU,mBAAmB,uMAIpB,qEAAe;iHAJd,mBAAmB;QEjUhC,wEAAqB;QAAA,6EAAkB;QAAA,4DAAK;QAE5C,yEAAwB;QAEtB,yEAAkD;QAChD,yEAAiF;QAC/E,uEAA6B;QAAA,gEAAK;QAAA,4DAAI;QACtC,iFAAiB;QACf,4EAAW;QAAA,yEAAS;QAAA,4DAAY;QAChC,uEAA2B;QAC7B,4DAAiB;QACjB,oFAAmB;QAAA,qFAAoB;QAAA,4DAAmB;QAC1D,kFAAiB;QACf,6EAAW;QAAA,8EAAa;QAAA,4DAAY;QACpC,uEAA2B;QAC7B,4DAAiB;QACnB,4DAAM;QACN,0EAAiF;QAC/E,wEAA6B;QAAA,mEAAO;QAAA,4DAAI;QACxC,kFAAiB;QACf,6EAAW;QAAA,+DAAG;QAAA,4DAAY;QAC1B,uEAA2B;QAC7B,4DAAiB;QACjB,kFAAiB;QACf,6EAAW;QAAA,oEAAQ;QAAA,4DAAY;QAC/B,uEAA2B;QAC7B,4DAAiB;QACjB,kFAAiB;QACf,6EAAW;QAAA,iEAAK;QAAA,4DAAY;QAC5B,uEAA2B;QAC7B,4DAAiB;QACjB,kFAAiB;QACf,6EAAW;QAAA,uEAAW;QAAA,4DAAY;QAClC,uEAA2B;QAC7B,4DAAiB;QACjB,kFAAiB;QACf,6EAAW;QAAA,gEAAI;QAAA,4DAAY;QAC3B,uEAA2B;QAC7B,4DAAiB;QACnB,4DAAM;QACR,4DAAM;QAGN,kFAAiB;QACf,6EAAW;QAAA,2EAAe;QAAA,4DAAY;QACtC,uEAA2B;QAC7B,4DAAiB;QAEnB,4DAAM;QAEN,0EAAwB;QACtB,6EAAyC;QAAtB,4IAAS,eAAW,IAAC;QAAC,mEAAO;QAAA,4DAAS;QACzD,6EAA6D;QAAA,sEAAK;QAAA,4DAAS;QAC7E,4DAAM;;QADe,2DAAyB;QAAzB,sFAAyB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AChDmC;AACG;AAIlB;AAEY;;;;;;;;;;;;;;;;;;ICalE,6EAA0H;IAA5B,+SAAS,yBAAiB,IAAC;IACvH,2EAAU;IAAA,gEAAK;IAAA,4DAAW;IAC5B,4DAAS;;;IAIL,iFAAyD;IACvD,uDACF;IAAA,4DAAa;;;IAF2B,6EAAgB;IACtD,0DACF;IADE,2FACF;;;IACA,6EAAqC;IAAA,oEAAG;IAAA,+EAAe;IAAA,4DAAI;IAAA,4DAAa;;;IAJ1E,sEAAuD;IACrD,6IAEa;IACb,6IAAwE;IAC1E,4DAAM;;;IAJ2B,0DAAO;IAAP,6EAAO;IAGzB,0DAAsB;IAAtB,sFAAsB;;;;IAqBvC,6EAAsH;IAA1B,+SAAS,uBAAe,IAAC;IACnH,2EAAU;IAAA,gEAAK;IAAA,4DAAW;IAC5B,4DAAS;;;IAIL,iFAAqD;IACnD,uDACF;IAAA,4DAAa;;;IAFyB,2EAAc;IAClD,0DACF;IADE,yFACF;;;IACA,6EAAqC;IAAA,oEAAG;IAAA,+EAAe;IAAA,4DAAI;IAAA,4DAAa;;;IAJ1E,sEAAqD;IACnD,6IAEa;IACb,6IAAwE;IAC1E,4DAAM;;;IAJyB,0DAAO;IAAP,6EAAO;IAGvB,0DAAsB;IAAtB,sFAAsB;;;IAyCvC,yEAAsC;IAAC,gEAAI;IAAA,4DAAK;;;IAChD,yEAAuC;IAAC,uDAAiB;IAAA,4DAAK;;;IAAtB,0DAAiB;IAAjB,4FAAiB;;;IAKzD,yEAAsC;IAAC,iEAAK;IAAA,4DAAK;;;IACjD,yEAAuC;IAAC,uDAAiB;IAAA,4DAAK;;;IAAtB,0DAAiB;IAAjB,4FAAiB;;;IAKzD,yEAAsC;IAAC,kEAAM;IAAA,4DAAK;;;IAClD,yEAAuC;IAAC,uDAAkB;IAAA,4DAAK;;;IAAvB,0DAAkB;IAAlB,6FAAkB;;;IAK1D,yEAAsC;IAAC,qEAAI;IAAA,4DAAK;;;IAChD,yEAAuC;IAAC,uDAAkB;IAAA,4DAAK;;;IAAvB,0DAAkB;IAAlB,6FAAkB;;;IAI1D,oEAA6C;;;;IAC7C,yEAAuC;IACrC,6EAAiF;IAAzC,0WAAS,0CAA8B,IAAC;IAC9E,2EAAU;IAAA,iEAAM;IAAA,4DAAW;IAC9B,4DAAS;IACV,4DAAK;;;IAGP,oEAA8D;;;IAC9D,oEAAoE;;;IC7HtE,4EAAgD;IAC9C,4FACF;IAAA,4DAAY;;;IAMZ,4EAA+C;IAC7C,4FACF;IAAA,4DAAY;;AF6Cb,MAAM,2BAA2B;IAiBtC,YACoB,GAAe,EACf,IAAiB,EACjB,MAAiB,EACjB,IAAY,EACZ,OAAsB;QAJtB,QAAG,GAAH,GAAG,CAAY;QACf,SAAI,GAAJ,IAAI,CAAa;QACjB,WAAM,GAAN,MAAM,CAAW;QACjB,SAAI,GAAJ,IAAI,CAAQ;QACZ,YAAO,GAAP,OAAO,CAAe;QAGxC,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;QACpB,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;QACnB,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;QAEjB,IAAI,CAAC,EAAE,GAAG;YACR,MAAM,EAAE;gBACN,IAAI,EAAY,EAAE;gBAClB,SAAS,EAAO,IAAI,+CAAa,CAAC,CAAC,CAAC;gBACpC,YAAY,EAAI,IAAI,4CAAU,EAAE;gBAChC,MAAM,EAAU,CAAC,KAAkC,EAAE,EAAE,CAAC,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC;gBAChF,WAAW,EAAK,CAAC,KAAS,EAAE,EAAE,CAAC,IAAI,CAAC,iBAAiB,CAAC,KAAK,CAAC;gBAC5D,KAAK,EAAW,GAAG,EAAE,CAAC,IAAI,CAAC,WAAW,EAAE;gBACxC,OAAO,EAAS,GAAG,EAAE,CAAC,IAAI,CAAC,aAAa,EAAE;gBAC1C,KAAK,EAAW,GAAG,EAAE,CAAC,IAAI,CAAC,WAAW,EAAE;gBACxC,OAAO,EAAS,CAAC,MAAU,EAAE,EAAE,CAAC,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC;aAC3D;YACD,IAAI,EAAE;gBACJ,IAAI,EAAY,EAAE;gBAClB,SAAS,EAAO,IAAI,+CAAa,CAAC,CAAC,CAAC;gBACpC,YAAY,EAAI,IAAI,4CAAU,EAAE;gBAChC,MAAM,EAAU,CAAC,KAAS,EAAE,EAAE,CAAC,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC;gBACrD,WAAW,EAAK,CAAC,KAAS,EAAE,EAAE,CAAC,IAAI,CAAC,eAAe,CAAC,KAAK,CAAC;gBAC1D,KAAK,EAAW,GAAG,EAAE,CAAC,IAAI,CAAC,SAAS,EAAE;gBACtC,OAAO,EAAS,GAAG,EAAE,CAAC,IAAI,CAAC,WAAW,EAAE;gBACxC,KAAK,EAAW,GAAG,EAAE,CAAC,IAAI,CAAC,SAAS,EAAE;gBACtC,OAAO,EAAS,CAAC,IAAQ,EAAE,EAAE,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC;aACrD;YACD,WAAW,EAAE;gBACX,KAAK,EAAW,EAAE;gBAClB,MAAM,EAAU,CAAC,KAAS,EAAE,EAAE,CAAC,IAAI,CAAC,iBAAiB,CAAC,KAAK,CAAC;aAC7D;YACD,QAAQ,EAAE;gBACR,MAAM,EAAU,EAAE;gBAClB,MAAM,EAAU,CAAC,MAAM,EAAE,MAAM,EAAE,OAAO,EAAE,OAAO,EAAE,UAAU,CAAC;gBAC9D,IAAI,EAAY,IAAI,+CAAa,CAAC,CAAC,CAAC;gBACpC,MAAM,EAAU,GAAG,EAAE,CAAC,IAAI,CAAC,aAAa,EAAE;gBAC1C,MAAM,EAAU,CAAC,EAAS,EAAE,EAAE,CAAC,IAAI,CAAC,aAAa,CAAC,EAAE,CAAC;aACtD;SACF,CAAC;IAEJ,CAAC;IAGM,QAAQ;QACb,IAAI,CAAC,EAAE,CAAC,QAAQ,CAAC,IAAI,CAAC,SAAS,CAAE,CAAC,KAAK,EAAE,EAAE;YACzC,OAAO,CAAC,GAAG,CAAC,kCAAkC,EAAE,KAAK,CAAC,CAAC;QACzD,CAAC,CAAC,CAAC;QAEH;;WAEG;QACH,IAAI,CAAC,YAAY,CAAC,SAAS,CAAE,CAAO,OAAY,EAAE,EAAE,CAAC;YACnD,IAAI,CAAC,IAAI,CAAC,GAAG,CAAE,GAAS,EAAE,CAAC;gBACzB,IAAI;oBACF,OAAO,CAAC,GAAG,CAAC,2DAA2D,EAAE,OAAO,CAAC,CAAC;oBAElF,IAAI,CAAC,OAAO,GAAG,OAAO,CAAC;oBAEvB,IAAG,OAAO,CAAC,WAAW,EAAE;wBACtB,IAAI,IAAI,GAAO,MAAM,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,mBAAmB,EAAE,CAAC,OAAO,CAAC,WAAW,CAAC,EAAE,CAAC,IAAI,EAAE,MAAM,EAAE,qBAAqB,CAAC,CAAC,CAAC;wBACtH,IAAG,IAAI,IAAI,IAAI,CAAC,MAAM,EAAE;4BACtB,IAAI,QAAQ,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;4BACvB,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;yBAC1B;qBACF;oBAED,IAAG,OAAO,CAAC,SAAS,EAAE;wBACpB,IAAI,IAAI,GAAO,MAAM,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,2BAA2B,EAAE,CAAC,OAAO,CAAC,SAAS,CAAC,EAAE,CAAC,IAAI,EAAE,MAAM,EAAE,MAAM,EAAE,iBAAiB,CAAC,CAAC,CAAC;wBAChI,IAAG,IAAI,IAAI,IAAI,CAAC,MAAM,EAAE;4BACtB,IAAI,MAAM,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;4BACrB,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;4BACrB,IAAI,CAAC,EAAE,CAAC,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,CAAC;yBACnC;qBACF;oBAED,IAAG,OAAO,CAAC,OAAO,EAAE;wBAClB,IAAI,IAAI,GAAO,MAAM,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,4BAA4B,EAAE,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,CAAC,IAAI,EAAE,MAAM,EAAE,MAAM,CAAC,CAAC,CAAC;wBAC5G,IAAG,IAAI,IAAI,IAAI,CAAC,MAAM,EAAE;4BACtB,IAAI,IAAI,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;4BACnB,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;4BACjB,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC;yBAC/B;qBACF;oBAED,IAAG,OAAO,CAAC,WAAW,IAAI,OAAO,CAAC,WAAW,CAAC,MAAM,EAAE;wBACpD,IAAI,CAAC,EAAE,CAAC,WAAW,CAAC,KAAK,GAAG,OAAO,CAAC,WAAW,CAAC;qBACjD;oBAED,IAAG,OAAO,CAAC,YAAY,EAAE;wBACvB,IAAI,IAAI,GAAO,MAAM,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,wBAAwB,EAAE,OAAO,CAAC,YAAY,EAAE,CAAC,IAAI,EAAE,MAAM,EAAE,MAAM,CAAC,CAAC,CAAC;wBAC3G,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,YAAY,EAAE,IAAI,CAAC,CAAC;wBACxC,IAAG,IAAI,IAAI,IAAI,CAAC,MAAM,EAAE;4BACtB,IAAI,CAAC,EAAE,CAAC,QAAQ,CAAC,MAAM,GAAG,IAAI,CAAC;4BAC/B,IAAI,CAAC,EAAE,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;yBAClC;qBACF;iBAEF;gBACD,OAAM,QAAQ,EAAE,GAAE;YACpB,CAAC,EAAC,CAAC;QAGL,CAAC,EAAC,CAAC;QAGH,8CAA8C;QAE9C,IAAI,CAAC,EAAE,CAAC,MAAM,CAAC,YAAY,GAAG,IAAI,CAAC,EAAE,CAAC,MAAM,CAAC,SAAS,CAAC,IAAI,CACzD,4DAAY,CAAC,GAAG,CAAC,EACjB,mDAAG,CAAE,CAAC,KAAS,EAAE,EAAE,CAAC,CAAC,OAAO,KAAK,KAAK,QAAQ,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,KAAK,IAAI,IAAI,CAAC,EAAC,GAAE,EAAC,MAAK,CAAC,IAAI,CAAC,CAAE,EACzF,wDAAQ,CAAE,CAAO,IAAW,EAAE,EAAE,CAAC,iGAAI,CAAC,aAAa,CAAC,IAAI,CAAC,KAAE,CAC5D,CAAC;QAEF,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CACrD,4DAAY,CAAC,GAAG,CAAC,EACjB,mDAAG,CAAE,CAAC,KAAS,EAAE,EAAE,CAAC,CAAC,OAAO,KAAK,KAAK,QAAQ,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,KAAK,IAAI,IAAI,CAAC,EAAC,GAAE,EAAC,MAAK,CAAC,IAAI,CAAC,CAAE,EACzF,wDAAQ,CAAE,CAAO,IAAW,EAAE,EAAE,CAAC,iGAAI,CAAC,WAAW,CAAC,IAAI,CAAC,KAAE,CAC1D,CAAC;IAEJ,CAAC;IAEa,YAAY,CAAC,KAAkC;;YAC3D,IAAI,MAAM,GAAG,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC;YAChC,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;YACrB,IAAI,CAAC,EAAE,CAAC,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,CAAC;YAElC,mCAAmC;YACnC,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,EAAC,SAAS,EAAE,IAAI,CAAC,MAAM,CAAC,EAAE,EAAC,CAAC,CAAC;QACvD,CAAC;KAAA;IAEO,WAAW;QACjB,IAAI,CAAC,EAAE,CAAC,MAAM,CAAC,SAAS,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;IACpC,CAAC;IAEO,iBAAiB,CAAC,KAAS;QACjC,IAAI,CAAC,EAAE,CAAC,MAAM,CAAC,SAAS,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;IACpD,CAAC;IAEO,aAAa,CAAC,MAAU;QAC9B,OAAO,MAAM,CAAC,CAAC,CAAC,MAAM,CAAC,IAAI,EAAC,CAAC,EAAE,CAAC;IAClC,CAAC;IAEO,WAAW;QACjB,UAAU,CAAE,GAAG,EAAE;YACf,IAAI,CAAC,EAAE,CAAC,MAAM,CAAC,IAAI,GAAG,EAAE,CAAC;QAC3B,CAAC,EAAE,GAAG,CAAC,CAAC;IACV,CAAC;IAEO,aAAa;QACnB,IAAG,IAAI,CAAC,MAAM,EAAE;YACd,IAAI,CAAC,EAAE,CAAC,MAAM,CAAC,IAAI,GAAG,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC;SACxC;aACI;YACH,IAAI,CAAC,EAAE,CAAC,MAAM,CAAC,IAAI,GAAG,EAAE,CAAC;SAC1B;IACH,CAAC;IAEO,iBAAiB,CAAC,KAAS;QACjC,OAAO,CAAC,GAAG,CAAC,iDAAiD,EAAE,KAAK,CAAC,CAAC;QACtE,IAAI,WAAW,GAAG,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC;QACrC,mCAAmC;QACnC,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,EAAC,WAAW,EAAE,WAAW,EAAC,CAAC,CAAC;IACtD,CAAC;IAEO,UAAU,CAAC,KAAS;QAC1B,OAAO,CAAC,GAAG,CAAC,0CAA0C,EAAE,KAAK,CAAC;QAE9D,wBAAwB;QACxB,IAAG,KAAK,IAAI,KAAK,CAAC,MAAM,IAAI,KAAK,CAAC,MAAM,CAAC,KAAK,EAAE;YAC9C,IAAI,IAAI,GAAG,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC;YAC9B,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;YACjB,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC;YAC9B,mCAAmC;YACnC,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,EAAC,OAAO,EAAE,IAAI,CAAC,EAAE,EAAC,CAAC,CAAC;SAC7C;IAEH,CAAC;IAEO,eAAe,CAAC,KAAS;QAC/B,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;IAClD,CAAC;IAEO,SAAS;QACf,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;IAClC,CAAC;IAEO,WAAW,CAAC,IAAQ;QAC1B,OAAO,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,EAAC,CAAC,EAAE,CAAC;IAC9B,CAAC;IAEO,SAAS;QACf,UAAU,CAAE,GAAG,EAAE;YACf,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,IAAI,GAAG,EAAE,CAAC;QACzB,CAAC,EAAE,GAAG,CAAC,CAAC;IACV,CAAC;IAEO,WAAW;QACjB,IAAG,IAAI,CAAC,IAAI,EAAE;YACZ,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC;SACpC;aACI;YACH,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,IAAI,GAAG,EAAE,CAAC;SACxB;IACH,CAAC;IAED;;;;OAIG;IACW,aAAa,CAAC,EAAS;;YACnC,IAAI;gBACF,MAAM,QAAQ,GAAG,MAAM,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,wBAAwB,EAAE,CAAC,EAAE,CAAC,EAAE,IAAI,CAAC,CAAC;gBAC7E,IAAI,KAAK,GAAG,IAAI,CAAC,EAAE,CAAC,QAAQ,CAAC,MAAM,CAAC,SAAS,CAAE,CAAC,OAAO,EAAE,EAAE,CAAC,OAAO,CAAC,EAAE,IAAI,EAAE,CAAC,CAAC;gBAC9E,IAAI,CAAC,EAAE,CAAC,QAAQ,CAAC,MAAM,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;gBACzC,IAAI,CAAC,EAAE,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,IAAI,CAAC,EAAE,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,CAAC;aAC1D;YACD,OAAM,QAAQ,EAAE;gBACd,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;aACxB;QACH,CAAC;KAAA;IAEK,aAAa;QACnB,IAAI,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC;QAE/B,IAAI,UAAU,GAAG;YACf,OAAO,EAAE;gBACP,MAAM,EAAM,wBAAwB;gBACpC,IAAI,EAAQ,MAAM;gBAClB,IAAI,EAAQ,SAAS;gBACrB,MAAM,EAAM,CAAE,CAAC,YAAY,EAAE,GAAG,EAAE,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,EAAE,CAAC,mBAAmB,EAAE,GAAG,EAAE,IAAI,CAAC,QAAQ,CAAC,mBAAmB,CAAC,EAAE,CAAC,cAAc,EAAE,GAAG,EAAE,SAAS,CAAC,EAAE,CAAC,MAAM,EAAE,GAAG,EAAE,SAAS,CAAC,CAAE;gBAC/K,IAAI,EAAQ,MAAM;gBAClB,OAAO,EAAK,QAAQ;gBACpB,MAAM,EAAM,uBAAuB;gBACnC,QAAQ,EAAI,CAAC,IAAQ,EAAE,EAAE;oBACvB,IAAG,IAAI,IAAI,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE;wBAC5C,IAAI,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;wBAC9B,IAAI,YAAY,GAAG,IAAI,CAAC,EAAE,CAAC,QAAQ,CAAC,MAAM,CAAC,GAAG,CAAE,CAAC,IAAI,EAAE,EAAE,CAAC,IAAI,CAAC,EAAE,CAAE,CAAC;wBACpE,YAAY,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC;wBAC9B,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,EAAC,YAAY,EAAE,YAAY,EAAC,CAAC,CAAC;qBACzD;gBACH,CAAC;aACF;SACF,CAAC;QAEF,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC;IAClC,CAAC;IAES,sBAAsB;QAC5B,MAAM,SAAS,GAAG,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,mBAAmB,EAAE;YACtD,KAAK,EAAE,MAAM;YACb,IAAI,EAAE,EAAE,YAAY,EAAE,SAAS,EAAE,IAAI,EAAE,SAAS,EAAE;SACnD,CAAC,CAAC;QAEH,SAAS,CAAC,WAAW,EAAE,CAAC,SAAS,CAAE,CAAO,IAAI,EAAE,EAAE,CAAC;YACjD,IAAG,IAAI,EAAE;gBACP,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;gBAElB,4CAA4C;gBAC5C,IAAI;oBACF,MAAM,QAAQ,GAAG,MAAM,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,oBAAoB,EAAE;wBAC3D,SAAS,EAAE,IAAI,CAAC,SAAS;wBACzB,QAAQ,EAAE,IAAI,CAAC,QAAQ;wBACvB,KAAK,EAAE,IAAI,CAAC,KAAK;wBACjB,KAAK,EAAE,IAAI,CAAC,KAAK;qBAClB,CAAC,CAAC;oBACH,oHAAoH;oBACpH,IAAI;wBACF,IAAI,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC;wBAC/B,MAAM,OAAO,GAAG,MAAM,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,wBAAwB,EAAE;4BAC9D,4CAA4C;4BAC5C,iBAAiB,EAAE,IAAI,CAAC,eAAe;4BACvC,mBAAmB,EAAE,QAAQ,CAAC,EAAE;4BAChC,UAAU,EAAE,IAAI,CAAC,OAAO,CAAC,EAAE;4BAC3B,IAAI,EAAE,IAAI,CAAC,IAAI;yBAChB,CAAC,CAAC;wBAEH,6BAA6B;wBAC7B,IAAI,CAAC,EAAE,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC;4BAC3B,EAAE,EAAE,OAAO,CAAC,EAAE;4BACd,IAAI,EAAE,IAAI,CAAC,SAAS,GAAG,GAAG,GAAG,IAAI,CAAC,QAAQ;4BAC1C,IAAI,EAAE,IAAI,CAAC,IAAI;4BACf,KAAK,EAAE,IAAI,CAAC,KAAK;4BACjB,KAAK,EAAE,IAAI,CAAC,KAAK;yBAClB,CAAC,CAAC;wBAEH,IAAI,CAAC,EAAE,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,IAAI,CAAC,EAAE,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,CAAC;qBAE1D;oBACD,OAAM,QAAQ,EAAE;wBACd,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;qBACxB;iBAEF;gBACD,OAAM,QAAQ,EAAE;oBACd,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;iBACxB;aAGF;QACH,CAAC,EAAC,CAAC;IACL,CAAC;IAED;;;;;OAKG;IACW,aAAa,CAAC,IAAY;;YACtC,IAAI,QAAQ,GAAS,EAAE,CAAC;YACxB,2DAA2D;YAC3D,IAAI;gBACF,IAAI,IAAI,GAAS,MAAM,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,2BAA2B,EAAE,CAAC,CAAC,MAAM,EAAE,OAAO,EAAE,GAAG,GAAC,IAAI,GAAC,GAAG,CAAC,CAAC,EAAE,CAAC,IAAI,EAAE,MAAM,CAAC,EAAE,MAAM,EAAE,KAAK,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;gBAC7I,QAAQ,GAAG,IAAI,CAAC;aACjB;YACD,OAAM,QAAQ,EAAE;gBACd,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;aACvB;YACD,OAAO,QAAQ,CAAC;QAClB,CAAC;KAAA;IAEa,WAAW,CAAC,IAAY;;YACpC,IAAI,QAAQ,GAAS,EAAE,CAAC;YACxB,IAAI;gBACF,IAAI,IAAI,GAAS,MAAM,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,4BAA4B,EAAE,CAAC,CAAC,MAAM,EAAE,OAAO,EAAE,GAAG,GAAC,IAAI,GAAC,GAAG,CAAC,CAAC,EAAE,CAAC,IAAI,EAAE,MAAM,CAAC,EAAE,MAAM,EAAE,KAAK,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC;gBAC/I,QAAQ,GAAG,IAAI,CAAC;aACjB;YACD,OAAM,QAAQ,EAAE;gBACd,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;aACvB;YACD,OAAO,QAAQ,CAAC;QAClB,CAAC;KAAA;;sGArWU,2BAA2B;yHAA3B,2BAA2B;QClExC,yEAAuB;QAEnB,mFAAoC;QAElC,6EAAyB;QAEvB,yEAAoD;QAElD,uEAA6B;QAAA,sFAAsB;QAAA,4DAAI;QAEvD,yEAAqC;QAGrC,oFAAsC;QACpC,4EAAW;QAAA,iEAAM;QAAA,4DAAY;QAC7B,4EAOiD;QAHzC,yJAAS,iCAA6B,IAAC,2FAC9B,qBAAiB,IADa,yFAE/B,uBAAmB,IAFY;QAJ/C,4DAOiD;QAEjD,+HAES;QAET,2FAAsI;QAA5C,sLAAkB,4BAAwB,IAAC;QACnI,0HAKM;;QACR,4DAAmB;QAEnB,gFAA+C;QAC7C,wEAAM;QAAA,oFAAmB;QAAA,4DAAO;QAClC,4DAAW;QACb,4DAAiB;QAGjB,sFAAoC;QAClC,6EAAW;QAAA,oFAAmB;QAAA,4DAAY;QAC1C,4EAOiD;QAHzC,yJAAS,+BAA2B,IAAC,2FAC5B,mBAAe,IADa,yFAE7B,qBAAiB,IAFY;QAJ7C,4DAOiD;QAEjD,+HAES;QAET,2FAAgI;QAA1C,sLAAkB,0BAAsB,IAAC;QAC7H,0HAKM;;QACR,4DAAmB;QAEnB,gFAA+C;QAC7C,wEAAM;QAAA,sGAAgC;QAAA,4DAAO;QAC/C,4DAAW;QACb,4DAAiB;QAEjB,4DAAM;QAMN,2EAAqD;QACnD,qFAAqC;QACnC,6EAAW;QAAA,uEAAW;QAAA,4DAAY;QAClC,gFAMmD;QAAzC,8JAAU,iCAA6B,IAAC;QAAC,4DAAW;QAChE,4DAAiB;QACnB,4DAAM;QAEV,4DAAM;QAEN,4DAAU;QAIV,+EAA0B;QACxB,wEAA6B;QAAA,+EAAmB;QAAA,8EAAoG;QAA/B,oJAAS,wBAAoB,IAAC;QAAE,4EAAU;QAAA,+DAAG;QAAA,4DAAW;QAAA,4DAAS;QAAA,4DAAI;QAE1L,6EAA8E;;QAG5E,6EAAkC;QAChC,wHAAgD;QAChD,wHAA8D;QAChE,qEAAe;QAGf,6EAAkC;QAChC,wHAAiD;QACjD,wHAA8D;QAChE,qEAAe;QAGf,6EAAmC;QACjC,wHAAkD;QAClD,wHAA+D;QACjE,qEAAe;QAGf,6EAAmC;QACjC,wHAAgD;QAChD,wHAA+D;QACjE,qEAAe;QAEf,6EAAsC;QACpC,wHAA6C;QAC7C,wHAIK;QACP,qEAAe;QAEf,wHAA8D;QAC9D,wHAAoE;QACtE,4DAAQ;QACV,4DAAU;QAGZ,4DAAgB;QAEpB,4DAAM;;;;QA9Hc,2DAAsC;QAAtC,gFAAsC;QAO1B,0DAA2B;QAA3B,2FAA2B;QAIS,0DAAiC;QAAjC,8FAAiC;QAChF,0DAAsC;QAAtC,+JAAsC;QAQrC,0DAAiB;QAAjB,0EAAiB;QAUnB,0DAAoC;QAApC,gFAAoC;QAOxB,0DAAyB;QAAzB,yFAAyB;QAIS,0DAA+B;QAA/B,4FAA+B;QAC5E,0DAAoC;QAApC,6JAAoC;QAQnC,0DAAiB;QAAjB,0EAAiB;QAmBf,0DAAgC;QAAhC,6FAAgC;QAc/B,0DAAuC;QAAvC,+JAAuC;QAmClC,2DAAmC;QAAnC,mGAAmC;QACtB,0DAA4B;QAA5B,oGAA4B;;AD0ShE,MAAM,mBAAmB;IAM9B,YACS,SAA4C,EAC3C,WAAwB,EACC,IAAkB;QAF5C,cAAS,GAAT,SAAS,CAAmC;QAC3C,gBAAW,GAAX,WAAW,CAAa;QACC,SAAI,GAAJ,IAAI,CAAc;QAEjD,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC;YACjC,SAAS,EAAE,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,EAAE,EAAE,gEAAmB,CAAC;YACtE,QAAQ,EAAE,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,EAAE,EAAE,gEAAmB,CAAC;YACpE,IAAI,EAAE,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,SAAS,EAAE,gEAAmB,CAAC;YACnE,KAAK,EAAE,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,gEAAmB,EAAC,6DAAgB,CAAC,CAAC;YACjF,KAAK,EAAE,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,CAAC;SAC1C,CAAC;IACN,CAAC;IAdD,IAAI,CAAC,KAAK,OAAO,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC;IAgB9B,oBAAoB,CAAC,SAAoB;QACzC,MAAO,CAAC,MAAM,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC,OAAO,CAAE,CAAC,OAAW,EAAE,EAAE;YAChE,OAAO,CAAC,aAAa,EAAE,CAAC;YACxB,IAAI,OAAO,CAAC,QAAQ,EAAE;gBACpB,IAAI,CAAC,oBAAoB,CAAC,OAAO,CAAC,CAAC;aACpC;QACH,CAAC,CAAC,CAAC;IACL,CAAC;IAED,QAAQ;QACN,IAAI,CAAC,SAAS,CAAC,KAAK,EAAE,CAAC;IACzB,CAAC;IAED,QAAQ;QACN,+BAA+B;QAC/B,IAAI,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE;YACrB,OAAO,IAAI,CAAC,oBAAoB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;SAC7C;QAED,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC;YACnB,SAAS,EAAE,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,SAAS;YACpC,QAAQ,EAAE,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,QAAQ;YAClC,IAAI,EAAE,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI;YAC1B,KAAK,EAAE,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,KAAK;YAC5B,KAAK,EAAE,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,KAAK;SAC7B,CAAC,CAAC;IAEL,CAAC;;sFA/CU,mBAAmB,kUASpB,qEAAe;iHATd,mBAAmB;QElbhC,wEAAqB;QAAA,mGAAmC;QAAA,4DAAK;QAE7D,yEAAwB;QACtB,0EAAiD;QAAxB,+IAAY,cAAU,IAAC;QAChD,yEAAkD;QAChD,yEAAiF;QAC/E,uEAA6B;QAAA,gEAAK;QAAA,4DAAI;QAEtC,iFAAiB;QACf,4EAAW;QAAA,uEAAM;QAAA,4DAAY;QAC7B,uEAA6C;QAC7C,6HAEY;QACd,4DAAiB;QAEjB,kFAAiB;QACf,6EAAW;QAAA,+DAAG;QAAA,4DAAY;QAC1B,uEAA6C;QAC7C,6HAEY;QACd,4DAAiB;QAEjB,kFAAgB;QACd,6EAAW;QAAA,2EAAe;QAAA,4DAAY;QACtC,iFAAoC;QAClC,kFAA4B;QAAA,4EAAW;QAAA,4DAAa;QACpD,kFAA4B;QAAA,uEAAW;QAAA,4DAAa;QACpD,kFAA6B;QAAA,oEAAQ;QAAA,4DAAa;QAClD,kFAA4B;QAAA,uEAAM;QAAA,4DAAa;QACjD,4DAAa;QACf,4DAAiB;QAEnB,4DAAM;QAEN,0EAAiF;QAC/E,wEAA6B;QAAA,4EAAW;QAAA,4DAAI;QAE5C,kFAAiB;QACf,6EAAW;QAAA,iEAAK;QAAA,4DAAY;QAC5B,wEAA0C;QAC5C,4DAAiB;QAEjB,kFAAiB;QACf,6EAAW;QAAA,iEAAK;QAAA,4DAAY;QAC5B,wEAA0C;QAC5C,4DAAiB;QAEnB,4DAAM;QAER,4DAAM;QACN,4DAAO;QACT,4DAAM;QAEN,2EAA2D;QACzD,8EAAwC;QAArB,4IAAS,cAAU,IAAC;QAAC,mEAAO;QAAA,4DAAS;QACxD,8EAAwD;QAArC,4IAAS,cAAU,IAAC;QAAiB,8DAAE;QAAA,4DAAS;QACrE,4DAAM;;QAvDE,0DAAkB;QAAlB,+EAAkB;QAQN,0DAAkC;QAAlC,yIAAkC;QAQlC,0DAAiC;QAAjC,uIAAiC","file":"src_app_in_bookings_booking_module_ts.js","sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { RouterModule, Routes } from '@angular/router';\r\n\r\nimport { BookingComponent } from './booking.component';\r\nimport { BookingEditComponent } from './edit/booking.edit.component';\r\nimport { BookingCompositionComponent } from './composition/booking.composition.component';\r\n\r\n\r\nconst routes: Routes = [\r\n    {\r\n        path: '',\r\n        component: BookingComponent\r\n    },    \r\n    {\r\n        path: 'edit/:id',\r\n        component: BookingEditComponent\r\n    },\r\n    {\r\n        path: 'edit',\r\n        component: BookingEditComponent\r\n    },\r\n    {\r\n        path: 'composition/:id',\r\n        component: BookingCompositionComponent\r\n    },\r\n\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forChild(routes)],\r\n  exports: [RouterModule]\r\n})\r\nexport class BookingRoutingModule {}\r\n","import { Component, OnInit, AfterViewInit  } from '@angular/core';\nimport { AuthService, ApiService } from 'sb-shared-lib';\n\n\n@Component({\n  selector: 'booking',\n  template: ''\n})\nexport class BookingComponent implements OnInit  {\n\n\n  constructor(\n    private auth: AuthService\n  ) {}\n\n\n  public ngOnInit() {\n    console.log('BookingComponent init');\n    // redirect to bookings list\n  }\n\n}","import { NgModule } from '@angular/core';\r\nimport { DateAdapter, MAT_DATE_LOCALE } from '@angular/material/core';\r\nimport { Platform } from '@angular/cdk/platform';\r\nimport { CustomDateAdapter } from '../../customDateAdapter';\r\n\r\n\r\nimport { SharedLibModule, AuthInterceptorService } from 'sb-shared-lib';\r\n\r\nimport { BookingRoutingModule } from './booking-routing.module';\r\n\r\nimport { BookingComponent } from './booking.component';\r\nimport { BookingEditComponent } from './edit/booking.edit.component';\r\n\r\n\r\nimport { BookingEditCustomerComponent } from './edit/components/booking.edit.customer/booking.edit.customer.component';\r\nimport { DialogCreatePartner } from './edit/components/booking.edit.customer/booking.edit.customer.component';\r\n\r\nimport { BookingEditSojournComponent } from './edit/components/booking.edit.sojourn/booking.edit.sojourn.component';\r\nimport { DialogCreateContact } from './edit/components/booking.edit.sojourn/booking.edit.sojourn.component';\r\n\r\nimport { BookingEditBookingsComponent } from './edit/components/booking.edit.bookings/booking.edit.bookings.component';\r\nimport { BookingEditBookingsGroupComponent } from './edit/components/booking.edit.bookings/components/booking.edit.bookings.group/booking.edit.bookings.group.component';\r\nimport { BookingEditBookingsGroupLineComponent } from './edit/components/booking.edit.bookings/components/booking.edit.bookings.group.line/booking.edit.bookings.group.line.component';\r\nimport { BookingEditBookingsGroupAccomodationComponent } from './edit/components/booking.edit.bookings/components/booking.edit.bookings.group.accomodation/booking.edit.bookings.group.accomodation.component';\r\nimport { BookingEditBookingsGroupLineDiscountComponent } from './edit/components/booking.edit.bookings/components/booking.edit.bookings.group.line.discount/booking.edit.bookings.group.line.discount.component';\r\n\r\nimport { BookingCompositionComponent, BookingCompositionDialogConfirm } from './composition/booking.composition.component';\r\nimport { BookingCompositionLinesComponent } from './composition/components/booking.composition.lines/booking.composition.lines.component';\r\n\r\n@NgModule({\r\n  imports: [\r\n    SharedLibModule,\r\n    BookingRoutingModule\r\n  ],\r\n  declarations: [\r\n    BookingComponent, BookingEditComponent, \r\n    BookingEditCustomerComponent, DialogCreatePartner,\r\n    BookingEditSojournComponent, DialogCreateContact,\r\n    BookingEditBookingsComponent, \r\n    BookingEditBookingsGroupComponent, BookingEditBookingsGroupAccomodationComponent, BookingEditBookingsGroupLineComponent, BookingEditBookingsGroupLineDiscountComponent,\r\n    BookingCompositionComponent, BookingCompositionDialogConfirm,\r\n    BookingCompositionLinesComponent\r\n  ],\r\n  providers: [\r\n    { provide: DateAdapter, useClass: CustomDateAdapter, deps: [MAT_DATE_LOCALE, Platform] }\r\n  ]\r\n})\r\nexport class AppInBookingModule { }\r\n","import { Component, AfterContentInit, OnInit, NgZone, Inject } from '@angular/core';\nimport { ActivatedRoute } from '@angular/router';\nimport { MatDialog, MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\n\nimport { ApiService, ContextService } from 'sb-shared-lib';\n\n\ninterface BookingCompositionDialogConfirmData {\n  booking: Booking;\n  relationship: string;\n}\n\nclass Booking {\n  constructor(\n    public id: number = 0,\n    public name: string = '',\n    public composition_id: number = 0\n  ) {}\n}\n\n\n@Component({\n  selector: 'booking-composition',\n  templateUrl: './booking.composition.component.html',\n  styleUrls: ['./booking.composition.component.scss']\n})\nexport class BookingCompositionComponent implements OnInit, AfterContentInit {\n\n  public showSbContainer: boolean = false;\n  public selectedTabIndex:number = 0;\n  public loading = true;\n\n  public booking_id: number;\n  public booking: any = new Booking();\n\n  constructor(\n    private dialog: MatDialog,\n    private api: ApiService, \n    private route: ActivatedRoute,\n    private context:ContextService,\n    private zone: NgZone) {\n    \n  }\n\n  /**\n   * Set up callbacks when component DOM is ready.\n   */\n  public ngAfterContentInit() {\n    this.loading = false;\n\n    // _open and _close event are relayed by eqListener on the DOM node given as target when a context is requested\n    // #sb-booking-container is defined in booking.edit.component.html\n    $('#sb-composition-container').on('_close', (event, data) => {\n      this.zone.run( () => {\n        console.log('hiding container');\n        this.showSbContainer = false;\n        this.selectedTabIndex = 0;\n      });\n    });\n\n    $('#sb-composition-container').on('_open', (event, data) => {\n      this.zone.run( () => {\n        console.log('showing container');\n        this.showSbContainer = true;\n      });\n    });\n  }\n\n  ngOnInit() {\n    // fetch the booking ID from the route\n    this.route.params.subscribe( async (params) => {\n      if(params && params.hasOwnProperty('id')) {\n        try {\n          this.booking_id = <number> params['id'];\n          const booking = await this.load( Object.getOwnPropertyNames(new Booking()) );  \n          this.booking = new Booking(\n            booking.id,\n            booking.name,\n            booking.composition_id\n          );\n        }\n        catch(error) {\n          console.warn(error);\n        }\n      }\n    });\n  }\n\n  private async load(fields: any[]) {\n    const result = await this.api.read(\"lodging\\\\sale\\\\booking\\\\Booking\", [this.booking_id], fields);\n    if(result && result.length) {\n      return result[0];\n    }\n    return {};\n  }\n\n  /**\n   * Request a new eQ context for selecting a payer, and relay change to self::payerChange(), if an object was created\n   * #sb-booking-container is defined in booking.edit.component.html\n   */\n  public viewFullList() {\n    // \n    this.selectedTabIndex = 1;\n\n    let descriptor = {\n      context: {\n        entity:     'sale\\\\booking\\\\CompositionItem',\n        type:       'list',\n        name:       'default',\n        domain:     ['composition_id', '=', this.booking.composition_id],\n        mode:       'view',\n        purpose:    'view',\n        target:     '#sb-composition-container',\n        callback:   (data:any) => {\n          if(data && data.objects && data.objects.length) {\n            // received data\n          }\n        }\n      }\n    };\n\n    // will trigger #sb-composition-container.on('_open')\n    this.context.change(descriptor);\n  }\n\n\n  \n  \n  public onGenerate() {\n    const dialogRef = this.dialog.open(BookingCompositionDialogConfirm, {\n      width: '50vw',\n      data: {booking: this.booking}\n    });\n\n    dialogRef.afterClosed().subscribe(result => {\n      if(result) {\n        console.log('answer is yes');\n      }\n      else {\n        console.log('answer is no');\n      }\n    });\n  }\n\n}\n\n\n@Component({\n  selector: 'dialog-booking-composition-generate-confirm-dialog',\n  template: `\n  <h1 mat-dialog-title>Générer la composition</h1>\n\n  <div mat-dialog-content>\n    <p>Cet assistant générera une composition sur base de la réservation <b>{{data.booking.name}}</b>.</p>\n    <p>Les détails de la composition existante seront remplacés et les éventuels changements effectués seront perdus.</p>\n    <p><b>Confirmez-vous la (re)génération ?</b></p>\n  </div>\n\n  <div mat-dialog-actions>\n    <button mat-button [mat-dialog-close]=\"false\">Annuler</button>\n    <button mat-button [mat-dialog-close]=\"true\" cdkFocusInitial>Créer</button>\n  </div>\n  `\n})\nexport class BookingCompositionDialogConfirm {\n  constructor(\n    public dialogRef: MatDialogRef<BookingCompositionDialogConfirm>,\n    @Inject(MAT_DIALOG_DATA) public data: BookingCompositionDialogConfirmData\n  ) {}\n}  \n","<div class=\"container\" [ngClass]=\"{'hidden': showSbContainer}\">\r\n  <div class=\"booking-header\">Composition <span> › </span> Réservation {{booking.name}}</div>\r\n  <div class=\"booking-body\">\r\n\r\n    <div style=\"display: flex;\">\r\n      <div style=\"flex: 0 1 20%\"></div> \r\n      <div style=\"margin-left: auto;\">\r\n        <button mat-stroked-button (click)=\"onGenerate()\" color=\"primary\">Générer la composition</button>\r\n      </div>\r\n    </div>      \r\n\r\n    <mat-tab-group [selectedIndex]=\"selectedTabIndex\">\r\n      <mat-tab label=\"Listing par Unité locative\"> \r\n\r\n        <div style=\"margin-top: 20px;\">\r\n\r\n          <mat-spinner *ngIf=\"loading\"></mat-spinner>\r\n\r\n          <booking-composition-lines *ngIf=\"!loading\"\r\n            [composition_id]=\"booking.composition_id\"\r\n          ></booking-composition-lines>  \r\n        </div>\r\n\r\n      </mat-tab>\r\n      \r\n      <mat-tab>\r\n        <ng-template mat-tab-label>\r\n          <span (click)=\"viewFullList()\">Listing complet</span>\r\n        </ng-template>        \r\n      </mat-tab>\r\n      \r\n    </mat-tab-group>\r\n\r\n  </div>\r\n</div>\r\n\r\n<div id=\"sb-composition-container\" class=\"sb-container\"></div>","import { transferArrayItem } from '@angular/cdk/drag-drop';\nimport { Component, ChangeDetectorRef, OnInit, NgZone, Input, SimpleChanges, OnChanges } from '@angular/core';\nimport { MatSnackBar } from '@angular/material/snack-bar';\n\nimport { ApiService, ContextService } from 'sb-shared-lib';\n\nclass Composition {\n  constructor(\n    public id: number = 0,\n    public booking_id: number = 0\n  ){}\n}\n\nclass CompositionItem {\n  constructor(\n    public id: number = 0,\n    public firstname: string = '',\n    public lastname: string = '',\n    public gender: string = '',\n    public date_of_birth: string = '',\n    public place_of_birth: string = '',\n    public email: string = '',\n    public phone: string = '',\n    public address: string = '',\n    public country: string = '',\n    public rental_unit_id: string = ''    \n  ) {}\n}\n\nclass RentalUnit {\n  constructor(\n    public id: number = 0,\n    public name: string = '',\n    public code: string = '',\n    public capacity: number = 0\n  ) {}\n}\n\n@Component({\n  selector: 'booking-composition-lines',\n  templateUrl: './booking.composition.lines.component.html',\n  styleUrls: ['./booking.composition.lines.component.scss']\n})\nexport class BookingCompositionLinesComponent implements OnInit, OnChanges {\n\n  @Input() composition_id: number;\n\n  private composition: Composition = new Composition();\n\n  // map of rental_unit_id mapping related composition items\n  public composition_items: any = {};\n\n  public rental_units: Array<RentalUnit> = [];\n\n  public selection:any = [];\n  public dragging: boolean = false;\n\n  constructor(\n    private api: ApiService, \n    private cd: ChangeDetectorRef, \n    private context:ContextService,\n    private zone: NgZone,\n    private snack:MatSnackBar\n  ) {}\n\n  ngOnInit() {\n\n  }\n\n  async ngOnChanges(changes: SimpleChanges) {\n    if(changes.composition_id) {\n\n      try {\n        const compositions = await this.api.read(\"sale\\\\booking\\\\Composition\", \n          [this.composition_id], \n          Object.getOwnPropertyNames( new Composition() )\n        );\n\n        if(compositions.length) {\n          this.composition = compositions[0];\n\n          {\n            const data = await this.load( Object.getOwnPropertyNames( new CompositionItem() ) );\n\n            for(let item of data) {\n              if(!this.composition_items.hasOwnProperty(item['rental_unit_id'])) {\n                this.composition_items[item['rental_unit_id']] = [];  \n              }\n              this.composition_items[item['rental_unit_id']].push(item);\n            }\n          }\n          console.log(this.composition_items);\n\n          {\n            const data = await this.api.read(\"lodging\\\\realestate\\\\RentalUnit\", \n              Object.keys(this.composition_items),\n              Object.getOwnPropertyNames( new RentalUnit() ) \n            );\n\n            this.rental_units = data;\n          }\n          console.log(this.rental_units);\n        }\n      }\n      catch(error) {\n        console.warn(error);\n        this.snack.open('unknonw error');\n      }\n      \n    }\n  }\n\n  public onToggle(event: any, item: any) {\n    console.log('selecting', event, item);\n    if(!item.hasOwnProperty('selected')) {\n      item.selected = false;  \n    }\n    \n    let rental_unit_id = item.rental_unit_id;\n\n    if(item.selected) {\n      item.selected = false;\n    }\n    else {      \n      // unselect items from other containers\n      for(let r_id of Object.keys(this.composition_items)) {\n        if(r_id != rental_unit_id) {\n          for(let i in this.composition_items[r_id]) {\n            this.composition_items[r_id][i].selected = false;\n          }\n        }\n      }\n      item.selected = true;  \n    }\n    // update current selection\n    this.selection = this.composition_items[rental_unit_id].filter( (item:any) => item.selected );\n\n    console.log(this.selection);\n  }\n\n  public onDragStart(event: any) {\n    this.dragging = true;\n  }\n\n  public onDrop(event: any) {\n    if (event.previousContainer != event.container) {\n      console.log('from', event.previousContainer.data, 'to', event.container.data);\n\n      let current_index = event.currentIndex;\n      let target_rental_unit = event.container.data;\n      let source_rental_unit = event.previousContainer.data;\n\n      for(let item of this.selection) {\n        let previous_index = this.composition_items[source_rental_unit].findIndex( (a:any) => a.id == item.id );\n        // move item\n        transferArrayItem(\n          this.composition_items[source_rental_unit],\n          this.composition_items[target_rental_unit],\n          previous_index,\n          current_index\n        );\n        ++current_index; \n        // update item\n        item.rental_unit_id = target_rental_unit;\n        item.selected = false;      \n      }\n      // reset selection\n      this.selection = [];\n    }\n    this.dragging = false;\n    console.log('dropped', event);\n  }\n\n  public onOpenRentalUnit(rental_unit_id: number) {\n\n    let descriptor = {\n      context: {\n        entity:     'lodging\\\\realestate\\\\RentalUnit',\n        type:       'form',\n        name:       'default',\n        domain:     ['id', '=', rental_unit_id],\n        mode:       'view',\n        purpose:    'view',\n        target:     '#sb-composition-container',\n        callback:   (data:any) => {\n          if(data && data.objects && data.objects.length) {\n            // received data\n          }\n        }\n      }\n    };\n\n    // will trigger #sb-composition-container.on('_open')\n    this.context.change(descriptor);\n  }\n\n  public onOpenCompositionItem(item_id: number) {\n\n    let descriptor = {\n      context: {\n        entity:     'sale\\\\booking\\\\CompositionItem',\n        type:       'form',\n        name:       'default',\n        domain:     ['id', '=', item_id],\n        mode:       'edit',\n        purpose:    'view',\n        target:     '#sb-composition-container',\n        callback:   (data:any) => {\n          if(data && data.objects && data.objects.length) {\n            // received data\n          }\n        }\n      }\n    };\n\n    // will trigger #sb-composition-container.on('_open')\n    this.context.change(descriptor);\n  }\n\n  private async load(fields: any[]) {\n    const result = await this.api.collect(\"sale\\\\booking\\\\CompositionItem\", [\n        'composition_id', '=', this.composition.id\n      ], \n      fields,\n      'id','asc',\n      0, 500\n    );    \n    return result;\n  }\n\n}","<!-- template vars -->\r\n<div #vUnit=\"var\" [var]=\"{items: []}\"></div>\r\n\r\n<table>\r\n\r\n  <thead>\r\n    <tr><th style=\"width: 25%\">Unité locative</th><th colspan=\"2\">occupation</th></tr>\r\n  </thead>\r\n\r\n  <tbody cdkDropListGroup>\r\n\r\n    <tr *ngFor=\"let rental_unit of rental_units; let index = index;\">\r\n      <td>\r\n        <div style=\"display: flex;\">\r\n          <div class=\"cell\" style=\"flex: 0 1 66%;\">{{rental_unit.name}}, {{rental_unit.code}} ({{rental_unit.capacity}})</div>\r\n          <div class=\"cell\" style=\"margin-left: auto;\">\r\n            <button mat-icon-button (click)=\"onOpenRentalUnit(rental_unit.id)\">\r\n              <mat-icon>open_in_new</mat-icon>\r\n            </button>\r\n          </div>  \r\n        </div>\r\n      </td>\r\n      <td style=\"width: 8%; text-align: center;\">\r\n        <div class=\"cell\">{{composition_items[rental_unit.id].length}}</div>\r\n      </td>\r\n\r\n      <td >\r\n        <div  class=\"part\">\r\n\r\n          <div class=\"part-toggle\">\r\n            <button mat-icon-button *ngIf=\"!vUnit.items[index]\" (click)=\"vUnit.items[index] = !vUnit.items[index]\">\r\n              <mat-icon style=\"font-size: 15px;\">keyboard_arrow_right</mat-icon>\r\n            </button>\r\n            <button mat-icon-button *ngIf=\"vUnit.items[index]\" (click)=\"vUnit.items[index] = !vUnit.items[index]\">\r\n              <mat-icon style=\"font-size: 15px;\">keyboard_arrow_up</mat-icon>\r\n            </button>\r\n          </div>\r\n        \r\n          <div class=\"part-container\" \r\n               id=\"{{rental_unit.id}}\"\r\n               cdkDropList\r\n               [cdkDropListData]=\"rental_unit.id\"\r\n               (cdkDropListDropped)=\"onDrop($event)\">\r\n\r\n            <div *ngIf=\"!vUnit.items[index]\">Voir le listing</div> \r\n\r\n            <div *ngIf=\"vUnit.items[index]\" class=\"composition-container\">\r\n              <div class=\"composition-container-header\"> \r\n                <div class=\"composition-container-column header\">#</div>\r\n                <div class=\"composition-container-column header\">Nom</div>\r\n                <div class=\"composition-container-column header\">Prénom</div>\r\n                <div class=\"composition-container-column header\">Genre</div>\r\n                <div class=\"composition-container-column header\"><!-- actions --></div>\r\n              </div>\r\n\r\n              <div cdkDrag \r\n                   class=\"composition-container-item\"\r\n                   *ngFor=\"let item of composition_items[rental_unit.id]; let i = index;\" \r\n                   (click)=\"onToggle($event, item)\"\r\n                   [class.selected]=\"item.selected\"\r\n                   [class.dragging]=\"dragging\"\r\n                   (cdkDragStarted)=\"onDragStart($event)\"\r\n                   [cdkDragDisabled]=\"!item.selected\">\r\n                <div class=\"drag-preview\" *cdkDragPreview>\r\n                  <div class=\"drag-preview-inner\">{{ selection.length > 0 ? selection.length : 1 }}</div>\r\n                </div>\r\n                <div class=\"composition-container-column\">{{i+1}}.</div> \r\n                <div class=\"composition-container-column\">{{item.firstname}}</div>\r\n                <div class=\"composition-container-column\">{{item.lastname}}</div>\r\n                <div class=\"composition-container-column\">{{item.gender}}</div>\r\n                <div class=\"composition-container-column\" style=\"text-align: right;\">\r\n                  <button mat-icon-button (click)=\"onOpenCompositionItem(item.id)\">\r\n                    <mat-icon>open_in_new</mat-icon>\r\n                  </button>\r\n                </div>\r\n              </div>\r\n\r\n            </div>\r\n\r\n          </div>\r\n\r\n        </div>\r\n      </td>\r\n\r\n    </tr>\r\n\r\n  </tbody>\r\n</table>","import { Component, OnInit, AfterViewInit, ChangeDetectorRef, ElementRef, QueryList, ViewChild, ViewChildren, NgZone  } from '@angular/core';\nimport { AuthService, ApiService } from 'sb-shared-lib';\nimport { Router, ActivatedRoute } from '@angular/router';\n\nimport {MatSnackBar} from '@angular/material/snack-bar';\n\nimport { MatDialog, MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\n\nimport { Observable, BehaviorSubject, ReplaySubject } from 'rxjs';\nimport { find, map, startWith, debounceTime, switchMap } from 'rxjs/operators';\n\n\n/*\nThis is a SmartComponent.\n\nSub-components are in charge of:\n * loading sub-objects required for displaying the values related to the current booking.\n * creating sub-objects when required\n * send data update notifications to this component \n\nSmart components are in charge of updating the model.\n\n*/\n\nclass Booking {\n  constructor(\n    public id: number = 0,\n    public name: string = '',\n    public created: Date = new Date(),\n    public price: number = 0,\n    public customer_id: number = 0,\n    public has_payer_organisation: boolean = false,\n    public payer_organisation_id: number = 0,\n    public center_id: number = 0, \n    public type_id = 0,\n    public description: string = '',\n    public contacts_ids: Array<number> = [],\n    public booking_lines_groups_ids: Array<number> = []\n  ) {}\n}\n\n\n@Component({\n  selector: 'booking-edit',\n  templateUrl: 'booking.edit.component.html',\n  styleUrls: ['booking.edit.component.scss']\n})\nexport class BookingEditComponent implements OnInit, AfterViewInit  {\n\n  public booking: any;\n  public id: number;\n\n  public _bookingInput:  ReplaySubject<any> = new ReplaySubject(1);\n  public _bookingOutput: ReplaySubject<any> = new ReplaySubject(1);\n\n  public showSbContainer: boolean = false;\n\n  constructor(\n              private auth: AuthService,\n              private api: ApiService,\n              private router: Router,\n              private dialog: MatDialog,\n              private route: ActivatedRoute,\n              private snack: MatSnackBar,\n              private zone: NgZone\n              ) {\n  }\n\n\n\n  /**\n   * Set up callbacks when component DOM is ready.\n   */\n  public ngAfterViewInit() {\n    // _open and _close event are relayed by eqListener on the DOM node given as target when a context is requested\n    // #sb-booking-container is defined in booking.edit.component.html\n    $('#sb-booking-container').on('_close', (event, data) => {\n      this.zone.run( () => {\n        this.showSbContainer = false;\n      });\n    });\n    $('#sb-booking-container').on('_open', (event, data) => {\n      this.zone.run( () => {\n        this.showSbContainer = true;\n      });\n    });\n  }\n\n  public ngOnInit() {\n\n    // listen to changes relayed by children component on the _bookingInput observable\n    this._bookingInput.subscribe(params => this.update(params));\n\n    // fetch the booking ID from the route\n    this.route.params.subscribe( async (params) => {\n      if(params && params.hasOwnProperty('id')) {        \n        this.id = <number> params['id'];\n        try {\n          // load booking object\n          let data = await this.load( Object.getOwnPropertyNames(new Booking()) );\n\n          this.booking = new Booking( \n            data.id,\n            data.name,\n            new Date(data.created),\n            data.price,\n            data.customer_id,\n            data.has_payer_organisation,\n            data.payer_organisation_id,\n            data.center_id, \n            data.type_id,\n            data.description,\n            <Array<number>> data.contacts_ids,\n            <Array<number>> data.booking_lines_groups_ids\n          );\n\n          // relay to children\n          this._bookingOutput.next(this.booking);\n        }\n        catch(response) {\n          console.warn(response);\n        }\n      }\n    });\n\n  }\n\n  /**\n   * Assign values based on selected booking and load sub-objects required by the view.\n   * \n   */\n  private async load(fields:any) {\n    const result = await this.api.read(\"lodging\\\\sale\\\\booking\\\\Booking\", [this.id], fields);\n    if(result && result.length) {\n      return result[0];\n    }\n    return {};\n  }\n\n  /**\n   * Handler for updates relayed from children components\n   */\n  private async update(booking:any) {\n    console.log('BookingEditComponent: received change', booking, this.booking);\n    try {\n\n      // handle requests for updating single fields\n      if(booking.hasOwnProperty('refresh')) {\n        // some changes have been done that might impact current object\n        // refresh property specifies which fields have to be re-loaded\n        let model_fields = Object.getOwnPropertyNames( new Booking() );\n        if(Array.isArray(booking.refresh)) {\n          model_fields = booking.refresh;\n        }\n\n        let data = await this.load(model_fields);\n\n        this.booking = new Booking( \n          data.id,\n          data.name,\n          new Date(data.created),\n          data.price,\n          data.customer_id,\n          data.has_payer_organisation,\n          data.payer_organisation_id,\n          data.center_id, \n          data.type_id,\n          data.description,\n          data.contacts_ids,\n          data.booking_lines_groups_ids\n        );\n\n        // notify children\n        this._bookingOutput.next(data);\n        return;\n      }\n\n      // handle request for updating single fields (reload)\n\n      let has_change = false;\n\n      if(booking.hasOwnProperty('customer_id') && booking.customer_id != this.booking.customer_id) {\n        await this.updateCustomer(booking.customer_id);\n        has_change = true;\n      }\n\n      if( (booking.hasOwnProperty('payer_organisation_id') && booking.payer_organisation_id != this.booking.payer_organisation_id)\n          || (booking.hasOwnProperty('has_payer_organisation') && booking.has_payer_organisation != this.booking.has_payer_organisation) ) {\n        await this.updatePayer(booking.payer_organisation_id);\n        has_change = true;\n      }\n\n      if(booking.hasOwnProperty('center_id') && booking.center_id != this.booking.center_id) {\n        await this.updateCenter(booking.center_id);\n        has_change = true;\n      }\n\n      if(booking.hasOwnProperty('type_id') && booking.type_id != this.booking.type_id) {\n        await this.updateType(booking.type_id);\n        has_change = true;\n      }\n\n      if(booking.hasOwnProperty('description') && booking.description != this.booking.description) {\n        await this.updateDescription(booking.description);\n        has_change = true;\n      }\n\n      if(booking.hasOwnProperty('contacts_ids') && booking.contacts_ids.length != this.booking.contacts_ids.length ) {\n        this.booking.contacts_ids = booking.contacts_ids;\n        has_change = true;\n      }\n\n      if(booking.hasOwnProperty('booking_lines_groups_ids') && booking.booking_lines_groups_ids.length != this.booking.booking_lines_groups_ids.length ) {\n        this.booking.booking_lines_groups_ids = booking.booking_lines_groups_ids;\n        has_change = true;\n      }\n\n\n      if(has_change) {\n        // reload booking\n        let data = await this.load( Object.getOwnPropertyNames( new Booking() ));\n        // update local object\n        for(let field of Object.keys(data)) {\n          this.booking[field] = data[field];\n        }\n        // relay changes to children components\n        this._bookingOutput.next(this.booking);\n        // notify User\n        this.snack.open(\"Réservation mise à jour\");\n      }\n    }\n    catch(response:any) {\n      console.warn('some changes could not be stored', response);\n      let error:string = 'unknonw';\n      if(response && response.hasOwnProperty('error') && response['error'].hasOwnProperty('errors')) {\n        let errors = response['error']['errors'];\n\n        if(errors.hasOwnProperty('INVALID_PARAM')) {\n          error = 'invalid_param';\n        }\n        else if(errors.hasOwnProperty('NOT_ALLOWED')) {\n          error = 'not_allowed';\n        }\n        else if(errors.hasOwnProperty('CONFLICT_OBJECT')) {            \n          error = 'conflict_object';\n        }\n      }\n\n      switch(error) {\n        case 'not_allowed':\n          this.snack.open(\"Erreur - Vous n'avez pas les autorisations pour cette opération.\");\n          break;\n        case 'conflict_object':\n          this.snack.open(\"Erreur - Cette réservation a été modifiée par un autre utilisateur.\");\n          break;  \n        case 'unknonw':\n        case 'invalid_param':\n        default:\n          this.snack.open(\"Erreur - certains changements n'ont pas pu être enregistrés.\");\n      }\n    }\n  }\n\n  private async updateCustomer(customer_id:number) {\n    console.log('BookingEditComponent::updateCustomer', customer_id);\n    await this.api.update(\"lodging\\\\sale\\\\booking\\\\Booking\", [this.id], <any>{\"customer_id\": customer_id});\n  }\n\n  private async updateDescription(description:string) {\n    console.log('BookingEditComponent::updateDescription', description);\n    await this.api.update(\"lodging\\\\sale\\\\booking\\\\Booking\", [this.id], <any>{\"description\": description});\n  }\n  \n  private async updatePayer(payer_organisation_id:number) {\n    console.log('BookingEditComponent::updatePayer', payer_organisation_id);\n    let values:any = {};\n\n    if(payer_organisation_id <= 0) {\n      values.has_payer_organisation = false;\n      values.payer_organisation_id = 0;\n    }\n    else {\n      values.has_payer_organisation = true;\n      values.payer_organisation_id = payer_organisation_id;\n    }\n\n    await this.api.update(\"lodging\\\\sale\\\\booking\\\\Booking\", [this.id], values);\n  }\n\n\n  private async updateCenter(center_id:number) {\n    console.log('BookingEditComponent::updateCenter', center_id);\n    await this.api.update(\"lodging\\\\sale\\\\booking\\\\Booking\", [this.id], <any>{\"center_id\": center_id});\n  }\n\n  private async updateType(type_id:number) {\n    console.log('BookingEditComponent::updateType', type_id);\n    await this.api.update(\"lodging\\\\sale\\\\booking\\\\Booking\", [this.id], <any>{\"type_id\": type_id});\n  }\n\n\n}","<div class=\"container\" [class.hidden]=\"showSbContainer\">\r\n    <div class=\"booking-header\">Nouvelle réservation</div>\r\n    <div class=\"booking-body\">\r\n\r\n        <mat-horizontal-stepper linear #stepper>\r\n            <!-- step customer -->\r\n            <mat-step>\r\n                <ng-template matStepLabel>Client</ng-template>\r\n                <div class=\"step-container\">\r\n                    <booking-edit-customer [bookingInput]=\"_bookingOutput\" [bookingOutput]=\"_bookingInput\"></booking-edit-customer>\r\n                </div>\r\n            </mat-step>\r\n\r\n            <!-- step sojourn -->\r\n            <mat-step>\r\n                <ng-template matStepLabel>Séjour</ng-template>\r\n                <div class=\"step-container\" >\r\n                    <booking-edit-sojourn [bookingInput]=\"_bookingOutput\" [bookingOutput]=\"_bookingInput\"></booking-edit-sojourn>\r\n                </div>\r\n            </mat-step>\r\n\r\n            <!-- step booking -->\r\n            <mat-step>\r\n                <ng-template matStepLabel>Réservations</ng-template>\r\n                <div class=\"step-container\" >\r\n                    <booking-edit-bookings [bookingInput]=\"_bookingOutput\" [bookingOutput]=\"_bookingInput\"></booking-edit-bookings>\r\n                </div>\r\n            </mat-step>\r\n        </mat-horizontal-stepper>\r\n    </div>\r\n</div>\r\n\r\n<div id=\"sb-booking-container\" class=\"sb-container\"></div>","import { Component, Inject, OnInit, OnChanges, NgZone, Output, Input, EventEmitter, SimpleChanges } from '@angular/core';\nimport { AuthService, ApiService, ContextService } from 'sb-shared-lib';\n\nimport { Observable, ReplaySubject, BehaviorSubject, async } from 'rxjs';\n\nimport {MatSnackBar} from '@angular/material/snack-bar';\n\nimport { find, map, mergeMap, startWith, debounceTime } from 'rxjs/operators';\n\nimport { CdkDragDrop, moveItemInArray } from '@angular/cdk/drag-drop';\n\n/*\nThis is a SmartComponent.\n\nSub-components are in charge of:\n * loading sub-objects required for displaying the values related to the current booking.\n * creating sub-objects when required\n * send data update notifications to this component\n\nSmart components are in charge of updating the model.\n\n*/\n\ninterface vmModel {\n  price: {\n      value:        number\n  },  \n  groups: {\n    add:            () => void,\n    remove:         (group:any) => void,\n    drop:           (event:CdkDragDrop<any>) => void\n  }\n}\n\n@Component({\n  selector: 'booking-edit-bookings',\n  templateUrl: 'booking.edit.bookings.component.html',\n  styleUrls: ['booking.edit.bookings.component.scss']\n})\nexport class BookingEditBookingsComponent implements OnInit  {\n\n  @Input() bookingInput:  ReplaySubject<any>;\n  @Input() bookingOutput: ReplaySubject<any>;\n\n  // observable for updates from children components\n  public _groupInput:  ReplaySubject<any> = new ReplaySubject(1);\n  // array of observable for children components\n  public _groupOutput: Array<ReplaySubject<any>> = [];\n\n\n  private model_fields = {\n    BookingLineGroup: [\"id\", \"booking_id\", \"name\", \"order\", \"has_pack\", \"pack_id\", \"price\",\n                      \"is_locked\", \"date_from\", \"date_to\",\n                      \"sojourn_type\", \"nb_pers\", \"rate_class_id\",\n                      \"booking_lines_ids\", \"accomodations_ids\"]\n  };\n\n\n  // reference to parent's booking object for sub-object creation\n  public booking:any;\n  private center: any;\n\n  public groups: Array<any>;\n\n\n  public vm: vmModel;\n\n  constructor(\n              private api: ApiService,\n              private auth: AuthService,\n              private zone: NgZone,\n              private snack: MatSnackBar\n              ) {\n\n    this.booking = {};\n    this.center = null;\n\n    this.groups = [];\n\n\n    this.vm = {\n      price: {\n        value:          0.0\n      },\n      groups: {\n        add:            () => this.groupAdd(),\n        remove:         (group:any) => this.groupRemove(group),\n        drop:           (event:CdkDragDrop<any>) => this.groupDrop(event)\n      }\n    };\n\n  }\n\n  public ngOnInit() {\n\n    // listen to the parent for changes on booking object\n    this.bookingInput.subscribe( async (booking: any) => this.load(booking) );\n\n    // listen to changes relayed by children component on the _bookingInput observable\n    this._groupInput.subscribe(params => this.updateFromGroup(params));\n\n  }\n\n  /**\n   * Load subitem of current booking object.\n   * \n   * @param booking \n   */\n  private async load(booking:any) {\n    this.zone.run( async () => {\n      try {\n        console.log(\"BookingEditBookingsComponent: received changes from parent\", booking);\n\n        // update local booking object\n        for(let field of Object.keys(booking)) {\n          this.booking[field] = booking[field];\n        }\n\n        if(booking.hasOwnProperty('price')) {\n          this.vm.price.value = booking.price;\n        }\n\n        if(booking.booking_lines_groups_ids && booking.booking_lines_groups_ids.length) {\n\n          let data:any = await this.loadGroups(booking.booking_lines_groups_ids, this.model_fields['BookingLineGroup']);\n          if(data) {\n            for(let [index, group] of data.entries()) {\n              // add new lines (indexes from this.lines and this._lineOutput are synced)\n              if(index >= this.groups.length) {\n                let item = new ReplaySubject(1);\n                this._groupOutput.push(item);\n                item.next(group);\n                this.groups.push(group);\n              }\n              // if lines differ, overwrite previsously assigned line\n              else if(JSON.stringify(this.groups[index]) != JSON.stringify(group) ) {\n                let item = new ReplaySubject(1);\n                this._groupOutput[index] = item;\n                this.groups[index] = group;\n                item.next(group);\n              }\n\n            }\n            // remove remaining lines, if any\n            if(this.groups.length > data.length) {\n              this.groups.splice(data.length);\n              this._groupOutput.splice(data.length);\n            }\n          }\n        }\n\n        if(booking.center_id) {\n          let data:any = await this.api.read(\"lodging\\\\identity\\\\Center\", [booking.center_id], [\"id\", \"name\", \"code\", \"organisation_id\"]);\n          if(data && data.length) {\n            this.center = data[0];\n          }\n        }\n\n      }\n      catch(response) {console.warn(response);}\n    });\n  }\n\n  private async loadGroups(ids:Array<any>, fields: any) {\n    let data:any = await this.api.read(\"lodging\\\\sale\\\\booking\\\\BookingLineGroup\",\n                                      ids,\n                                      fields,\n                                      'order'\n                                      );\n    return data;\n  }\n\n  private async groupAdd() {\n    console.log(\"group add\");\n\n    try {\n      const group = await this.api.create(\"lodging\\\\sale\\\\booking\\\\BookingLineGroup\", {\n        name: \"Séjour \" + this.center.name,\n        order: this.groups.length + 1,\n        booking_id: this.booking.id,\n        rate_class_id: 4                // default to 'general public'\n      });\n\n      let data = await this.loadGroups([group.id], this.model_fields['BookingLineGroup']);\n\n      let item = new ReplaySubject(1);\n      this._groupOutput.push(item);\n      this.groups.push(data[0]);\n      item.next(data[0]);\n      // emit change to parent\n      //this.bookingOutput.next({booking_lines_groups_ids: groups_ids});\n    }\n    catch(error) {\n      console.log(error);\n    }\n  }\n\n  private async groupRemove(group:any) {\n    try {\n      const response = await this.api.remove(\"lodging\\\\sale\\\\booking\\\\BookingLineGroup\", [group.id], true);\n      let index = this.groups.findIndex( (element) => element.id == group.id);\n      this.groups.splice(index, 1);\n      this._groupOutput.splice(index, 1);\n    }\n    catch(response) {\n      console.warn(response);\n    }\n  }\n\n  private groupDrop(event:CdkDragDrop<any>) {\n    console.log(event.previousIndex, event.currentIndex);\n    // adapt this.groups and this._groupOutput\n    moveItemInArray(this.groups, event.previousIndex, event.currentIndex);\n    moveItemInArray(this._groupOutput, event.previousIndex, event.currentIndex);\n\n    // adapt new values for 'order' field\n    for(let index in this.groups) {\n      let item = this.groups[index];\n      this.updateFromGroup({id: item.id, order: parseInt(index) + 1});\n    }\n\n\n  }\n\n  private async updateFromGroup(group: any) {\n    console.log(\"BookingEditBookingsComponent: received changes from child\", group);\n\n    try {\n      let index = this.groups.findIndex( (element) => element.id == group.id);\n      let t_group = this.groups.find( (element) => element.id == group.id);\n\n      // handle single fields updates\n\n      let has_change = false;\n      let refresh_requests:any = [];\n\n      if(group.hasOwnProperty('name') && group.name != t_group.name) {\n        await this.updateName(group);\n        has_change = true;\n      }\n\n      if(group.hasOwnProperty('pack_id') && group.pack_id != t_group.pack_id) {\n        await this.updatePack(group);\n        // we need to reload booking price\n        refresh_requests.push('price');\n        has_change = true;\n      }\n\n      if(group.hasOwnProperty('rate_class_id') && group.rate_class_id != t_group.rate_class_id) {\n        await this.updateRateClass(group);\n        has_change = true;\n      }\n\n      if(group.hasOwnProperty('is_locked') && group.is_locked != t_group.is_locked) {\n        await this.updateIsLocked(group);\n        // we need to reload booking price\n        refresh_requests.push('price');\n        has_change = true;\n      }\n\n      if(group.hasOwnProperty('has_pack') && group.has_pack != t_group.has_pack) {\n        await this.updateHasPack(group);\n        has_change = true;\n      }\n\n      if( (group.hasOwnProperty('date_from') && group.date_from != t_group.date_from)\n      || (group.hasOwnProperty('date_to') && group.date_to != t_group.date_to) ) {\n        await this.updateDate(group);\n        has_change = true;\n      }\n\n      if(group.hasOwnProperty('nb_pers') && group.nb_pers != t_group.nb_pers) {\n        await this.updateNbPers(group);\n        has_change = true;\n      }\n\n      if(group.hasOwnProperty('order') && group.order != t_group.order) {\n        await this.updateOrder(group);\n        has_change = true;\n      }\n\n      if(group.hasOwnProperty('booking_lines_ids')) {\n        let diff = group.booking_lines_ids.filter( (lid:any) => t_group.booking_lines_ids.indexOf(lid) === -1);\n        if(diff.length) {\n          await this.updateBookingLinesIds(group);\n          has_change = true;\n        }\n      }\n\n      // handle explicit requests for updating single fields (reload partial object)\n      if(group.hasOwnProperty('refresh')) {\n        // some changes have been done that might impact current object\n        // refresh property specifies which fields have to be re-loaded\n        let model_fields = this.model_fields['BookingLineGroup'];\n\n        if(group.refresh.hasOwnProperty('self')) {\n          if(Array.isArray(group.refresh.self)) {\n            model_fields = group.refresh.self;\n          }          \n          // reload object from server\n          let data = await this.loadGroups([group.id], model_fields);\n          this._groupOutput[index].next(data[0]);\n        }\n\n        // handle requests to relay to parent\n        if(group.refresh.hasOwnProperty('booking_id')) {\n          // group.refresh.booking_id is an array of fields from sale\\booking\\Booking to be updated\n          refresh_requests = [...refresh_requests, ...group.refresh.booking_id];\n        }\n\n      }\n      // reload whole object from server\n      else if(has_change) {\n        \n        let data = await this.loadGroups([group.id], this.model_fields['BookingLineGroup']);\n        let object = data[0];\n        for(let field of Object.keys(object)) {\n          this.groups[index][field] = object[field];\n        }\n        // relay changes to children components\n        this._groupOutput[index].next(this.groups[index]);\n        // notify User\n        this.snack.open(\"Regroupement mis à jour\");\n      }\n\n      // relay refresh request to parent, if any\n      if(refresh_requests.length) {\n        this.bookingOutput.next({id: this.booking.id, refresh: refresh_requests});\n      }\n\n    }\n    catch(response:any) {\n      console.warn('some changes could not be stored', response);\n      let error:string = 'unknonw';\n      if(response && response.hasOwnProperty('error') && response['error'].hasOwnProperty('errors')) {\n        let errors = response['error']['errors'];\n\n        if(errors.hasOwnProperty('INVALID_PARAM')) {\n          error = 'invalid_param';\n        }\n        else if(errors.hasOwnProperty('NOT_ALLOWED')) {\n          error = 'not_allowed';\n        }\n        else if(errors.hasOwnProperty('CONFLICT_OBJECT')) {            \n          error = 'conflict_object';\n        }\n      }\n\n      switch(error) {\n        case 'not_allowed':\n          this.snack.open(\"Erreur - Vous n'avez pas les autorisations pour cette opération.\");\n          break;\n        case 'conflict_object':\n          this.snack.open(\"Erreur - Cette réservation a été modifiée par un autre utilisateur.\");\n          break;  \n        case 'unknonw':\n        case 'invalid_param':\n        default:\n          this.snack.open(\"Erreur - certains changements n'ont pas pu être enregistrés.\");\n      }\n      \n    }\n  };\n\n\n\n\n  private async updateName(group:any) {\n    console.log('BookingEditBookingsComponent::updateName', group);\n    await this.api.update(\"lodging\\\\sale\\\\booking\\\\BookingLineGroup\", [group.id], <any>{\"name\": group.name});\n  }\n\n  private async updatePack(group:any) {\n    console.log('BookingEditBookingsComponent::updatePack', group);\n    await this.api.update(\"lodging\\\\sale\\\\booking\\\\BookingLineGroup\", [group.id], <any>{\"pack_id\": group.pack_id});\n  }\n\n  private async updateRateClass(group:any) {\n    console.log('BookingEditBookingsComponent::updateRateClass', group);\n    await this.api.update(\"lodging\\\\sale\\\\booking\\\\BookingLineGroup\", [group.id], <any>{\"rate_class_id\": group.rate_class_id});\n  }\n\n  private async updateHasPack(group:any) {\n    console.log('BookingEditBookingsComponent::updateHasPack', group);\n    await this.api.update(\"lodging\\\\sale\\\\booking\\\\BookingLineGroup\", [group.id], <any>{\"has_pack\": group.has_pack});\n  }\n\n  private async updateNbPers(group:any) {\n    console.log('BookingEditBookingsComponent::updateNbPers', group);\n    await this.api.update(\"lodging\\\\sale\\\\booking\\\\BookingLineGroup\", [group.id], <any>{\"nb_pers\": group.nb_pers});\n  }\n\n  private async updateOrder(group:any) {\n    console.log('BookingEditBookingsComponent::updateOrder', group);\n    await this.api.update(\"lodging\\\\sale\\\\booking\\\\BookingLineGroup\", [group.id], <any>{\"order\": group.order});\n  }\n\n  private async updateIsLocked(group:any) {\n    console.log('BookingEditBookingsComponent::updateIsLocked', group);\n    await this.api.update(\"lodging\\\\sale\\\\booking\\\\BookingLineGroup\", [group.id], <any>{\"is_locked\": group.is_locked});\n  }\n\n  private async updateDate(group:any) {\n    console.log('BookingEditBookingsComponent::updateDate', group);\n    if(group.date_from && group.date_to) {\n      await this.api.update(\"lodging\\\\sale\\\\booking\\\\BookingLineGroup\", [group.id], <any>{\"date_from\": group.date_from, \"date_to\": group.date_to});\n    }\n    else if(group.date_from) {\n      await this.api.update(\"lodging\\\\sale\\\\booking\\\\BookingLineGroup\", [group.id], <any>{\"date_from\": group.date_from});\n    }    \n    else {\n      await this.api.update(\"lodging\\\\sale\\\\booking\\\\BookingLineGroup\", [group.id], <any>{\"date_to\": group.date_to});\n    }\n  }\n\n  private async updateBookingLinesIds(group:any) {\n    await this.api.update(\"lodging\\\\sale\\\\booking\\\\BookingLineGroup\", [group.id], <any>{\"booking_lines_ids\": group.booking_lines_ids});\n  }\n\n}","<div class=\"container\">\r\n\r\n  <div class=\"outer-wrapper\" style=\"width: 100%\">\r\n    <div class=\"header\" style=\"display: flex; width: 100%;\">\r\n      <div style=\"flex: 1;\">Ajouter un séjour <button mat-mini-fab color=\"primary\" style=\"transform: scale(0.65);\" (click)=\"vm.groups.add()\"> <mat-icon>add</mat-icon></button></div>\r\n      <div style=\"margin-left: auto; font-size: 20px;\">Total TTC {{vm.price.value | number: '1.2-2'}} €</div>\r\n    </div>    \r\n    <div class=\"inner-wrapper\" *ngIf=\"groups.length\">\r\n      <div class=\"groups-list\" cdkDropList (cdkDropListDropped)=\"vm.groups.drop($event)\">\r\n        <!-- groups -->\r\n        <div class=\"group-item\" cdkDrag [cdkDragData]=\"group\" *ngFor=\"let group of groups; let index = index;\" >\r\n          <div class=\"group-handle\" cdkDragHandle ><mat-icon style=\"font-size: 16px;\">drag_indicator</mat-icon></div>\r\n          <div class=\"group-remove\"><button mat-icon-button (click)=\"vm.groups.remove(group)\"> <mat-icon>delete</mat-icon></button></div>\r\n          <booking-edit-bookings-group [bookingInput]=\"booking\" [groupInput]=\"_groupOutput[index]\" [groupOutput]=\"_groupInput\"></booking-edit-bookings-group>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n\r\n</div>","import { Component, Inject, OnInit, OnChanges, NgZone, Output, Input, EventEmitter, SimpleChanges } from '@angular/core';\nimport { AuthService, ApiService, ContextService } from 'sb-shared-lib';\n\nimport { MatDialog, MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { MatAutocompleteSelectedEvent } from '@angular/material/autocomplete';\n\nimport {MatSnackBar} from '@angular/material/snack-bar';\n\nimport { Observable, ReplaySubject, BehaviorSubject } from 'rxjs';\n\nimport { find, map, mergeMap, startWith, debounceTime } from 'rxjs/operators';\n\n\ninterface vmModel {\n  rental_unit: {\n    name:           string\n    inputClue:      ReplaySubject<any>,\n    filteredList:   Observable<any>,\n    inputChange:    (event:any) => void,\n    change:         (event:any) => void,\n    focus:          () => void,\n    restore:        () => void,\n    reset:          () => void,\n    display:        (type:any) => string\n  },\n  product: {\n    id:             number,\n    name:           string\n  }\n}\n\n@Component({\n  selector: 'booking-edit-bookings-group-accomodation',\n  templateUrl: 'booking.edit.bookings.group.accomodation.component.html',\n  styleUrls: ['booking.edit.bookings.group.accomodation.component.scss']\n})\nexport class BookingEditBookingsGroupAccomodationComponent implements OnInit  {\n\n  // read-only parent group\n  @Input() groupInput: any;\n\n  @Input() accomodationOutput: ReplaySubject<any>;\n  @Input() accomodationInput:  ReplaySubject<any>;\n\n\n  \n  // current accomodation (consumption)\n  public accomodation: any;\n\n  // sub-objects (not present in group)\n  public product:any;\n  public rental_unit:any;\n\n  public ready: boolean = false;\n\n  public vm: vmModel;\n\n  constructor(\n              private api: ApiService,\n              private auth: AuthService,\n              private zone: NgZone,\n              private snack: MatSnackBar\n              ) {\n\n    this.accomodation = {};\n    this.product = null;\n    this.rental_unit = null;\n\n\n    this.vm = {\n      rental_unit: {\n        name:           '',\n        inputClue:      new ReplaySubject(1),\n        filteredList:   new Observable(),\n        change:         (event:any) => this.rentalUnitChange(event),\n        inputChange:    (event:any) => this.rentalUnitInputChange(event),\n        focus:          () => this.rentalUnitFocus(),\n        restore:        () => this.rentalUnitRestore(),\n        reset:          () => this.rentalUnitReset(),\n        display:        (type:any) => this.rentalUnitDisplay(type)\n      },\n      product: {\n        id:             0,\n        name:           ''\n      }      \n    };\n\n  }\n\n\n  public ngOnInit() {\n\n    this.accomodationInput.subscribe( (line: any) => this.load(line) );\n\n    /**\n     * listen to the changes on FormControl objects\n     */\n    this.vm.rental_unit.filteredList = this.vm.rental_unit.inputClue.pipe(\n      debounceTime(300),\n      map( (value:any) => (typeof value === 'string' ? value : (value == null)?'':value.name) ),\n      mergeMap( async (name:string) => this.filterRentalUnits(name) )\n    );\n\n  }\n\n  /**\n   * Assign values from parent and load sub-objects required by the view.\n   * \n   * @param accomodation \n   */\n  private async load(accomodation:any) {\n    this.zone.run( () => {\n      this.ready = false;\n    });    \n    \n    this.zone.run( async () => {\n      try {\n\n        // update local group object\n        for(let field of Object.keys(accomodation)) {\n          this.accomodation[field] = accomodation[field];\n        }\n\n        if(accomodation.product_id) {\n          let data:any = await this.api.read(\"lodging\\\\sale\\\\catalog\\\\Product\", [accomodation.product_id], [\"id\", \"name\", \"sku\"]);\n          if(data && data.length) {\n            let product = data[0];\n            this.product = product;\n            this.vm.product.name = product.name + ' ('+ product.sku +')';\n          }  \n        }\n\n        if(accomodation.rental_unit_id) {\n          let data:any = await this.api.read(\"lodging\\\\realestate\\\\RentalUnit\", [accomodation.rental_unit_id], [\"id\", \"name\", \"capacity\"]);\n          if(data && data.length) {\n            let rental_unit = data[0];\n            this.rental_unit = rental_unit;\n            this.vm.rental_unit.name = rental_unit.name + ' ('+ rental_unit.capacity +')';\n          }  \n        }\n\n        \n\n      }\n      catch(response) {console.warn(response);}\n      this.ready = true;\n    });\n  }\n\n\n\n  private rentalUnitInputChange(event:any) {\n    this.vm.rental_unit.inputClue.next(event.target.value);\n  }\n\n  private rentalUnitFocus() {\n    this.vm.rental_unit.inputClue.next(\"\");\n  }\n\n  private rentalUnitDisplay(rental_unit:any): string {\n    return rental_unit ? rental_unit.name + ' ('+ rental_unit.capacity +')': '';\n  }\n\n  private rentalUnitReset() {\n    setTimeout( () => {\n      this.vm.rental_unit.name = '';\n    }, 100);\n  }\n\n  private rentalUnitRestore() {\n    if(this.rental_unit) {\n      this.vm.rental_unit.name = this.rental_unit.name + ' ('+ this.rental_unit.capacity +')';\n    }\n    else {\n      this.vm.rental_unit.name = '';\n    }\n  }\n\n\n  private rentalUnitChange(event:any) {\n    console.log('BookingEditCustomerComponent::rentalUnitChange', event)\n\n    // from mat-autocomplete\n    if(event && event.option && event.option.value) {\n      let rental_unit = event.option.value;\n      this.rental_unit = rental_unit;\n      this.vm.rental_unit.name = rental_unit.name + ' ('+ rental_unit.capacity +')';\n      // relay change to parent component\n      this.accomodationOutput.next({id: this.accomodation.id, rental_unit_id: rental_unit.id});\n    }\n  }\n\n  private async filterRentalUnits(name: string) {\n    let filtered:any[] = [];\n    try {\n      let data:any[] = await this.api.collect(\"lodging\\\\realestate\\\\RentalUnit\", [[\"name\", \"ilike\", '%'+name+'%']], [\"id\", \"name\", \"capacity\"], 'name', 'asc', 0, 25);\n      filtered = data;\n    }\n    catch(response) {\n      console.log(response);\n    }\n    return filtered;\n  }  \n\n}","\r\n\r\n<!-- rental_unit -->\r\n<div class=\"cell\">\r\n  <mat-form-field>\r\n    <mat-label>Unité locative</mat-label>\r\n    <input  matInput\r\n            type=\"text\"\r\n            [matAutocomplete]=\"rentalUnitAutocomplete\"\r\n            [value]=\"vm.rental_unit.name\"\r\n            (keyup)=\"vm.rental_unit.inputChange($event)\"\r\n            (focus)=\"vm.rental_unit.focus()\"\r\n            (blur)=\"vm.rental_unit.restore()\"\r\n            placeholder=\"Commencez à taper le nom\" />\r\n\r\n    <mat-hint [align]=\"'end'\">Logement assigné à {{vm.product.name }}</mat-hint>          \r\n\r\n    <button mat-button *ngIf=\"vm.rental_unit.name.length\" matSuffix mat-icon-button aria-label=\"Clear\" (click)=\"vm.rental_unit.reset()\">\r\n      <mat-icon>close</mat-icon>\r\n    </button>\r\n\r\n    <mat-autocomplete #rentalUnitAutocomplete=\"matAutocomplete\" [displayWith]=\"vm.rental_unit.display\" (optionSelected)=\"vm.rental_unit.change($event)\">\r\n      <div  *ngIf=\"vm.rental_unit.filteredList | async; let list\">\r\n        <mat-option *ngFor=\"let rental_unit of list\" [value]=\"rental_unit\">\r\n          {{rental_unit.name}} ({{rental_unit.capacity}})\r\n        </mat-option>\r\n        <mat-option *ngIf=\"list.length == 0\"><i>pas de résultat</i></mat-option>\r\n      </div>\r\n    </mat-autocomplete>                  \r\n\r\n  </mat-form-field>\r\n</div>\r\n\r\n\r\n\r\n","import { Component, Inject, OnInit, OnChanges, NgZone, Output, Input, EventEmitter, SimpleChanges } from '@angular/core';\nimport { AuthService, ApiService, ContextService } from 'sb-shared-lib';\n\nimport { FormControl, Validators } from '@angular/forms';\nimport { MatDialog, MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\n\nimport {MatSnackBar} from '@angular/material/snack-bar';\n\nimport { Observable, ReplaySubject, BehaviorSubject } from 'rxjs';\n\nimport { find, map, mergeMap, startWith, debounceTime } from 'rxjs/operators';\n\n\ninterface vmModel {\n  value: {\n    value:          number,\n    formControl:    FormControl,\n    change:         (event:any) => void\n  },\n  type: {\n    value:          string,\n    formControl:    FormControl,\n    change:         (event:any) => void\n  }\n}\n\n@Component({\n  selector: 'booking-edit-bookings-group-line-discount',\n  templateUrl: 'booking.edit.bookings.group.line.discount.component.html',\n  styleUrls: ['booking.edit.bookings.group.line.discount.component.scss']\n})\nexport class BookingEditBookingsGroupLineDiscountComponent implements OnInit  {\n\n  // read-only parent line\n  @Input() lineInput: any;\n\n  @Input() lineOutput: ReplaySubject<any>;\n  @Input() discountInput: ReplaySubject<any>;\n  @Input() discountOutput: ReplaySubject<any>;\n\n  // current discount\n  private discount: any;\n\n  public ready: boolean = false;\n\n  public vm: vmModel;\n\n  constructor(\n              private api: ApiService,\n              private auth: AuthService,\n              private dialog: MatDialog,\n              private zone: NgZone,\n              private snack: MatSnackBar\n              ) {\n\n    this.discount = {};\n\n\n    this.vm = {\n      value: {\n        value:          0.0,\n        formControl:    new FormControl('', Validators.required),\n        change:         (event:any) => this.valueChange(event)\n      },\n      type: {\n        value:          '',\n        formControl:    new FormControl('', Validators.required),\n        change:         (event:any) => this.typeChange(event)\n      }\n    };\n\n  }\n\n\n  public ngOnInit() {\n\n    this.discountInput.subscribe( (discount: any) => this.load(discount) );\n\n    /**\n     * listen to the changes on FormControl objects\n     */\n\n    this.vm.value.formControl.valueChanges.subscribe( (value:number)  => {\n      this.vm.value.value = value;\n    });\n\n    \n  }\n\n  /**\n   * Assign values from parent and load sub-objects required by the view.\n   * \n   * @param discount \n   */\n  private async load(discount:any) {\n    this.zone.run( () => {\n      this.ready = false;\n    });    \n    \n    this.zone.run( async () => {\n      try {\n        console.log(\"BookingEditBookingsGroupLineDiscountComponent: received changes from parent\", discount.id, discount);\n\n        // update local group object\n        for(let field of Object.keys(discount)) {\n          this.discount[field] = discount[field];\n        }\n\n        if(discount.hasOwnProperty('type')) {\n          this.vm.type.value = discount.type;\n          if(discount.type == 'percent') {\n            this.vm.type.formControl.setValue(false);\n          }\n          else {\n            this.vm.type.formControl.setValue(true);\n          }\n        }\n\n        if(discount.hasOwnProperty('value')) {\n          this.vm.value.value = discount.value;\n          this.vm.value.formControl.setValue(discount.value);\n        }      \n\n      }\n      catch(response) {console.warn(response);}\n      this.ready = true;\n    });\n  }\n\n\n\n  private typeChange(event:any) {\n    console.log(event);\n    // true is €, false, is %\n\n    if(event) {\n      this.vm.type.value = \"amount\";\n    }\n    else {\n      this.vm.type.value = \"percent\";\n    }\n    if(this.vm.value.value) {\n      this.discountOutput.next({id: this.discount.id, type: this.vm.type.value});\n    }\n  }\n\n  private valueChange(event:any) {\n    if(this.vm.value.value) {\n      // relay change to parent component\n      this.discountOutput.next({id: this.discount.id, value: this.vm.value.value});\n\n    }\n  }\n\n}","<div class=\"cell\">\r\n      <mat-form-field floatLabel=\"always\" class=\"invisible\" style=\"max-width: 85px;\">\r\n        % <mat-slide-toggle [formControl]=\"vm.type.formControl\" (change)=\"vm.type.change($event.checked)\">€</mat-slide-toggle>      \r\n        <textarea matInput hidden></textarea>\r\n      </mat-form-field>\r\n</div>\r\n<div class=\"cell\">\r\n      <mat-form-field style=\"max-width: 90px;\">\r\n        <input  type=\"number\" \r\n                placeholder=\"réduction\"\r\n                matInput \r\n                (blur)=\"vm.value.change($event)\"\r\n                [formControl]=\"vm.value.formControl\" >\r\n        <mat-error *ngIf=\"!vm.value.formControl.hasError('required')\">\r\n          Ne peut être vide.\r\n        </mat-error>\r\n      </mat-form-field>\r\n</div>      ","import { Component, Inject, OnInit, OnChanges, NgZone, Output, Input, EventEmitter, SimpleChanges } from '@angular/core';\nimport { AuthService, ApiService, ContextService } from 'sb-shared-lib';\nimport { Router, ActivatedRoute } from '@angular/router';\n\nimport { FormBuilder, FormGroup, FormControl, Validators } from '@angular/forms';\nimport { MatDialog, MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { CdkTextareaAutosize } from '@angular/cdk/text-field';\nimport { MatAutocompleteSelectedEvent } from '@angular/material/autocomplete';\n\nimport {MatSnackBar} from '@angular/material/snack-bar';\n\nimport { Observable, ReplaySubject, BehaviorSubject } from 'rxjs';\n\nimport { find, map, mergeMap, startWith, debounceTime } from 'rxjs/operators';\n\nimport { CdkDragDrop, moveItemInArray } from '@angular/cdk/drag-drop';\n\n\ninterface vmModel {\n  product: {\n    name:           string\n    inputClue:      ReplaySubject<any>,\n    filteredList:   Observable<any>,\n    inputChange:    (event:any) => void,\n    change:         (event:any) => void,\n    focus:          () => void,\n    restore:        () => void,\n    reset:          () => void,\n    display:        (type:any) => string\n  },\n  qty: {\n    value:          number,\n    formControl:    FormControl,\n    change:         () => void\n  },\n  free_qty: {\n    value:          number\n  },\n  unit_price: {\n    value:          number\n  },\n  discount: {\n    value:          number\n  },\n  vat: {\n    value:          number\n  },\n  total_price: {\n    value:          number\n  },\n  discounts: {\n    add:            () => void,\n    remove:         (discount:any) => void\n  }\n}\n\n@Component({\n  selector: 'booking-edit-bookings-group-line',\n  templateUrl: 'booking.edit.bookings.group.line.component.html',\n  styleUrls: ['booking.edit.bookings.group.line.component.scss']\n})\nexport class BookingEditBookingsGroupLineComponent implements OnInit  {\n\n  // read-only parent group\n  @Input() groupInput: any;\n\n  @Input() lineOutput: ReplaySubject<any>;\n  @Input() lineInput:  ReplaySubject<any>;\n\n  // observable for updates from children components\n  public _discountInput:  ReplaySubject<any> = new ReplaySubject(1);\n  // array of observable for children components\n  public _discountOutput: Array<ReplaySubject<any>> = [];\n\n  // fields for sub-items\n  private model_fields = {\n    BookingPriceAdapter: [\"id\", \"type\", \"value\", \"discount_id.name\", \"booking_line_id\"]\n  };\n\n  // current line\n  public line: any;\n\n  // sub-objects (not present in group)\n  public product:any;\n  public rate_class:any;\n  public price:any;\n  public discounts: any;\n  public adapters: any;\n\n  public ready: boolean = false;\n\n  public vm: vmModel;\n\n  constructor(\n              private api: ApiService,\n              private auth: AuthService,\n              private dialog: MatDialog,\n              private zone: NgZone,\n              private snack: MatSnackBar\n              ) {\n\n    this.line = {};\n    this.product = null;\n    this.discounts = [];\n\n    this.vm = {\n      product: {\n        name:           '',\n        inputClue:      new ReplaySubject(1),\n        filteredList:   new Observable(),\n        change:         (event:any) => this.productChange(event),\n        inputChange:    (event:any) => this.productInputChange(event),\n        focus:          () => this.productFocus(),\n        restore:        () => this.productRestore(),\n        reset:          () => this.productReset(),\n        display:        (type:any) => this.productDisplay(type)\n      },\n      qty: {\n        value:          0,\n        formControl:    new FormControl('', Validators.required),\n        change:         () => this.qtyChange()\n      },\n      free_qty: {\n        value:          0.0\n      },\n      unit_price: {\n        value:          0.0\n      },\n      discount: {\n        value:          0.0\n      },\n      vat: {\n        value:          0.0\n      },\n      total_price: {\n        value:          0.0\n      },\n      discounts: {\n        add:            () => this.discountAdd(),\n        remove:         (discount:any) => this.discountRemove(discount)\n      }\n    };\n\n  }\n\n\n  public ngOnInit() {\n\n    this.lineInput.subscribe( (line: any) => this.load(line) );\n\n    // listen to changes relayed by children component on the _bookingInput observable\n    this._discountInput.subscribe(params => this.updateFromDiscount(params));\n\n    /**\n     * listen to the changes on FormControl objects\n     */\n    this.vm.product.filteredList = this.vm.product.inputClue.pipe(\n      debounceTime(300),\n      map( (value:any) => (typeof value === 'string' ? value : (value == null)?'':value.name) ),\n      mergeMap( async (name:string) => this.filterProducts(name) )\n    );\n\n    this.vm.qty.formControl.valueChanges.subscribe( (value:number)  => {\n      this.vm.qty.value = value;\n    });\n  }\n\n  /**\n   * Assign values from parent and load sub-objects required by the view.\n   * \n   * @param line \n   */\n  private async load(line:any) {\n    this.zone.run( () => {\n      this.ready = false;\n    });    \n    \n    this.zone.run( async () => {\n      try {\n        console.log(\"BookingEditBookingsGroupLineComponent: received changes from parent\", line.id, line);\n\n        // update local group object\n        for(let field of Object.keys(line)) {\n          this.line[field] = line[field];\n        }\n\n        if(line.product_id) {\n          let data:any = await this.api.read(\"lodging\\\\sale\\\\catalog\\\\Product\", [line.product_id], [\"id\", \"name\", \"sku\"]);\n          if(data && data.length) {\n            let product = data[0];\n            this.product = product;\n            this.vm.product.name = product.name + ' ('+ product.sku +')';\n          }  \n        }\n\n// #todo - obtenir les réductions automatiques assignées au goupe et les afficher pour les produits pour lesquels elles sont d'application\n\n// #todo - obtenir les réductions manuelles la ligne : dans un sous-component\n        if(line.hasOwnProperty('price_id')) {\n          let data:any = await this.api.read(\"sale\\\\price\\\\Price\", [line.price_id], [\"id\", \"price\"]);\n          if(data && data.length) {\n            let price = data[0];\n            this.price = price;\n            // #memo : price is a computed field set server-side, according to price adapters            \n            this.vm.unit_price.value = price.price;\n          }\n          else {\n            this.price = null;\n            this.vm.unit_price.value = 0;\n            this.vm.vat.value = 0;\n          }\n        }\n\n        if(line.hasOwnProperty('unit_price')) {\n          this.vm.unit_price.value = line.unit_price;\n        }\n\n        if(line.hasOwnProperty('vat_rate')) {\n          this.vm.vat.value = line.vat_rate;\n        }\n\n        if(line.hasOwnProperty('price')) {\n          this.vm.total_price.value = line.price;\n        }\n\n        if(line.hasOwnProperty('qty')) {\n          this.vm.qty.value = line.qty;\n          this.vm.qty.formControl.setValue(line.qty);\n        }\n\n        if(line.manual_discounts_ids) {\n          let data:any = await this.loadManualDiscounts(line.manual_discounts_ids, this.model_fields['BookingPriceAdapter']);\n          if(data) {\n            for(let [index, discount] of data.entries()) {\n              // add new discounts (indexes from this.discount and this._lineOutput are synced)\n              if(index >= this.discounts.length) {\n                let item = new ReplaySubject(1);\n                this._discountOutput.push(item);\n                item.next(discount);\n                this.discounts.push(discount);\n              }\n              // if discount differ, overwrite previsously assigned discount\n              else if(JSON.stringify(this.discounts[index]) != JSON.stringify(discount) ) {\n                let item = new ReplaySubject(1);\n                this._discountOutput[index] = item;\n                this.discounts[index] = discount;\n                item.next(discount);\n              }\n            }\n            // remove remaining discounts, if any\n            if(this.discounts.length > data.length) {\n              this.discounts.splice(data.length);\n              this._discountOutput.splice(data.length);\n            }\n          }\n          let discount = 0.0;\n          for(let item of this.discounts) {\n            if(item['type'] == 'percent') {\n              discount += item['value'];\n            }\n          }\n          this.vm.discount.value = discount;\n        }\n\n        // allways load price adapters\n        if(line.auto_discounts_ids) {\n          let free_qty = 0;\n          const adapters:any = await this.loadAutoDiscounts(line.auto_discounts_ids, this.model_fields['BookingPriceAdapter']);\n          this.adapters = adapters;\n          for(let adapter of this.adapters) {\n            if(adapter['type'] == 'freebie') {\n              free_qty += adapter['value'];\n            }\n          }\n\n          this.vm.free_qty.value = free_qty;\n        }\n        \n\n      }\n      catch(response) {console.warn(response);}\n      this.ready = true;\n    });\n  }\n\n\n  /**\n   * Handle update events received from BookingLine children.\n   * \n   */\n   private async updateFromDiscount(discount: any) {\n    console.log(\"BookingEditBookingsGroupLineComponent: received changes from child\", discount);\n\n    console.log(this.discounts);\n    \n    try {\n\n      let has_change = false;\n      let index = this.discounts.findIndex( (element:any) => element.id == discount.id);\n      let t_line = this.discounts.find( (element:any) => element.id == discount.id);\n\n      if(discount.hasOwnProperty('value') && discount.value != t_line.value) {\n        await this.updateDiscount(discount);\n        has_change = true;\n      }\n\n      if(discount.hasOwnProperty('type') && discount.type != t_line.type) {\n        await this.updateDiscount(discount);\n        has_change = true;\n      }\n\n      if(has_change) {\n        this.lineOutput.next({id: this.line.id, price_adapters_ids: true});\n      }      \n\n    }\n    catch(error) {\n      console.warn('some changes could not be stored', error);\n      this.snack.open(\"Erreur - certains changements n'ont pas pu être enregistrés.\");\n    }\n  }\n\n  private productInputChange(event:any) {\n    this.vm.product.inputClue.next(event.target.value);\n  }\n\n  private productFocus() {\n    this.vm.product.inputClue.next(\"\");\n  }\n\n  private productDisplay(product:any): string {\n    return product ? product.name + ' ('+ product.sku +')': '';\n  }\n\n  private productReset() {\n    setTimeout( () => {\n      this.vm.product.name = '';\n    }, 100);\n  }\n\n  private productRestore() {\n    if(this.product) {\n      this.vm.product.name = this.product.name + ' ('+ this.product.sku +')';\n    }\n    else {\n      this.vm.product.name = '';\n    }\n  }\n\n\n  private productChange(event:any) {\n    console.log('BookingEditCustomerComponent::productChange', event)\n\n    // from mat-autocomplete\n    if(event && event.option && event.option.value) {\n      let product = event.option.value;\n      this.product = product;\n      this.vm.product.name = product.name + ' ('+ product.sku +')';\n      // relay change to parent component\n      this.lineOutput.next({id: this.line.id, product_id: product.id, refresh: {self: ['price']}});\n    }\n\n  }\n\n  private qtyChange() {\n    // relay change to parent component\n    this.lineOutput.next({id: this.line.id, qty: this.vm.qty.value, refresh: {self: ['price']}});\n  }\n\n  private async filterProducts(name: string) {\n/*\n#todo - limit products to the ones available for currently selected center\n$families_ids = center.product_families_ids\n$products = sale\\catalog\\Product::search(['family_id', 'in', $families_ids])\n*/\n    let filtered:any[] = [];\n    try {\n      let data:any[] = await this.api.collect(\"lodging\\\\sale\\\\catalog\\\\Product\", [[\"name\", \"ilike\", '%'+name+'%']], [\"id\", \"name\", \"sku\"], 'name', 'asc', 0, 25);\n      filtered = data;\n    }\n    catch(response) {\n      console.log(response);\n    }\n    return filtered;\n  }  \n\n\n  private async loadAutoDiscounts(ids:Array<any>, fields:any) {\n    let data:any[] = await this.api.read(\"lodging\\\\sale\\\\booking\\\\BookingPriceAdapter\", ids, fields);\n    return data;\n  }  \n\n  private async loadManualDiscounts(ids:Array<any>, fields:any) {\n    let data:any[] = await this.api.read(\"lodging\\\\sale\\\\booking\\\\BookingPriceAdapter\", ids, fields);\n    return data;\n  }  \n\n\n  private async discountAdd() {\n\n    try {\n      const adapter = await this.api.create(\"lodging\\\\sale\\\\booking\\\\BookingPriceAdapter\", {\n        booking_id: this.line.booking_id,\n        booking_line_group_id: this.line.booking_line_group_id,\n        booking_line_id: this.line.id\n      });\n\n      // emit change to parent\n      // this.lineOutput.next({id: this.line.id, price_adapters_ids: [adapter.id]});\n\n      let discount = {id: adapter.id, type: 'percent', value: 0};\n\n      let item = new ReplaySubject(1);\n      this._discountOutput.push(item);\n      item.next(discount);\n      this.discounts.push(discount);\n\n    }\n    catch(error) {\n      console.log(error);\n    }\n\n  }\n\n  private async discountRemove(discount: any) {\n    // await this.api.remove(\"lodging\\\\sale\\\\booking\\\\BookingPriceAdapter\", [discount.id], true);\n    await this.api.update(\"lodging\\\\sale\\\\booking\\\\BookingLine\", [this.line.id], {price_adapters_ids: [-discount.id]}, discount);\n    this.lineOutput.next({id: this.line.id, price_adapters_ids: true});\n  }\n\n  private async updateDiscount(discount:any) {\n    await this.api.update(\"lodging\\\\sale\\\\booking\\\\BookingPriceAdapter\", [discount.id], discount);\n  }\n}","\r\n<!-- template vars -->\r\n<div #vProduct=\"var\" [var]=\"{identification: {folded: true}, discounts: {folded: true}, adapters: {folded: true}}\"></div>\r\n\r\n\r\n<!-- identification-->\r\n<div class=\"part\" [class.hidden]=\"!ready\">\r\n  <div class=\"part-toggle\" [class.hidden]=\"groupInput.is_locked\">\r\n    <button mat-icon-button *ngIf=\"!vProduct.identification.folded\" (click)=\"vProduct.identification.folded = !vProduct.identification.folded\">\r\n      <mat-icon style=\"font-size: 15px;\">keyboard_arrow_up</mat-icon>\r\n    </button>\r\n    <button mat-icon-button *ngIf=\"vProduct.identification.folded\" (click)=\"vProduct.identification.folded = !vProduct.identification.folded\">\r\n      <mat-icon style=\"font-size: 15px;\">keyboard_arrow_right</mat-icon>\r\n    </button>\r\n  </div>\r\n\r\n  <div class=\"part-container\" >\r\n\r\n    <!-- 1) product summary -->\r\n    <div class=\"row row-first\">\r\n\r\n      <!-- product -->\r\n      <div class=\"cell\">\r\n        <mat-form-field>\r\n          <mat-label>Produit</mat-label>\r\n          <input  matInput\r\n                  type=\"text\"\r\n                  [matAutocomplete]=\"productAutocomplete\"\r\n                  [value]=\"vm.product.name\"\r\n                  (keyup)=\"vm.product.inputChange($event)\"\r\n                  (focus)=\"vm.product.focus()\"\r\n                  (blur)=\"vm.product.restore()\"\r\n                  placeholder=\"Commencez à taper le nom\" />\r\n\r\n          <mat-icon *ngIf=\"line.qty_accounting_method == 'accomodation'\" matSuffix style=\"vertical-align: sub;\">hotel</mat-icon>\r\n          <mat-hint>Hint</mat-hint>\r\n          <mat-hint [align]=\"'end'\">\r\n            <span *ngIf=\"line.qty_accounting_method == 'accomodation'\">au logement</span>\r\n            <span *ngIf=\"line.qty_accounting_method == 'person'\">à la personne</span>\r\n            <span *ngIf=\"line.qty_accounting_method == 'unit'\">à l'unité</span>\r\n          </mat-hint>\r\n          \r\n\r\n          <button mat-button *ngIf=\"vm.product.name.length\" matSuffix mat-icon-button aria-label=\"Clear\" (click)=\"vm.product.reset()\">\r\n            <mat-icon>close</mat-icon>\r\n          </button>\r\n\r\n          <mat-autocomplete #productAutocomplete=\"matAutocomplete\" [displayWith]=\"vm.product.display\" (optionSelected)=\"vm.product.change($event)\">\r\n            <div  *ngIf=\"vm.product.filteredList | async; let list\">\r\n              <mat-option *ngFor=\"let product of list\" [value]=\"product\">\r\n                {{product.name}}\r\n              </mat-option>\r\n              <mat-option *ngIf=\"list.length == 0\"><i>pas de résultat</i></mat-option>\r\n            </div>\r\n          </mat-autocomplete>                  \r\n\r\n        </mat-form-field>\r\n      </div>\r\n\r\n\r\n      <!-- qty -->\r\n      <div class=\"cell cell-right\" [class.cell-text]=\"groupInput.is_locked\">\r\n        <span *ngIf=\"groupInput.is_locked\">{{vm.qty.value }}</span>\r\n        <mat-form-field *ngIf=\"!groupInput.is_locked\">\r\n          <mat-label>Quantité</mat-label>\r\n          <input  type=\"number\" \r\n                  matInput \r\n                  (blur)=\"vm.qty.change()\"\r\n                  [formControl]=\"vm.qty.formControl\" >\r\n          <mat-error *ngIf=\"!vm.qty.formControl.hasError('required')\">\r\n            Ne peut être vide.\r\n          </mat-error>\r\n        </mat-form-field>\r\n      </div>\r\n\r\n      <!-- Freebies -->\r\n      <div class=\"cell cell-text cell-right\" >\r\n        <span *ngIf=\"!groupInput.is_locked\">{{vm.free_qty.value }}</span>\r\n      </div>\r\n\r\n      <!-- Unit Price -->\r\n      <div class=\"cell cell-text cell-right\" >\r\n        <span *ngIf=\"!groupInput.is_locked\">{{vm.unit_price.value | number: '1.2-2'}} €</span>\r\n      </div>\r\n\r\n      <!-- Discount -->\r\n      <div class=\"cell cell-text cell-right\" >\r\n        <span *ngIf=\"!groupInput.is_locked\">{{vm.discount.value | percent}}</span>\r\n      </div>\r\n      \r\n      <!-- Tax -->\r\n      <div class=\"cell cell-text cell-right\" >\r\n        <span *ngIf=\"!groupInput.is_locked\">{{vm.vat.value | percent}}</span>\r\n      </div>\r\n\r\n      <!-- Total Price -->\r\n      <div class=\"cell cell-text cell-right\" >\r\n        <span *ngIf=\"!groupInput.is_locked\">{{vm.total_price.value | number : '1.2-2'}} €</span>\r\n      </div>\r\n\r\n      <!-- actions (empty: set in parent component) -->\r\n      <div class=\"cell cell-actions\"></div>  \r\n\r\n    </div>\r\n\r\n\r\n\r\n    <!-- 2) auto-discounts / price adapters -->\r\n    <div class=\"row row-first\" *ngIf=\"!vProduct.identification.folded && !groupInput.is_locked\">\r\n      <div class=\"part cell\" [class.hidden]=\"!ready\">\r\n        <div class=\"part-toggle\">\r\n          <button mat-icon-button *ngIf=\"!vProduct.adapters.folded\" (click)=\"vProduct.adapters.folded = !vProduct.adapters.folded\">\r\n            <mat-icon style=\"font-size: 15px;\">keyboard_arrow_up</mat-icon>\r\n          </button>\r\n          <button mat-icon-button *ngIf=\"vProduct.adapters.folded\" (click)=\"vProduct.adapters.folded = !vProduct.adapters.folded\">\r\n            <mat-icon style=\"font-size: 15px;\">keyboard_arrow_right</mat-icon>\r\n          </button>\r\n        </div>\r\n        <div class=\"part-container\">\r\n          <div class=\"row row-title row-thin\">\r\n          <span>Détail du prix</span>\r\n          </div>\r\n          <!-- auto discounts details -->\r\n          <div class=\"row row-thin\" *ngIf=\"!vProduct.adapters.folded\">\r\n            <div>\r\n              <div *ngFor=\"let adapter of adapters; let index = index;\">\r\n                {{adapter.discount_id.name}} :\r\n                <span *ngIf=\"adapter.type == 'amount'\">{{adapter.value | number: '1.2-2'}} €</span>\r\n                <span *ngIf=\"adapter.type == 'percent'\">{{adapter.value | percent}}</span>\r\n                <span *ngIf=\"adapter.type == 'freebie'\">{{adapter.value}}</span>\r\n              </div>  \r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- 3) manual discounts -->\r\n    <div class=\"row row-first\" *ngIf=\"!vProduct.identification.folded && !groupInput.is_locked\">\r\n      <div class=\"part cell\" [class.hidden]=\"!ready\">\r\n        <div class=\"part-toggle\">\r\n          <button mat-icon-button *ngIf=\"!vProduct.discounts.folded\" (click)=\"vProduct.discounts.folded = !vProduct.discounts.folded\">\r\n            <mat-icon style=\"font-size: 15px;\">keyboard_arrow_up</mat-icon>\r\n          </button>\r\n          <button mat-icon-button *ngIf=\"vProduct.discounts.folded\" (click)=\"vProduct.discounts.folded = !vProduct.discounts.folded\">\r\n            <mat-icon style=\"font-size: 15px;\">keyboard_arrow_right</mat-icon>\r\n          </button>\r\n        </div>\r\n        <div class=\"part-container\">\r\n          <div class=\"row row-title row-thin\">\r\n          <span>Réductions <button mat-mini-fab color=\"primary\" style=\"transform: scale(0.65);\" (click)=\"vm.discounts.add(); vProduct.discounts.folded = false\"> <mat-icon>add</mat-icon></button></span>\r\n          </div>\r\n          <!-- manual discounts details -->\r\n          <div class=\"row row-thin\" *ngIf=\"!vProduct.discounts.folded\">\r\n\r\n            <div class=\"discounts-list\">\r\n              <!-- discounts -->\r\n              <div class=\"discount-item\" *ngFor=\"let discount of discounts; let index = index;\">\r\n                <div class=\"discount-remove\"><button mat-icon-button (click)=\"vm.discounts.remove(discount)\"> <mat-icon>delete</mat-icon></button></div>\r\n                <booking-edit-bookings-group-line-discount [discountInput]=\"_discountOutput[index]\" [discountOutput]=\"_discountInput\" [lineInput]=\"line\" [lineOutput]=\"lineOutput\"></booking-edit-bookings-group-line-discount>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n  </div>\r\n</div>","import { Component, Inject, OnInit, OnChanges, NgZone, Output, Input, EventEmitter, SimpleChanges } from '@angular/core';\nimport { AuthService, ApiService, ContextService } from 'sb-shared-lib';\nimport { Router, ActivatedRoute } from '@angular/router';\n\nimport { FormBuilder, FormGroup, FormControl, Validators } from '@angular/forms';\nimport { MatDialog, MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { CdkTextareaAutosize } from '@angular/cdk/text-field';\nimport { MatAutocompleteSelectedEvent } from '@angular/material/autocomplete';\n\nimport {MatSnackBar} from '@angular/material/snack-bar';\n\nimport { Observable, ReplaySubject, BehaviorSubject } from 'rxjs';\n\nimport { find, map, mergeMap, startWith, debounceTime } from 'rxjs/operators';\n\nimport { CdkDragDrop, moveItemInArray } from '@angular/cdk/drag-drop';\n\n\ninterface vmModel {\n  price: {\n    value:        number\n  }\n  name: {\n    value:        string,\n    formControl:  FormControl,\n    change:       () => void\n  },\n  daterange: {\n    start: {\n      formControl:  FormControl\n    },\n    end: {\n      formControl:  FormControl\n    },\n    nights_count:   number,\n    change:         () => void\n  },\n  participants_count: {\n    value:          number,\n    formControl:    FormControl\n    change:         () => void\n  },\n  sojourn_type: {\n    value:          'GG',\n    change:         (event:any) => void\n  },\n  pack: {\n    name:           string,\n    has_pack:       boolean,\n    is_locked:      boolean,\n    inputClue:      ReplaySubject<any>,\n    filteredList:   Observable<any>,\n    inputChange:    (event:any) => void,\n    change:         (target: string, value:any) => void,\n    focus:          () => void,\n    restore:        () => void,\n    reset:          () => void,\n    display:        (type:any) => string\n  },\n  rate_class: {\n    name:           string\n    inputClue:      ReplaySubject<any>,\n    filteredList:   Observable<any>,\n    inputChange:    (event:any) => void,\n    change:         (event:any) => void,\n    focus:          () => void,\n    restore:        () => void,\n    reset:          () => void,\n    display:        (type:any) => string\n  },\n  lines: {\n    add:            () => void,\n    remove:         (product:any) => void,\n    drop:           (event:CdkDragDrop<any>) => void\n  }\n}\n\n@Component({\n  selector: 'booking-edit-bookings-group',\n  templateUrl: 'booking.edit.bookings.group.component.html',\n  styleUrls: ['booking.edit.bookings.group.component.scss']\n})\nexport class BookingEditBookingsGroupComponent implements OnInit  {\n\n  // read-only parent booking\n  @Input() bookingInput: any;\n\n  //private _groupInput: ReplaySubject<any> = new ReplaySubject(1);\n  @Input() groupOutput: ReplaySubject<any>;\n  @Input() groupInput:  ReplaySubject<any>;\n\n\n  // observable for updates from children components\n  public _lineInput:  ReplaySubject<any> = new ReplaySubject(1);\n  // array of observable for children components\n  public _lineOutput: Array<ReplaySubject<any>> = [];\n\n\n  // observable for updates from children components\n  public _accomodationInput:  ReplaySubject<any> = new ReplaySubject(1);\n  // array of observable for children components\n  public _accomodationOutput: Array<ReplaySubject<any>> = [];\n\n\n  // fields for sub-items\n  private model_fields = {\n    BookingLine: [\n      \"id\", \"product_id\", \"order\", \"qty\", \"price_id\", \"vat_rate\", \"unit_price\", \"price\", \n      \"booking_id\", \"booking_line_group_id\",\n      \"price_adapters_ids\", \"auto_discounts_ids\", \"manual_discounts_ids\",\n      \"qty_accounting_method\"\n    ],\n    Consumption: [\n      \"id\", \"product_id\", \"rental_unit_id\"\n    ]\n\n  };\n\n\n  // current group  \n  public group: any;\n\n  // sub-objects (not present in group)\n  public pack:any;\n  public customer:any;\n  public rate_class:any;\n  \n  public lines: Array<any>;   // bookingLines\n  public accomodations: Array<any>;   // bookingLines\n\n  public ready: boolean = false;\n\n  public vm: vmModel;\n\n  constructor(\n              private api: ApiService,\n              private auth: AuthService,\n              private dialog: MatDialog,\n              private zone: NgZone,\n              private snack: MatSnackBar\n              ) {\n\n    this.group = {};\n    this.rate_class = null;\n    this.pack = null;\n    this.lines = [];\n    this.accomodations = [];\n\n\n    this.vm = {\n      price: {\n        value:          0\n      },\n      name: {\n        value:          '',\n        formControl:    new FormControl('', Validators.required),\n        change:         () => this.nameChange()\n      },\n      daterange: {\n        start:{\n          formControl:  new FormControl()\n        },\n        end:{\n          formControl:  new FormControl()\n        },\n        nights_count:   0,\n        change:         () => this.dateRangeChange()\n      },\n      participants_count: {\n        value:          1,\n        formControl:    new FormControl('', Validators.required),\n        change:         () => this.nbPersChange()\n      },\n      sojourn_type: {\n        value:          'GG',\n        change:         (event:any) => this.sojournTypeChange(event)\n      },\n      pack: {\n        name:           '',\n        has_pack:       false,\n        is_locked:      false,\n        inputClue:      new ReplaySubject(1),\n        filteredList:   new Observable(),\n        change:         (target, value:any) => this.packChange(target, value),\n        inputChange:    (event:any) => this.packInputChange(event),\n        focus:          () => this.packFocus(),\n        restore:        () => this.packRestore(),\n        reset:          () => this.packReset(),\n        display:        (type:any) => this.packDisplay(type)\n      },\n      rate_class: {\n        name:           '',\n        inputClue:      new ReplaySubject(1),\n        filteredList:   new Observable(),\n        change:         (event:any) => this.rateClassChange(event),\n        inputChange:    (event:any) => this.rateClassInputChange(event),\n        focus:          () => this.rateClassFocus(),\n        restore:        () => this.rateClassRestore(),\n        reset:          () => this.rateClassReset(),\n        display:        (type:any) => this.rateClassDisplay(type)\n      },\n      lines: {\n        add:            () => this.lineAdd(),\n        remove:         (group:any) => this.lineRemove(group),\n        drop:           (event:CdkDragDrop<any>) => this.lineDrop(event)\n      }\n    };\n\n  }\n\n\n  public ngOnInit() {\n\n    // listen to the parent for changes on group object\n    this.groupInput.subscribe( (group: any) => this.load(group) );\n\n\n    // listen to changes relayed by children component on the _bookingInput observable\n    this._lineInput.subscribe(params => this.updateFromLine(params));\n\n    // listen to changes relayed by children component on the _bookingInput observable\n    this._accomodationInput.subscribe(params => this.updateFromAccomodation(params));\n\n    /**\n     * listen to the changes on FormControl objects\n     */\n\n    this.vm.pack.filteredList = this.vm.pack.inputClue.pipe(\n      debounceTime(300),\n      map( (value:any) => (typeof value === 'string' ? value : (value == null)?'':value.name) ),\n      mergeMap( async (name:string) => this.filterPacks(name) )\n    );\n\n    this.vm.rate_class.filteredList = this.vm.rate_class.inputClue.pipe(\n      debounceTime(300),\n      map( (value:any) => (typeof value === 'string' ? value : (value == null)?'':value.name) ),\n      mergeMap( async (name:string) => this.filterRateClasses(name) )\n    );\n\n    this.vm.daterange.start.formControl.valueChanges.subscribe( (date:Date)  => {\n      this.dateRangeUpdate();\n    });\n\n    this.vm.daterange.end.formControl.valueChanges.subscribe( (date:Date)  => {\n      this.dateRangeUpdate();\n    });\n\n    this.vm.participants_count.formControl.valueChanges.subscribe( (value:number)  => {\n      this.vm.participants_count.value = value;\n    });\n\n    this.vm.name.formControl.valueChanges.subscribe( (value:string)  => {\n      this.vm.name.value = value;\n    });\n\n  }\n\n\n  /**\n   * Assign values from parent and load sub-objects required by the view.\n   * \n   * @param group\n   */\n  private async load(group:any) {\n    this.zone.run( () => {\n      // this.ready = false;\n    });\n    this.zone.run( async () => {\n      try {\n        console.log(\"BookingEditBookingsGroupComponent: received changes from parent\", group.id, group);\n\n        // update local group object\n        for(let field of Object.keys(group)) {\n          this.group[field] = group[field];\n        }\n\n        if(group.name) {\n          this.vm.name.formControl.setValue(group.name);\n        }\n\n        if(group.hasOwnProperty('price')) {\n          this.vm.price.value = group.price;\n        }\n\n        if(group.rate_class_id) {\n          let data:any = await this.api.read(\"sale\\\\customer\\\\RateClass\", [group.rate_class_id], [\"id\", \"name\", \"description\"]);\n          if(data && data.length) {\n            let rate_class = data[0];\n            this.rate_class = rate_class;\n            this.vm.rate_class.name = rate_class.name;\n          }  \n        }\n\n        if(group.pack_id) {\n          let data:any = await this.api.read(\"lodging\\\\sale\\\\catalog\\\\Product\", [group.pack_id], [\"id\", \"name\", \"sku\"]);\n          if(data && data.length) {\n            let pack = data[0];\n            this.pack = pack;\n            this.vm.pack.name = pack.name;\n          }\n\n          // we need to load related is_lock value\n        }\n\n        if(group.hasOwnProperty('has_pack')) {\n          this.vm.pack.has_pack = group.has_pack;\n        }\n\n        if(group.hasOwnProperty('is_locked')) {\n          this.vm.pack.is_locked = group.is_locked;\n        }\n\n        if(group.hasOwnProperty('nb_pers')) {\n          this.vm.participants_count.formControl.setValue(group.nb_pers);\n        }\n\n        if(group.sojourn_type) {\n          this.vm.sojourn_type.value = group.sojourn_type;\n        }\n\n        if(group.date_from) {\n          this.vm.daterange.start.formControl.setValue(group.date_from);\n        }\n        \n        if(group.date_to) {\n          this.vm.daterange.end.formControl.setValue(group.date_to);\n        }\n\n        if(group.booking_lines_ids) {\n          let data:any = await this.loadLines(group.booking_lines_ids, this.model_fields['BookingLine']);\n          if(data) {\n            for(let [index, line] of data.entries()) {\n              // add new lines (indexes from this.lines and this._lineOutput are synced)\n              if(index >= this.lines.length) {\n                let item = new ReplaySubject(1);\n                this._lineOutput.push(item);\n                item.next(line);\n                this.lines.push(line);\n              }\n              // if lines differ, overwrite previsously assigned line\n              else if(JSON.stringify(this.lines[index]) != JSON.stringify(line) ) {\n                let item = new ReplaySubject(1);\n                this._lineOutput[index] = item;\n                this.lines[index] = line;\n                item.next(line);\n              }\n            }\n            // remove remaining lines, if any\n            if(this.lines.length > data.length) {\n              this.lines.splice(data.length);\n              this._lineOutput.splice(data.length);\n            }\n          }\n        }\n\n\n        if(group.accomodations_ids) {\n          let data:any = await this.loadAccomodations(group.accomodations_ids, this.model_fields['Consumption']);\n          if(data) {\n            for(let [index, accomodation] of data.entries()) {\n              // add new lines (indexes from this.lines and this._lineOutput are synced)\n              if(index >= this.accomodations.length) {\n                let item = new ReplaySubject(1);\n                this._accomodationOutput.push(item);\n                item.next(accomodation);\n                this.accomodations.push(accomodation);\n              }\n              // if accomodations differ, overwrite previsously assigned line\n              else if(JSON.stringify(this.accomodations[index]) != JSON.stringify(accomodation) ) {\n                let item = new ReplaySubject(1);\n                this._accomodationOutput[index] = item;\n                this.accomodations[index] = accomodation;\n                item.next(accomodation);\n              }\n            }\n            // remove remaining accomodations, if any\n            if(this.accomodations.length > data.length) {\n              this.accomodations.splice(data.length);\n              this._accomodationOutput.splice(data.length);\n            }\n          }\n        }        \n      }\n      catch(response) {console.warn(response);}\n      this.ready = true;\n    });\n  }\n\n  private async updateFromAccomodation(line: any) {\n    console.log(\"BookingEditBookingsGroupComponent: received changes from child\", line);\n\n    let has_change:boolean = false;\n\n    try {\n      let index = this.lines.findIndex( (element) => element.id == line.id);\n      let t_line = this.lines.find( (element) => element.id == line.id);\n\n      if(line.hasOwnProperty('rental_unit_id') && line.rental_unit_id != t_line.rental_unit_id) {\n        has_change = true;\n        await this.updateRentalUnit(line);\n      }\n\n\n      if(has_change) {        \n        let data = await this.loadAccomodations([line.id], this.model_fields['Consumption']);\n        let object = data[0];\n        for(let field of Object.keys(object)) {\n          this.accomodations[index][field] = object[field];\n        }\n        // relay changes to children components\n        this._accomodationOutput[index].next(this.accomodations[index]);\n        // notify User\n        this.snack.open(\"Logement mis à jour\");\n      }\n    }\n    catch(error) {\n      console.warn(error);\n    }\n  }\n\n  /**\n   * Handle update events received from BookingLine children.\n   * \n   */\n  private async updateFromLine(line: any) {\n    console.log(\"BookingEditBookingsGroupComponent: received changes from child\", line);\n\n    try {\n      let has_change = false;\n      let refresh_requests:any = {};\n\n      let index = this.lines.findIndex( (element) => element.id == line.id);\n      let t_line = this.lines.find( (element) => element.id == line.id);\n\n      if(line.hasOwnProperty('product_id') && line.product_id != t_line.product_id) {\n        await this.updateProduct(line);\n        has_change = true;\n        // this implies reloading current group price and booking price        \n        refresh_requests['booking_id'] = ['price'];\n        refresh_requests['self'] = ['price'];\n      }\n\n      if(line.hasOwnProperty('qty') && line.qty != t_line.qty) {\n        await this.updateQuantity(line);\n        has_change = true;\n        refresh_requests['booking_id'] = ['price'];\n        refresh_requests['self'] = ['price'];\n      }\n\n      if(line.hasOwnProperty('price_adapters_ids')) {\n        has_change = true;\n        refresh_requests['booking_id'] = ['price'];\n        refresh_requests['self'] = ['price'];\n      }\n\n\n      // handle explicit requests for updating single fields (reload partial object)\n      if(line.hasOwnProperty('refresh')) {\n        // some changes have been done that might impact current object\n        // refresh property specifies which fields have to be re-loaded\n        let model_fields = this.model_fields['BookingLine'];\n\n        if(line.refresh.hasOwnProperty('self')) {\n          if(Array.isArray(line.refresh.self)) {\n            model_fields = line.refresh.self;\n          }          \n          // reload object from server\n          let data = await this.loadLines([line.id], model_fields);\n          this._lineOutput[index].next(data[0]);\n        }\n\n        // handle requests to relay to parent\n        if(line.refresh.hasOwnProperty('booking_line_group_id')) {\n          // line.refresh.booking_line_group_id is an array of fields from sale\\booking\\BookingLineGroup to be updated\n          if(refresh_requests.hasOwnPropertyKey('self')) {\n            refresh_requests['self'] = [...refresh_requests['self'], ...line.refresh.booking_line_group_id];\n          }\n          else {\n            refresh_requests['self'] = line.refresh.booking_line_group_id;\n          }\n        }\n      }\n      // reload whole object from server\n      else if(has_change) {        \n        let data = await this.loadLines([line.id], this.model_fields['BookingLine']);\n        let object = data[0];\n        for(let field of Object.keys(object)) {\n          this.lines[index][field] = object[field];\n        }\n        // relay changes to children components\n        this._lineOutput[index].next(this.lines[index]);\n        // notify User\n        this.snack.open(\"Regroupement mis à jour\");\n      }\n\n      // relay refresh request to parent, if any\n      if(Object.keys(refresh_requests).length) {\n        this.groupOutput.next({id: this.group.id, refresh: refresh_requests});\n      }\n\n    }\n    catch(error) {\n      console.warn('some changes could not be stored', error);\n      this.snack.open(\"Erreur - certains changements n'ont pas pu être enregistrés.\");\n    }\n  }\n\n  private async loadLines(ids:Array<any>, fields:any) {\n    let data:any = await this.api.read(\"lodging\\\\sale\\\\booking\\\\BookingLine\",\n                                      ids,\n                                      fields,\n                                      'order'\n                                      );\n    return data;\n  }\n\n  private async loadAccomodations(ids:Array<any>, fields:any) {\n    let data:any = await this.api.read(\"lodging\\\\sale\\\\booking\\\\BookingLine\",\n                                      ids,\n                                      fields\n                                      );\n    return data;\n  }\n\n  private dateRangeUpdate() {\n    let start = this.vm.daterange.start.formControl.value;\n    let end = this.vm.daterange.end.formControl.value;\n    if(start && end) {\n      let diff = Math.floor((Date.parse(end.toString()) - Date.parse(start.toString())) / (60*60*24*1000));\n      this.vm.daterange.nights_count = (diff < 0)?0:diff;\n    }\n  }\n\n  private nbPersChange() {\n    console.log('BookingEditCustomerComponent::nbPersChange');\n    // relay change to parent component\n    this.groupOutput.next({id: this.group.id, nb_pers: this.vm.participants_count.value, refresh: { self: ['price'], booking_id: ['price'] }});\n  }\n\n  private nameChange() {\n    console.log('BookingEditCustomerComponent::nameChange');\n    // relay change to parent component\n    this.groupOutput.next({id: this.group.id, name: this.vm.name.value})\n  }\n\n  private dateRangeChange() {\n    console.log('BookingEditCustomerComponent::dateRangeChange');\n    // relay change to parent component\n    this.groupOutput.next({id: this.group.id, date_from: this.vm.daterange.start.formControl.value, date_to: this.vm.daterange.end.formControl.value})\n  }\n\n  private packChange(target:string, value:any) {\n    console.log('BookingEditCustomerComponent::packChange', value)\n\n    switch(target) {\n      case 'name':\n        let pack = value;\n        this.pack = pack;\n        this.vm.pack.name = pack.name;\n        // relay change to parent component\n        this.groupOutput.next({id: this.group.id, pack_id: pack.id})\n        break;\n      case 'has_pack':\n        this.vm.pack.has_pack = value;\n        // relay change to parent component\n        this.groupOutput.next({id: this.group.id, has_pack: value})\n        break;        \n      case 'is_locked':\n        this.vm.pack.is_locked = value;\n        // relay change to parent component\n        this.groupOutput.next({id: this.group.id, is_locked: value})\n        break;\n    }\n  }\n\n  private packInputChange(event:any) {\n    this.vm.pack.inputClue.next(event.target.value);\n  }\n\n  private packFocus() {\n    this.vm.pack.inputClue.next(\"\");\n  }\n\n  private packDisplay(pack:any): string {\n    return pack ? pack.name: '';\n  }\n\n  private packReset() {\n    setTimeout( () => {\n      this.vm.pack.name = '';\n    }, 100);\n  }\n\n  private packRestore() {\n    if(this.pack) {\n      this.vm.pack.name = this.pack.name;\n    }\n    else {\n      this.vm.pack.name = '';\n    }\n  }\n\n\n\n  private sojournTypeChange(event:any) {\n\n  }\n\n  private rateClassChange(event:any) {\n    console.log('BookingEditCustomerComponent::rateClassChange', event)\n\n    // from mat-autocomplete\n    if(event && event.option && event.option.value) {\n      let rate_class = event.option.value;\n      this.rate_class = rate_class;\n      this.vm.rate_class.name = rate_class.name;\n      // relay change to parent component\n      // this.bookingOutput.next({type_id: type.id});\n      this.groupOutput.next({id: this.group.id, rate_class_id: rate_class.id});\n    }\n\n  }\n\n  private rateClassInputChange(event:any) {\n    this.vm.rate_class.inputClue.next(event.target.value);\n  }\n\n  private rateClassFocus() {\n    this.vm.rate_class.inputClue.next(\"\");\n  }\n\n  private rateClassDisplay(rate_class:any): string {\n    return rate_class ? (rate_class.name + ' - ' + rate_class.description): '';\n  }\n\n  private rateClassReset() {\n    setTimeout( () => {\n      this.vm.rate_class.name = '';\n    }, 100);\n  }\n\n  private rateClassRestore() {\n    if(this.rate_class) {\n      this.vm.rate_class.name = this.rate_class.name;\n    }\n    else {\n      this.vm.rate_class.name = '';\n    }\n  }\n\n  private async filterPacks(name: string) {\n/*\n#todo - limit packages to the ones available for currently selected center\n$families_ids = center.product_families_ids\n$products = sale\\catalog\\Product::search(['family_id', 'in', $families_ids])\n*/\n    let filtered:any[] = [];\n    try {\n      let data:any[] = await this.api.collect(\"lodging\\\\sale\\\\catalog\\\\Product\", [[\"name\", \"ilike\", '%'+name+'%'], [\"is_pack\", \"=\", \"true\"]], [\"id\", \"name\"], 'name', 'asc', 0, 25);\n      filtered = data;\n    }\n    catch(response) {\n      console.log(response);\n    }\n    return filtered;\n  }\n\n  private async filterRateClasses(name: string) {\n    let filtered:any[] = [];\n    try {\n      let data:any[] = await this.api.collect(\"sale\\\\customer\\\\RateClass\", [[\"name\", \"ilike\", '%'+name+'%']], [\"id\", \"name\", \"description\"], 'name', 'asc', 0, 25);\n      filtered = data;\n    }\n    catch(response) {\n      console.log(response);\n    }\n    return filtered;\n  }\n\n  private async lineAdd() {\n    try {\n      const line = await this.api.create(\"lodging\\\\sale\\\\booking\\\\BookingLine\", {\n        order: this.lines.length + 1,\n        booking_id: this.group.booking_id,\n        booking_line_group_id: this.group.id\n      });\n\n      // emit change to parent\n      this.groupOutput.next({id: this.group.id, booking_lines_ids: [line.id]});\n    }\n    catch(error) {\n      console.log(error);\n    }\n  }\n\n  /**\n   * Emit change to parent for partial update.\n   * @param line \n   */\n  private async lineRemove(line: any) {\n    this.groupOutput.next({id: this.group.id, booking_lines_ids: [-line.id]});\n  }\n\n  private lineDrop(event:CdkDragDrop<any>) {\n    moveItemInArray(this.lines, event.previousIndex, event.currentIndex);\n    moveItemInArray(this._lineOutput, event.previousIndex, event.currentIndex);\n\n    // adapt new values for 'order' field\n    for(let index in this.lines) {\n      let item = this.lines[index];\n      this.updateFromLine({id: item.id, order: parseInt(index) + 1});\n    }\n\n  }\n\n  private async updateProduct(line:any) {\n    await this.api.update(\"lodging\\\\sale\\\\booking\\\\BookingLine\", [line.id], <any>{\"product_id\": line.product_id});\n  }\n\n  private async updateQuantity(line:any) {\n    await this.api.update(\"lodging\\\\sale\\\\booking\\\\BookingLine\", [line.id], <any>{\"qty\": line.qty});\n  }\n\n  private async updateRentalUnit(line:any) {\n    await this.api.update(\"lodging\\\\sale\\\\booking\\\\BookingLine\", [line.id], <any>{\"rental_unit_id\": line.rental_unit_id});\n  }\n  \n\n}","\r\n<!-- template vars -->\r\n<div #vGroup=\"var\" [var]=\"{identification: {folded: false}, products: {folded: false}, accomodations: {folded: true}}\"></div>\r\n\r\n<div [class.hidden]=\"!ready\">\r\n\r\n<!-- identification-->\r\n<div class=\"part\">\r\n\r\n  <div class=\"part-toggle\">\r\n    <button mat-icon-button *ngIf=\"!vGroup.identification.folded\" (click)=\"vGroup.identification.folded = !vGroup.identification.folded\">\r\n      <mat-icon style=\"font-size: 15px;\">keyboard_arrow_up</mat-icon>\r\n    </button>\r\n    <button mat-icon-button *ngIf=\"vGroup.identification.folded\" (click)=\"vGroup.identification.folded = !vGroup.identification.folded\">\r\n      <mat-icon style=\"font-size: 15px;\">keyboard_arrow_right</mat-icon>\r\n    </button>\r\n  </div>\r\n\r\n  <div class=\"part-container\" *ngIf=\"vGroup.identification.folded\">\r\n\r\n    <div class=\"row\">\r\n\r\n      <!-- sojourn name -->\r\n      <div class=\"\" style=\"min-width: 350px;\">\r\n        <mat-form-field class=\"header\">\r\n          <mat-label>Intitulé du séjour</mat-label>\r\n          <input  type=\"text\" \r\n                  matInput \r\n                  (blur)=\"vm.name.change()\"\r\n                  [formControl]=\"vm.name.formControl\" >\r\n          <mat-hint>Libellé du regroupement.</mat-hint>\r\n          <mat-error *ngIf=\"!vm.name.formControl.hasError('required')\">\r\n            Ne peut être vide.\r\n          </mat-error>\r\n        </mat-form-field>\r\n      </div>\r\n    </div>  \r\n  </div>\r\n\r\n  <div class=\"part-container\" *ngIf=\"!vGroup.identification.folded\">\r\n\r\n    <div class=\"row\">\r\n\r\n      <!-- sojourn name -->\r\n      <div class=\"\" style=\"min-width: 350px;\">\r\n        <mat-form-field class=\"header\">\r\n          <mat-label>Intitulé du séjour</mat-label>\r\n          <input  type=\"text\" \r\n                  matInput \r\n                  (blur)=\"vm.name.change()\"\r\n                  [formControl]=\"vm.name.formControl\" >\r\n          <mat-hint>Libellé du regroupement.</mat-hint>\r\n          <mat-error *ngIf=\"!vm.name.formControl.hasError('required')\">\r\n            Ne peut être vide.\r\n          </mat-error>\r\n        </mat-form-field>\r\n      </div>\r\n  \r\n      <!-- sojourn Dates -->\r\n      <div class=\"cell\" style=\"max-width: 260px;\">\r\n        <mat-form-field >\r\n          <mat-label>Dates du séjour</mat-label>\r\n          <mat-date-range-input \r\n            [rangePicker]=\"sojournDateRangePicker\">\r\n            <input matStartDate placeholder=\"dd/mm/yyyy\" (blur)=\"vm.daterange.change()\" [formControl]=\"vm.daterange.start.formControl\">\r\n            <input matEndDate placeholder=\"dd/mm/yyyy\" (blur)=\"vm.daterange.change()\" [formControl]=\"vm.daterange.end.formControl\">\r\n          </mat-date-range-input>\r\n          <mat-datepicker-toggle matSuffix [for]=\"sojournDateRangePicker\"></mat-datepicker-toggle>\r\n          <mat-date-range-picker #sojournDateRangePicker (closed)=\"vm.daterange.change()\"></mat-date-range-picker>\r\n          <mat-hint [align]=\"'end'\"><strong>{{vm.daterange.nights_count}} {{(vm.daterange.nights_count > 1)?'nuitées':'nuitée'}}</strong></mat-hint>\r\n        </mat-form-field> \r\n      </div>\r\n  \r\n      <!-- participants -->\r\n      <div class=\"cell\" style=\"max-width: 150px;\">\r\n        <mat-form-field>\r\n          <mat-label>Participants</mat-label>\r\n          <input  type=\"number\" \r\n                  matInput \r\n                  (blur)=\"vm.participants_count.change()\"\r\n                  [value]=\"vm.participants_count.value\" \r\n                  [formControl]=\"vm.participants_count.formControl\" >\r\n          <mat-hint>Nombre d'hôtes</mat-hint>\r\n          <mat-error *ngIf=\"!vm.participants_count.formControl.hasError('required')\">\r\n            Doit être supérieur à 0.\r\n          </mat-error>\r\n        </mat-form-field>\r\n      </div>\r\n  \r\n    </div>\r\n  \r\n    <div class=\"row\">   \r\n  \r\n  \r\n  \r\n      <!-- rateClass -->\r\n      <div class=\"cell\" style=\"max-width: 250px;\">\r\n        <mat-form-field>\r\n          <mat-label>Catégorie tarifaire</mat-label>\r\n          <input  matInput\r\n                  type=\"text\"\r\n                  [matAutocomplete]=\"rateClassAutocomplete\"\r\n                  [value]=\"vm.rate_class.name\"\r\n                  (keyup)=\"vm.rate_class.inputChange($event)\"\r\n                  (focus)=\"vm.rate_class.focus()\"\r\n                  (blur)=\"vm.rate_class.restore()\"\r\n                  placeholder=\"Commencez à taper le nom\" />\r\n  \r\n          <button mat-button *ngIf=\"vm.rate_class.name.length\" matSuffix mat-icon-button aria-label=\"Clear\" (click)=\"vm.rate_class.reset()\">\r\n            <mat-icon>close</mat-icon>\r\n          </button>\r\n  \r\n          <mat-autocomplete #rateClassAutocomplete=\"matAutocomplete\" [displayWith]=\"vm.rate_class.display\" (optionSelected)=\"vm.rate_class.change($event)\">\r\n            <div  *ngIf=\"vm.rate_class.filteredList | async; let list\">\r\n              <mat-option *ngFor=\"let rate_class of list\" [value]=\"rate_class\">\r\n                {{rate_class.name}}\r\n              </mat-option>\r\n              <mat-option *ngIf=\"list.length == 0\"><i>pas de résultat</i></mat-option>\r\n            </div>\r\n          </mat-autocomplete>\r\n  \r\n          <mat-hint [align]=\"'start'\" style=\"opacity: 1\">\r\n            <span>Catégorie tarifaire de facturation</span>\r\n          </mat-hint>\r\n        </mat-form-field>\r\n      </div>\r\n  \r\n      <!-- sojourn type -->\r\n      <div class=\"cell\" style=\"max-width: 120px;\">\r\n        <mat-form-field>\r\n          <mat-label>Type de séjour</mat-label>\r\n          <mat-select [ngModel]=\"vm.sojourn_type.value\" (selectionChange)=\"vm.sojourn_type.change($event)\">\r\n            <mat-option value=\"GG\">GG</mat-option>\r\n            <mat-option value=\"GA\">GA</mat-option>\r\n          </mat-select>\r\n        </mat-form-field>\r\n      </div>\r\n  \r\n  \r\n    </div>\r\n  \r\n  \r\n    <div class=\"row\">   \r\n  \r\n      <!-- has pack -->\r\n      <div class=\"cell\" style=\"max-width: 200px;\">\r\n      <mat-form-field floatLabel=\"always\" class=\"invisible\">\r\n        <mat-slide-toggle color=\"primary\" [ngModel]=\"vm.pack.has_pack\" (change)=\"vm.pack.change('has_pack', $event.checked)\">Utiliser un pack ?</mat-slide-toggle>      \r\n        <textarea matInput hidden></textarea>\r\n      </mat-form-field>\r\n    </div>\r\n  \r\n      <!-- ref pack-->\r\n      <div class=\"cell\" style=\"max-width: 350px;\" *ngIf=\"vm.pack.has_pack\">\r\n        <mat-form-field >\r\n          <mat-label>Pack de référence</mat-label>\r\n          <input  matInput\r\n                  type=\"text\"\r\n                  [matAutocomplete]=\"packAutocomplete\"\r\n                  [value]=\"vm.pack.name\"\r\n                  (keyup)=\"vm.pack.inputChange($event)\"\r\n                  (focus)=\"vm.pack.focus()\"\r\n                  (blur)=\"vm.pack.restore()\"\r\n                  placeholder=\"Commencez à taper le nom\" />\r\n  \r\n          <button mat-button *ngIf=\"vm.pack.name.length\" matSuffix mat-icon-button aria-label=\"Clear\" (click)=\"vm.pack.reset()\">\r\n            <mat-icon>close</mat-icon>\r\n          </button>\r\n  \r\n          <mat-autocomplete #packAutocomplete=\"matAutocomplete\" [displayWith]=\"vm.pack.display\" (optionSelected)=\"vm.pack.change('name', $event.option.value)\">\r\n            <div  *ngIf=\"vm.pack.filteredList | async; let list\">\r\n              <mat-option *ngFor=\"let pack of list\" [value]=\"pack\">\r\n                {{pack.name}}\r\n              </mat-option>\r\n              <mat-option *ngIf=\"list.length == 0\"><i>pas de résultat</i></mat-option>\r\n            </div>\r\n          </mat-autocomplete>\r\n  \r\n          <mat-hint [align]=\"'start'\" style=\"opacity: 1\">\r\n            <span>Type de séjour de la réservation</span>\r\n          </mat-hint>\r\n        </mat-form-field>\r\n      </div>\r\n  \r\n      <!-- locked pack -->\r\n      <div class=\"cell\" *ngIf=\"vm.pack.has_pack\">\r\n        <mat-form-field floatLabel=\"always\" class=\"invisible\">\r\n          <mat-slide-toggle [ngModel]=\"vm.pack.is_locked\" (change)=\"vm.pack.change('is_locked', $event.checked)\">Liste des produits verrouillée</mat-slide-toggle>      \r\n          <textarea matInput hidden></textarea>\r\n        </mat-form-field>\r\n      </div>\r\n  \r\n    </div>\r\n        \r\n  </div>\r\n\r\n  \r\n</div>\r\n\r\n\r\n<!-- products -->\r\n<div class=\"part\">\r\n\r\n  <div class=\"part-toggle\">\r\n    <button mat-icon-button *ngIf=\"!vGroup.products.folded\" (click)=\"vGroup.products.folded = !vGroup.products.folded\">\r\n      <mat-icon style=\"font-size: 15px;\">keyboard_arrow_up</mat-icon>\r\n    </button>\r\n    <button mat-icon-button *ngIf=\"vGroup.products.folded\" (click)=\"vGroup.products.folded = !vGroup.products.folded\">\r\n      <mat-icon style=\"font-size: 15px;\">keyboard_arrow_right</mat-icon>\r\n    </button>\r\n  </div>\r\n  \r\n  <div class=\"part-container\">\r\n    <div class=\"row\">\r\n      <div class=\"row-products-title\">Produits <button *ngIf=\"!vm.pack.is_locked\" mat-mini-fab color=\"primary\" style=\"transform: scale(0.65);\" (click)=\"vm.lines.add()\"> <mat-icon>add</mat-icon></button></div>  \r\n      <div class=\"row-products-price\">TOTAL TTC &nbsp;:&nbsp; {{vm.price.value | number : '1.2-2'}} €</div>\r\n    </div>\r\n    <div class=\"row\" *ngIf=\"!vGroup.products.folded\">\r\n        <div style=\"width: 100%;\">\r\n          <div class=\"products-header\">\r\n            <div style=\"display: flex; width: 100%;\">\r\n              <div class=\"product-cell\" style=\"text-align: left;\">SKU</div>\r\n              <div class=\"product-cell\">QTÉ</div>\r\n              <div class=\"product-cell\">GTÉ</div>\r\n              <div class=\"product-cell\">P.U.</div>\r\n              <div class=\"product-cell\">RÉDUC</div>\r\n              <div class=\"product-cell\">TAX</div>\r\n              <div class=\"product-cell\">PRIX</div>\r\n              <!-- actions -->\r\n              <div class=\"product-cell\" style=\"max-width: 35px;\"></div>  \r\n            </div>\r\n          </div>\r\n  \r\n          <div class=\"products-list\" cdkDropList (cdkDropListDropped)=\"vm.lines.drop($event)\">\r\n            <!-- products -->\r\n            <div class=\"product-item\" cdkDrag [cdkDragData]=\"line\" *ngFor=\"let line of lines; let index = index;\">\r\n              <div class=\"product-handle\" cdkDragHandle><mat-icon style=\"font-size: 16px;\">drag_indicator</mat-icon></div>\r\n              <div class=\"product-remove\"><button *ngIf=\"!vm.pack.is_locked\" mat-icon-button (click)=\"vm.lines.remove(line)\"> <mat-icon>delete</mat-icon></button></div>\r\n              <booking-edit-bookings-group-line [groupInput]=\"group\" [lineInput]=\"_lineOutput[index]\" [lineOutput]=\"_lineInput\"></booking-edit-bookings-group-line>\r\n            </div>\r\n          </div>\r\n  \r\n        </div>\r\n\r\n    </div>\r\n  </div>\r\n  \r\n</div>\r\n\r\n\r\n<!-- accomodations -->\r\n<div class=\"part\">\r\n\r\n  <div class=\"part-toggle\">\r\n    <button mat-icon-button *ngIf=\"!vGroup.accomodations.folded\" (click)=\"vGroup.accomodations.folded = !vGroup.accomodations.folded\">\r\n      <mat-icon style=\"font-size: 15px;\">keyboard_arrow_up</mat-icon>\r\n    </button>\r\n    <button mat-icon-button *ngIf=\"vGroup.accomodations.folded\" (click)=\"vGroup.accomodations.folded = !vGroup.accomodations.folded\">\r\n      <mat-icon style=\"font-size: 15px;\">keyboard_arrow_right</mat-icon>\r\n    </button>\r\n  </div>\r\n\r\n  <div class=\"part-container\" *ngIf=\"vGroup.accomodations.folded\">\r\n    <div class=\"row\">\r\n      <div style=\"margin-top: 8px;\">Logements </div>\r\n    </div>\r\n  </div>\r\n  \r\n  <div class=\"part-container\" *ngIf=\"!vGroup.accomodations.folded\">\r\n    <div class=\"row\">\r\n      <div style=\"margin-top: 8px;\">Logements </div>  \r\n    </div>\r\n    <div class=\"row\" style=\"display: block;\">  \r\n      <div class=\"accomodation-item\" *ngFor=\"let consumption of accomodations; let index = index;\">\r\n        <booking-edit-bookings-group-accomodation [groupInput]=\"group\" [accomodationInput]=\"_accomodationOutput[index]\" [accomodationOutput]=\"_accomodationInput\"></booking-edit-bookings-group-accomodation>\r\n      </div>\r\n    </div>\r\n  </div>\r\n  \r\n</div>\r\n\r\n\r\n</div>","import { Component, Inject, OnInit, OnChanges, NgZone, Output, Input, EventEmitter, SimpleChanges } from '@angular/core';\nimport { AuthService, ApiService, ContextService } from 'sb-shared-lib';\nimport { Router, ActivatedRoute } from '@angular/router';\n\nimport { FormGroup, FormControl, Validators } from '@angular/forms';\nimport { MatDialog, MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { CdkTextareaAutosize } from '@angular/cdk/text-field';\nimport { MatAutocompleteSelectedEvent } from '@angular/material/autocomplete';\n\nimport { Observable, ReplaySubject, BehaviorSubject } from 'rxjs';\n\nimport { find, map, mergeMap, startWith, debounceTime } from 'rxjs/operators';\n\nimport { CdkDragDrop, moveItemInArray } from '@angular/cdk/drag-drop';\n\ninterface DialogCreatePartnerData {\n  owner_identity_id: number;\n  relationship: string;\n}\n\ninterface vmModel {\n  customer: {\n    name:           string,\n    inputClue:      ReplaySubject<any>,\n    filteredList:   Observable<any>,\n    inputChange:    (event:any) => void,\n    change:         (event:MatAutocompleteSelectedEvent) => void,\n    focus:          () => void,\n    restore:        () => void,\n    reset:          () => void,\n    display:        (customer:any) => string\n  },\n  payer: {\n    name:           string\n    inputClue:      ReplaySubject<any>,\n    filteredList:   Observable<any>,\n    inputChange:    (event:any) => void,\n    change:         (event:any) => void,\n    focus:          () => void,\n    restore:        () => void,\n    reset:          () => void,\n    display:        (payer:any) => string\n  }\n}\n\n@Component({\n  selector: 'booking-edit-customer',\n  templateUrl: 'booking.edit.customer.component.html',\n  styleUrls: ['booking.edit.customer.component.scss']\n})\nexport class BookingEditCustomerComponent implements OnInit  {\n\n  @Input() bookingInput: ReplaySubject<any>;\n  @Input() bookingOutput: ReplaySubject<any>;\n\n  // reference to parent's booking object for sub-object creation\n  private booking:any;\n\n  // sub-objects (not present in booking)\n  public customer:any;\n  public payer:any;\n\n  public has_payer:boolean;\n\n  public vm: vmModel;\n\n  constructor(\n              private api: ApiService,\n              private dialog: MatDialog,\n              private zone: NgZone,\n              private context:ContextService\n              ) {\n\n    this.customer = null;\n    this.has_payer = false;\n    this.payer = null;\n\n    this.vm = {\n      customer: {\n        name:           '',\n        inputClue:      new ReplaySubject(1),\n        filteredList:   new Observable(),\n        inputChange:    (event:any) => this.customerInputChange(event),\n        change:         (event:MatAutocompleteSelectedEvent) => this.customerChange(event),\n        focus:          () => this.customerFocus(),\n        restore:        () => this.customerRestore(),\n        reset:          () => this.customerReset(),\n        display:        (customer:any) => this.customerDisplay(customer)\n      },\n      payer: {\n        name:           '',\n        inputClue:      new ReplaySubject(1),\n        filteredList:   new Observable(),\n        inputChange:    (event:any) => this.payerInputChange(event),\n        change:         (event:any) => this.payerChange(event),\n        focus:          () => this.payerFocus(),\n        restore:        () => this.payerRestore(),\n        reset:          () => this.payerReset(),\n        display:        (payer:any) => this.payerDisplay(payer)\n      }\n    };\n\n  }\n\n\n  public ngOnInit() {\n\n    /**\n     * listen to the parent for changes on booking object\n     */\n    this.bookingInput.subscribe( async (booking: any) => {\n      this.zone.run( async () => {\n        try {\n          console.log('BookingEditCustomerComponent: received change from parent, updating');\n\n          this.booking = booking;\n\n          this.has_payer = booking.has_payer_organisation;\n\n          if(booking.customer_id) {\n            let data:any = await this.api.read(\"identity\\\\Partner\", [booking.customer_id], [\"id\", \"name\", \"partner_identity_id\"]);\n            if(data && data.length) {\n              let customer = data[0];\n              this.customer = customer;\n              this.vm.customer.name = customer.name;\n            }  \n          }\n\n          if(booking.payer_organisation_id) {\n            let data:any = await this.api.read(\"identity\\\\Partner\", [booking.payer_organisation_id], [\"id\", \"name\", \"partner_identity_id\"]);\n            if(data && data.length) {\n              let payer = data[0];\n              this.payer = payer;\n              this.vm.payer.name = payer.name;\n            }\n          }\n        }\n        catch(response) {}\n      });\n\n\n    });\n\n\n    // update filtered lists, based on input clues\n\n    this.vm.customer.filteredList = this.vm.customer.inputClue.pipe(\n      debounceTime(300),\n      map( (value:any) => (typeof value === 'string' ? value : (value == null)?'':value.name) ),\n      mergeMap( async (name:string) => this.filterCustomers(name) )\n    );\n\n    this.vm.payer.filteredList = this.vm.payer.inputClue.pipe(\n      debounceTime(300),\n      map( (value:any) => (typeof value === 'string' ? value : (value == null)?'':value.name) ),\n      mergeMap( async (name:string) => this.filterPayers(name) )\n    );\n\n  }\n\n  private async customerChange(event:MatAutocompleteSelectedEvent) {\n    let customer = event.option.value;\n    this.customer = customer;\n    this.vm.customer.name = customer.name;\n    this.bookingOutput.next({customer_id: this.customer.id});\n  }\n\n  private customerInputChange(event:any) {\n    this.vm.customer.inputClue.next(event.target.value);\n  }\n\n  private customerFocus() {\n    this.vm.customer.inputClue.next(\"\");\n  }\n\n  private customerDisplay(customer: any): string {\n    return customer ? customer.name : '';\n  }\n\n  private customerReset() {\n    setTimeout( () => {\n      this.vm.customer.name = '';\n    }, 100);\n  }\n\n  private customerRestore() {\n    if(this.customer) {\n      this.vm.customer.name = this.customer.name;\n    }\n    else {\n      this.vm.customer.name = '';\n    }\n  }\n\n  private payerChange(event:any) {\n    console.log('BookingEditCustomerComponent::payerChange', event);\n\n    // from mat-slide-toggle\n    if(event && event.hasOwnProperty('checked')) {\n      this.has_payer = <boolean>event.checked;\n      if(!this.has_payer) {\n        this.bookingOutput.next({payer_organisation_id: 0});\n      }  \n    }\n    // from mat-autocomplete\n    else if(event && event.option && event.option.value) {\n      let payer = event.option.value;\n      this.payer = payer;\n      this.vm.payer.name = payer.name;\n      this.bookingOutput.next({payer_organisation_id: this.payer.id, has_payer_organisation: this.has_payer});\n    }\n    \n  }\n\n  private payerInputChange(event:any) {\n    this.vm.payer.inputClue.next(event.target.value);\n  }\n\n  private payerFocus() {\n    this.vm.payer.inputClue.next(\"\");\n  }\n\n  private payerDisplay(payer: any): string {\n    return payer ? payer.name : '';\n  }\n\n  private payerReset() {\n    setTimeout( () => {\n      this.vm.payer.name = '';\n    }, 100);\n  }\n\n  private payerRestore() {\n    if(this.payer) {\n      this.vm.payer.name = this.payer.name;\n    }\n    else {\n      this.vm.payer.name = '';\n    }\n  }\n\n\n  /**\n   * Request a new eQ context for selecting a payer, and relay change to self::payerChange(), if an object was created\n   * #sb-booking-container is defined in booking.edit.component.html\n   */\n  public selectPayer() {\n    console.log(\"BookingEditCustomerComponent::selectPayer\");\n\n    let descriptor = {\n      context: {\n        entity:     'identity\\\\Partner',\n        type:       'form',\n        name:       'payer',\n        domain:     [ ['owner_identity_id', '=', this.customer.partner_identity_id], ['relationship', '=', 'payer'] ],\n        mode:       'edit',\n        purpose:    'create',\n        target:     '#sb-booking-container',\n        callback:   (data:any) => {\n          if(data && data.objects && data.objects.length) {\n            this.payerChange({option: {\n              value: data.objects[0]\n            }});\n          }\n        }\n      }\n    };\n\n    this.context.change(descriptor);\n  }\n\n  public createPayer() {\n    const dialogRef = this.dialog.open(DialogCreatePartner, {\n      width: '80vw',\n      data: {owner_identity_id: this.customer.partner_identity_id, relationship: 'payer'}\n    });\n\n    dialogRef.afterClosed().subscribe(result => {\n      console.log('The dialog was closed');\n    });\n  }\n\n  /**\n   * Search for Customers that match the name.\n   *\n   * @param name\n   * @returns\n   */\n  private async filterCustomers(name: string) {\n    let filtered:any[] = [];\n    try {\n      let data:any[] = await this.api.collect(\"identity\\\\Partner\", [[\"name\", \"ilike\", '%'+name+'%'], [\"relationship\", \"=\", \"customer\"]], [\"id\", \"name\"], 'name', 'asc', 0, 5);\n      filtered = data;\n    }\n    catch(response) {\n      console.log(response);\n    }\n    return filtered;\n  }\n\n  private async filterPayers(name: string) {\n    let filtered:any[] = [];\n    try {\n      let data:any[] = await this.api.collect(\"identity\\\\Partner\", [[\"name\", \"ilike\", '%'+name+'%'], [\"owner_identity_id\", \"=\", this.customer.partner_identity_id], [\"relationship\", \"=\", \"payer\"]], [\"id\", \"name\"], 'name', 'asc', 0, 5);\n      filtered = data;\n    }\n    catch(response) {\n      console.log(response);\n    }\n    return filtered;\n  }\n\n\n}\n\n\n\n@Component({\n  selector: 'dialog-booking-edit-customer-create-partner-dialog',\n  templateUrl: 'booking.edit.customer.create.partner.dialog.html'\n})\nexport class DialogCreatePartner {\n\n  constructor(\n    public dialogRef: MatDialogRef<DialogCreatePartner>,\n    @Inject(MAT_DIALOG_DATA) public data: DialogCreatePartnerData) {}\n\n  onNoClick(): void {\n    this.dialogRef.close();\n  }\n\n}","<div class=\"container\">\r\n\r\n    <div style=\"flex: 0 1 50%;\">\r\n        <mat-form-field style=\"width: 350px;\">\r\n          <mat-label>Client</mat-label>\r\n          <input  matInput \r\n                  type=\"text\"  \r\n                  [matAutocomplete]=\"customerAutocomplete\" \r\n                  [value]=\"vm.customer.name\" \r\n                  (keyup)=\"vm.customer.inputChange($event)\" \r\n                  (focus)=\"vm.customer.focus()\"\r\n                  (blur)=\"vm.customer.restore()\"\r\n                  placeholder=\"Commencez à taper le nom\" \r\n                  autocomplete=\"off\" />\r\n          \r\n          <button mat-button *ngIf=\"vm.customer.name.length\" matSuffix mat-icon-button aria-label=\"Clear\" (click)=\"vm.customer.reset()\">\r\n            <mat-icon>close</mat-icon>\r\n          </button>\r\n          \r\n          <mat-autocomplete #customerAutocomplete=\"matAutocomplete\" [displayWith]=\"vm.customer.display\" (optionSelected)=\"vm.customer.change($event)\">\r\n            <div *ngIf=\"vm.customer.filteredList | async; let list\">\r\n              <mat-option *ngFor=\"let customer of list\" [value]=\"customer\">\r\n                {{customer.name}}\r\n              </mat-option>\r\n              <mat-option *ngIf=\"list.length == 0\"><i>pas de résultat</i></mat-option>\r\n            </div>\r\n          </mat-autocomplete>\r\n          \r\n          <mat-hint [align]=\"'start'\" style=\"opacity: 1\">\r\n            <span>Sélection du client</span>\r\n          </mat-hint>\r\n                \r\n        </mat-form-field>       \r\n\r\n    </div>\r\n\r\n    <div style=\"flex: 0 1 50%;\">\r\n      <div>\r\n        <mat-slide-toggle [ngModel]=\"has_payer\" (change)=\"vm.payer.change($event)\">Réservation payée par une autre organisation</mat-slide-toggle>\r\n      </div>\r\n      <div *ngIf=\"has_payer\">      \r\n\r\n        <mat-form-field style=\"width: 50%;\">\r\n          <mat-label>Organisme payeur</mat-label>\r\n          <input  matInput \r\n                  type=\"text\"  \r\n                  [matAutocomplete]=\"payerAutocomplete\" \r\n                  [value]=\"vm.payer.name\" \r\n                  (keyup)=\"vm.payer.inputChange($event)\" \r\n                  (focus)=\"vm.payer.focus()\"\r\n                  (blur)=\"vm.payer.restore()\"\r\n                  placeholder=\"Commencez à taper le nom\" />\r\n          \r\n          <button mat-button *ngIf=\"vm.payer.name.length\" matSuffix mat-icon-button aria-label=\"Clear\" (click)=\"vm.payer.reset()\">\r\n            <mat-icon>close</mat-icon>\r\n          </button>\r\n          \r\n          <mat-autocomplete #payerAutocomplete=\"matAutocomplete\" [displayWith]=\"vm.payer.display\" (optionSelected)=\"vm.payer.change($event)\">\r\n            <div  *ngIf=\"vm.payer.filteredList | async; let list\">\r\n              <mat-option *ngFor=\"let payer of list\" [value]=\"payer\">\r\n                {{payer.name}}\r\n              </mat-option>\r\n              <mat-option *ngIf=\"list.length == 0\"><i>pas de résultat</i></mat-option>\r\n            </div>\r\n          </mat-autocomplete>\r\n          \r\n          <mat-hint [align]=\"'start'\" style=\"opacity: 1\">\r\n            <span>Sélection de l'organisme payeur</span>\r\n          </mat-hint>                \r\n        </mat-form-field>\r\n\r\n        <button mat-button (click)=\"selectPayer()\">Ajouter un organisme payeur</button>\r\n      </div>\r\n      \r\n\r\n\r\n    </div>\r\n\r\n</div>\r\n\r\n","<h1 mat-dialog-title>Nouveau partenaire</h1>\r\n\r\n<div mat-dialog-content>\r\n\r\n  <div style=\"display: flex; flex-direction: row; \">\r\n    <div style=\"flex: 0 1 49%; display: flex; flex-direction: column; margin: 10px;\">\r\n      <p style=\"font-weight: 500;\">Infos</p>\r\n      <mat-form-field >\r\n        <mat-label>Nom légal</mat-label>\r\n        <input matInput value=\"\" />\r\n      </mat-form-field>\r\n      <mat-slide-toggle >Assujetti à la TVA ?</mat-slide-toggle>\r\n      <mat-form-field >\r\n        <mat-label>Numéro de TVA</mat-label>\r\n        <input matInput value=\"\" />\r\n      </mat-form-field>\r\n    </div>\r\n    <div style=\"flex: 0 1 49%; display: flex; flex-direction: column; margin: 10px;\">\r\n      <p style=\"font-weight: 500;\">Adresse</p>\r\n      <mat-form-field >\r\n        <mat-label>Rue</mat-label>\r\n        <input matInput value=\"\" />\r\n      </mat-form-field>\r\n      <mat-form-field >\r\n        <mat-label>Dispatch</mat-label>\r\n        <input matInput value=\"\" />\r\n      </mat-form-field>\r\n      <mat-form-field >\r\n        <mat-label>Ville</mat-label>\r\n        <input matInput value=\"\" />\r\n      </mat-form-field>\r\n      <mat-form-field >\r\n        <mat-label>Code postal</mat-label>\r\n        <input matInput value=\"\" />\r\n      </mat-form-field>\r\n      <mat-form-field >\r\n        <mat-label>Pays</mat-label>\r\n        <input matInput value=\"\" />\r\n      </mat-form-field>\r\n    </div>    \r\n  </div>\r\n\r\n\r\n  <mat-form-field >\r\n    <mat-label>Favorite Animal</mat-label>\r\n    <input matInput value=\"\" />\r\n  </mat-form-field>\r\n\r\n</div>\r\n\r\n<div mat-dialog-actions>\r\n  <button mat-button (click)=\"onNoClick()\">Annuler</button>\r\n  <button mat-button [mat-dialog-close]=\"data\" cdkFocusInitial>Créer</button>\r\n</div>","import { Component, Inject, OnInit, OnChanges, NgZone, Output, Input, EventEmitter, SimpleChanges } from '@angular/core';\nimport { AuthService, ApiService, ContextService } from 'sb-shared-lib';\nimport { Router, ActivatedRoute } from '@angular/router';\n\nimport { FormBuilder, FormGroup, FormControl, Validators } from '@angular/forms';\nimport { MatDialog, MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { CdkTextareaAutosize } from '@angular/cdk/text-field';\nimport { MatAutocompleteSelectedEvent } from '@angular/material/autocomplete';\n\nimport { Observable, ReplaySubject, BehaviorSubject } from 'rxjs';\n\nimport { find, map, mergeMap, startWith, debounceTime } from 'rxjs/operators';\n\nimport { CdkDragDrop, moveItemInArray } from '@angular/cdk/drag-drop';\nimport { type } from 'jquery';\n\ninterface ContactModel {\n  firstname:        string;\n  lastname:         string;\n  type:             string;\n  email:            string;\n  phone:            string;\n  relationship:     string;\n}\n\ninterface vmModel {\n  center: {\n    name:           string,\n    inputClue:      ReplaySubject<any>,\n    filteredList:   Observable<any>,\n    inputChange:    (event:any) => void,\n    change:         (event:MatAutocompleteSelectedEvent) => void,\n    focus:          () => void,\n    restore:        () => void,\n    reset:          () => void,\n    display:        (center:any) => string\n  },\n  type: {\n    name:           string\n    inputClue:      ReplaySubject<any>,\n    filteredList:   Observable<any>,\n    inputChange:    (event:any) => void,\n    change:         (event:any) => void,\n    focus:          () => void,\n    restore:        () => void,\n    reset:          () => void,\n    display:        (type:any) => string\n  },\n  description: {\n    value:          string,\n    change:         (event:any) => void\n  },\n  contacts: {\n    values:         Array<any>,\n    fields:         Array<any>,\n    list:           ReplaySubject<any>,\n    create:         () => void,\n    remove:         (id:number) => void\n  }\n}\n\n@Component({\n  selector: 'booking-edit-sojourn',\n  templateUrl: 'booking.edit.sojourn.component.html',\n  styleUrls: ['booking.edit.sojourn.component.scss']\n})\nexport class BookingEditSojournComponent implements OnInit  {\n\n  @Input() bookingInput: ReplaySubject<any>;\n  @Input() bookingOutput: ReplaySubject<any>;\n\n  // reference to parent's booking object for sub-object creation\n  private booking:any;\n\n  // sub-objects (not present in booking)\n  public center:any;\n  public type:any;\n  public customer:any;\n\n  public has_payer:boolean;\n\n  public vm: vmModel;\n\n  constructor(\n              private api: ApiService,\n              private auth: AuthService,\n              private dialog: MatDialog,\n              private zone: NgZone,\n              private context:ContextService\n              ) {\n\n    this.booking = null;\n    this.center = null;\n    this.type = null;\n\n    this.vm = {\n      center: {\n        name:           '',\n        inputClue:      new ReplaySubject(1),\n        filteredList:   new Observable(),\n        change:         (event:MatAutocompleteSelectedEvent) => this.centerChange(event),\n        inputChange:    (event:any) => this.centerInputChange(event),\n        focus:          () => this.centerFocus(),\n        restore:        () => this.centerRestore(),\n        reset:          () => this.centerReset(),\n        display:        (center:any) => this.centerDisplay(center)\n      },\n      type: {\n        name:           '',\n        inputClue:      new ReplaySubject(1),\n        filteredList:   new Observable(),\n        change:         (event:any) => this.typeChange(event),\n        inputChange:    (event:any) => this.typeInputChange(event),\n        focus:          () => this.typeFocus(),\n        restore:        () => this.typeRestore(),\n        reset:          () => this.typeReset(),\n        display:        (type:any) => this.typeDisplay(type)\n      },\n      description: {\n        value:          '',\n        change:         (event:any) => this.descriptionChange(event)\n      },\n      contacts: {\n        values:         [],\n        fields:         ['name', 'type', 'email', 'phone', '_actions'],\n        list:           new ReplaySubject(1),\n        create:         () => this.createContact(),\n        remove:         (id:number) => this.removeContact(id)\n      }\n    };\n\n  }\n\n\n  public ngOnInit() {\n    this.vm.contacts.list.subscribe( (value) => {\n      console.log(\"contact list: received new value\", value);\n    });\n\n    /**\n     * listen to the parent for changes on booking object\n     */\n    this.bookingInput.subscribe( async (booking: any) => {\n      this.zone.run( async () => {\n        try {\n          console.log(\"BookingEditSojournComponent: received changes from parent\", booking);\n\n          this.booking = booking;\n\n          if(booking.customer_id) {\n            let data:any = await this.api.read(\"identity\\\\Partner\", [booking.customer_id], [\"id\", \"name\", \"partner_identity_id\"]);\n            if(data && data.length) {\n              let customer = data[0];\n              this.customer = customer;\n            }  \n          }\n\n          if(booking.center_id) {          \n            let data:any = await this.api.read(\"lodging\\\\identity\\\\Center\", [booking.center_id], [\"id\", \"name\", \"code\", \"organisation_id\"]);\n            if(data && data.length) {\n              let center = data[0];\n              this.center = center;\n              this.vm.center.name = center.name;\n            }\n          }\n\n          if(booking.type_id) {\n            let data:any = await this.api.read(\"sale\\\\booking\\\\BookingType\", [booking.type_id], [\"id\", \"name\", \"code\"]);\n            if(data && data.length) {\n              let type = data[0];\n              this.type = type;\n              this.vm.type.name = type.name;\n            }\n          }\n\n          if(booking.description && booking.description.length) {\n            this.vm.description.value = booking.description;\n          }\n\n          if(booking.contacts_ids) {\n            let data:any = await this.api.read(\"sale\\\\booking\\\\Contact\", booking.contacts_ids, [\"id\", \"name\", \"type\"]);\n            console.log(booking.contacts_ids, data);\n            if(data && data.length) {\n              this.vm.contacts.values = data;\n              this.vm.contacts.list.next(data);\n            }\n          }\n          \n        }\n        catch(response) {}\n      });\n\n\n    });\n\n\n    // update filtered lists, based on input clues\n\n    this.vm.center.filteredList = this.vm.center.inputClue.pipe(\n      debounceTime(300),\n      map( (value:any) => (typeof value === 'string' ? value : (value == null)?'':value.name) ),\n      mergeMap( async (name:string) => this.filterCenters(name) )\n    );\n\n    this.vm.type.filteredList = this.vm.type.inputClue.pipe(\n      debounceTime(300),\n      map( (value:any) => (typeof value === 'string' ? value : (value == null)?'':value.name) ),\n      mergeMap( async (name:string) => this.filterTypes(name) )\n    );\n\n  }\n\n  private async centerChange(event:MatAutocompleteSelectedEvent) {\n    let center = event.option.value;\n    this.center = center;\n    this.vm.center.name = center.name;\n\n    // relay change to parent component\n    this.bookingOutput.next({center_id: this.center.id});\n  }\n\n  private centerFocus() {\n    this.vm.center.inputClue.next(\"\");\n  }\n\n  private centerInputChange(event:any) {\n    this.vm.center.inputClue.next(event.target.value);\n  }\n\n  private centerDisplay(center:any): string {\n    return center ? center.name: '';\n  }\n\n  private centerReset() {\n    setTimeout( () => {\n      this.vm.center.name = '';\n    }, 100);\n  }\n\n  private centerRestore() {\n    if(this.center) {\n      this.vm.center.name = this.center.name;\n    }\n    else {\n      this.vm.center.name = '';\n    }\n  }\n\n  private descriptionChange(event:any) {\n    console.log('BookingEditCustomerComponent::descriptionChange', event);\n    let description = event.target.value;\n    // relay change to parent component\n    this.bookingOutput.next({description: description});\n  }\n\n  private typeChange(event:any) {\n    console.log('BookingEditCustomerComponent::typeChange', event)\n\n    // from mat-autocomplete\n    if(event && event.option && event.option.value) {\n      let type = event.option.value;\n      this.type = type;\n      this.vm.type.name = type.name;\n      // relay change to parent component\n      this.bookingOutput.next({type_id: type.id});\n    }\n\n  }\n\n  private typeInputChange(event:any) {\n    this.vm.type.inputClue.next(event.target.value);\n  }\n\n  private typeFocus() {\n    this.vm.type.inputClue.next(\"\");\n  }\n\n  private typeDisplay(type:any): string {\n    return type ? type.name: '';\n  }\n\n  private typeReset() {\n    setTimeout( () => {\n      this.vm.type.name = '';\n    }, 100);\n  }\n\n  private typeRestore() {\n    if(this.type) {\n      this.vm.type.name = this.type.name;\n    }\n    else {\n      this.vm.type.name = '';\n    }\n  }\n\n  /**\n   * Permanently remove the contact (but not the identity) from the booking.\n   * \n   * @param id \n   */\n  private async removeContact(id:number) {\n    try {\n      const identity = await this.api.remove(\"sale\\\\booking\\\\Contact\", [id], true);\n      let index = this.vm.contacts.values.findIndex( (element) => element.id == id);\n      this.vm.contacts.values.splice(index, 1);\n      this.vm.contacts.list.next([...this.vm.contacts.values]);\n    }\n    catch(response) {\n      console.warn(response);\n    }\n  }\n\nprivate createContact() {\n  let user = this.auth.getUser();\n\n  let descriptor = {\n    context: {\n      entity:     'sale\\\\booking\\\\Contact',\n      type:       'form',\n      name:       'default',\n      domain:     [ ['booking_id', '=', this.booking.id], ['owner_identity_id', '=', this.customer.partner_identity_id], ['relationship', '=', 'contact'], ['type', '=', 'booking'] ],\n      mode:       'edit',\n      purpose:    'create',\n      target:     '#sb-booking-container',\n      callback:   (data:any) => {\n        if(data && data.objects && data.objects.length) {\n            let contact = data.objects[0];\n            let contacts_ids = this.vm.contacts.values.map( (elem) => elem.id );\n            contacts_ids.push(contact.id);\n            this.bookingOutput.next({contacts_ids: contacts_ids});\n        }\n      }\n    }\n  };\n\n  this.context.change(descriptor);\n}\n\n  private alternateCreateContact() {\n    const dialogRef = this.dialog.open(DialogCreateContact, {\n      width: '80vw',\n      data: { relationship: 'contact', type: 'booking' }\n    });\n\n    dialogRef.afterClosed().subscribe( async (data) => {\n      if(data) {\n        console.log(data);\n\n        // 1) create a new identity, and get the ID \n        try {\n          const identity = await this.api.create(\"identity\\\\Identity\", {\n            firstname: data.firstname,\n            lastname: data.lastname,\n            email: data.email,\n            phone: data.phone\n          });\n          // 2) create a partner with customer_id from booking as owner_identity_id and new identity ID as partner_identity_id\n          try {\n            let user = this.auth.getUser();\n            const contact = await this.api.create(\"sale\\\\booking\\\\Contact\", {\n              // owner is the organisation of current user\n              owner_identity_id: user.organisation_id,\n              partner_identity_id: identity.id,\n              booking_id: this.booking.id,\n              type: data.type\n            });\n\n            // update VM list of contacts\n            this.vm.contacts.values.push({\n              id: contact.id,\n              name: data.firstname + ' ' + data.lastname,\n              type: data.type,\n              email: data.email,\n              phone: data.phone\n            });\n              \n            this.vm.contacts.list.next([...this.vm.contacts.values]);\n\n          }\n          catch(response) {\n            console.warn(response);\n          }\n\n        }\n        catch(response) {\n          console.warn(response);\n        }\n\n\n      }\n    });\n  }\n\n  /**\n   * Search for Customers that match the name.\n   *\n   * @param name\n   * @returns\n   */\n  private async filterCenters(name: string) {\n    let filtered:any[] = [];\n    // server will return only centers visible for current User\n    try {\n      let data:any[] = await this.api.collect(\"lodging\\\\identity\\\\Center\", [[\"name\", \"ilike\", '%'+name+'%']], [\"id\", \"name\"], 'name', 'asc', 0, 5);\n      filtered = data;\n    }\n    catch(response) {\n      console.log(response);\n    }\n    return filtered;\n  }\n\n  private async filterTypes(name: string) {\n    let filtered:any[] = [];\n    try {\n      let data:any[] = await this.api.collect(\"sale\\\\booking\\\\BookingType\", [[\"name\", \"ilike\", '%'+name+'%']], [\"id\", \"name\"], 'name', 'asc', 0, 25);\n      filtered = data;\n    }\n    catch(response) {\n      console.log(response);\n    }\n    return filtered;\n  }\n\n\n}\n\n\n\n@Component({\n  selector: 'dialog-booking-edit-customer-create-contact-dialog',\n  templateUrl: 'booking.edit.customer.create.contact.dialog.html'\n})\nexport class DialogCreateContact {\n\n  public form: FormGroup;\n\n  get f() { return this.form.controls; }\n    \n  constructor(\n    public dialogRef: MatDialogRef<DialogCreateContact>,\n    private formBuilder: FormBuilder,\n    @Inject(MAT_DIALOG_DATA) private data: ContactModel) {\n\n      this.form = this.formBuilder.group({\n        firstname: [this.data ? this.data.firstname : '', Validators.required],\n        lastname: [this.data ? this.data.lastname : '', Validators.required],\n        type: [this.data ? this.data.type : 'booking', Validators.required],\n        email: [this.data ? this.data.email : '', [Validators.required,Validators.email]],\n        phone: [this.data ? this.data.phone : ''],\n      })\n  }\n\n  private markFormGroupTouched(formGroup: FormGroup) {\n    (<any>Object).values(formGroup.controls).forEach( (control:any) => {\n      control.markAsTouched();\n      if (control.controls) {\n        this.markFormGroupTouched(control);\n      }\n    });\n  }\n\n  onCancel(): void {\n    this.dialogRef.close();\n  }\n\n  onSubmit() {\n    // stop here if form is invalid\n    if (this.form.invalid) {\n      return this.markFormGroupTouched(this.form);\n    }\n    \n    this.dialogRef.close({\n      firstname: this.form.value.firstname,\n      lastname: this.form.value.lastname,\n      type: this.form.value.type,\n      email: this.form.value.email,\n      phone: this.form.value.phone  \n    });\n\n  }\n\n}","<div class=\"container\">\r\n\r\n    <mat-tab-group style=\"width: 100%;\">\r\n\r\n      <mat-tab label=\"Détails\">\r\n\r\n        <div style=\"display: flex; flex-direction: column;\">\r\n\r\n          <p style=\"font-weight: 500;\">Informations du séjour</p>\r\n\r\n          <div style=\"flex: 1; display: flex;\">\r\n\r\n          <!-- Center selection -->\r\n          <mat-form-field style=\"width: 350px;\">\r\n            <mat-label>Centre</mat-label>\r\n            <input  matInput\r\n                    type=\"text\"\r\n                    [matAutocomplete]=\"centerAutocomplete\"\r\n                    [value]=\"vm.center.name\"\r\n                    (keyup)=\"vm.center.inputChange($event)\"\r\n                    (focus)=\"vm.center.focus()\"\r\n                    (blur)=\"vm.center.restore()\"\r\n                    placeholder=\"Commencez à taper le nom\" />\r\n\r\n            <button mat-button *ngIf=\"vm.center.name.length\" matSuffix mat-icon-button aria-label=\"Clear\" (click)=\"vm.center.reset()\">\r\n              <mat-icon>close</mat-icon>\r\n            </button>\r\n\r\n            <mat-autocomplete #centerAutocomplete=\"matAutocomplete\" [displayWith]=\"vm.center.display\" (optionSelected)=\"vm.center.change($event)\">\r\n              <div  *ngIf=\"vm.center.filteredList | async; let list\">\r\n                <mat-option *ngFor=\"let center of list\" [value]=\"center\">\r\n                  {{center.name}}\r\n                </mat-option>\r\n                <mat-option *ngIf=\"list.length == 0\"><i>pas de résultat</i></mat-option>\r\n              </div>\r\n            </mat-autocomplete>\r\n\r\n            <mat-hint [align]=\"'start'\" style=\"opacity: 1\">\r\n              <span>Sélection du centre</span>\r\n            </mat-hint>\r\n          </mat-form-field>\r\n\r\n          <!-- Booking type selection -->\r\n          <mat-form-field style=\"width: 50%;\">\r\n            <mat-label>Type de réservation</mat-label>\r\n            <input  matInput\r\n                    type=\"text\"\r\n                    [matAutocomplete]=\"typeAutocomplete\"\r\n                    [value]=\"vm.type.name\"\r\n                    (keyup)=\"vm.type.inputChange($event)\"\r\n                    (focus)=\"vm.type.focus()\"\r\n                    (blur)=\"vm.type.restore()\"\r\n                    placeholder=\"Commencez à taper le nom\" />\r\n\r\n            <button mat-button *ngIf=\"vm.type.name.length\" matSuffix mat-icon-button aria-label=\"Clear\" (click)=\"vm.type.reset()\">\r\n              <mat-icon>close</mat-icon>\r\n            </button>\r\n\r\n            <mat-autocomplete #typeAutocomplete=\"matAutocomplete\" [displayWith]=\"vm.type.display\" (optionSelected)=\"vm.type.change($event)\">\r\n              <div  *ngIf=\"vm.type.filteredList | async; let list\">\r\n                <mat-option *ngFor=\"let type of list\" [value]=\"type\">\r\n                  {{type.name}}\r\n                </mat-option>\r\n                <mat-option *ngIf=\"list.length == 0\"><i>pas de résultat</i></mat-option>\r\n              </div>\r\n            </mat-autocomplete>\r\n\r\n            <mat-hint [align]=\"'start'\" style=\"opacity: 1\">\r\n              <span>Type de séjour de la réservation</span>\r\n            </mat-hint>\r\n          </mat-form-field>\r\n\r\n          </div>\r\n\r\n\r\n\r\n\r\n          <!-- description -->\r\n          <div style=\"flex: 1; width: 100%; margin-top: 20px;\">\r\n            <mat-form-field style=\"width: 100%;\">\r\n              <mat-label>Description</mat-label>\r\n              <textarea matInput\r\n                        cdkTextareaAutosize\r\n                        cdkAutosizeMinRows=\"3\"\r\n                        cdkAutosizeMaxRows=\"20\"\r\n                        placeholder=\"Indiquez des détails ou spécificités du séjour\" \r\n                        [ngModel]=\"vm.description.value\" \r\n                        (change)=\"vm.description.change($event)\"></textarea>\r\n            </mat-form-field>\r\n          </div>\r\n\r\n      </div>\r\n\r\n      </mat-tab>\r\n\r\n\r\n\r\n      <mat-tab label=\"Contacts\">\r\n        <p style=\"font-weight: 500;\">Liste des contacts <button mat-mini-fab color=\"primary\" style=\"transform: scale(0.65);\" (click)=\"vm.contacts.create()\"> <mat-icon>add</mat-icon></button></p>\r\n        <!-- list of contacts -->\r\n        <table mat-table [dataSource]=\"vm.contacts.list | async\" style=\"width: 100%;\">\r\n\r\n          <!-- Name Column -->\r\n          <ng-container matColumnDef=\"name\">\r\n            <th mat-header-cell *matHeaderCellDef> Nom </th>\r\n            <td mat-cell *matCellDef=\"let element\"> {{element.name}} </td>\r\n          </ng-container>\r\n\r\n          <!-- Type Column -->\r\n          <ng-container matColumnDef=\"type\">\r\n            <th mat-header-cell *matHeaderCellDef> Type </th>\r\n            <td mat-cell *matCellDef=\"let element\"> {{element.type}} </td>\r\n          </ng-container>\r\n\r\n          <!-- Email Column -->\r\n          <ng-container matColumnDef=\"email\">\r\n            <th mat-header-cell *matHeaderCellDef> Email </th>\r\n            <td mat-cell *matCellDef=\"let element\"> {{element.email}} </td>\r\n          </ng-container>\r\n\r\n          <!-- Phone Column -->\r\n          <ng-container matColumnDef=\"phone\">\r\n            <th mat-header-cell *matHeaderCellDef> Tél </th>\r\n            <td mat-cell *matCellDef=\"let element\"> {{element.phone}} </td>\r\n          </ng-container>\r\n\r\n          <ng-container matColumnDef=\"_actions\">\r\n            <th mat-header-cell *matHeaderCellDef>  </th>\r\n            <td mat-cell *matCellDef=\"let element\">\r\n              <button mat-icon-button color=\"primary\" (click)=\"vm.contacts.remove(element.id)\">\r\n                <mat-icon>delete</mat-icon>\r\n             </button>\r\n            </td>\r\n          </ng-container>\r\n\r\n          <tr mat-header-row *matHeaderRowDef=\"vm.contacts.fields\"></tr>\r\n          <tr mat-row *matRowDef=\"let row; columns: vm.contacts.fields;\"></tr>\r\n        </table>\r\n      </mat-tab>\r\n\r\n\r\n    </mat-tab-group>\r\n\r\n</div>","<h1 mat-dialog-title>Nouveau contact pour la réservation</h1>\r\n\r\n<div mat-dialog-content>\r\n  <form [formGroup]=\"form\" (ngSubmit)=\"onSubmit()\">\r\n  <div style=\"display: flex; flex-direction: row; \">\r\n    <div style=\"flex: 0 1 49%; display: flex; flex-direction: column; margin: 10px;\">\r\n      <p style=\"font-weight: 500;\">Infos</p>\r\n\r\n      <mat-form-field >\r\n        <mat-label>Prénom</mat-label>\r\n        <input matInput formControlName=\"firstname\"/>\r\n        <mat-error *ngIf=\"f.firstname.errors?.required\">\r\n          Ce champ doit être rempli.\r\n        </mat-error>\r\n      </mat-form-field>\r\n\r\n      <mat-form-field >\r\n        <mat-label>Nom</mat-label>\r\n        <input matInput formControlName=\"lastname\" />\r\n        <mat-error *ngIf=\"f.lastname.errors?.required\">\r\n          Ce champ doit être rempli.\r\n        </mat-error>\r\n      </mat-form-field>\r\n\r\n      <mat-form-field>\r\n        <mat-label>Type de contact</mat-label>\r\n        <mat-select formControlName=\"type\" >\r\n          <mat-option value=\"booking\">réservation</mat-option>\r\n          <mat-option value=\"invoice\">facturation</mat-option>\r\n          <mat-option value=\"contract\">contrats</mat-option>\r\n          <mat-option value=\"sojourn\">séjour</mat-option>\r\n        </mat-select>\r\n      </mat-form-field>\r\n\r\n    </div>\r\n\r\n    <div style=\"flex: 0 1 49%; display: flex; flex-direction: column; margin: 10px;\">\r\n      <p style=\"font-weight: 500;\">Coordonnées</p>\r\n\r\n      <mat-form-field >\r\n        <mat-label>Email</mat-label>\r\n        <input matInput formControlName=\"email\" />\r\n      </mat-form-field>\r\n\r\n      <mat-form-field >\r\n        <mat-label>Phone</mat-label>\r\n        <input matInput formControlName=\"phone\" />\r\n      </mat-form-field>\r\n\r\n    </div>\r\n\r\n  </div>\r\n  </form>\r\n</div>\r\n\r\n<div mat-dialog-actions style=\"justify-content: flex-end;\">\r\n  <button mat-button (click)=\"onCancel()\">Annuler</button>\r\n  <button mat-button (click)=\"onSubmit()\" cdkFocusInitial>Ok</button>\r\n</div>"],"sourceRoot":"webpack:///"}